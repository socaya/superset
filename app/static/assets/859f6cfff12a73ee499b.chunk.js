"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9427],{35942:(t,e,o)=>{o.d(e,{S:()=>h});var n=o(2404),r=o.n(n),a=o(2445),l=o(24002),i=o(88813),s=o(16226),c=o(67413),u=o(81465),p=o(7566);const d=u.I4.div`
  ${({theme:t,top:e,left:o,variant:n})=>`\n    position: absolute;\n    top: ${e}px;\n    left: ${o}px;\n    zIndex: 9;\n    pointerEvents: none;\n    ${"default"===n?`\n      padding: ${2*t.sizeUnit}px;\n      margin: ${2*t.sizeUnit}px;\n      background: ${t.colorBgElevated};\n      color: ${t.colorText};\n      maxWidth: 300px;\n      fontSize: ${t.fontSizeSM}px;\n      border: 1px solid ${t.colorBorder};\n      border-radius: ${t.borderRadius}px;\n      box-shadow: ${t.boxShadowSecondary};\n    `:`\n      margin: ${3*t.sizeUnit}px;\n    `}\n  `}
`;function f(t){const{tooltip:e,variant:o="default"}=t;if(null==e)return null;const{x:n,y:r,content:l}=e,i="string"==typeof l?(0,p.nn)(l):l;return(0,a.Y)(d,{top:r,left:n,variant:o,children:i})}var m=o(51316);const v=(0,l.memo)((0,l.forwardRef)((t,e)=>{var o;const[n,u]=(0,l.useState)(null),[p,d]=(0,l.useState)(null),[v,h]=(0,l.useState)(t.viewport),g=(0,c.Z)(t.viewport),b=(0,l.useRef)(null);(0,l.useEffect)(()=>()=>{var t;null==(t=b.current)||null==(t=t.getExtension("WEBGL_lose_context"))||t.loseContext()},[]),(0,l.useImperativeHandle)(e,()=>({setTooltip:u}),[]);const w=(0,l.useCallback)(()=>{if(p&&Date.now()-p>250){const e=t.setControlValue;e&&e("viewport",v),d(null)}},[p,t.setControlValue,v]);(0,l.useEffect)(()=>{const t=setInterval(w,250);return clearInterval(t)},[w]),(0,l.useEffect)(()=>{r()(t.viewport,g)||h(t.viewport)},[g,t.viewport]);const x=(0,l.useCallback)(({viewState:t})=>{h(t),d(Date.now())},[]),y=(0,l.useCallback)(()=>{var e,o;return(null!=(e=t.mapStyle)&&e.startsWith(m.GU)||m.hw.some(e=>{var o;return null==(o=t.mapStyle)?void 0:o.includes(e)}))&&!1===t.layers.some(t=>"function"!=typeof t&&"tile-layer"===(null==t?void 0:t.id))&&t.layers.unshift((0,m.Up)((null!=(o=t.mapStyle)?o:"").replace(m.GU,""),"tile-layer")),t.layers.some(t=>"function"==typeof t)?t.layers.map(t=>"function"==typeof t?t():t):t.layers},[t.layers,t.mapStyle]),{children:C=null,height:S,width:k}=t;return(0,a.FD)(a.FK,{children:[(0,a.FD)("div",{style:{position:"relative",width:k,height:S},onContextMenu:t=>{t.preventDefault(),t.stopPropagation()},children:[(0,a.Y)(s.A,{controller:!0,width:k,height:S,layers:y(),viewState:v,onViewStateChange:x,onAfterRender:t=>{b.current=t.gl},children:(null==(o=t.mapStyle)?void 0:o.startsWith(m.Pn))&&(0,a.Y)(i.b,{preserveDrawingBuffer:!0,mapStyle:t.mapStyle||"light",mapboxApiAccessToken:t.mapboxApiAccessToken})}),C]}),(_=n,_?(E=_.content,(0,l.isValidElement)(E)&&"custom"===(null==(D=E.props)?void 0:D["data-tooltip-type"])?(0,a.Y)(f,{tooltip:_,variant:"custom"}):(0,a.Y)(f,{tooltip:_})):null)]});var _,E,D})),h=(0,u.I4)(v)`
  .deckgl-tooltip > div {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`},48238:(t,e,o)=>{o.d(e,{A:()=>s});var n=o(55016),r=o(71960);const a=[-90,90],l=[-180,180];function i([t,e],[o,n],r=.25){return t<e?[t,e]:[Math.max(o,t-r),Math.min(n,e+r)]}function s(t,{points:e,width:o,height:s,minExtent:c,maxZoom:u,offset:p,padding:d=20}){const{bearing:f,pitch:m}=t,v=function(t){const e=i((0,r.extent)(t,t=>t[1]),a),o=i((0,r.extent)(t,t=>t[0]),l);return[[o[0],e[0]],[o[1],e[1]]]}(e);try{return{...(0,n.Fe)({bounds:v,width:o,height:s,minExtent:c,maxZoom:u,offset:p,padding:d}),bearing:f,pitch:m}}catch(t){console.error("Could not fit viewport",t)}return t}},50871:(t,e,o)=>{o.r(e),o.d(e,{hexToRGB:()=>r});var n=o(89040);function r(t,e=255){if(!t)return[0,0,0,e];const{r:o,g:r,b:a}=(0,n.Qh)(t);return[o,r,a,e]}},51316:(t,e,o)=>{o.d(e,{BK:()=>w,Fe:()=>p,GU:()=>m,L6:()=>g,LC:()=>u,Pn:()=>f,Up:()=>x,hw:()=>v,y1:()=>b});var n=o(71960),r=o(67216),a=o(96469),l=o(49785),i=o(65916),s=o(51803),c=o(50871);const u=[0,0,0,0],p=[255,0,0,255],d=10,f="mapbox://",m="tile://",v=["openstreetmap","osm"];function h({break_points:t,num_buckets:e},o,r){if(!o)return[];if(void 0===t||0===t.length){const t=e?parseInt(e,10):d,[a,l]=(0,n.extent)(o,r).map(t=>"string"==typeof t?parseFloat(t):t);if(void 0===a||void 0===l)return[];if(!Number.isFinite(a)||!Number.isFinite(l))return[];const i=(l-a)/t,s=0===i?0:Math.max(0,Math.ceil(Math.log10(1/i)));return new Array(t+1).fill(0).map((e,o)=>{const n=a+o*i;if(0===o){const t=Math.pow(10,s);return(Math.floor(a*t)/t).toFixed(s)}if(o===t){const t=Math.pow(10,s);return(Math.ceil(l*t)/t).toFixed(s)}return n.toFixed(s)})}return t.sort((t,e)=>parseFloat(t)-parseFloat(e))}function g({break_points:t,num_buckets:e,linear_color_scheme:o,opacity:i},s,p){const d=t||e?h({break_points:t,num_buckets:e},s,p):null,f=Array.isArray(o)?new l.A({colors:o,id:"custom"}):(0,a.A)().get(o);if(!f)return()=>u;let m,v;if(null!==d){const t=d.length-1,e=t>1?f.getColors(t):[f.colors[f.colors.length-1]],o=e[0],n=e[e.length-1];e.unshift(o),e.push(n);const a=d.map(parseFloat);m=(0,r.A)().domain(a).range(e),v=t=>!!t&&(t>a[a.length-1]||t<a[0])}else{const t=(0,n.extent)(s,p);m=t.some(t=>"number"==typeof t)?f.createLinearScale((0,n.extent)(s,p)):f.createLinearScale(),v=()=>!1}return t=>{const e=p(t);if(!e)return u;const o=(0,c.hexToRGB)(m(e));return v(e)?o[3]=0:o[3]=i/100*255,o}}function b(t,e,o){const n=h(t,e,o),r=g(t,e,o),a={};return n.slice(1).forEach((e,o)=>{const l=`${n[o]} - ${n[o+1]}`,i=.5*(parseFloat(n[o])+parseFloat(n[o+1])),s=t.metric?t.metric.label||t.metric:null;a[l]={color:null==r?void 0:r({[s||t.metric]:i}),enabled:!0}}),a}function w(t){const e=t||[],o={};return e&&e.length?(e.forEach(t=>{const e=`${t.minValue} - ${t.maxValue}`;o[e]={color:[t.color.r,t.color.g,t.color.b],enabled:!0}}),o):o}function x(t,e){return new i.A({data:t,id:e,minZoom:0,maxZoom:19,tileSize:256,renderSubLayers:t=>{const{west:e,north:o,east:n,south:r}=t.tile.bbox;return[new s.A(t,{data:void 0,image:t.data,bounds:[e,r,n,o]})]}})}},52480:(t,e,o)=>{o.d(e,{A:()=>r});var n=o(2445);const r=({label:t,value:e})=>(0,n.FD)("div",{children:[t,(0,n.Y)("strong",{children:e})]})},83860:(t,e,o)=>{o.d(e,{T$:()=>m,g_:()=>g,JV:()=>b,XC:()=>w});var n=o(24002),r=o(71960),a=o(98456),l=o(55241),i=o.n(l);const s=({position:t,positions:e,positionBounds:o,spatialData:n})=>{const{lonCol:r,latCol:a,lonlatCol:l,geohashCol:s,reverseCheckbox:c,type:u,delimiter:p}=n;let d,f=[],m=[];if(!t&&!e&&!o)throw new Error("Position of picked data is required");switch(u){case"latlong":if(null!=r&&null!=a){const n=[r,a];e&&e.length>0?(f=e,d=n.join(", "),m=[{col:r,op:"IN",val:e.map(t=>t[0])},{col:a,op:"IN",val:e.map(t=>t[1])}]):t?(f=t,d=n.join(", "),m=[...n.map((e,o)=>({col:e,op:"==",val:t[o]}))]):o&&(f=[o.from,o.to],d=`From ${r}, ${a} to ${r}, ${a}`,m=[...n.map((t,e)=>({col:t,op:">=",val:o.from[e]})),...n.map((t,e)=>({col:t,op:"<=",val:o.to[e]}))])}break;case"delimited":{const o=null!=l?l:s;if(!o)throw new Error("Column is required");if(e&&e.length>0){const t=e.map(t=>(c?[...t].reverse():t).join(p));f=t,m=[{col:o,op:"IN",val:t}]}else if(t){const e=(c?t.reverse():t).join(p);f=[e],m=[{col:o,op:"==",val:e}]}break}case"geohash":{const o=null!=l?l:s;if(!o)throw new Error("Column is required");if(e&&e.length>0){const t=e.map(t=>{const[e,o]=t;return i().encode(o,e,12)});f=t,m=[{col:o,op:"IN",val:t}]}else if(t){const[e,n]=t,r=i().encode(n,e,12);f=[r],m=[{col:o,op:"==",val:r}]}break}default:f=[]}return{filters:m,values:f,customColumnLabel:d}},c=({latCol:t,lonCol:e,geohashCol:o,line_column:n})=>t&&e?`${t}, ${e}`:o||n||"",u=({data:t,filterState:e,formData:o})=>{var n,r;let a,l=[],i=[];if(o.start_spatial&&o.end_spatial){const e=(({formData:t,data:e})=>{var o,n;const r=null==(o=e.object)?void 0:o.sourcePosition,a=null==(n=e.object)?void 0:n.targetPosition;if(!r||!a)throw new Error("Position of picked data is required");if(!t.start_spatial||!t.end_spatial)throw new Error("Spatial data is required");const l=`Start ${c(t.start_spatial)} end ${c(t.end_spatial)}`,i=s({position:r,spatialData:t.start_spatial}),u=s({position:a,spatialData:t.end_spatial});if(!i||!u)throw new Error("Failed to generate filters");return{values:[i.values,u.values],filters:[...i.filters||[],...u.filters||[]],customColumnLabel:l}})({formData:o,data:t});({values:l,filters:i,customColumnLabel:a}=e)}else if(null!=(n=o.spatial)&&n.type){const n=(({formData:t,data:e,filterState:o})=>{var n;const r=null==(n=e.object)||null==(n=n.points)?void 0:n.map(t=>t.position);let a;if(!r&&e.coordinate&&e.viewport&&(a=(({pickedCoordinates:t,viewport:e})=>{const o=.3/Math.pow(2,e.zoom/2);return{from:[t[0]-o,t[1]-o],to:[t[0]+o,t[1]+o]}})({pickedCoordinates:e.coordinate,viewport:e.viewport}),null!=o&&o.value&&e.coordinate)){const t=o.value;if(Array.isArray(t)&&2===t.length&&(i={from:t[0],to:t[1]},(l=[e.coordinate[0],e.coordinate[1]])[0]>=i.from[0]&&l[0]<=i.to[0]&&l[1]>=i.from[1]&&l[1]<=i.to[1]))return{filters:[],values:t,customColumnLabel:o.customColumnLabel}}var l,i;if(!t.spatial)throw new Error("Spatial data is required");return s({positions:r,positionBounds:a,spatialData:t.spatial})})({formData:o,data:t,filterState:e});({values:l,filters:i,customColumnLabel:a}=n)}else if(o.line_column){const e=(({formData:t,data:e})=>{var o,n;const r=(null==e||null==(o=e.object)?void 0:o.path)||(null==(n=e.object)?void 0:n.polygon),a=JSON.stringify(r);if(!t.line_column)throw new Error("Line column is required");if(!r)throw new Error("Position of picked data is required");return{values:[a],filters:[{col:{expressionType:"SQL",sqlExpression:`REPLACE(${t.line_column}, ' ', '')`,label:t.line_column},op:"==",val:a}]}})({formData:o,data:t});({values:l,filters:i,customColumnLabel:a}=e)}else{if(!o.geojson)throw new Error("No valid spatial configuration found in form data");{const e=(({formData:t,data:e})=>{var o;const n=null==(o=e.object)||null==(o=o.geometry)?void 0:o.coordinates;if(!n)throw new Error("Position of picked data is required");const r=`%${JSON.stringify(n)}%`;return{values:[n],filters:[{col:{expressionType:"SQL",sqlExpression:`REPLACE(${t.geojson}, ' ', '')`,label:t.geojson},op:"LIKE",val:r}]}})({formData:o,data:t});({values:l,filters:i,customColumnLabel:a}=e)}}const u=l&&(null==e||null==(r=e.value)?void 0:r.every((t,e)=>t.toString()===l[e].toString()));return u&&(l=[]),{dataMask:{extraFormData:{filters:l.length?i:[]},filterState:{value:l.length?l:null,...a&&l.length?{customColumnLabel:a}:{}}},isCurrentValueSelected:u||!1}};var p=o(92123),d=o(50871),f=o(20605);function m({formData:t,setDataMask:e,setTooltip:o,setTooltipContent:r,onSelect:l,onContextMenu:i,filterState:s,emitCrossFilters:c}){const p=t;let d,f,m=r;if(p.js_tooltip&&(m=(0,a.A)(p.js_tooltip)),m){let t=null;const e=t=>{var e;return(0,n.isValidElement)(t)&&"custom"===(null==(e=t.props)?void 0:e["data-tooltip-type"])};d=n=>(n.picked&&(t=m(n)),t&&(n.picked||e(t))?o({content:t,x:n.x,y:n.y}):(o(null),t=null),!0)}return p.js_onclick_href?f=t=>{const e=(0,a.A)(p.js_onclick_href)(t);return window.open(e),!0}:p.table_filter&&void 0!==l?f=t=>(l(t.object[p.line_column]),!0):c&&(f=(o,n)=>{const r=u({data:o,filterState:s,formData:t});return n.leftButton&&void 0!==e&&r?e(r.dataMask):n.rightButton&&void 0!==i&&i(n.center.x,n.center.y,{drillToDetail:[],crossFilter:r,drillBy:{}}),!0}),{onClick:f,onHover:d,pickable:Boolean(d||f)}}const v={p1:.01,p5:.05,p95:.95,p99:.99},h={sum:r.sum,min:r.min,max:r.max,mean:r.mean,median:r.median,variance:r.variance,deviation:r.deviation};function g(t="sum",e=null){if("count"===t)return t=>t.length;let o;if(t in v)o=(o,n)=>{let a;return a=e?o.sort((t,o)=>(0,r.ascending)(e(t),e(o))):o.sort(r.ascending),(0,r.quantile)(a,v[t],n)};else{if(!(t in h))throw new Error(`Unsupported aggregation type: ${t}`);o=h[t]}return e?t=>o(t.map(t=>e(t))):t=>o(t)}const b=(t,e,o)=>{const n=t(e);if(void 0!==n&&!Array.isArray(n))return o.findIndex(t=>n>=t.minValue&&n<=t.maxValue)+1},w=({colorSchemeType:t,fixedColor:e,colorBreakpoints:o,colorScale:n,defaultBreakpointsColor:r})=>{let a;switch(t){case p.wP.linear_palette:case p.wP.categorical_palette:a=null==n?void 0:n.range().map(t=>(0,d.hexToRGB)(t));break;case p.wP.color_breakpoints:{var l;const t=r?[r.r,r.g,r.b,255*r.a]:[f.DL.r,f.DL.g,f.DL.b,255*f.DL.a];a=null==o?void 0:o.map(e=>e.color?[e.color.r,e.color.g,e.color.b,255*e.color.a]:t),null==(l=a)||l.unshift(t);break}default:{const t=e||{r:f.DL.r,g:f.DL.g,b:f.DL.b,a:f.DL.a};a=[[t.r,t.g,t.b,255*t.a]]}}return a}},98456:(t,e,o)=>{o.d(e,{A:()=>c});var n=o(68961),r=o.n(n),a=o(4523),l=o(71960),i=o(50871);const s={console,_:a.Ay,colors:i,d3array:l};function c(t,e,o){const n={},a=`SAFE_EVAL_${Math.floor(1e6*Math.random())}`;n[a]={};const l=`${a}=${t}`,i={...s,...e};Object.keys(i).forEach(t=>{n[t]=i[t]});try{return r().runInNewContext(l,n,o),n[a]}catch(t){return()=>t}}}}]);