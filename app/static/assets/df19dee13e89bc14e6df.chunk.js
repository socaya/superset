"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7141],{4651:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(2445),i=a(29645);const o=Object.assign(({padded:e,...t})=>(0,n.Y)(i.Card,{...t,css:t=>({".ant-card-body":{padding:e?4*t.sizeUnit:t.sizeUnit}})}),{Meta:i.Card.Meta})},13410:(e,t,a)=>{a.d(t,{E:()=>s});var n=a(2445),i=a(81465),o=a(29645);const s=(0,i.I4)(e=>(0,n.Y)(o.Badge,{...e}))`
  ${({theme:e,color:t,count:a})=>`\n    & > sup,\n    & > sup.ant-badge-count {\n      box-shadow: none;\n      ${void 0!==a?`background: ${t||e.colorPrimary};`:""}\n    }\n  `}
`},17942:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(74098);function i(e){return!(!e||!Number.isNaN(Number(e)))&&(0,n.t)("is expected to be a number")}},18865:(e,t,a)=>{a.d(t,{A:()=>u});var n=a(2445),i=a(74098),o=a(17437),s=a(81465),r=a(23195),l=a(95018),d=a(5250),c=a(8558);const h=o.AH`
  &.anticon {
    font-size: unset;
    .anticon {
      line-height: unset;
      vertical-align: unset;
    }
  }
`,u=({name:e,label:t,description:a,validationErrors:u=[],renderTrigger:m=!1,rightNode:p,leftNode:g,onClick:b,hovered:f=!1,tooltipOnClick:y=()=>{},warning:C,danger:v})=>{const _=(0,s.DP)();return t?(0,n.FD)("div",{className:"ControlHeader",children:[(0,n.Y)("div",{className:"pull-left",children:(0,n.FD)(r.l,{css:e=>o.AH`
            margin-bottom: ${.5*e.sizeUnit}px;
            position: relative;
            font-size: ${e.fontSizeSM}px;
          `,children:[g&&(0,n.FD)("span",{children:[g," "]}),(0,n.Y)("span",{role:"button",tabIndex:0,onClick:b,style:{cursor:b?"pointer":""},children:t})," ",C&&(0,n.FD)("span",{children:[(0,n.Y)(l.m,{id:"error-tooltip",placement:"top",title:C,children:(0,n.Y)(c.F.WarningOutlined,{iconColor:_.colorWarning,css:o.AH`
                    vertical-align: baseline;
                  `,iconSize:"s"})})," "]}),v&&(0,n.FD)("span",{children:[(0,n.Y)(l.m,{id:"error-tooltip",placement:"top",title:v,children:(0,n.Y)(c.F.CloseCircleOutlined,{iconColor:_.colorErrorText,iconSize:"s"})})," "]}),(null==u?void 0:u.length)>0&&(0,n.FD)("span",{css:o.AH`
                cursor: pointer;
              `,children:[(0,n.Y)(l.m,{id:"error-tooltip",placement:"top",title:null==u?void 0:u.join(" "),children:(0,n.Y)(c.F.InfoCircleOutlined,{iconColor:_.colorErrorText})})," "]}),f?(0,n.FD)("span",{css:()=>o.AH`
          position: absolute;
          top: 50%;
          right: 0;
          padding-left: ${_.sizeUnit}px;
          transform: translate(100%, -50%);
          white-space: nowrap;
        `,children:[a&&(0,n.FD)("span",{children:[(0,n.Y)(l.m,{id:"description-tooltip",title:a,placement:"top",children:(0,n.Y)(c.F.InfoCircleOutlined,{css:h,onClick:y})})," "]}),m&&(0,n.FD)("span",{children:[(0,n.Y)(d.I,{label:(0,i.t)("bolt"),tooltip:(0,i.t)("Changing this control takes effect instantly"),placement:"top",type:"notice"})," "]})]}):null]})}),p&&(0,n.Y)("div",{className:"pull-right",children:p}),(0,n.Y)("div",{className:"clearfix"})]}):null}},21325:(e,t,a)=>{a.d(t,{Ay:()=>b,fn:()=>m,pX:()=>g});var n=a(2445),i=a(17437),o=a(81465),s=a(29645),r=a(8558);const l=({animated:e=!1,allowOverflow:t=!0,tabBarStyle:a,...r})=>{const l={paddingLeft:4*(0,o.DP)().sizeUnit,...a};return(0,n.Y)(s.Tabs,{animated:e,...r,tabBarStyle:l,css:e=>i.AH`
        overflow: ${t?"visible":"hidden"};

        .ant-tabs-content-holder {
          overflow: ${t?"visible":"auto"};
        }
        .ant-tabs-tab {
          flex: 1 1 auto;

          .short-link-trigger.btn {
            padding: 0 ${e.sizeUnit}px;
            & > .fa.fa-link {
              top: 0;
            }
          }
        }
        .ant-tabs-tab-btn {
          display: flex;
          flex: 1 1 auto;
          align-items: center;
          justify-content: center;
          font-size: ${e.fontSizeSM}px;
          text-align: center;
          user-select: none;
          .required {
            margin-left: ${e.sizeUnit/2}px;
            color: ${e.colorError};
          }
          &:focus-visible {
            box-shadow: none;
          }
        }
      `})},d=(0,o.I4)(s.Tabs.TabPane)``,c=Object.assign(l,{TabPane:d}),h=(0,o.I4)(l)`
  ${({theme:e})=>`\n    .ant-tabs-content-holder {\n      background: ${e.colorBgContainer};\n    }\n\n    & > .ant-tabs-nav {\n      margin-bottom: 0;\n    }\n\n    .ant-tabs-tab-remove {\n      padding-top: 0;\n      padding-bottom: 0;\n      height: ${6*e.sizeUnit}px;\n    }\n  `}
`,u=(0,o.I4)(r.F.CloseOutlined)`
  color: ${({theme:e})=>e.colorIcon};
`,m=Object.assign(h,{TabPane:d});m.defaultProps={type:"editable-card",animated:{inkBar:!0,tabPane:!1}},m.TabPane.defaultProps={closeIcon:(0,n.Y)(u,{iconSize:"s",role:"button",tabIndex:0})};const p=(0,o.I4)(m)`
  &.ant-tabs-card > .ant-tabs-nav .ant-tabs-tab {
    margin: 0 ${({theme:e})=>4*e.sizeUnit}px;
    padding: ${({theme:e})=>`${3*e.sizeUnit}px ${e.sizeUnit}px`};
    background: transparent;
    border: none;
  }

  &.ant-tabs-card > .ant-tabs-nav .ant-tabs-ink-bar {
    visibility: visible;
  }

  .ant-tabs-tab-btn {
    font-size: ${({theme:e})=>e.fontSize}px;
  }

  .ant-tabs-tab-remove {
    margin-left: 0;
    padding-right: 0;
  }

  .ant-tabs-nav-add {
    min-width: unset !important;
    background: transparent !important;
    border: none !important;
  }
`,g=Object.assign(p,{TabPane:d}),b=c},22197:(e,t,a)=>{a.d(t,{z:()=>g});var n=a(2445),i=a(74098),o=a(17437),s=a(81465),r=a(24002),l=a(46942),d=a.n(l),c=a(95018),h=a(54569),u=a(29645);const m=(0,s.I4)(h.T)`
  vertical-align: middle;
`,p=s.I4.span`
  &.editable-title {
    display: inline;
    &.editable-title--editing {
      width: 100%;
    }

    input,
    textarea {
      outline: none;
      background: transparent;
      box-shadow: none;
      cursor: initial;
      font-feature-settings:
        'liga' 0,
        'calt' 0;
      font-variant-ligatures: none;
      font-weight: bold;
    }

    input[type='text'],
    textarea {
      color: ${({theme:e})=>e.colorTextTertiary};
      border-radius: ${({theme:e})=>e.sizeUnit}px;
      font-size: ${({theme:e})=>e.fontSizeLG}px;
      padding: ${({theme:e})=>e.sizeUnit/2}px;
      min-height: 100px;
      width: 95%;
    }

    &.datasource-sql-expression {
      min-width: 315px;
      width: 100%;
    }
  }
`;function g({canEdit:e=!1,editing:t=!1,extraClasses:a,noPermitTooltip:s,onSaveTitle:l,showTooltip:h=!0,style:g,title:b="",defaultTitle:f="",placeholder:y="",certifiedBy:C,certificationDetails:v,renderLink:_,maxWidth:x,autoSize:S=!0,...Y}){const[w,A]=(0,r.useState)(t),[D,T]=(0,r.useState)(b),[E,z]=(0,r.useState)(b),[F,k]=(0,r.useState)(0),I=(0,r.useRef)(null);function L(){const t=D.trim();e&&(A(!1),t.length?(E!==t&&z(t),b!==t&&l(t)):T(E))}(0,r.useEffect)(()=>{var e;const{font:t}=window.getComputedStyle((null==(e=I.current)||null==(e=e.resizableTextArea)?void 0:e.textArea)||document.body),a=function(e,t="14px Arial"){const a=document.createElement("canvas").getContext("2d");return a?(a.font=t,a.measureText(e).width):0}(D||"",t),n="number"==typeof x?x:1/0;k(Math.min(a+20,n))},[D]),(0,r.useEffect)(()=>{b!==D&&(z(D),T(b))},[b]),(0,r.useEffect)(()=>{if(w&&I.current){var e;const t=null==(e=I.current.resizableTextArea)?void 0:e.textArea;if(t){t.focus();const{length:e}=t.value;t.setSelectionRange(e,e),t.scrollTop=t.scrollHeight}}},[w]);let $=D;w||D||($=f||b);let M=(0,n.Y)(u.Input.TextArea,{size:"small",ref:I,value:$,className:b?void 0:"text-muted",onChange:function(t){e&&T(t.target.value)},onBlur:L,onClick:function(){var t;if(!e||w)return;const a=null==(t=I.current)||null==(t=t.resizableTextArea)?void 0:t.textArea;if(a){a.focus();const{length:e}=a.value;a.setSelectionRange(e,e)}A(!0)},onKeyDown:function(e){["Backspace","Delete"," ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&e.stopPropagation(),"Enter"===e.key&&(e.preventDefault(),L())},onPressEnter:function(e){e.preventDefault(),L()},placeholder:y,variant:w?"outlined":"borderless",autoSize:!!S&&{minRows:1,maxRows:3},css:e=>o.AH`
        && {
          width: ${F}px;
          min-width: ${10*e.sizeUnit}px;
          transition: auto;
        }
      `});return h&&!w&&(M=(0,n.Y)(c.m,{id:"title-tooltip",placement:"topLeft",title:e?(0,i.t)("Click to edit"):s||(0,i.t)("You don't have the rights to alter this title."),children:M})),e||(M=_?_($||""):(0,n.Y)("span",{children:$})),(0,n.FD)(p,{className:d()("editable-title",a,e&&"editable-title--editable",w&&"editable-title--editing"),style:g,editing:w,canEdit:e,...Y,children:[C&&(0,n.FD)(n.FK,{children:[(0,n.Y)(m,{certifiedBy:C,details:v,size:"xl"})," "]}),M]})}},36188:(e,t,a)=>{a.d(t,{c:()=>s});var n=a(2445),i=a(17437),o=a(29645);function s(e){return(0,n.Y)(o.Divider,{css:e=>i.AH`
        margin: ${e.margin}px 0;
      `,...e})}},37845:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ke});var n=a(17437),i=a(58561),o=a.n(i),s=a(24002),r=a(5556),l=a.n(r),d=a(61225),c=a(22750),h=a(1763),u=a(81465),m=a(74098),p=a(99106),g=a(79378),b=a(90924),f=a(40984),y=a(59744),C=a(98837),v=a(21325),_=a(35273),x=a(94083),S=a(3513),Y=a(88843),w=a(39438),A=a(75536),D=a(64457),T=a(22111),E=a(13410),z=a(2801),F=a(42566),k=a(54569),I=a(22197),L=a(27509),$=a(4651),M=a(49965),O=a(23195),q=a(56196),U=a(8558),R=a(36188),K=a(29645),P=a(88217),N=a(94185),H=a(9876);const Q=(0,a(10992).A)({method:"POST",endpoint:"/api/v1/sqllab/execute"});function B(e){return{type:"SET_QUERY_IS_LOADING",payload:e}}var j=a(6411),W=a.n(j),G=a(54264),V=a(2445),X=a(43561),J=a(5250),Z=a(18009),ee=a(65729);function te(e,t,a){return s.Children.map(e,e=>{let n=e;return e&&e.type&&e.type.name===t.name&&(n=(0,s.cloneElement)(e,a(e))),n&&n.props&&n.props.children&&(n=(0,s.cloneElement)(n,{children:te(n.props.children,t,a)})),n})}var ae=a(95018),ne=a(82384);function ie({fieldKey:e,value:t,label:a,description:i=null,control:o,additionalControl:r,onChange:l=()=>{},compact:d=!1,inline:c,errorMessage:h}){const m=(0,s.useCallback)(t=>{l(e,t)},[l,e]),p=(0,u.DP)(),g=!d&&i?i:void 0,b=d&&i?(0,V.Y)(ae.m,{css:n.AH`
          color: ${p.colorTextTertiary};
        `,id:"field-descr",placement:"right",title:i,children:(0,V.Y)(U.F.InfoCircleOutlined,{iconSize:"s",css:n.AH`
            margin-left: ${p.marginXXS}px;
          `,iconColor:p.colorTextTertiary})}):void 0,f=(0,s.cloneElement)(o,{value:t,onChange:m,label:(0,V.FD)(O.l,{children:[a||e,b]})});return(0,V.FD)("div",{css:r&&n.AH`
          position: relative;
        `,children:[r,(0,V.Y)(ne.e,{extra:g,css:!c&&n.AH`
            .ControlHeader {
              margin-bottom: ${p.marginXXS}px;
            }
          `,children:f}),h&&(0,V.Y)("div",{css:e=>({color:e.colorText,[c?"marginLeft":"marginTop"]:e.marginXXS}),children:h})]})}function oe({children:e,onChange:t,item:a,title:i=null,compact:o=!1}){const r=(0,s.useCallback)((e,n)=>{t({...a,[e]:n})},[t,a]);return(0,V.FD)(ee.l,{className:"CRUD",layout:"vertical",children:[i&&(0,V.FD)(F.o.Title,{level:5,css:n.AH`
            margin-top: 0.5em;
          `,children:[i," ",(0,V.Y)(R.c,{})]}),te(e,ie,e=>({onChange:r,value:a[e.props.fieldKey],compact:o}))]})}const se=u.I4.div`
  text-align: right;
  ${({theme:e})=>`margin-bottom: ${2*e.sizeUnit}px`}
`,re=u.I4.span`
  ${({theme:e})=>`\n    margin-top: ${3*e.sizeUnit}px;\n    margin-left: ${3*e.sizeUnit}px;\n    button>span>:first-of-type {\n      margin-right: 0;\n    }\n  `}
`;function le(e){const t=e.map(e=>({...e,id:e.id||(0,X.Ak)()})),a={};return t.forEach(e=>{a[e.id]=e}),{collection:a,collectionArray:t}}class de extends s.PureComponent{constructor(e){super(e);const{collection:t,collectionArray:a}=le(e.collection);this.state={expandedColumns:{},collection:t,collectionArray:a,sortColumn:"",sort:0},this.onAddItem=this.onAddItem.bind(this),this.renderExpandableSection=this.renderExpandableSection.bind(this),this.getLabel=this.getLabel.bind(this),this.onFieldsetChange=this.onFieldsetChange.bind(this),this.changeCollection=this.changeCollection.bind(this),this.handleTableChange=this.handleTableChange.bind(this),this.buildTableColumns=this.buildTableColumns.bind(this),this.toggleExpand=this.toggleExpand.bind(this)}componentDidUpdate(e){if(this.props.collection!==e.collection){const{collection:e,collectionArray:t}=le(this.props.collection);this.setState(a=>({collection:e,collectionArray:t,expandedColumns:a.expandedColumns}))}}onCellChange(e,t,a){this.setState(n=>{const i={...n.collection,[e]:{...n.collection[e],[t]:a}},o=n.collectionArray.map(t=>t.id===e?i[e]:t);return this.props.onChange&&this.props.onChange(o),{collection:i,collectionArray:o}})}onAddItem(){if(this.props.itemGenerator){let e=this.props.itemGenerator();const t=!0===e.expanded;e.id||(e={...e,id:(0,X.Ak)()}),delete e.expanded,this.setState(a=>{const n={...a.collection,[e.id]:e},i=t?{...a.expandedColumns,[e.id]:!0}:a.expandedColumns;return{collection:n,collectionArray:[e,...a.collectionArray],expandedColumns:i}},()=>{this.props.onChange&&this.props.onChange(this.state.collectionArray)})}}onFieldsetChange(e){this.changeCollection({...this.state.collection,[e.id]:e})}getLabel(e){const{columnLabels:t}=this.props;let a=null!=t&&t[e]?t[e]:e;return a.startsWith("__")&&(a=""),a}getTooltip(e){const{columnLabelTooltips:t}=this.props;return null==t?void 0:t[e]}changeCollection(e){const t=function(e){return Object.keys(e).map(t=>e[t])}(e);this.setState({collection:e,collectionArray:t}),this.props.onChange&&this.props.onChange(t)}deleteItem(e){const t={...this.state.collection};delete t[e],this.changeCollection(t)}toggleExpand(e){this.setState(t=>({expandedColumns:{...t.expandedColumns,[e]:!t.expandedColumns[e]}}))}handleTableChange(e,t,a){const n=Array.isArray(a)?a[0]:a;let i="",o=0;null!=n&&n.columnKey&&null!=n&&n.order&&(i=n.columnKey,o="ascend"===n.order?1:2);const{sortColumns:s}=this.props,r=i;if(null!=s&&s.includes(r)||0===o){let e=[...this.props.collection];if(0!==o){const t=(e,t)=>{if("string"==typeof e&&"string"==typeof t)return(e||"").localeCompare(t||"");if("number"==typeof e&&"number"==typeof t)return e-t;if("boolean"==typeof e&&"boolean"==typeof t)return e===t?0:e?1:-1;const a=String(null!=e?e:""),n=String(null!=t?t:"");return a.localeCompare(n)};e.sort((e,a)=>t(e[r],a[r])),2===o&&e.reverse()}else{const{collectionArray:t}=le(this.props.collection);e=t}this.setState({collectionArray:e,sortColumn:i,sort:o})}}renderExpandableSection(e){return te(this.props.expandFieldset,oe,()=>({item:e,onChange:this.onFieldsetChange}))}renderCell(e,t){var a;const n=null==(a=this.props.itemRenderers)?void 0:a[t],i=e[t],o=this.onCellChange.bind(this,e.id,t);return n?n(i,o,this.getLabel(t),e):i}buildTableColumns(){const{tableColumns:e,allowDeletes:t,sortColumns:a=[]}=this.props,i=e.map(e=>{const t=this.getLabel(e),n=this.getTooltip(e),i=a.includes(e),o=this.state.sortColumn===e?1===this.state.sort?"ascend":2===this.state.sort?"descend":null:null;return{key:e,dataIndex:e,minWidth:100,title:(0,V.FD)(V.FK,{children:[t,n&&(0,V.FD)(V.FK,{children:[" ",(0,V.Y)(J.I,{label:(0,m.t)("description"),tooltip:n,placement:"top"})]})]}),render:(t,a)=>this.renderCell(a,e),onCell:a=>{var n;const i=null==(n=this.props.itemCellProps)?void 0:n[e],o=a[e];return i?i(o,t,a):{}},sorter:i,sortOrder:o}});return t&&i.push({key:"__actions",dataIndex:"__actions",sorter:!1,title:(0,V.Y)(V.FK,{}),onCell:()=>({}),sortOrder:null,minWidth:50,render:(e,t)=>(0,V.Y)("span",{className:"text-primary",css:e=>n.AH`
              display: flex;
              justify-content: center;
              color: ${e.colorTextTertiary};
            `,children:(0,V.Y)(U.F.DeleteOutlined,{"aria-label":"Delete item",className:"pointer",role:"button",tabIndex:0,onClick:()=>this.deleteItem(t.id),iconSize:"l",iconColor:"inherit"})})}),i}render(){const{stickyHeader:e,emptyMessage:t=(0,m.t)("No items"),expandFieldset:a}=this.props,i=this.buildTableColumns(),o=Object.keys(this.state.expandedColumns).filter(e=>this.state.expandedColumns[e]),s=a?{expandedRowRender:e=>this.renderExpandableSection(e),rowExpandable:()=>!0,expandedRowKeys:o,onExpand:(e,t)=>{this.toggleExpand(t.id)}}:void 0;return(0,V.FD)(V.FK,{children:[(0,V.Y)(se,{children:this.props.allowAddItem&&(0,V.Y)(re,{children:(0,V.FD)(P.$,{buttonSize:"small",buttonStyle:"secondary",onClick:this.onAddItem,children:[(0,V.Y)(U.F.PlusOutlined,{iconSize:"m"}),(0,m.t)("Add item")]})})}),(0,V.Y)(Z.Ay,{columns:i,data:this.state.collectionArray,rowKey:e=>String(e.id),sticky:e,pagination:!1,onChange:this.handleTableChange,locale:{emptyText:t},css:e&&n.AH`
              height: 350px;
              overflow: auto;
            `,expandable:s,size:Z.QS.Middle,tableLayout:"auto"})]})}}var ce=a(52024);const he=u.I4.div`
  align-items: center;
  display: flex;
  gap: ${({theme:e})=>e.sizeUnit}px;

  a {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.2;
  }

  svg {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,ue=({datasourceId:e,charts:t,totalCount:a,onFetchCharts:i,addDangerToast:o})=>{const r=(0,s.useRef)(o),l=(0,s.useRef)(null),d=(0,s.useRef)(!1),[c,h]=(0,s.useState)(!1),[u,p]=(0,s.useState)(1),[g,b]=(0,s.useState)("changed_on_delta_humanized"),[f,y]=(0,s.useState)("desc"),C=(0,s.useCallback)(async(t=1,a=g,n=f)=>{if(e){h(!0);try{await i(t,25,a,n),p(t),b(a),y(n)}catch(e){r.current&&r.current((0,m.t)("Error fetching charts"))}finally{h(!1)}}},[e,i,g,f]);(0,s.useEffect)(()=>{r.current=o},[o]),(0,s.useEffect)(()=>{let e;return d.current&&!c&&(e=requestAnimationFrame(()=>{var e;const t=null==(e=l.current)?void 0:e.querySelector(".ant-table-body");t&&t.scrollTo({top:0,behavior:"smooth"})})),d.current=c,()=>{void 0!==e&&cancelAnimationFrame(e)}},[c]);const v=(0,s.useCallback)(e=>{C(e)},[C]),_=(0,s.useCallback)(e=>{C(1,e,e===g&&"desc"===f?"asc":"desc")},[C,g,f]),x=(0,s.useCallback)(e=>{null!=e&&e.current&&e.current!==u&&v(e.current)},[u,v]),S=(0,s.useMemo)(()=>[{title:(0,m.t)("Chart"),dataIndex:"slice_name",key:"slice_name",render:(e,t)=>(0,V.FD)(he,{children:[(0,V.FD)(H.Kt,{to:t.url,target:"_blank",children:[t.certified_by&&(0,V.FD)(V.FK,{children:[(0,V.Y)(k.T,{certifiedBy:t.certified_by,details:t.certification_details})," "]}),t.slice_name]}),t.description&&(0,V.Y)(J.I,{tooltip:t.description})]}),sorter:!0,sortOrder:"slice_name"===g?"asc"===f?"ascend":"descend":void 0,onHeaderCell:()=>({onClick:()=>_("slice_name"),style:{cursor:"pointer"}}),width:300},{title:(0,m.t)("Chart owners"),dataIndex:"owners",key:"owners",render:(e,t)=>(0,V.Y)(H.WM,{users:t.owners,maxCount:3}),sorter:!1,width:150},{title:(0,m.t)("Last modified"),dataIndex:"changed_on_delta_humanized",key:"changed_on_delta_humanized",render:(e,t)=>(0,V.Y)(H.UW,{date:t.changed_on_delta_humanized,user:t.changed_by||void 0}),sorter:!0,sortOrder:"changed_on_delta_humanized"===g?"asc"===f?"ascend":"descend":void 0,onHeaderCell:()=>({onClick:()=>_("changed_on_delta_humanized"),style:{cursor:"pointer"}}),width:160},{title:(0,m.t)("Dashboard usage"),dataIndex:"dashboards",key:"dashboards",render:(e,t)=>(0,V.Y)(ce.o,{dashboards:t.dashboards.map(e=>({id:e.id,dashboard_title:e.dashboard_title})),external:!0}),sorter:!1,width:200}],[_,g,f]);return(0,V.Y)("div",{ref:l,children:(0,V.Y)(Z.Ay,{sticky:!0,columns:S,data:t,pagination:{current:u,total:a,pageSize:25,onChange:v,showSizeChanger:!1,size:"default"},loading:c,size:Z.QS.Middle,rowKey:e=>e.id?`chart-${e.id}`:`chart-${e.slice_name}`,tableLayout:"fixed",scroll:{y:293,x:"100%"},css:n.AH`
          .ant-table-pagination.ant-pagination {
            margin-bottom: 0;
          }
        `,locale:{emptyText:(0,m.t)("No items")},onChange:x})})};var me;const pe=(0,h.a)(),ge=u.I4.div`
  .change-warning {
    margin: 16px 10px 0;
    color: ${({theme:e})=>e.colorWarning};
  }

  .change-warning .bold {
    font-weight: ${({theme:e})=>e.fontWeightStrong};
  }

  .form-group.has-feedback > .help-block {
    margin-top: 8px;
  }

  .form-group.form-group-md {
    margin-bottom: 8px;
  }
`,be=u.I4.div`
  align-items: center;
  display: flex;

  svg {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,fe=(0,u.I4)(v.Ay)`
  overflow: visible;
  .ant-tabs-content-holder {
    overflow: visible;
  }
`,ye=(0,u.I4)(E.E)`
  .ant-badge-count {
    line-height: ${({theme:e})=>4*e.sizeUnit}px;
    height: ${({theme:e})=>4*e.sizeUnit}px;
    margin-left: ${({theme:e})=>e.sizeUnit}px;
  }
`,Ce=u.I4.div`
  font-size: ${({theme:e})=>e.fontSizeSM}px;
  display: flex;
  align-items: center;
  a {
    padding: 0 10px;
  }
`,ve=u.I4.div`
  text-align: right;
  ${({theme:e})=>`margin-bottom: ${2*e.sizeUnit}px`}
`,_e=u.I4.div`
  display: flex;
  align-items: center;
  span {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,xe=u.I4.div`
  .table > tbody > tr > td {
    vertical-align: middle;
  }

  .ant-tag {
    margin-top: ${({theme:e})=>e.sizeUnit}px;
  }
`,Se=u.I4.span`
  ${({theme:e})=>`\n    margin-top: ${3*e.sizeUnit}px;\n    margin-left: ${3*e.sizeUnit}px;\n    button>span>:first-of-type {\n      margin-right: 0;\n    }\n  `}
`,Ye=(e,t)=>(0,V.Y)(S.A,{value:e,onChange:t}),we=[{value:"STRING",label:(0,m.t)("STRING")},{value:"NUMERIC",label:(0,m.t)("NUMERIC")},{value:"DATETIME",label:(0,m.t)("DATETIME")},{value:"BOOLEAN",label:(0,m.t)("BOOLEAN")}],Ae="SOURCE",De=[{key:"physical",label:(0,m.t)("Physical (table or view)")},{key:"virtual",label:(0,m.t)("Virtual (SQL)")}],Te={};De.forEach(e=>{Te[e.key]=e});var Ee={name:"s5xdrg",styles:"display:flex;align-items:center"};function ze({title:e,collection:t}){return(0,V.FD)("div",{css:Ee,children:[e," ",(0,V.Y)(ye,{count:t?t.length:0,showZero:!0})]})}function Fe({columns:e,datasource:t,onColumnsChange:a,onDatasourceChange:n,editableColumnName:i,showExpression:o,allowAddItem:s,allowEditDataType:r,itemGenerator:l,columnLabelTooltips:d}){return(0,V.Y)(de,{tableColumns:(0,p.G7)(p.TO.EnableAdvancedDataTypes)?["column_name","advanced_data_type","type","is_dttm","main_dttm_col","filterable","groupby"]:["column_name","type","is_dttm","main_dttm_col","filterable","groupby"],sortColumns:(0,p.G7)(p.TO.EnableAdvancedDataTypes)?["column_name","advanced_data_type","type","is_dttm","main_dttm_col","filterable","groupby"]:["column_name","type","is_dttm","main_dttm_col","filterable","groupby"],allowDeletes:!0,allowAddItem:s,itemGenerator:l,collection:e,columnLabelTooltips:d,stickyHeader:!0,expandFieldset:(0,V.Y)(Ie,{children:(0,V.FD)(oe,{compact:!0,children:[o&&(0,V.Y)(ie,{fieldKey:"expression",label:(0,m.t)("SQL expression"),control:(0,V.Y)(w.A,{language:"markdown",offerEditInModal:!1,resize:"vertical"})}),(0,V.Y)(ie,{fieldKey:"verbose_name",label:(0,m.t)("Label"),control:(0,V.Y)(Y.A,{controlId:"verbose_name",placeholder:(0,m.t)("Label")})}),(0,V.Y)(ie,{fieldKey:"description",label:(0,m.t)("Description"),control:(0,V.Y)(Y.A,{controlId:"description",placeholder:(0,m.t)("Description")})}),r&&(0,V.Y)(ie,{fieldKey:"type",label:(0,m.t)("Data type"),control:(0,V.Y)(z.A,{ariaLabel:(0,m.t)("Data type"),options:we,name:"type",allowNewOptions:!0,allowClear:!0})}),(0,p.G7)(p.TO.EnableAdvancedDataTypes)?(0,V.Y)(ie,{fieldKey:"advanced_data_type",label:(0,m.t)("Advanced data type"),control:(0,V.Y)(Y.A,{controlId:"advanced_data_type",placeholder:(0,m.t)("Advanced Data type")})}):(0,V.Y)(V.FK,{}),(0,V.Y)(ie,{fieldKey:"python_date_format",label:(0,m.t)("Datetime format"),description:(0,V.FD)("div",{children:[(0,m.t)("The pattern of timestamp format. For strings use "),(0,V.Y)(F.o.Link,{href:"https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior",children:(0,m.t)("Python datetime string pattern")}),(0,m.t)(" expression which needs to adhere to the "),(0,V.Y)(F.o.Link,{href:"https://en.wikipedia.org/wiki/ISO_8601",children:(0,m.t)("ISO 8601")}),(0,m.t)(" standard to ensure that the lexicographical ordering\n                      coincides with the chronological ordering. If the\n                      timestamp format does not adhere to the ISO 8601 standard\n                      you will need to define an expression and type for\n                      transforming the string into a date or timestamp. Note\n                      currently time zones are not supported. If time is stored\n                      in epoch format, put `epoch_s` or `epoch_ms`. If no pattern\n                      is specified we fall back to using the optional defaults on a per\n                      database/column name level via the extra parameter.")]}),control:(0,V.Y)(Y.A,{controlId:"python_date_format",placeholder:"%Y-%m-%d"})}),(0,V.Y)(ie,{fieldKey:"certified_by",label:(0,m.t)("Certified By"),description:(0,m.t)("Person or group that has certified this metric"),control:(0,V.Y)(Y.A,{controlId:"certified",placeholder:(0,m.t)("Certified by")})}),(0,V.Y)(ie,{fieldKey:"certification_details",label:(0,m.t)("Certification details"),description:(0,m.t)("Details of the certification"),control:(0,V.Y)(Y.A,{controlId:"certificationDetails",placeholder:(0,m.t)("Certification details")})})]})}),columnLabels:(0,p.G7)(p.TO.EnableAdvancedDataTypes)?{column_name:(0,m.t)("Column"),advanced_data_type:(0,m.t)("Advanced data type"),type:(0,m.t)("Data type"),groupby:(0,m.t)("Is dimension"),is_dttm:(0,m.t)("Is temporal"),main_dttm_col:(0,m.t)("Default datetime"),filterable:(0,m.t)("Is filterable")}:{column_name:(0,m.t)("Column"),type:(0,m.t)("Data type"),groupby:(0,m.t)("Is dimension"),is_dttm:(0,m.t)("Is temporal"),main_dttm_col:(0,m.t)("Default datetime"),filterable:(0,m.t)("Is filterable")},onChange:a,itemRenderers:(0,p.G7)(p.TO.EnableAdvancedDataTypes)?{column_name:(e,t,a,n)=>i?(0,V.FD)(_e,{children:[n.is_certified&&(0,V.Y)(k.T,{certifiedBy:n.certified_by,details:n.certification_details}),(0,V.Y)(I.z,{canEdit:!0,title:e,onSaveTitle:t})]}):(0,V.FD)(_e,{children:[n.is_certified&&(0,V.Y)(k.T,{certifiedBy:n.certified_by,details:n.certification_details}),e]}),main_dttm_col:(e,a,i,o)=>{const s=t.main_dttm_col===o.column_name,r=!(null!=o&&o.is_dttm);return(0,V.Y)(c.s,{"aria-label":(0,m.t)("Set %s as default datetime column",o.column_name),checked:s,disabled:r,onChange:()=>n({...t,main_dttm_col:o.column_name})})},type:e=>e?(0,V.Y)(L.JU,{children:e}):null,advanced_data_type:e=>(0,V.Y)(L.JU,{onChange:a,children:e}),is_dttm:Ye,filterable:Ye,groupby:Ye}:{column_name:(e,t,a,n)=>i?(0,V.FD)(_e,{children:[n.is_certified&&(0,V.Y)(k.T,{certifiedBy:n.certified_by,details:n.certification_details}),(0,V.Y)(Y.A,{value:e,onChange:t})]}):(0,V.FD)(_e,{children:[n.is_certified&&(0,V.Y)(k.T,{certifiedBy:n.certified_by,details:n.certification_details}),e]}),main_dttm_col:(e,a,i,o)=>{const s=t.main_dttm_col===o.column_name,r=!(null!=o&&o.is_dttm);return(0,V.Y)(c.s,{"aria-label":(0,m.t)("Set %s as default datetime column",o.column_name),checked:s,disabled:r,onChange:()=>n({...t,main_dttm_col:o.column_name})})},type:e=>e?(0,V.Y)(L.JU,{children:e}):null,is_dttm:Ye,filterable:Ye,groupby:Ye}})}function ke({label:e,formElement:t}){return(0,V.FD)("div",{children:[(0,V.Y)("div",{children:(0,V.Y)("strong",{children:e})}),(0,V.Y)("div",{children:t})]})}function Ie({children:e}){return(0,V.Y)($.Z,{padded:!0,style:{backgroundColor:u.vP.theme.colorBgLayout},children:e})}ze.propTypes={title:l().string,collection:l().array},Fe.propTypes={columns:l().array.isRequired,datasource:l().object.isRequired,onColumnsChange:l().func.isRequired,onDatasourceChange:l().func.isRequired,editableColumnName:l().bool,showExpression:l().bool,allowAddItem:l().bool,allowEditDataType:l().bool,itemGenerator:l().func},Fe.defaultProps={editableColumnName:!1,showExpression:!1,allowAddItem:!1,allowEditDataType:!1,itemGenerator:()=>({column_name:(0,m.t)("<new column>"),filterable:!0,groupby:!0})},ke.propTypes={label:l().string,formElement:l().node},Ie.propTypes={children:l().node};const Le={datasource:l().object.isRequired,onChange:l().func,addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,setIsEditing:l().func};function $e({datasource:e,onChange:t}){const a=(0,s.useCallback)((e="",t,a)=>{const n=o().encode({filter:e,page:t,page_size:a});return g.A.get({endpoint:`/api/v1/dataset/related/owners?q=${n}`}).then(e=>({data:e.json.result.filter(e=>e.extra.active).map(e=>({value:e.value,label:e.text})),totalCount:e.json.count}))},[]);return(0,V.Y)(M.A,{ariaLabel:(0,m.t)("Select owners"),mode:"multiple",name:"owners",value:e.owners,options:a,onChange:t,header:(0,V.Y)(O.l,{children:(0,m.t)("Owners")}),allowClear:!0})}const Me=null!=(me=pe.get("sqleditor.extension.resultTable"))?me:H.TR;var Oe={name:"hkh81z",styles:"margin-top:8px"},qe={name:"hkh81z",styles:"margin-top:8px"};class Ue extends s.PureComponent{constructor(e){var t;super(e),this.renderSqlEditorOverlay=()=>(0,V.Y)("div",{css:e=>n.AH`
        position: absolute;
        background: ${e.colorBgLayout};
        align-items: center;
        display: flex;
        height: 100%;
        width: 100%;
        justify-content: center;
      `,children:(0,V.FD)("div",{children:[(0,V.Y)(q.R,{position:"inline-centered"}),(0,V.Y)("span",{css:e=>n.AH`
            display: block;
            margin: ${4*e.sizeUnit}px auto;
            width: fit-content;
            color: ${e.colorText};
          `,children:(0,m.t)("We are working on your query")})]})}),this.renderSqlErrorMessage=()=>{var e;return(0,V.FD)("span",{css:e=>n.AH`
        font-size: ${e.fontSizeSM}px;
        color: ${e.colorErrorText};
      `,children:[(null==(e=this.props.database)?void 0:e.error)&&(0,m.t)("Error executing query. "),this.renderOpenInSqlLabLink(!0),(0,m.t)(" to check for details.")]})},this.state={datasource:{...e.datasource,owners:e.datasource.owners.map(e=>({value:e.value||e.id,label:e.label||`${e.first_name} ${e.last_name}`})),metrics:null==(t=e.datasource.metrics)?void 0:t.map(e=>{const{certified_by:t,certification_details:a}=e,{certification:{details:n,certified_by:i}={},warning_markdown:o}=JSON.parse(e.extra||"{}")||{};return{...e,certification_details:a||n,warning_markdown:o||"",certified_by:i||t}})},errors:[],isSqla:"table"===e.datasource.datasource_type||"table"===e.datasource.type,isEditMode:!1,databaseColumns:e.datasource.columns.filter(e=>!e.expression),calculatedColumns:e.datasource.columns.filter(e=>!!e.expression),metadataLoading:!1,activeTabKey:Ae,datasourceType:e.datasource.sql?Te.virtual.key:Te.physical.key,usageCharts:[],usageChartsCount:0},this.onChange=this.onChange.bind(this),this.onChangeEditMode=this.onChangeEditMode.bind(this),this.onDatasourcePropChange=this.onDatasourcePropChange.bind(this),this.onDatasourceChange=this.onDatasourceChange.bind(this),this.tableChangeAndSyncMetadata=this.tableChangeAndSyncMetadata.bind(this),this.syncMetadata=this.syncMetadata.bind(this),this.setColumns=this.setColumns.bind(this),this.validateAndChange=this.validateAndChange.bind(this),this.handleTabSelect=this.handleTabSelect.bind(this),this.formatSql=this.formatSql.bind(this),this.fetchUsageData=this.fetchUsageData.bind(this),this.currencies=(0,b.A)(e.currencies).map(e=>({value:e,label:`${(0,f.Q)({symbol:e})} (${e})`}))}onChange(){const{datasourceType:e,datasource:t}=this.state,a=e===Te.physical.key?"":t.sql,n={...this.state.datasource,sql:a,columns:[...this.state.databaseColumns,...this.state.calculatedColumns]};this.props.onChange(n,this.state.errors)}onChangeEditMode(){this.props.setIsEditing(!this.state.isEditMode),this.setState(e=>({isEditMode:!e.isEditMode}))}onDatasourceChange(e,t=this.validateAndChange){this.setState({datasource:e},t)}onDatasourcePropChange(e,t){if(void 0===t)return;const a={...this.state.datasource,[e]:t};this.setState(a=>({datasource:{...a.datasource,[e]:t}}),"table_name"===e?this.onDatasourceChange(a,this.tableChangeAndSyncMetadata):this.onDatasourceChange(a,this.validateAndChange))}onDatasourceTypeChange(e){this.setState({datasourceType:e},this.onChange)}setColumns(e){this.setState(e,this.validateAndChange)}validateAndChange(){this.validate(this.onChange)}async onQueryRun(){this.props.runQuery({client_id:this.props.clientId,database_id:this.state.datasource.database.id,runAsync:!1,catalog:this.state.datasource.catalog,schema:this.state.datasource.schema,sql:this.state.datasource.sql,tmp_table_name:"",select_as_cta:!1,ctas_method:"TABLE",queryLimit:25,expand_data:!0})}async onQueryFormat(){const{datasource:e}=this.state;if(e.sql&&this.state.isEditMode)try{const t=await this.props.formatQuery(e.sql);this.onDatasourcePropChange("sql",t.json.result),this.props.addSuccessToast((0,m.t)("SQL was formatted"))}catch(e){const{error:t,statusText:a}=await(0,y.h4)(e);this.props.addDangerToast(t||a||(0,m.t)("An error occurred while formatting SQL"))}}getSQLLabUrl(){return`/sqllab/?${new URLSearchParams({dbid:this.state.datasource.database.id,sql:this.state.datasource.sql,name:this.state.datasource.datasource_name,schema:this.state.datasource.schema,autorun:!0,isDataset:!0}).toString()}`}openOnSqlLab(){window.open(this.getSQLLabUrl(),"_blank","noopener,noreferrer")}tableChangeAndSyncMetadata(){this.validate(()=>{this.syncMetadata(),this.onChange()})}async formatSql(){const{datasource:e}=this.state;if(e.sql)try{const t=await g.A.post({endpoint:"/api/v1/sql/format",body:JSON.stringify({sql:e.sql}),headers:{"Content-Type":"application/json"}});this.onDatasourcePropChange("sql",t.json.result),this.props.addSuccessToast((0,m.t)("SQL was formatted"))}catch(e){const{error:t,statusText:a}=await(0,y.h4)(e);this.props.addDangerToast(t||a||(0,m.t)("An error occurred while formatting SQL"))}}async syncMetadata(){const{datasource:e}=this.state;this.setState({metadataLoading:!0});try{const t=await async function(e){var t,a;const n={datasource_type:e.type||e.datasource_type,database_name:(null==(t=e.database)?void 0:t.database_name)||(null==(a=e.database)?void 0:a.name),catalog_name:e.catalog,schema_name:e.schema,table_name:e.table_name,normalize_columns:e.normalize_columns,always_filter_main_dttm:e.always_filter_main_dttm};Object.entries(n).forEach(([e,t])=>{void 0===t&&(n[e]=null)});const i=`/datasource/external_metadata_by_name/?q=${o().encode_uri(n)}`,{json:s}=await g.A.get({endpoint:i});return s}(e),a=function(e,t,a){const n=t.map(e=>e.column_name),i=e.reduce((e,t)=>(e[t.column_name]=t,e),{}),o={added:[],modified:[],removed:e.filter(e=>!(e.expression||n.includes(e.column_name))).map(e=>e.column_name),finalColumns:[]};return t.forEach(e=>{const t=i[e.column_name];t?t.type!==e.type||t.is_dttm!==e.is_dttm?(o.finalColumns.push({...t,type:e.type,is_dttm:t.is_dttm||e.is_dttm}),o.modified.push(e.column_name)):o.finalColumns.push(t):(o.finalColumns.push({id:(0,X.Ak)(),column_name:e.column_name,type:e.type,groupby:!0,filterable:!0,is_dttm:e.is_dttm}),o.added.push(e.column_name))}),e.filter(e=>e.expression).forEach(e=>{o.finalColumns.push(e)}),o.modified.length&&a((0,m.tn)("Modified 1 column in the virtual dataset","Modified %s columns in the virtual dataset",o.modified.length,o.modified.length)),o.removed.length&&a((0,m.tn)("Removed 1 column from the virtual dataset","Removed %s columns from the virtual dataset",o.removed.length,o.removed.length)),o.added.length&&a((0,m.tn)("Added 1 new column to the virtual dataset","Added %s new columns to the virtual dataset",o.added.length,o.added.length)),o}(e.columns,t,this.props.addSuccessToast);this.setColumns({databaseColumns:a.finalColumns.filter(e=>!e.expression)}),this.props.addSuccessToast((0,m.t)("Metadata has been synced")),this.setState({metadataLoading:!1})}catch(e){const{error:t,statusText:a}=await(0,y.h4)(e);this.props.addDangerToast(t||a||(0,m.t)("An error has occurred")),this.setState({metadataLoading:!1})}}async fetchUsageData(e=1,t=25,a="changed_on_delta_humanized",n="desc"){const{datasource:i}=this.state;try{const s=o().encode({columns:["slice_name","url","certified_by","certification_details","description","owners.first_name","owners.last_name","owners.id","changed_on_delta_humanized","changed_on","changed_by.first_name","changed_by.last_name","changed_by.id","dashboards.id","dashboards.dashboard_title","dashboards.url"],filters:[{col:"datasource_id",opr:"eq",value:i.id}],order_column:a,order_direction:n,page:e-1,page_size:t}),{json:r={}}=await g.A.get({endpoint:`/api/v1/chart/?q=${s}`}),l=(null==r?void 0:r.result)||[],d=(null==r?void 0:r.ids)||[],c=l.map((e,t)=>({...e,id:d[t]}));return this.setState({usageCharts:c,usageChartsCount:(null==r?void 0:r.count)||0}),{charts:c,count:(null==r?void 0:r.count)||0,ids:d}}catch(e){const{error:t,statusText:a}=await(0,y.h4)(e);return this.props.addDangerToast(t||a||(0,m.t)("An error occurred while fetching usage data")),this.setState({usageCharts:[],usageChartsCount:0}),{charts:[],count:0,ids:[]}}}findDuplicates(e,t){const a={},n=[];return e.forEach(e=>{const i=t(e);i in a?n.push(i):a[i]=null}),n}validate(e){let t,a=[];const{datasource:n}=this.state;t=this.findDuplicates(n.columns,e=>e.column_name),a=a.concat(t.map(e=>(0,m.t)("Column name [%s] is duplicated",e))),t=this.findDuplicates(n.metrics,e=>e.metric_name),a=a.concat(t.map(e=>(0,m.t)("Metric name [%s] is duplicated",e)));const i=this.state.calculatedColumns.filter(e=>!e.expression&&!e.json);a=a.concat(i.map(e=>(0,m.t)("Calculated column [%s] requires an expression",e.column_name)));try{var o;null==(o=this.state.datasource.metrics)||o.forEach(e=>{var t;return(null==(t=e.currency)?void 0:t.symbol)&&new Intl.NumberFormat("en-US",{style:"currency",currency:e.currency.symbol})})}catch{a=a.concat([(0,m.t)("Invalid currency code in saved metrics")])}this.setState({errors:a},e)}handleTabSelect(e){this.setState({activeTabKey:e})}sortMetrics(e){return e.sort(({id:e},{id:t})=>t-e)}renderSettingsFieldset(){const{datasource:e}=this.state;return(0,V.FD)(oe,{title:(0,m.t)("Basic"),item:e,onChange:this.onDatasourceChange,children:[(0,V.Y)(ie,{fieldKey:"description",label:(0,m.t)("Description"),control:(0,V.Y)(w.A,{language:"markdown",offerEditInModal:!1,resize:"vertical"})}),(0,V.Y)(ie,{fieldKey:"default_endpoint",label:(0,m.t)("Default URL"),description:(0,V.FD)(V.FK,{children:[(0,m.t)("Default URL to redirect to when accessing from the dataset list page. Accepts relative URLs such as")," ",(0,V.FD)(F.o.Text,{code:!0,children:["/superset/dashboard/","{id}","/"]})]}),control:(0,V.Y)(Y.A,{controlId:"default_endpoint"})}),(0,V.Y)(ie,{inline:!0,fieldKey:"filter_select_enabled",label:(0,m.t)("Autocomplete filters"),description:(0,m.t)("Whether to populate autocomplete filters options"),control:(0,V.Y)(S.A,{})}),this.state.isSqla&&(0,V.Y)(ie,{fieldKey:"fetch_values_predicate",label:(0,m.t)("Autocomplete query predicate"),description:(0,m.t)('When using "Autocomplete filters", this can be used to improve performance of the query fetching the values. Use this option to apply a predicate (WHERE clause) to the query selecting the distinct values from the table. Typically the intent would be to limit the scan by applying a relative time filter on a partitioned or indexed time-related field.'),control:(0,V.Y)(w.A,{language:"sql",controlId:"fetch_values_predicate",minLines:5,resize:"vertical"})}),this.state.isSqla&&(0,V.Y)(ie,{fieldKey:"extra",label:(0,m.t)("Extra"),description:(0,m.t)('Extra data to specify table metadata. Currently supports metadata of the format: `{ "certification": { "certified_by": "Data Platform Team", "details": "This table is the source of truth." }, "warning_markdown": "This is a warning." }`.'),control:(0,V.Y)(w.A,{controlId:"extra",language:"json",offerEditInModal:!1,resize:"vertical"})}),(0,V.Y)($e,{datasource:e,onChange:t=>{this.onDatasourceChange({...e,owners:t})}})]})}renderAdvancedFieldset(){const{datasource:e}=this.state;return(0,V.FD)(oe,{title:(0,m.t)("Advanced"),item:e,onChange:this.onDatasourceChange,children:[(0,V.Y)(ie,{fieldKey:"cache_timeout",label:(0,m.t)("Cache timeout"),description:(0,m.t)("The duration of time in seconds before the cache is invalidated. Set to -1 to bypass the cache."),control:(0,V.Y)(Y.A,{controlId:"cache_timeout"})}),(0,V.Y)(ie,{fieldKey:"offset",label:(0,m.t)("Hours offset"),control:(0,V.Y)(Y.A,{controlId:"offset"}),description:(0,m.t)("The number of hours, negative or positive, to shift the time column. This can be used to move UTC time to local time.")}),this.state.isSqla&&(0,V.Y)(ie,{fieldKey:"template_params",label:(0,m.t)("Template parameters"),description:(0,m.t)("A set of parameters that become available in the query using Jinja templating syntax"),control:(0,V.Y)(Y.A,{controlId:"template_params"})}),(0,V.Y)(ie,{inline:!0,fieldKey:"normalize_columns",label:(0,m.t)("Normalize column names"),description:(0,m.t)("Allow column names to be changed to case insensitive format, if supported (e.g. Oracle, Snowflake)."),control:(0,V.Y)(S.A,{controlId:"normalize_columns"})}),(0,V.Y)(ie,{inline:!0,fieldKey:"always_filter_main_dttm",label:(0,m.t)("Always filter main datetime column"),description:(0,m.t)("When the secondary temporal columns are filtered, apply the same filter to the main datetime column."),control:(0,V.Y)(S.A,{controlId:"always_filter_main_dttm"})})]})}renderSpatialTab(){const{datasource:e}=this.state,{spatials:t,all_cols:a}=e;return{key:"SPATIAL",label:(0,V.Y)(ze,{collection:t,title:(0,m.t)("Spatial")}),children:(0,V.Y)(de,{tableColumns:["name","config"],onChange:this.onDatasourcePropChange.bind(this,"spatials"),itemGenerator:()=>({name:(0,m.t)("<new spatial>"),type:(0,m.t)("<no type>"),config:null}),collection:t,allowDeletes:!0,itemRenderers:{name:(e,t)=>(0,V.Y)(I.z,{canEdit:!0,title:e,onSaveTitle:t}),config:(e,t)=>(0,V.Y)(A.A,{value:e,onChange:t,choices:a})}})}}renderOpenInSqlLabLink(e=!1){return(0,V.Y)("a",{href:this.getSQLLabUrl(),target:"_blank",rel:"noopener noreferrer",css:t=>n.AH`
          color: ${e?t.colorErrorText:t.colorText};
          font-size: ${t.fontSizeSM}px;
          text-decoration: underline;
        `,children:(0,m.t)("Open in SQL lab")})}renderSourceFieldset(){var e,t,a,i,o,s,r,l,d,h,u,p;const{datasource:g}=this.state;return(0,V.FD)("div",{children:[(0,V.FD)(Ce,{children:[(0,V.Y)("span",{css:e=>n.AH`
              color: ${e.colorTextTertiary};
            `,role:"button",tabIndex:0,onClick:this.onChangeEditMode,children:this.state.isEditMode?(0,V.Y)(U.F.UnlockOutlined,{iconSize:"xl",css:e=>n.AH`
                  margin: auto ${e.sizeUnit}px auto 0;
                `}):(0,V.Y)(U.F.LockOutlined,{iconSize:"xl",css:e=>({margin:`auto ${e.sizeUnit}px auto 0`})})}),!this.state.isEditMode&&(0,V.Y)("div",{children:(0,m.t)("Click the lock to make changes.")}),this.state.isEditMode&&(0,V.Y)("div",{children:(0,m.t)("Click the lock to prevent further changes.")})]}),(0,V.Y)("div",{css:e=>n.AH`
            margin-top: ${3*e.sizeUnit}px;
          `,children:De.map(e=>(0,V.Y)(c.s,{value:e.key,inline:!0,onChange:this.onDatasourceTypeChange.bind(this,e.key),checked:this.state.datasourceType===e.key,disabled:!this.state.isEditMode,children:e.label},e.key))}),(0,V.Y)(R.c,{}),(0,V.FD)(oe,{item:g,onChange:this.onDatasourceChange,compact:!0,children:[this.state.datasourceType===Te.virtual.key&&(0,V.Y)("div",{children:this.state.isSqla&&(0,V.FD)(V.FK,{children:[(0,V.FD)(K.Col,{xs:24,md:12,children:[(0,V.Y)(ie,{fieldKey:"databaseSelector",label:(0,m.t)("Virtual"),control:(0,V.Y)("div",{css:Oe,children:(0,V.Y)(G.R,{db:null==g?void 0:g.database,catalog:g.catalog,schema:g.schema,onCatalogChange:e=>this.state.isEditMode&&this.onDatasourcePropChange("catalog",e),onSchemaChange:e=>this.state.isEditMode&&this.onDatasourcePropChange("schema",e),onDbChange:e=>this.state.isEditMode&&this.onDatasourcePropChange("database",e),formMode:!1,handleError:this.props.addDangerToast,readOnly:!this.state.isEditMode})})}),(0,V.Y)("div",{css:(0,n.AH)({width:"calc(100% - 34px)",marginTop:-16},"",""),children:(0,V.Y)(ie,{fieldKey:"table_name",label:(0,m.t)("Name"),control:(0,V.Y)(Y.A,{controlId:"table_name",onChange:e=>{this.onDatasourcePropChange("table_name",e)},placeholder:(0,m.t)("Dataset name"),disabled:!this.state.isEditMode})})})]}),(0,V.Y)(ie,{fieldKey:"sql",label:(0,m.t)("SQL"),description:(0,m.t)("When specifying SQL, the datasource acts as a view. Superset will use this statement as a subquery while grouping and filtering on the generated parent queries.If changes are made to your SQL query, columns in your dataset will be synced when saving the dataset."),control:null!=(e=this.props.database)&&e.isLoading?(0,V.FD)(V.FK,{children:[this.renderSqlEditorOverlay(),(0,V.Y)(w.A,{hotkeys:[{name:"formatQuery",key:"ctrl+shift+f",descr:(0,m.t)("Format SQL query"),func:()=>{this.onQueryFormat()}}],language:"sql",offerEditInModal:!1,minLines:10,maxLines:1/0,readOnly:!this.state.isEditMode,resize:"both"})]}):(0,V.Y)(w.A,{css:e=>n.AH`
                            margin-top: ${3*e.sizeUnit}px;
                          `,hotkeys:[{name:"formatQuery",key:"ctrl+shift+f",descr:(0,m.t)("Format SQL query"),func:()=>{this.onQueryFormat()}}],language:"sql",offerEditInModal:!1,minLines:10,maxLines:1/0,readOnly:!this.state.isEditMode,resize:"both"}),additionalControl:(0,V.FD)("div",{css:n.AH`
                          position: absolute;
                          right: 0;
                          top: 0;
                          z-index: 2;
                          display: flex;
                        `,children:[(0,V.Y)(P.$,{disabled:null==(t=this.props.database)?void 0:t.isLoading,tooltip:(0,m.t)("Open SQL Lab in a new tab"),buttonStyle:"secondary",onClick:()=>{this.openOnSqlLab()},icon:(0,V.Y)(U.F.ExportOutlined,{iconSize:"s"})}),(0,V.Y)(P.$,{disabled:null==(a=this.props.database)?void 0:a.isLoading,tooltip:(0,m.t)("Run query"),buttonStyle:"primary",onClick:()=>{this.onQueryRun()},icon:(0,V.Y)(U.F.CaretRightFilled,{iconSize:"s"})})]})}),(null==(i=this.props.database)?void 0:i.queryResult)&&(0,V.FD)(V.FK,{children:[(0,V.FD)("div",{css:e=>n.AH`
                          margin-bottom: ${e.sizeUnit}px;
                        `,children:[(0,V.Y)("span",{css:e=>n.AH`
                            color: ${e.colorText};
                            font-size: ${e.fontSizeSM}px;
                          `,children:(0,m.t)("In this view you can preview the first 25 rows. ")}),this.renderOpenInSqlLabLink(),(0,V.Y)("span",{css:e=>n.AH`
                            color: ${e.colorText};
                            font-size: ${e.fontSizeSM}px;
                          `,children:(0,m.t)(" to see details.")})]}),(0,V.Y)(Me,{data:null==(o=this.props.database)?void 0:o.queryResult.data,queryId:null==(s=this.props.database)?void 0:s.queryResult.query.id,orderedColumnKeys:null==(r=this.props.database)?void 0:r.queryResult.columns.map(e=>e.column_name),expandedColumns:null==(l=this.props.database)?void 0:l.queryResult.expandedColumns,height:300,allowHTML:!0})]}),(null==(d=this.props.database)?void 0:d.error)&&this.renderSqlErrorMessage()]})}),this.state.datasourceType===Te.physical.key&&(0,V.Y)(K.Col,{xs:24,md:12,children:this.state.isSqla&&(0,V.Y)(ie,{fieldKey:"tableSelector",label:(0,m.t)("Physical"),control:(0,V.Y)("div",{css:qe,children:(0,V.Y)(x.Ay,{clearable:!1,database:{...g.database,database_name:(null==(h=g.database)?void 0:h.database_name)||(null==(u=g.database)?void 0:u.name)},dbId:null==(p=g.database)?void 0:p.id,handleError:this.props.addDangerToast,catalog:g.catalog,schema:g.schema,sqlLabMode:!1,tableValue:g.table_name,onCatalogChange:this.state.isEditMode?e=>this.onDatasourcePropChange("catalog",e):void 0,onSchemaChange:this.state.isEditMode?e=>this.onDatasourcePropChange("schema",e):void 0,onDbChange:this.state.isEditMode?e=>this.onDatasourcePropChange("database",e):void 0,onTableSelectChange:this.state.isEditMode?e=>this.onDatasourcePropChange("table_name",e):void 0,readOnly:!this.state.isEditMode})}),description:(0,m.t)("The pointer to a physical table (or view). Keep in mind that the chart is associated to this Superset logical table, and this logical table points the physical table referenced here.")})})]})]})}renderErrors(){return this.state.errors.length>0?(0,V.Y)(N.F,{css:e=>({marginBottom:4*e.sizeUnit}),type:"error",message:(0,V.Y)(V.FK,{children:this.state.errors.map(e=>(0,V.Y)("div",{children:e},e))})}):null}renderMetricCollection(){const{datasource:e}=this.state,{metrics:t}=e,a=null!=t&&t.length?this.sortMetrics(t):[];return(0,V.Y)(de,{tableColumns:["metric_name","verbose_name","expression"],sortColumns:["metric_name","verbose_name","expression"],columnLabels:{metric_name:(0,m.t)("Metric Key"),verbose_name:(0,m.t)("Label"),expression:(0,m.t)("SQL expression")},columnLabelTooltips:{metric_name:(0,m.t)("This field is used as a unique identifier to attach the metric to charts. It is also used as the alias in the SQL query.")},expandFieldset:(0,V.Y)(Ie,{children:(0,V.FD)(oe,{compact:!0,children:[(0,V.Y)(ie,{fieldKey:"description",label:(0,m.t)("Description"),control:(0,V.Y)(Y.A,{controlId:"description",placeholder:(0,m.t)("Description")})}),(0,V.Y)(ie,{fieldKey:"d3format",label:(0,m.t)("D3 format"),control:(0,V.Y)(Y.A,{controlId:"d3format",placeholder:"%y/%m/%d"})}),(0,V.Y)(ie,{fieldKey:"currency",label:(0,m.t)("Metric currency"),control:(0,V.Y)(T.A,{currencySelectOverrideProps:{placeholder:(0,m.t)("Select or type currency symbol")},symbolSelectAdditionalStyles:n.AH`
                      max-width: 30%;
                    `})}),(0,V.Y)(ie,{label:(0,m.t)("Certified by"),fieldKey:"certified_by",description:(0,m.t)("Person or group that has certified this metric"),control:(0,V.Y)(Y.A,{controlId:"certified_by",placeholder:(0,m.t)("Certified by")})}),(0,V.Y)(ie,{label:(0,m.t)("Certification details"),fieldKey:"certification_details",description:(0,m.t)("Details of the certification"),control:(0,V.Y)(Y.A,{controlId:"certification_details",placeholder:(0,m.t)("Certification details")})}),(0,V.Y)(ie,{label:(0,m.t)("Warning"),fieldKey:"warning_markdown",description:(0,m.t)("Optional warning about use of this metric"),control:(0,V.Y)(w.A,{controlId:"warning_markdown",language:"markdown",offerEditInModal:!1,resize:"vertical"})})]})}),collection:a,allowAddItem:!0,onChange:this.onDatasourcePropChange.bind(this,"metrics"),itemGenerator:()=>({metric_name:(0,m.t)("<new metric>"),verbose_name:"",expression:""}),itemCellProps:{expression:()=>({width:"240px"})},itemRenderers:{metric_name:(e,t,a,n)=>(0,V.FD)(be,{children:[n.is_certified&&(0,V.Y)(k.T,{certifiedBy:n.certified_by,details:n.certification_details}),n.warning_markdown&&(0,V.Y)(_.A,{warningMarkdown:n.warning_markdown}),(0,V.Y)(I.z,{canEdit:!0,title:e,onSaveTitle:t,maxWidth:300})]}),verbose_name:(e,t)=>(0,V.Y)(Y.A,{canEdit:!0,value:e,onChange:t}),expression:(e,t)=>(0,V.Y)(w.A,{canEdit:!0,initialValue:e,onChange:t,extraClasses:["datasource-sql-expression"],language:"sql",offerEditInModal:!1,minLines:5,textAreaStyles:{minWidth:"200px",maxWidth:"450px"},resize:"both"}),description:(e,t,a)=>(0,V.Y)(ke,{label:a,formElement:(0,V.Y)(Y.A,{value:e,onChange:t})}),d3format:(e,t,a)=>(0,V.Y)(ke,{label:a,formElement:(0,V.Y)(Y.A,{value:e,onChange:t})})},allowDeletes:!0,stickyHeader:!0})}render(){const{datasource:e,activeTabKey:t}=this.state,{metrics:a}=e,n=null!=a&&a.length?this.sortMetrics(a):[],{theme:i}=this.props;return(0,V.FD)(ge,{children:[this.renderErrors(),(0,V.Y)(N.F,{css:e=>({marginBottom:4*e.sizeUnit}),type:"warning",message:(0,V.FD)(V.FK,{children:[" ",(0,V.FD)("strong",{children:[(0,m.t)("Be careful.")," "]}),(0,m.t)("Changing these settings will affect all charts using this dataset, including charts owned by other people.")]})}),(0,V.Y)(fe,{id:"table-tabs",onChange:this.handleTabSelect,defaultActiveKey:t,items:[{key:Ae,label:(0,m.t)("Source"),children:this.renderSourceFieldset(i)},{key:"METRICS",label:(0,V.Y)(ze,{collection:n,title:(0,m.t)("Metrics")}),children:this.renderMetricCollection()},{key:"COLUMNS",label:(0,V.Y)(ze,{collection:this.state.databaseColumns,title:(0,m.t)("Columns")}),children:(0,V.FD)(xe,{children:[(0,V.Y)(ve,{children:(0,V.Y)(Se,{children:(0,V.FD)(P.$,{buttonSize:"small",buttonStyle:"tertiary",onClick:this.syncMetadata,className:"sync-from-source",disabled:this.state.isEditMode,children:[(0,V.Y)(U.F.DatabaseOutlined,{iconSize:"m"}),(0,m.t)("Sync columns from source")]})})}),(0,V.Y)(Fe,{className:"columns-table",columns:this.state.databaseColumns,datasource:e,onColumnsChange:e=>this.setColumns({databaseColumns:e}),onDatasourceChange:this.onDatasourceChange}),this.state.metadataLoading&&(0,V.Y)(q.R,{})]})},{key:"CALCULATED_COLUMNS",label:(0,V.Y)(ze,{collection:this.state.calculatedColumns,title:(0,m.t)("Calculated columns")}),children:(0,V.Y)(xe,{children:(0,V.Y)(Fe,{columns:this.state.calculatedColumns,onColumnsChange:e=>this.setColumns({calculatedColumns:e}),columnLabelTooltips:{column_name:(0,m.t)("This field is used as a unique identifier to attach the calculated dimension to charts. It is also used as the alias in the SQL query.")},onDatasourceChange:this.onDatasourceChange,datasource:e,editableColumnName:!0,showExpression:!0,allowAddItem:!0,allowEditDataType:!0,itemGenerator:()=>({column_name:(0,m.t)("<new column>"),filterable:!0,groupby:!0,expression:(0,m.t)("<enter SQL expression here>"),expanded:!0})})})},{key:"USAGE",label:(0,V.Y)(ze,{collection:{length:this.state.usageChartsCount},title:(0,m.t)("Usage")}),children:(0,V.Y)(xe,{children:(0,V.Y)(ue,{datasourceId:e.id,charts:this.state.usageCharts,totalCount:this.state.usageChartsCount,onFetchCharts:this.fetchUsageData,addDangerToast:this.props.addDangerToast})})},{key:"SETTINGS",label:(0,m.t)("Settings"),children:(0,V.FD)(K.Row,{gutter:16,children:[(0,V.Y)(K.Col,{xs:24,md:12,children:(0,V.Y)(Ie,{children:this.renderSettingsFieldset()})}),(0,V.Y)(K.Col,{xs:24,md:12,children:(0,V.Y)(Ie,{children:this.renderAdvancedFieldset()})})]})}]})]})}componentDidMount(){W().bind("ctrl+shift+f",e=>(e.preventDefault(),this.state.isEditMode&&this.onQueryFormat(),!1)),this.fetchUsageData()}componentWillUnmount(){W().unbind("ctrl+shift+f"),this.props.resetQuery()}}Ue.defaultProps={onChange:()=>{},setIsEditing:()=>{}},Ue.propTypes=Le;const Re=(0,C.b)(Ue),Ke=(0,D.Ay)((0,d.Ng)(e=>({database:null==e?void 0:e.database}),e=>({runQuery:t=>e(function(e){return async function(t){try{t(B(!0)),t({type:"SET_QUERY_RESULT",payload:await Q(e)})}catch(e){t(function(e){return{type:"SET_QUERY_ERROR",payload:e}}(e.message))}finally{t(B(!1))}}}(t)),resetQuery:()=>e({type:"RESET_DATABASE_STATE"}),formatQuery:t=>e(function(e){return function(t){return g.A.post({endpoint:"/api/v1/sqllab/format_sql/",body:JSON.stringify({sql:e}),headers:{"Content-Type":"application/json"}}).then(e=>(t({type:"SET_QUERY",payload:e.json.result}),e))}}(t))}))(Re))},39438:(e,t,a)=>{a.d(t,{A:()=>C});var n=a(38221),i=a.n(n),o=a(24002),s=a(5556),r=a.n(s),l=a(29645),d=a(52167),c=a(88217),h=a(41876),u=a(95018),m=a(74098),p=a(98837),g=(a(15850),a(18865)),b=a(2445);const f={name:r().string,onChange:r().func,initialValue:r().string,height:r().number,minLines:r().number,maxLines:r().number,offerEditInModal:r().bool,language:r().oneOf([null,"json","html","sql","markdown","javascript","handlebars"]),aboveEditorSection:r().node,readOnly:r().bool,resize:r().oneOf([null,"block","both","horizontal","inline","none","vertical"]),textAreaStyles:r().object,tooltipOptions:r().object,hotkeys:r().array,debounceDelay:r().number};class y extends o.Component{constructor(e){super(e),e.debounceDelay&&(this.debouncedOnChange=i()(e.onChange,e.debounceDelay))}componentDidUpdate(e){this.props.onChange!==e.onChange&&this.props.debounceDelay&&(this.debouncedOnChange&&this.debouncedOnChange.cancel(),this.debouncedOnChange=i()(this.props.onChange,this.props.debounceDelay))}handleChange(e){const t="object"==typeof e?e.target.value:e;this.debouncedOnChange?this.debouncedOnChange(t):this.props.onChange(t)}componentWillUnmount(){this.debouncedOnChange&&this.debouncedOnChange.cancel()}renderEditor(e=!1){const t=e?40:this.props.minLines||12;if(this.props.language){const a={border:`1px solid ${this.props.theme.colorBorder}`,minHeight:`${t}em`,width:"auto",...this.props.textAreaStyles};this.props.resize&&(a.resize=this.props.resize),this.props.readOnly&&(a.backgroundColor="#f2f2f2");const n=e=>{this.props.hotkeys.forEach(t=>{e.commands.addCommand({name:t.name,bindKey:{win:t.key,mac:t.key},exec:t.func})})},i=(0,b.Y)("div",{children:(0,b.Y)(d.S9,{mode:this.props.language,style:a,minLines:t,maxLines:e?1e3:this.props.maxLines,editorProps:{$blockScrolling:!0},onLoad:n,defaultValue:this.props.initialValue,readOnly:this.props.readOnly,...this.props,onChange:this.handleChange.bind(this)},this.props.name)});return this.props.tooltipOptions?(0,b.Y)(u.m,{...this.props.tooltipOptions,children:i}):i}const a=(0,b.Y)("div",{children:(0,b.Y)(l.Input.TextArea,{placeholder:(0,m.t)("textarea"),onChange:this.handleChange.bind(this),defaultValue:this.props.initialValue,disabled:this.props.readOnly,style:{height:this.props.height},"aria-required":this.props["aria-required"]})});return this.props.tooltipOptions?(0,b.Y)(u.m,{...this.props.tooltipOptions,children:a}):a}renderModalBody(){return(0,b.FD)(b.FK,{children:[(0,b.Y)("div",{children:this.props.aboveEditorSection}),this.renderEditor(!0)]})}render(){const e=(0,b.Y)(g.A,{...this.props});return(0,b.FD)("div",{children:[e,this.renderEditor(),this.props.offerEditInModal&&(0,b.Y)(h.g,{modalTitle:e,triggerNode:(0,b.Y)(c.$,{buttonSize:"small",style:{marginTop:this.props.theme.sizeUnit},children:(0,m.t)("Edit %s in modal",this.props.language)}),modalBody:this.renderModalBody(!0),responsive:!0})]})}}y.propTypes=f,y.defaultProps={onChange:()=>{},initialValue:"",height:250,minLines:3,maxLines:10,offerEditInModal:!0,readOnly:!1,resize:null,textAreaStyles:{},tooltipOptions:{},hotkeys:[],debounceDelay:null};const C=(0,p.b)(y)},40984:(e,t,a)=>{a.d(t,{A:()=>l,Q:()=>s});var n=a(14735),i=a(52966),o=a(29898);const s=e=>{var t;return null==(t=new Intl.NumberFormat("en-US",{style:"currency",currency:e.symbol}).formatToParts(1).find(e=>"currency"===e.type))?void 0:t.value};class r extends n.A{constructor(e){super(e=>this.format(e)),this.d3Format=void 0,this.locale=void 0,this.currency=void 0,this.d3Format=e.d3Format||i.A.SMART_NUMBER,this.currency=e.currency,this.locale=e.locale||"en-US"}hasValidCurrency(){var e;return Boolean(null==(e=this.currency)?void 0:e.symbol)}getNormalizedD3Format(){return this.d3Format.replace(/\$|%/g,"")}format(e){const t=(0,o.gV)(this.getNormalizedD3Format())(e);return this.hasValidCurrency()?"prefix"===this.currency.symbolPosition?`${s(this.currency)} ${t}`:`${t} ${s(this.currency)}`:t}}const l=r},54569:(e,t,a)=>{a.d(t,{T:()=>l});var n=a(2445),i=a(74098),o=a(81465),s=a(8558),r=a(95018);function l({certifiedBy:e,details:t,size:a="l"}){const l=(0,o.DP)();return(0,n.Y)(r.m,{id:"certified-details-tooltip",title:(0,n.FD)(n.FK,{children:[e&&(0,n.Y)("div",{children:(0,n.Y)("strong",{children:(0,i.t)("Certified by %s",e)})}),(0,n.Y)("div",{children:t})]}),children:(0,n.Y)(s.F.Certified,{iconColor:l.colorPrimary,iconSize:a})})}},65729:(e,t,a)=>{a.d(t,{l:()=>o});var n=a(2445),i=a(29645);const o=Object.assign(function(e){return(0,n.Y)(i.Form,{...e})},{useForm:i.Form.useForm,Item:i.Form.Item,List:i.Form.List,ErrorList:i.Form.ErrorList,Provider:i.Form.Provider})},78878:(e,t,a)=>{function n(e,t){return e===t||!e&&!t||!!(e&&t&&e.length===t.length&&e.every((e,a)=>e===t[a]))}a.d(t,{A:()=>n})},82384:(e,t,a)=>{a.d(t,{e:()=>i});var n=a(29645);const i=(0,a(81465).I4)(n.Form.Item)`
  ${({theme:e})=>`\n    &.ant-form-item > .ant-row > .ant-form-item-label {\n      padding-bottom: ${e.paddingXXS}px;\n    }\n    .ant-form-item-label {\n      & > label {\n        font-size: ${e.fontSizeSM}px;\n        &.ant-form-item-required:not(.ant-form-item-required-mark-optional) {\n          &::before {\n            display: none;\n          }\n          &::after {\n            display: inline-block;\n            visibility: visible;\n            color: ${e.colorError};\n            font-size: ${e.fontSizeSM}px;\n            content: '*';\n          }\n        }\n      }\n    }\n    .ant-form-item-extra {\n      margin-top: ${e.sizeUnit}px;\n      font-size: ${e.fontSizeSM}px;\n    }\n  `}
`},94083:(e,t,a)=>{a.d(t,{Ay:()=>x,Kt:()=>_,cs:()=>C});var n=a(2445),i=a(24002),o=a(74098),s=a(81465),r=a(59744),l=a(2801),d=a(54569),c=a(23195),h=a(9876),u=a(8558),m=a(9992),p=a(35273),g=a(64457),b=a(98244);const f=s.I4.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.sizeUnit}px;\n      margin-top: ${5*e.sizeUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .divider {\n      border-bottom: 1px solid ${e.colorSplit};\n      margin: 15px 0;\n    }\n\n    .table-length {\n      color: ${e.colorTextSecondary};\n    }\n\n    .select {\n      flex: 1;\n      max-width: calc(100% - ${e.sizeUnit+30}px)\n    }\n  `}
`,y=s.I4.span`
  align-items: center;
  display: flex;
  white-space: nowrap;

  svg,
  small {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,C=({table:e})=>{const{value:t,type:a,extra:i}=e;return(0,n.FD)(y,{title:t,children:["view"===a?(0,n.Y)(u.F.FunctionOutlined,{iconSize:"m"}):"materialized_view"===a?(0,n.Y)(u.F.ProfileOutlined,{iconSize:"m"}):(0,n.Y)(u.F.TableOutlined,{iconSize:"m"}),(null==i?void 0:i.certification)&&(0,n.Y)(d.T,{certifiedBy:i.certification.certified_by,details:i.certification.details,size:"l"}),(null==i?void 0:i.warning_markdown)&&(0,n.Y)(p.A,{warningMarkdown:i.warning_markdown,size:"l",marginRight:4}),t]})},v=({database:e,emptyState:t,formMode:a=!1,getDbList:s,handleError:d,isDatabaseSelectEnabled:u=!0,onDbChange:p,onCatalogChange:y,onSchemaChange:v,readOnly:_=!1,onEmptyResults:x,catalog:S,schema:Y,sqlLabMode:w=!0,tableSelectMode:A="single",tableValue:D,onTableSelectChange:T,customTableOptionLabelRenderer:E})=>{const{addSuccessToast:z}=(0,g.Yf)(),[F,k]=(0,i.useState)(S),[I,L]=(0,i.useState)(Y),[$,M]=(0,i.useState)(void 0),{currentData:O,isFetching:q,refetch:U}=(0,b.ty)({dbId:null==e?void 0:e.id,catalog:F,schema:I,onSuccess:(e,t)=>{t&&z((0,o.t)("List updated"))},onError:e=>{(0,r.h4)(e).then(e=>{d((0,r.hi)((0,o.t)("There was an error loading the tables"),e))})}}),R=(0,i.useMemo)(()=>O?O.options.map(e=>({value:e.value,label:E?E(e):(0,n.Y)(C,{table:e}),text:e.value})):[],[O,E]);(0,i.useEffect)(()=>{void 0===e&&(k(void 0),L(void 0),M(void 0))},[e,A]),(0,i.useEffect)(()=>{M("single"===A?R.find(e=>e.value===D):(null==R?void 0:R.filter(e=>e&&(null==D?void 0:D.includes(e.value))))||[])},[R,D,A]);const K=(0,i.useMemo)(()=>(e,t)=>{const a=e.trim().toLowerCase(),{value:n}=t;return n.toLowerCase().includes(a)},[]);return(0,n.FD)(f,{children:[(0,n.Y)(h.RA,{db:e,emptyState:t,formMode:a,getDbList:s,handleError:d,onDbChange:_?void 0:e=>{p&&p(e),k(void 0),L(void 0),M("single"===A?void 0:[])},onEmptyResults:x,onCatalogChange:_?void 0:e=>{k(e),y&&y(e),L(void 0),M("single"===A?void 0:[])},catalog:F,onSchemaChange:_?void 0:e=>{L(e),v&&v(e),M("single"===A?void 0:[])},schema:I,sqlLabMode:w,isDatabaseSelectEnabled:u&&!_,readOnly:_}),w&&!a&&(0,n.Y)("div",{className:"divider"}),function(){const e=I&&!a&&_||!I,t=w?(0,n.Y)(c.l,{children:(0,o.t)("See table schema")}):(0,n.Y)(c.l,{children:(0,o.t)("Table")});return i=(0,n.Y)(l.A,{ariaLabel:(0,o.t)("Select table or type to search tables"),disabled:e,filterOption:K,header:t,labelInValue:!0,loading:q,name:"select-table",onChange:e=>{return t=e,void(I?null==T||T(Array.isArray(t)?t.map(e=>null==e?void 0:e.value):null==t?void 0:t.value,F,I):M(t));var t},options:R,placeholder:(0,o.t)("Select table or type to search tables"),showSearch:!0,mode:A,value:$,allowClear:"multiple"===A,allowSelectAll:!1}),s=!_&&(0,n.Y)(m.A,{onClick:()=>U(),tooltipContent:(0,o.t)("Force refresh table list")}),(0,n.FD)("div",{className:"section",children:[(0,n.Y)("span",{className:"select",children:i}),(0,n.Y)("span",{className:"refresh",children:s})]});var i,s}()]})},_=e=>(0,n.Y)(v,{tableSelectMode:"multiple",...e}),x=v}}]);