"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3120],{53048:(e,n,t)=>{t.d(n,{M:()=>d});var a=t(2445),l=t(24002),o=t(59674),i=t(81465),r=t(8558),s=t(27509);function d({endTime:e,isRunning:n,startTime:t,status:d="success"}){const c=(0,i.DP)(),[m,u]=(0,l.useState)("00:00:00.00"),p=(0,l.useRef)();return(0,l.useEffect)(()=>{const a=()=>{p.current&&(clearInterval(p.current),p.current=void 0)};return n&&(p.current=setInterval(()=>{if(t){const l=e||(0,o.tB)();t<l&&u((0,o.RW)(t,l)),n||a()}},30)),a},[e,n,t]),(0,a.Y)(s.JU,{icon:(0,a.Y)(r.F.ClockCircleOutlined,{iconSize:"m"}),type:d,role:"timer",style:{fontFamily:c.fontFamilyCode},children:m})}},57249:(e,n,t)=>{t.d(n,{f:()=>h});var a=t(2445),l=t(24002),o=t(81465),i=t(74098),r=t(8558),s=t(97163),d=t(88217),c=t(42566);const m=o.I4.span`
  margin-right: ${({theme:e})=>2*e.sizeUnit}px;
`,u=(0,a.Y)(r.F.QuestionCircleOutlined,{iconSize:"m"}),p=({show:e,onHide:n,onConfirm:t,title:l,body:o,confirmText:r=(0,i.t)("Confirm"),cancelText:p=(0,i.t)("Cancel"),confirmButtonStyle:h="primary",icon:v=u,loading:f=!1})=>(0,a.Y)(s.aF,{centered:!0,responsive:!0,onHide:n,show:e,width:"600px",title:(0,a.FD)(a.FK,{children:[(0,a.Y)(m,{children:v}),l]}),footer:(0,a.FD)(a.FK,{children:[(0,a.Y)(d.$,{buttonStyle:"secondary",onClick:n,disabled:f,children:p}),(0,a.Y)(d.$,{buttonStyle:h,onClick:t,loading:f,children:r})]}),children:"string"==typeof o?(0,a.Y)(c.o.Text,{children:o}):o}),h=()=>{const[e,n]=(0,l.useState)(null),[t,o]=(0,l.useState)(!1),i=(0,l.useCallback)(e=>{n(e)},[]),r=(0,l.useCallback)(()=>{t||n(null)},[t]),s=(0,l.useCallback)(async()=>{if(e)try{o(!0),await e.onConfirm(),n(null)}catch(e){console.error("Confirm action failed:",e)}finally{o(!1)}},[e]);return{showConfirm:i,ConfirmModal:e?(0,a.Y)(p,{show:!!e,onHide:r,onConfirm:s,title:e.title,body:e.body,confirmText:e.confirmText,cancelText:e.cancelText,confirmButtonStyle:e.confirmButtonStyle,icon:e.icon,loading:t}):null}}},77290:(e,n,t)=>{t.d(n,{D:()=>U});var a=t(62193),l=t.n(a),o=t(2445),i=t(24002),r=t(51692),s=t(22750),d=t(29645),c=t(49965),m=t(8558),u=t(88217),p=t(97163),h=t(76576),v=t(74098),f=t(79378),y=t(81465),b=t(99106),g=t(59744),w=t(7741),x=t(59674),C=t(61225),S=t(58561),Y=t.n(S),_=t(49299),D=t(91412),T=t(89105),$=t(28674),k=t(94921),F=t(85923);const N=y.I4.div`
  ${({theme:e})=>`\n    .sdm-body {\n      padding: ${4*e.sizeUnit}px ${6*e.sizeUnit}px;\n    }\n\n    .sdm-prompt {\n      margin-bottom: ${4*e.sizeUnit}px;\n      color: ${e.colorTextSecondary};\n    }\n\n    .sdm-radio-group {\n      display: flex;\n      flex-direction: column;\n      gap: ${6*e.sizeUnit}px;\n    }\n\n    .sdm-radio-option {\n      display: flex;\n      flex-direction: column;\n      gap: ${3*e.sizeUnit}px;\n    }\n\n    .sdm-radio {\n      margin: 0;\n      .ant-radio {\n        margin-right: ${2*e.sizeUnit}px;\n      }\n      .ant-radio-wrapper {\n        color: ${e.colorText};\n      }\n    }\n\n    .sdm-form-field {\n      margin-left: 0;\n      max-width: 400px;\n    }\n\n    .sdm-overwrite-msg {\n      padding: ${4*e.sizeUnit}px ${6*e.sizeUnit}px;\n      text-align: center;\n      color: ${e.colorText};\n    }\n  `}
`,O=async(e,n,t,a,l,o)=>{const i=`api/v1/dataset/${n}?override_columns=${o}`,r=JSON.stringify({sql:t,columns:a,owners:l,database_id:e});return(await f.A.put({endpoint:i,headers:{"Content-Type":"application/json"},body:r})).json.result},I=(0,v.t)("Untitled Dataset"),U=({visible:e,onHide:n,buttonTextOnSave:t,buttonTextOnOverwrite:a,modalDescription:y,datasource:S,openWindow:U=!0,formData:z={}})=>{const P=(0,C.d4)(e=>{var n;return(null==(n=e.common)||null==(n=n.conf)?void 0:n.DEFAULT_VIZ_TYPE)||w.Y.Table}),A=()=>`${(null==S?void 0:S.name)||I} ${(0,x.XV)().format("L HH:mm:ss")}`,[L,q]=(0,i.useState)(A()),[B,E]=(0,i.useState)(T.lr.SaveNew),[H,j]=(0,i.useState)(!1),[K,X]=(0,i.useState)({}),[J,R]=(0,i.useState)(void 0),[V,G]=(0,i.useState)(!1),M=(0,C.d4)(e=>e.user),W=(0,C.wA)(),[Q,Z]=(0,i.useState)(!1),ee=e=>{U?window.open(e,"_blank","noreferrer"):window.location.href=e},ne={...T.V0,...z||{}},te=(0,i.useCallback)(async(e="")=>{const{userId:n}=M,t=Y().encode({filters:[{col:"table_name",opr:"ct",value:e},{col:"owners",opr:"rel_m_m",value:n}],order_column:"changed_on_delta_humanized",order_direction:"desc"});return f.A.get({endpoint:`/api/v1/dataset/?q=${t}`}).then(e=>({data:e.json.result.map(e=>({value:e.table_name,label:e.table_name,datasetid:e.id,owners:e.owners})),totalCount:e.json.count}))},[M]),ae=B===T.lr.SaveNew&&0===L.length||B===T.lr.OverwriteDataset&&l()(J);return(0,o.Y)(p.aF,{show:e,name:(0,v.t)("Save or Overwrite Dataset"),title:(0,o.Y)(r.r,{title:(0,v.t)("Save or Overwrite Dataset"),icon:(0,o.Y)(m.F.SaveOutlined,{})}),onHide:n,footer:(0,o.FD)(h.s,{align:"center",justify:"flex-end",gap:"8px",children:[(0,b.G7)(b.TO.EnableTemplateProcessing)&&(0,o.FD)("div",{style:{display:"flex",alignItems:"center"},children:[(0,o.Y)(d.Checkbox,{checked:Q,onChange:e=>{var n;return Z(null!=(n=e.target.checked)&&n)}}),(0,o.Y)("span",{style:{marginLeft:"5px"},children:(0,v.t)("Include Template Parameters")})]}),B===T.lr.SaveNew&&(0,o.Y)(u.$,{disabled:ae,buttonStyle:"primary",onClick:()=>{var e,t;G(!0);const a=null!=(e=null==S?void 0:S.columns)?e:[];let l;if("string"==typeof(null==S?void 0:S.templateParams)&&Q)try{const e=JSON.parse(S.templateParams);e._filters&&delete e._filters,l=JSON.stringify(e)}catch(e){l=void 0}W((0,_.createDatasource)({sql:S.sql,dbId:S.dbId||(null==S||null==(t=S.database)?void 0:t.id),catalog:null==S?void 0:S.catalog,schema:null==S?void 0:S.schema,templateParams:l,datasourceName:L})).then(e=>(0,k.T)(e.id,"table",{...ne,datasource:`${e.id}__table`,...P===w.Y.Table&&{all_columns:a.map(e=>e.column_name)}})).then(e=>{G(!1);const t=(0,$.eX)(null,{[F.vX.formDataKey.name]:e});ee(t),q(A()),n()}).catch(()=>{G(!1),(0,D.iB)((0,v.t)("An error occurred saving dataset"))})},loading:V,children:t}),B===T.lr.OverwriteDataset&&(0,o.FD)(o.FK,{children:[H&&(0,o.Y)(u.$,{onClick:()=>{j(!1),X({})},children:(0,v.t)("Back")}),(0,o.Y)(u.$,{className:"md",buttonStyle:"primary",onClick:async()=>{if(H){G(!0);try{var e,t,a;const[,l]=await Promise.all([O(null==S?void 0:S.dbId,null==K?void 0:K.datasetid,null==S?void 0:S.sql,null==S||null==(e=S.columns)?void 0:e.map(e=>({column_name:e.column_name,type:e.type,is_dttm:e.is_dttm})),null==K||null==(t=K.owners)?void 0:t.map(e=>e.id),!0),(0,k.T)(K.datasetid,"table",{...ne,datasource:`${K.datasetid}__table`,...P===w.Y.Table&&{all_columns:null==S||null==(a=S.columns)?void 0:a.map(e=>e.column_name)}})]);G(!1);const o=(0,$.eX)(null,{[F.vX.formDataKey.name]:l});ee(o),j(!1),q(A()),n()}catch(e){G(!1),(0,g.h4)(e).then(e=>{W((0,D.iB)(e.error||(0,v.t)("An error occurred while overwriting the dataset")))})}}else j(!0)},disabled:ae,loading:V,children:a})]})]}),children:(0,o.FD)(N,{children:[!H&&(0,o.FD)("div",{className:"sdm-body",children:[y&&(0,o.Y)("div",{className:"sdm-prompt",children:y}),(0,o.FD)(s.s.Group,{onChange:e=>{E(Number(e.target.value))},value:B,className:"sdm-radio-group",children:[(0,o.FD)("div",{className:"sdm-radio-option",children:[(0,o.Y)(s.s,{className:"sdm-radio",value:1,children:(0,v.t)("Save as new")}),(0,o.Y)("div",{className:"sdm-form-field",children:(0,o.Y)(d.Input,{value:L,onChange:e=>{q(e.target.value)},disabled:1!==B,placeholder:(0,v.t)("Dataset name")})})]}),(0,o.FD)("div",{className:"sdm-radio-option",children:[(0,o.Y)(s.s,{className:"sdm-radio",value:2,children:(0,v.t)("Overwrite existing")}),(0,o.Y)("div",{className:"sdm-form-field",children:(0,o.Y)(c.A,{allowClear:!0,showSearch:!0,placeholder:(0,v.t)("Select or type dataset name"),ariaLabel:(0,v.t)("Existing dataset"),onChange:(e,n)=>{X(n),R(e)},options:e=>te(e),value:J,filterOption:(e,n)=>n.value.toLowerCase().includes(e.toLowerCase()),disabled:2!==B,getPopupContainer:()=>document.body})})]})]})]}),H&&(0,o.Y)("div",{className:"sdm-overwrite-msg",children:(0,v.t)("Are you sure you want to overwrite this dataset?")})]})})}},84986:(e,n,t)=>{t.d(n,{l:()=>a});const a=e=>{var n;const t="number"==typeof e.version;return{columns:e.columns||[],name:e.datasource_name||e.name||"Untitled",dbId:(null==(n=e.database)?void 0:n.id)||e.dbId||0,sql:e.sql||"",catalog:e.catalog||null,schema:e.schema||null,templateParams:t&&e.templateParams||null}}},89063:(e,n,t)=>{t.d(n,{F:()=>i});var a=t(2445),l=t(95018),o=t(88217);const i=({children:e=null,className:n="",onClick:t=()=>{},placement:i="top",style:r={},tooltip:s=null,mouseEnterDelay:d=.3,mouseLeaveDelay:c=.15})=>{const m=(0,a.Y)(o.$,{onClick:t,style:{padding:0,...r},buttonStyle:"link",className:`IconTooltip ${n}`,children:e});return s?(0,a.Y)(l.m,{id:"tooltip",title:s,placement:i,mouseEnterDelay:d,mouseLeaveDelay:c,children:m}):m}}}]);