"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9918],{35173:(e,t,n)=>{n.r(t),n.d(t,{ChartCreation:()=>F,default:()=>k});var a=n(2445),i=n(24002),s=n(58561),r=n.n(s),o=n(74098),l=n(79378),d=n(74842),c=n(81465),h=n(98837),p=n(31296),u=n(85923),m=n(71519),g=n(61574),b=n(29645),f=n(49965),v=n(88217),x=n(64457),y=n(37788),$=n(90886),_=n(32064),D=n(94265),w=n(8558);const z=((0,_.Ay)().common.conf.VIZ_TYPE_DENYLIST||[]).concat(Object.values(u.fJ)),S=c.I4.div`
  ${({theme:e})=>`\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    max-width: ${y.rE}px;\n    max-height: calc(100vh - 56px);\n    border-radius: ${e.borderRadius}px;\n    background-color: ${e.colorBgContainer};\n    margin-left: auto;\n    margin-right: auto;\n    padding-left: ${e.padding}px;\n    padding-right: ${e.padding}px;\n    padding-bottom: ${e.padding}px;\n\n    h3 {\n      padding-bottom: ${e.paddingSM}px;\n    }\n\n    & .dataset {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      margin-bottom: ${e.marginMD}px;\n\n      & > div {\n        min-width: 200px;\n        width: 300px;\n      }\n\n      & > span {\n        color: ${e.colorText};\n        margin-left: ${e.margin}px;\n      }\n    }\n\n    & .viz-gallery {\n      border: 1px solid ${e.colorBorder};\n      border-radius: ${e.borderRadius}px;\n      margin: ${e.marginXXS}px 0px;\n      max-height: calc(100vh - 306px);\n      flex: 1;\n    }\n\n    & .footer {\n      flex: 1;\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      align-items: center;\n\n      & > span {\n        color: ${e.colorText};\n        margin-right: ${e.margin}px;\n      }\n    }\n\n    /* The following extra ampersands (&&&&) are used to boost selector specificity */\n\n    &&&& .ant-steps-item-tail {\n      display: none;\n    }\n\n    &&&& .ant-steps-item-icon {\n      margin-right: ${e.marginXS}px;\n      width: ${5*e.sizeUnit}px;\n      height: ${5*e.sizeUnit}px;\n      line-height: ${5*e.sizeUnit}px;\n    }\n\n    &&&& .ant-steps-item-title {\n      line-height: ${5*e.sizeUnit}px;\n    }\n\n    &&&& .ant-steps-item-content {\n      overflow: unset;\n\n      .ant-steps-item-description {\n        margin-top: ${e.sizeUnit}px;\n        padding-bottom: ${e.sizeUnit}px;\n      }\n    }\n\n    &&&& .ant-tooltip-open {\n      display: inline;\n    }\n  `}
`,T=c.I4.span`
  ${({theme:{fontSize:e,fontWeightStrong:t}})=>`\n      font-size: ${e}px;\n      font-weight: ${t};\n    `}
`,C=c.I4.div`
  ${({theme:e})=>`\n    margin-top: ${e.margin}px;\n    margin-bottom: ${e.marginSM}px;\n    margin-left: ${e.marginMD}px;\n  `}
`;class F extends i.PureComponent{constructor(e){super(e),this.state={vizType:null,canCreateDataset:(0,$.L)("can_write","Dataset",e.user.roles)},this.changeDatasource=this.changeDatasource.bind(this),this.changeVizType=this.changeVizType.bind(this),this.gotoSlice=this.gotoSlice.bind(this),this.loadDatasources=this.loadDatasources.bind(this),this.onVizTypeDoubleClick=this.onVizTypeDoubleClick.bind(this)}componentDidMount(){const e=new URLSearchParams(window.location.search).get("dataset");e&&(this.loadDatasources(e,0,1).then(e=>{const t=e.data[0];this.setState({datasource:t})}),this.props.addSuccessToast((0,o.t)("The dataset has been saved")))}exploreUrl(){var e;const t=(0,p.P3)(u.vX.dashboardId);let n=`/explore/?viz_type=${this.state.vizType}&datasource=${null==(e=this.state.datasource)?void 0:e.value}`;return(0,d.A)(t)&&(n+=`&dashboard_id=${t}`),n}gotoSlice(){this.props.history.push(this.exploreUrl())}changeDatasource(e){this.setState({datasource:e})}changeVizType(e){this.setState({vizType:e})}isBtnDisabled(){var e;return!(null!=(e=this.state.datasource)&&e.value&&this.state.vizType)}onVizTypeDoubleClick(){this.isBtnDisabled()||this.gotoSlice()}loadDatasources(e,t,n){const a=r().encode({columns:["id","table_name","datasource_type","database.database_name","schema"],filters:[{col:"table_name",opr:"ct",value:e}],page:t,page_size:n,order_column:"table_name",order_direction:"asc"});return l.A.get({endpoint:`/api/v1/dataset/?q=${a}`}).then(e=>({data:e.json.result.map(e=>({id:e.id,value:`${e.id}__${e.datasource_type}`,label:(0,D.$)(e),customLabel:e.table_name})),totalCount:e.json.count}))}render(){var e;const{theme:t}=this.props,n=this.isBtnDisabled(),i=(0,o.t)("view instructions"),s=this.state.canCreateDataset?(0,a.FD)("span",{children:[(0,a.Y)(m.N_,{to:"/dataset/add/",children:(0,o.t)("Add a dataset")})," ",(0,o.t)("or")," ",(0,a.FD)("a",{href:"https://superset.apache.org/docs/creating-charts-dashboards/creating-your-first-dashboard/#registering-a-new-table",rel:"noopener noreferrer",target:"_blank",children:[`${i} `,(0,a.Y)(w.F.Full,{iconSize:"m",iconColor:t.colorPrimary})]}),"."]}):(0,a.FD)("span",{children:[(0,a.FD)("a",{href:"https://superset.apache.org/docs/creating-charts-dashboards/creating-your-first-dashboard/#registering-a-new-table",rel:"noopener noreferrer",target:"_blank",children:[`${i} `,(0,a.Y)(w.F.Full,{iconSize:"m",iconColor:t.colorPrimary})]}),"."]});return(0,a.FD)(S,{children:[(0,a.Y)("h3",{children:(0,o.t)("Create a new chart")}),(0,a.FD)(b.Steps,{direction:"vertical",size:"small",children:[(0,a.Y)(b.Steps.Step,{title:(0,a.Y)(T,{children:(0,o.t)("Choose a dataset")}),status:null!=(e=this.state.datasource)&&e.value?"finish":"process",description:(0,a.FD)(C,{className:"dataset",children:[(0,a.Y)(f.A,{autoFocus:!0,ariaLabel:(0,o.t)("Dataset"),name:"select-datasource",onChange:this.changeDatasource,options:this.loadDatasources,optionFilterProps:["id","customLabel"],placeholder:(0,o.t)("Choose a dataset"),showSearch:!0,value:this.state.datasource}),s]})}),(0,a.Y)(b.Steps.Step,{title:(0,a.Y)(T,{children:(0,o.t)("Choose chart type")}),status:this.state.vizType?"finish":"process",description:(0,a.Y)(C,{children:(0,a.Y)(y.Ay,{denyList:z,className:"viz-gallery",onChange:this.changeVizType,onDoubleClick:this.onVizTypeDoubleClick,selectedViz:this.state.vizType})})})]}),(0,a.FD)("div",{className:"footer",children:[n&&(0,a.Y)("span",{children:(0,o.t)("Please select both a Dataset and a Chart type to proceed")}),(0,a.Y)(v.$,{buttonStyle:"primary",disabled:n,onClick:this.gotoSlice,children:(0,o.t)("Create new chart")})]})]})}}const k=(0,g.y)((0,x.Ay)((0,h.b)(F)))},92026:(e,t,n)=>{n.d(t,{Kg:()=>g,J8:()=>u,Pz:()=>b,tg:()=>h,pY:()=>p,px:()=>m});var a=n(31463),i=n(81115),s=n(74098),r=n(46772);const o=e=>null!=e&&"function"==typeof e[Symbol.iterator];var l=n(29624),d=n(32064);const c=()=>{var e;const t=(0,d.Ay)();return(null==t||null==(e=t.common)||null==(e=e.conf)?void 0:e.NATIVE_FILTER_DEFAULT_ROW_LIMIT)||1e3},h=({datasetId:e,dependencies:t={},groupby:n,defaultDataMask:a,controlValues:i,filterType:s,sortMetric:o,adhoc_filters:l,time_range:d,granularity_sqla:h,type:p,dashboardId:u,id:m,cascade_parent_column:g,cascade_parent_value:b})=>{var f;const v={};e&&(v.datasource=`${e}__table`),n&&(v.groupby=[n]),o&&(v.sortMetric=o);const x={...i,...v,adhoc_filters:null!=l?l:[],extra_filters:[],extra_form_data:t,granularity_sqla:h,metrics:["count"],row_limit:c(),showSearch:!0,defaultValue:null==a||null==(f=a.filterState)?void 0:f.value,time_range:d,url_params:(0,r.A)("regular"),inView:!0,viz_type:s,type:p,dashboardId:u,native_filter_id:m};return g&&void 0!==b&&(x.cascade_parent_column=g,x.cascade_parent_value=b),x};function p(e={},t={}){const n={};return a.t1.forEach(a=>{const i=e[a],s=t[a],r=[...o(i)?i:[],...o(s)?s:[]];r.length&&(n[a]=r)}),a.zk.forEach(a=>{const i=e[a];void 0!==i&&(n[a]=i);const s=t[a];void 0!==s&&(n[a]=s)}),n}function u(e,t){let n={};return t.forEach(t=>{var a,i;n=p(n,null!=(a=null==(i=e[t])?void 0:i.extraFormData)?a:{})}),n}function m(e){return!e.includes(i.nS.NativeFilter)||e.includes(i.nS.InteractiveChart)}const g=(e,t)=>new Set(t.map(t=>{var n;return null==(n=e.find(e=>{var n;return(null==e||null==(n=e.meta)?void 0:n.chartId)===t}))||null==(n=n.parents)?void 0:n.filter(e=>e.startsWith(`${l.B8}-`))}).filter(e=>void 0!==e).flat()),b=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,s.t)("Unknown value")},94265:(e,t,n)=>{n.d(t,{$:()=>u});var a=n(2445),i=n(95018),s=n(74098),r=n(81465);const o=r.I4.div`
  ${({theme:e})=>`\n    .tooltip-header {\n      font-size: ${e.fontSize}px;\n      font-weight: ${e.fontWeightStrong};\n    }\n\n    .tooltip-description {\n      margin-top: ${2*e.sizeUnit}px;\n      display: -webkit-box;\n      -webkit-line-clamp: 20;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  `}
`,l=r.I4.div`
  ${({theme:e})=>`\n    left: ${3*e.sizeUnit}px;\n    right: ${3*e.sizeUnit}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: block;\n  `}
`,d=r.I4.span`
  ${({theme:e})=>`\n    left: ${3*e.sizeUnit}px;\n    right: ${3*e.sizeUnit}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: block;\n  `}
`,c=r.I4.div`
  display: grid;
  grid-template-columns: auto auto;
  justify-content: start;
  width: 100%;
`,h=r.I4.span`
  ${({theme:{fontSizeSM:e,colorTextSecondary:t}})=>`\n    overflow: hidden;\n    text-overflow: ellipsis;\n    font-size: ${e}px;\n    color: ${t};\n    line-height: 1.6;\n  `}
`,p=e=>!["null","none"].includes(e.toLowerCase())&&""!==e.trim(),u=e=>(0,a.Y)(i.m,{mouseEnterDelay:.2,placement:"right",title:(0,a.FD)(o,{children:[(0,a.Y)("div",{className:"tooltip-header",children:e.table_name&&p(e.table_name)?e.table_name:(0,s.t)("Not defined")}),(0,a.FD)("div",{className:"tooltip-description",children:[(0,a.FD)("div",{children:[(0,s.t)("Database"),": ",e.database.database_name]}),(0,a.FD)("div",{children:[(0,s.t)("Schema"),":"," ",e.schema&&p(e.schema)?e.schema:(0,s.t)("Not defined")]})]})]}),children:(0,a.FD)(l,{children:[(0,a.Y)(d,{children:e.table_name&&p(e.table_name)?e.table_name:e.database.database_name}),(0,a.FD)(c,{children:[(0,a.Y)(h,{children:e.database.database_name}),e.schema&&p(e.schema)&&(0,a.FD)(h,{children:["Â - ",e.schema]})]})]})})}}]);