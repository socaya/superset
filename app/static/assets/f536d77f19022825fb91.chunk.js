"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9599],{832:(t,e,a)=>{a.d(e,{c:()=>C,y:()=>k});var o=a(2404),r=a.n(o),l=a(2445),i=a(24002),s=a(67413),n=a(35942),u=a(14503),c=a(28027),d=a(50871),p=a(98456),m=a(48238),f=a(92123),b=a(51316),_=a(20605);const{getScale:h}=u;function g(t,e){const a=t.color_picker||{r:0,g:0,b:0,a:1},o=[a.r,a.g,a.b,255*a.a],r=t.color_scheme,l=h(r);let i={};return t.color_scheme_type===f.wP.color_breakpoints?i=(0,b.BK)(t.color_breakpoints):e.forEach(e=>{if(null!=e.cat_color&&!i.hasOwnProperty(e.cat_color)){let r;r=t.dimension?(0,d.hexToRGB)(l(e.cat_color,t.sliceId),255*a.a):o,i[e.cat_color]={color:r,enabled:!0}}}),i}const v=t=>{const e=(0,i.useRef)(null),a=(0,i.useCallback)(()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,m.A)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e},[t]),[o,r]=(0,i.useState)(g(t.formData,t.payload.data.features||[])),[s,u]=(0,i.useState)(t.payload.form_data),[b,v]=(0,i.useState)(a());(0,i.useEffect)(()=>{if(t.payload.form_data!==s){const e=t.payload.data.features||[],o=g(t.formData,e);v(a()),u(t.payload.form_data),r(o)}},[a,t,s]);const y=(0,i.useCallback)(t=>{const{current:a}=e;a&&a.setTooltip(t)},[]),k=(0,i.useCallback)((t,e,a)=>{const o=e.color_scheme,r=h(o);let l;switch(a){case f.wP.fixed_color:{l=e.color_picker||{r:0,g:0,b:0,a:100};const a=[l.r,l.g,l.b,255*l.a];return t.map(t=>({...t,color:a}))}case f.wP.categorical_palette:if(!e.dimension){const a=e.color_picker||{r:0,g:0,b:0,a:100},o=[a.r,a.g,a.b,255*a.a];return t.map(t=>({...t,color:o}))}return t.map(t=>({...t,color:(0,d.hexToRGB)(r(t.cat_color,e.slice_id))}));case f.wP.color_breakpoints:{const a=e.default_breakpoint_color?[e.default_breakpoint_color.r,e.default_breakpoint_color.g,e.default_breakpoint_color.b,255*e.default_breakpoint_color.a]:[_.DL.r,_.DL.g,_.DL.b,255*_.DL.a];return t.map(t=>{var o;const r=null==(o=e.color_breakpoints)?void 0:o.find(e=>t.metric>=e.minValue&&t.metric<=e.maxValue);if(r){const e=[r.color.r,r.color.g,r.color.b,255*r.color.a];return{...t,color:e}}return{...t,color:a}})}default:return[]}},[]),C=(0,i.useCallback)(()=>{const{getLayer:e,getHighlightLayer:a,payload:r,formData:l,onAddFilter:i,onContextMenu:s,filterState:n,setDataMask:u,emitCrossFilters:c}=t;let d=r.data.features?[...r.data.features]:[];const m=l.color_scheme_type;d=k(d,l,m),l.js_data_mutator&&(d=(0,p.A)(l.js_data_mutator)(d)),l.dimension&&(d=d.filter(t=>{var e;return null==(e=o[t.cat_color])?void 0:e.enabled}));const f={formData:l,payload:{...r,data:{...r.data,features:d}},onAddFilter:i,setTooltip:y,datasource:t.datasource,onContextMenu:s,filterState:n,setDataMask:u,emitCrossFilters:c},b=e(f);return c&&null!=n&&n.value&&a?[b,a(f)]:[b]},[k,o,t,y]),D=(0,i.useCallback)(t=>{const e=o[t],a={...o,[t]:{...e,enabled:!e.enabled}};Object.values(a).every(t=>!t.enabled)&&Object.values(a).forEach(t=>{t.enabled=!0}),r(a)},[o]),w=(0,i.useCallback)(t=>{const e={...o};Object.values(e).forEach(t=>{t.enabled=!1}),e[t].enabled=!0,r(e)},[o]);return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(n.S,{ref:e,viewport:b,layers:C(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,l.Y)(c.A,{forceCategorical:!0,categories:o,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:w,toggleCategory:D})]})},y=(0,i.memo)(v);function k(t,e,a){return(0,i.memo)(o=>{const u=(0,i.useRef)(),d=(0,s.Z)(o.formData),p=(0,s.Z)(o.filterState),f=(0,s.Z)(o.payload),[_,h]=(0,i.useState)((0,b.BK)(o.formData.color_breakpoints)||[]),[g,v]=(0,i.useState)((()=>{const{width:t,height:a,formData:r}=o;return r.autozoom?(0,m.A)(o.viewport,{width:t,height:a,points:e(o.payload.data.features)}):o.viewport})()),y=(0,i.useCallback)(t=>{const{current:e}=u;e&&(null==e||e.setTooltip(t))},[]),k=(0,i.useCallback)(e=>{const{formData:o,payload:r,onAddFilter:l,filterState:i,setDataMask:s,onContextMenu:n,emitCrossFilters:u}=e,c={formData:o,payload:r,onAddFilter:l,setTooltip:y,setDataMask:s,onContextMenu:n,filterState:i,emitCrossFilters:u},d=t(c);return u&&null!=i&&i.value&&a?[d,a(c)]:[d]},[y]);(0,i.useEffect)(()=>{const t=(0,b.BK)(o.formData.color_breakpoints);h(t)},[o]);const[C,D]=(0,i.useState)(k(o));(0,i.useEffect)(()=>{const t={...d,...p,viewport:null},e={...o.formData,...o.filterState,viewport:null};r()(t,e)&&f===o.payload||D(k(o))},[k,d,p,f,o]);const{formData:w,payload:x,setControlValue:M,height:S,width:A}=o;return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(n.S,{ref:u,mapboxApiAccessToken:x.data.mapboxApiKey,viewport:g,layers:C,mapStyle:w.mapbox_style,setControlValue:M,width:A,height:S,onViewportChange:v}),(0,l.Y)(c.A,{forceCategorical:!0,categories:_,format:o.formData.legend_format,position:o.formData.legend_position})]})})}function C(t,e,a){return function(o){const{datasource:r,formData:i,height:s,payload:n,setControlValue:u,viewport:c,width:d,setDataMask:p,filterState:m,onContextMenu:f,emitCrossFilters:b}=o;return(0,l.Y)(y,{datasource:r,formData:i,mapboxApiKey:n.data.mapboxApiKey,setControlValue:u,viewport:c,getLayer:t,getHighlightLayer:a,payload:n,getPoints:e,width:d,height:s,setDataMask:p,onContextMenu:f,filterState:m,emitCrossFilters:b})}}},99599:(t,e,a)=>{a.r(e),a.d(e,{default:()=>g,getHighlightLayer:()=>h,getLayer:()=>_,getPoints:()=>b});var o=a(2445),r=a(31073),l=a(74098),i=a(92123),s=a(83860),n=a(832),u=a(42828),c=a(52480);const d=1609.34;function p(t,e){return"square_m"===t?Math.sqrt(e/Math.PI):"radius_m"===t?e:"radius_km"===t?1e3*e:"radius_miles"===t?e*d:"square_km"===t?1e3*Math.sqrt(e/Math.PI):"square_miles"===t?Math.sqrt(e/Math.PI)*d:null}var m=a(51316);function f(t,e){return(0,u.j1)(t,a=>{var r,i,s,n,u,d,p;const m=(null==e?void 0:e[t.point_radius_fixed.value])||("string"==typeof(f=null==(r=t.point_radius_fixed)?void 0:r.value)?f:null!=f&&f.label?f.label:null!=f&&f.verbose_name?f.verbose_name:(null==f?void 0:f.value)||"Metric");var f;return(0,o.FD)("div",{className:"deckgl-tooltip",children:[(0,o.Y)(c.A,{label:`${(0,l.t)("Longitude and Latitude")}: `,value:`${null==(i=a.object)||null==(i=i.position)?void 0:i[0]}, ${null==(s=a.object)||null==(s=s.position)?void 0:s[1]}`}),(null==(n=a.object)?void 0:n.cat_color)&&(0,o.Y)(c.A,{label:`${(0,l.t)("Category")}: `,value:`${null==(u=a.object)?void 0:u.cat_color}`}),(null==(d=a.object)?void 0:d.metric)&&(0,o.Y)(c.A,{label:`${m}: `,value:`${null==(p=a.object)?void 0:p.metric}`})]})})}function b(t){return t.map(t=>t.position)}const _=function({formData:t,payload:e,setTooltip:a,setDataMask:o,filterState:l,onContextMenu:i,datasource:n,emitCrossFilters:u}){const c=t,d=e.data.features.map(t=>{let e=p(c.point_unit,t.radius)||10;if(c.multiplier&&(e*=c.multiplier),t.color)return{...t,radius:e};const a=c.color_picker||{r:0,g:0,b:0,a:1},o=[a.r,a.g,a.b,255*a.a];return{...t,radius:e,color:o}});return new r.A({id:`scatter-layer-${c.slice_id}`,data:d,fp64:!0,getFillColor:t=>t.color,getRadius:t=>t.radius,radiusMinPixels:Number(c.min_radius)||void 0,radiusMaxPixels:Number(c.max_radius)||void 0,stroked:!1,...(0,s.T$)({formData:c,setTooltip:a,setTooltipContent:f(c,null==n?void 0:n.verboseMap),setDataMask:o,filterState:l,onContextMenu:i,emitCrossFilters:u}),opacity:null!=l&&l.value?.3:1})},h=function({formData:t,payload:e,filterState:a}){const o=t,l=e.data.features.map(t=>{let e=p(o.point_unit,t.radius)||10;return o.multiplier&&(e*=o.multiplier),{...t,radius:e}}).filter(t=>(0,i.st)(t.position,null==a?void 0:a.value));return new r.A({id:`scatter-highlight-layer-${o.slice_id}`,data:l,fp64:!0,getFillColor:()=>m.Fe,getRadius:t=>t.radius,radiusMinPixels:Number(o.min_radius)||void 0,radiusMaxPixels:Number(o.max_radius)||void 0,stroked:!1})},g=(0,n.c)(_,b,h)}}]);