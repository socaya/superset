"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1440],{87070:(t,e,n)=>{n.r(e),n.d(e,{default:()=>z});var a=n(2445),o=n(24002),l=n(61574),i=n(71519),d=n(81465),r=n(17437),s=n(74098),c=n(79378),u=n(59744),h=n(59674),m=n(58561),_=n.n(m),p=n(94551),g=n(38961),f=n(9876),y=n(20237),Y=n(64457),b=n(86784),v=n(71323),D=n(52167),S=n(97163),A=n(29645),w=n(64535),k=n(45207),x=n(51692);const C=d.I4.div`
  margin: ${({theme:t})=>2*t.sizeUnit}px auto
    ${({theme:t})=>4*t.sizeUnit}px auto;
`,T=(0,d.I4)(D.iN)`
  /* Border is already applied by AceEditor itself */
`,H=d.I4.div`
  margin-bottom: ${({theme:t})=>5*t.sizeUnit}px;

  .control-label {
    margin-bottom: ${({theme:t})=>2*t.sizeUnit}px;
  }

  .required {
    margin-left: ${({theme:t})=>t.sizeUnit/2}px;
    color: ${({theme:t})=>t.colorError};
  }

  input[type='text'] {
    width: 65%;
  }
`,F=(0,Y.Ay)(({addDangerToast:t,addSuccessToast:e,annotationLayerId:n,annotation:l=null,onAnnotationAdd:i,onHide:d,show:r})=>{var c,u;const[m,_]=(0,o.useState)(!0),[p,g]=(0,o.useState)(null),f=null!==l,y=(0,k.p)(null==p?void 0:p.json_metadata,{errorPrefix:"Invalid JSON metadata"}),{state:{loading:Y,resource:v},fetchResource:D,createResource:F,updateResource:$}=(0,b.fn)(`annotation_layer/${n}/annotation`,(0,s.t)("annotation"),t),N=()=>{g({short_descr:"",start_dttm:"",end_dttm:"",json_metadata:"",long_descr:""})},E=()=>{f?g(v):N(),d()},z=t=>{const{target:e}=t,n={...p,end_dttm:p?p.end_dttm:"",short_descr:p?p.short_descr:"",start_dttm:p?p.start_dttm:""};n[e.name]=e.value,g(n)};return(0,o.useEffect)(()=>{if(f&&(null==p||!p.id||l&&l.id!==p.id||r)){if(null!==(null==l?void 0:l.id)&&!Y){const t=l.id||0;D(t)}}else f||p&&!p.id&&!r||N()},[l]),(0,o.useEffect)(()=>{v&&g(v)},[v]),(0,o.useEffect)(()=>{var t,e,n;null!=p&&null!=(t=p.short_descr)&&t.length&&null!=p&&null!=(e=p.start_dttm)&&e.length&&null!=p&&null!=(n=p.end_dttm)&&n.length?_(!1):_(!0)},[p?p.short_descr:"",p?p.start_dttm:"",p?p.end_dttm:""]),(0,a.FD)(S.aF,{disablePrimaryButton:m,onHandledPrimaryAction:()=>{if(f){if(null!=p&&p.id){const t=p.id;delete p.id,delete p.created_by,delete p.changed_by,delete p.changed_on_delta_humanized,delete p.layer,$(t,p).then(t=>{t&&(i&&i(),E(),e((0,s.t)("The annotation has been updated")))})}}else p&&F(p).then(t=>{t&&(i&&i(),E(),e((0,s.t)("The annotation has been saved")))})},onHide:E,primaryButtonName:f?(0,s.t)("Save"):(0,s.t)("Add"),show:r,width:"55%",name:f?(0,s.t)("Edit annotation"):(0,s.t)("Add annotation"),title:(0,a.Y)(x.r,{isEditMode:f,title:f?(0,s.t)("Edit annotation"):(0,s.t)("Add annotation")}),children:[(0,a.Y)(C,{children:(0,a.Y)("h4",{children:(0,s.t)("General information")})}),(0,a.FD)(H,{children:[(0,a.FD)("div",{className:"control-label",children:[(0,s.t)("Name"),(0,a.Y)("span",{className:"required",children:"*"})]}),(0,a.Y)(A.Input,{name:"short_descr",onChange:z,type:"text",value:null==p?void 0:p.short_descr})]}),(0,a.FD)(H,{children:[(0,a.FD)("div",{className:"control-label",children:[(0,s.t)("date"),(0,a.Y)("span",{className:"required",children:"*"})]}),(0,a.Y)(w.c,{placeholder:[(0,s.t)("Start date"),(0,s.t)("End date")],format:"YYYY-MM-DD HH:mm",onCalendarChange:(t,e)=>{var n;if(null==t||!t[0]||null==t||!t[1]){var a;const t={...p,start_dttm:"",end_dttm:"",short_descr:null!=(a=null==p?void 0:p.short_descr)?a:""};return void g(t)}const o={...p,start_dttm:t[0].format("YYYY-MM-DD HH:mm"),end_dttm:t[1].format("YYYY-MM-DD HH:mm"),short_descr:null!=(n=null==p?void 0:p.short_descr)?n:""};g(o)},showTime:{format:"hh:mm a"},use12Hours:!0,value:null!=p&&null!=(c=p.start_dttm)&&c.length||null!=p&&null!=(u=p.end_dttm)&&u.length?[(0,h.XV)(p.start_dttm),(0,h.XV)(p.end_dttm)]:null})]}),(0,a.Y)(C,{children:(0,a.Y)("h4",{children:(0,s.t)("Additional information")})}),(0,a.FD)(H,{children:[(0,a.Y)("div",{className:"control-label",children:(0,s.t)("description")}),(0,a.Y)(A.Input.TextArea,{name:"long_descr",value:p?p.long_descr:"",placeholder:(0,s.t)("Description (this can be seen in the list)"),onChange:z})]}),(0,a.FD)(H,{children:[(0,a.Y)("div",{className:"control-label",children:(0,s.t)("JSON metadata")}),(0,a.Y)(T,{onChange:t=>{const e={...p,end_dttm:p?p.end_dttm:"",json_metadata:t,short_descr:p?p.short_descr:"",start_dttm:p?p.start_dttm:""};g(e)},value:null!=p&&p.json_metadata?p.json_metadata:"",width:"100%",height:"120px",annotations:y})]})]})});var $=n(8558),N=n(42566);const E=d.I4.div`
  ${({theme:t})=>r.AH`
    display: flex;
    flex-direction: row;

    a,
    Link {
      margin-left: ${4*t.sizeUnit}px;
      font-size: ${t.fontSizeSM}px;
      font-weight: ${t.fontWeightNormal};
      text-decoration: underline;
    }
  `}
`,z=(0,Y.Ay)(function({addDangerToast:t,addSuccessToast:e}){const{annotationLayerId:n}=(0,l.g)(),{state:{loading:d,resourceCount:r,resourceCollection:m,bulkSelectEnabled:Y},fetchData:D,refreshData:S,toggleBulkSelect:A}=(0,b.RU)(`annotation_layer/${n}/annotation`,(0,s.t)("annotation"),t,!1),[w,k]=(0,o.useState)(!1),[x,C]=(0,o.useState)(""),[T,H]=(0,o.useState)(null),[z,I]=(0,o.useState)(null),B=t=>{H(t),k(!0)},M=(0,o.useCallback)(async function(){try{const t=await c.A.get({endpoint:`/api/v1/annotation_layer/${n}`});C(t.json.result.name)}catch(e){await(0,u.h4)(e).then(({error:e})=>{t(e.error||e.statusText||e)})}},[n]);(0,o.useEffect)(()=>{M()},[M]);const j=[{id:"short_descr",desc:!0}],O=(0,o.useMemo)(()=>[{accessor:"short_descr",Header:(0,s.t)("Name"),size:"xxl",id:"short_descr"},{accessor:"long_descr",Header:(0,s.t)("Description"),id:"long_descr"},{Cell:({row:{original:{start_dttm:t}}})=>(0,h.XV)(new Date(t)).format("ll"),Header:(0,s.t)("Start"),accessor:"start_dttm",id:"start_dttm"},{Cell:({row:{original:{end_dttm:t}}})=>(0,h.XV)(new Date(t)).format("ll"),Header:(0,s.t)("End"),accessor:"end_dttm",id:"end_dttm"},{Cell:({row:{original:t}})=>{const e=[{label:"edit-action",tooltip:(0,s.t)("Edit annotation"),placement:"bottom",icon:"EditOutlined",onClick:()=>B(t)},{label:"delete-action",tooltip:(0,s.t)("Delete annotation"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>I(t)}];return(0,a.Y)(f.kv,{actions:e})},Header:(0,s.t)("Actions"),id:"actions",disableSortBy:!0}],[!0,!0]),U=[];U.push({name:(0,s.t)("Bulk select"),onClick:A,buttonStyle:"secondary"}),U.push({icon:(0,a.Y)($.F.PlusOutlined,{iconSize:"m"}),name:(0,s.t)("Annotation"),buttonStyle:"primary",onClick:()=>{B(null)}});let L=!0;try{(0,l.W6)()}catch(t){L=!1}const P={title:(0,s.t)("No annotation yet"),image:"filter-results.svg",buttonAction:()=>{B(null)},buttonText:(0,a.FD)(a.FK,{children:[(0,a.Y)($.F.PlusOutlined,{iconSize:"m"}),(0,s.t)("Annotation")]})};return(0,a.FD)(a.FK,{children:[(0,a.Y)(y.A,{name:(0,a.FD)(E,{children:[(0,a.Y)("span",{children:(0,s.t)("Annotation Layer %s",x)}),(0,a.Y)("span",{children:L?(0,a.Y)(i.N_,{to:"/annotationlayer/list/",children:(0,s.t)("Back to all")}):(0,a.Y)(N.o.Link,{href:"/annotationlayer/list/",children:(0,s.t)("Back to all")})})]}),buttons:U}),(0,a.Y)(F,{addDangerToast:t,addSuccessToast:e,annotation:T,show:w,onAnnotationAdd:()=>S(),annotationLayerId:n,onHide:()=>k(!1)}),z&&(0,a.Y)(p.T,{description:(0,s.t)("Are you sure you want to delete %s?",null==z?void 0:z.short_descr),onConfirm:()=>{z&&(({id:a,short_descr:o})=>{c.A.delete({endpoint:`/api/v1/annotation_layer/${n}/annotation/${a}`}).then(()=>{S(),I(null),e((0,s.t)("Deleted: %s",o))},(0,v.JF)(e=>t((0,s.t)("There was an issue deleting %s: %s",o,e))))})(z)},onHide:()=>I(null),open:!0,title:(0,s.t)("Delete Annotation?")}),(0,a.Y)(g.h,{title:(0,s.t)("Please confirm"),description:(0,s.t)("Are you sure you want to delete the selected annotations?"),onConfirm:a=>{c.A.delete({endpoint:`/api/v1/annotation_layer/${n}/annotation/?q=${_().encode(a.map(({id:t})=>t))}`}).then(({json:t={}})=>{S(),e(t.message)},(0,v.JF)(e=>t((0,s.t)("There was an issue deleting the selected annotations: %s",e))))},children:n=>{const o=[{key:"delete",name:(0,s.t)("Delete"),onSelect:n,type:"danger"}];return(0,a.Y)(f.uO,{className:"annotations-list-view",bulkActions:o,bulkSelectEnabled:Y,columns:O,count:r,data:m,disableBulkSelect:A,emptyState:P,fetchData:D,addDangerToast:t,addSuccessToast:e,refreshData:S,initialSort:j,loading:d,pageSize:25})}})]})})}}]);