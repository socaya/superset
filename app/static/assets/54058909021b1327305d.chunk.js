"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2246],{12389:(e,t,a)=>{a.d(t,{A:()=>n});const n=a(29645).Tree},36188:(e,t,a)=>{a.d(t,{c:()=>r});var n=a(2445),l=a(17437),i=a(29645);function r(e){return(0,n.Y)(i.Divider,{css:e=>l.AH`
        margin: ${e.margin}px 0;
      `,...e})}},66347:(e,t,a)=>{a.r(t),a.d(t,{datasetReducer:()=>gn,default:()=>Sn});var n=a(2445),l=a(24002),i=a(61574),r=a(79378),o=a(74098),s=a(75574),d=a(58561),c=a.n(d),p=a(91412);const u=(e,t)=>{const[a,n]=(0,l.useState)([]),i=t?encodeURIComponent(t):void 0,d=(0,l.useCallback)(async e=>{let t,a=[],l=0;for(;void 0===t||a.length<t;){const n=c().encode_uri({filters:e,page:l});try{const e=await r.A.get({endpoint:`/api/v1/dataset/?q=${n}`});({count:t}=e.json);const{json:{result:i}}=e;a=[...a,...i],l+=1}catch(e){(0,p.iB)((0,o.t)("There was an error fetching dataset")),s.A.error((0,o.t)("There was an error fetching dataset"),e)}}n(a)},[]);(0,l.useEffect)(()=>{const a=[{col:"database",opr:"rel_o_m",value:null==e?void 0:e.id},{col:"schema",opr:"eq",value:i},{col:"sql",opr:"dataset_is_null_or_empty",value:!0}];t&&d(a)},[null==e?void 0:e.id,t,i,d]);const u=(0,l.useMemo)(()=>null==a?void 0:a.map(e=>e.table_name),[a]);return{datasets:a,datasetNames:u}};var h,m=a(73306),g=a(88217),y=a(8558),S=a(85600);!function(e){e[e.SelectDatabase=0]="SelectDatabase",e[e.SelectCatalog=1]="SelectCatalog",e[e.SelectSchema=2]="SelectSchema",e[e.SelectTable=3]="SelectTable",e[e.ChangeDataset=4]="ChangeDataset",e[e.SetDHIS2Parameters=5]="SetDHIS2Parameters",e[e.SetDHIS2Columns=6]="SetDHIS2Columns"}(h||(h={}));var v=a(81465),f=a(17437);const b=v.I4.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  background-color: ${({theme:e})=>e.colorBgContainer};
`,Y=v.I4.div`
  width: ${({theme:e,width:t})=>null!=t?t:80*e.sizeUnit}px;
  max-width: ${({theme:e,width:t})=>null!=t?t:80*e.sizeUnit}px;
  flex-direction: column;
  flex: 1 0 auto;
`,x=v.I4.div`
  display: flex;
  flex-direction: column;
  flex-grow: 1;
`,T=v.I4.div`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: row;
`,I=(0,v.I4)(T)`
  flex: 1 0 auto;
  position: relative;
`,_=(0,v.I4)(T)`
  flex: 1 0 auto;
  height: auto;
`,E=(0,v.I4)(T)`
  flex: 0 0 auto;
  height: ${({theme:e})=>16*e.sizeUnit}px;
  z-index: 0;
`,D=v.I4.div`
  ${({theme:e})=>`\n  flex: 0 0 auto;\n  display: flex;\n  align-items: center;\n  height: ${16*e.sizeUnit}px;\n  border-bottom: 1px solid ${e.colorBorder};\n\n  .header-with-actions {\n    height: ${15.5*e.sizeUnit}px;\n  }\n  `}
`,A=v.I4.div`
  ${({theme:e})=>`\n  margin: ${4*e.sizeUnit}px;\n  font-size: ${e.fontSizeXL}px;\n  font-weight: ${e.fontWeightStrong};\n  `}
`,w=v.I4.div`
  ${({theme:e})=>`\n  height: 100%;\n  border-right: 1px solid ${e.colorBorderSecondary};\n  `}
`,L=v.I4.div`
  width: 100%;
  position: relative;
`,$=v.I4.div`
  ${({theme:e})=>`\n  border-left: 1px solid ${e.colorBorderSecondary};\n  color: ${e.colorSuccess};\n  `}
`,C=v.I4.div`
  ${({theme:e})=>`\n  height: ${16*e.sizeUnit}px;\n  width: 100%;\n  border-top: 1px solid ${e.colorBorderSecondary};\n  border-bottom: 1px solid ${e.colorBorderSecondary};\n  color: ${e.colorInfo};\n  border-top: ${e.sizeUnit/4}px solid\n    ${e.colorBorderSecondary};\n  padding: ${4*e.sizeUnit}px;\n  display: flex;\n  justify-content: flex-end;\n  background-color: ${e.colorBgContainer};\n  z-index: ${e.zIndexPopupBase}\n  `}
`,R=v.I4.div`
  .ant-btn {
    span {
      margin-right: 0;
    }

    &:disabled {
      svg {
        color: ${({theme:e})=>e.colorIconHover};
      }
    }
  }
`,N=e=>f.AH`
  width: ${21.5*e.sizeUnit}px;

  &:disabled {
    background-color: ${e.colorBgContainerDisabled};
    color: ${e.colorTextDisabled};
  }
`,U=(0,o.t)("New dataset"),F={text:(0,o.t)("Select a database table and create dataset"),placement:"bottomRight"},k=()=>(0,n.FD)(g.$,{buttonStyle:"primary",tooltip:null==F?void 0:F.text,placement:null==F?void 0:F.placement,disabled:!0,css:N,children:[(0,n.Y)(y.F.SaveOutlined,{iconSize:"m"}),(0,o.t)("Save")]}),z=()=>(0,n.Y)(S.W1,{items:[{key:"settings",label:(0,o.t)("Settings")},{key:"delete",label:(0,o.t)("Delete")}]});function H({setDataset:e,title:t=U,editing:a=!1}){const l={title:null!=t?t:U,placeholder:U,onSave:t=>{e({type:h.ChangeDataset,payload:{name:"dataset_name",value:t}})},canEdit:!1,label:(0,o.t)("dataset name")};return(0,n.Y)(R,{children:a?(0,n.Y)(m.U,{editableTitleProps:l,showTitlePanelItems:!1,showFaveStar:!1,faveStarProps:{itemId:1,saveFaveStar:()=>{}},titlePanelAdditionalItems:(0,n.Y)(n.FK,{}),rightPanelAdditionalItems:k(),additionalActionsMenu:z(),menuDropdownProps:{disabled:!0},tooltipProps:F}):(0,n.Y)(A,{children:t||U})})}var B=a(13410),P=a(21325);const M=(0,v.I4)(P.Ay)`
  ${({theme:e})=>`\n  margin-top: ${8.5*e.sizeUnit}px;\n  padding-left: ${4*e.sizeUnit}px;\n  padding-right: ${4*e.sizeUnit}px;\n\n  .ant-tabs-top > .ant-tabs-nav::before {\n    width: ${50*e.sizeUnit}px;\n  }\n  `}
`,O=v.I4.div`
  ${({theme:e})=>`\n  .ant-badge {\n    width: ${8*e.sizeUnit}px;\n    margin-left: ${2.5*e.sizeUnit}px;\n  }\n  `}
`,W={USAGE_TEXT:(0,o.t)("Usage"),COLUMNS_TEXT:(0,o.t)("Columns"),METRICS_TEXT:(0,o.t)("Metrics")},j=({id:e})=>{const{usageCount:t}=(e=>{const[t,a]=(0,l.useState)(0),n=(0,l.useCallback)(()=>r.A.get({endpoint:`/api/v1/dataset/${e}/related_objects`}).then(({json:e})=>{a(null==e?void 0:e.charts.count)}).catch(e=>{(0,p.iB)((0,o.t)("There was an error fetching dataset's related objects")),s.A.error(e)}),[e]);return(0,l.useEffect)(()=>{e&&n()},[e,n]),{usageCount:t}})(e),a=(0,n.FD)(O,{children:[(0,n.Y)("span",{children:W.USAGE_TEXT}),t>0&&(0,n.Y)(B.E,{count:t})]}),i=[{key:"COLUMNS",label:W.COLUMNS_TEXT,children:null},{key:"METRICS",label:W.METRICS_TEXT,children:null},{key:"USAGE",label:a,children:null}];return(0,n.Y)(M,{moreIcon:null,items:i})};var K=a(31296),X=a(94185),V=a(56196),G=a(18009),Q=a(80711),q=a(71519);const Z=v.I4.div`
  padding: ${({theme:e})=>8*e.sizeUnit}px
    ${({theme:e})=>6*e.sizeUnit}px;

  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
`,J=(0,v.I4)(Q.p)`
  max-width: 50%;

  p {
    width: ${({theme:e})=>115*e.sizeUnit}px;
  }
`,ee=(0,o.t)("Datasets can be created from database tables or SQL queries. Select a database table to the left or "),te=(0,o.t)("create dataset from SQL query"),ae=(0,o.t)(" to open SQL Lab. From there you can save the query as a dataset."),ne=(0,o.t)("Select dataset source"),le=(0,o.t)("No table columns"),ie=(0,o.t)("This database table does not contain any data. Please select a different table."),re=(0,o.t)("An Error Occurred"),oe=(0,o.t)("Unable to load columns for the selected table. Please select a different table."),se=e=>{const{hasError:t,tableName:a,hasColumns:l}=e;let i="empty-dataset.svg",r=ne,o=(0,n.FD)(n.FK,{children:[ee,(0,n.Y)(q.N_,{to:"/sqllab",children:(0,n.Y)("span",{role:"button",tabIndex:0,children:te})}),ae]});return t?(r=re,o=(0,n.Y)(n.FK,{children:oe}),i=void 0):a&&!l&&(i="no-columns.svg",r=le,o=(0,n.Y)(n.FK,{children:ie})),(0,n.Y)(Z,{children:(0,n.Y)(J,{image:i,size:"large",title:r,description:o})})};var de;!function(e){e.ABSOLUTE="absolute",e.RELATIVE="relative"}(de||(de={}));const ce=v.I4.div`
  ${({theme:e,position:t})=>`\n  position: ${t};\n  margin: ${4*e.sizeUnit}px\n    ${3*e.sizeUnit}px\n    ${3*e.sizeUnit}px\n    ${6*e.sizeUnit}px;\n  font-size: ${6*e.sizeUnit}px;\n  font-weight: ${e.fontWeightStrong};\n  padding-bottom: ${3*e.sizeUnit}px;\n\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n\n  .anticon:first-of-type {\n    margin-right: ${2*e.sizeUnit}px;\n    vertical-align: text-top;\n  }\n\n  `}
`,pe=v.I4.div`
  ${({theme:e})=>`\n  margin-left: ${6*e.sizeUnit}px;\n  margin-bottom: ${3*e.sizeUnit}px;\n  font-weight: ${e.fontWeightStrong};\n  `}
`,ue=v.I4.div`
  ${({theme:e})=>`\n  padding: ${8*e.sizeUnit}px\n    ${6*e.sizeUnit}px;\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  `}
`,he=v.I4.div`
  ${({theme:e})=>`\n  max-width: 50%;\n  width: 200px;\n\n  .ant-image {\n    width: 120px;\n    margin-left: 40px;\n  }\n\n  div {\n    width: 100%;\n    margin-top: ${3*e.sizeUnit}px;\n    text-align: center;\n    font-weight: ${e.fontWeightNormal};\n    font-size: ${e.fontSizeLG}px;\n    color: ${e.colorTextSecondary};\n  }\n  `}
`,me=v.I4.div`
  ${({theme:e})=>`\n  position: relative;\n  margin: ${3*e.sizeUnit}px;\n  margin-left: ${6*e.sizeUnit}px;\n  height: calc(100% - ${60*e.sizeUnit}px);\n  overflow: auto;\n  `}
`,ge=v.I4.div`
  ${({theme:e})=>`\n  position: relative;\n  margin: ${3*e.sizeUnit}px;\n  margin-left: ${6*e.sizeUnit}px;\n  height: calc(100% - ${30*e.sizeUnit}px);\n  overflow: auto;\n  `}
`,ye=v.I4.div`
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
`,Se=(0,v.I4)(X.F)`
  ${({theme:e})=>`\n  border: 1px solid ${e.colorInfoText};\n  padding: ${4*e.sizeUnit}px;\n  margin: ${6*e.sizeUnit}px ${6*e.sizeUnit}px\n    ${8*e.sizeUnit}px;\n  .view-dataset-button {\n    position: absolute;\n    top: ${4*e.sizeUnit}px;\n    right: ${4*e.sizeUnit}px;\n\n    &:hover {\n      color: ${e.colorPrimary};\n      text-decoration: underline;\n    }\n  }\n  `}
`,ve=(0,o.t)("Refreshing columns"),fe=(0,o.t)("Table columns"),be=["5","10","15","25"],Ye=[{title:"Column Name",dataIndex:"name",key:"name",sorter:(e,t)=>e.name.localeCompare(t.name)},{title:"Datatype",dataIndex:"type",key:"type",width:"100px",sorter:(e,t)=>e.name.localeCompare(t.name)}],xe=(0,o.t)("This table already has a dataset associated with it. You can only associate one dataset with a table.\n"),Te=(0,o.t)("View Dataset"),Ie=({tableName:e,columnList:t,loading:a,hasError:l,datasets:i})=>{const r=Boolean((null==t?void 0:t.length)>0),s=null==i?void 0:i.map(e=>e.table_name),d=null==i?void 0:i.find(t=>t.table_name===e);let c,p;return a&&(p=(0,n.Y)(ue,{children:(0,n.FD)(he,{children:[(0,n.Y)(V.R,{position:"inline-centered"}),(0,n.Y)("div",{children:ve})]})})),a||(c=!a&&e&&r&&!l?(0,n.FD)(n.FK,{children:[(0,n.Y)(pe,{children:fe}),d?(0,n.Y)(me,{children:(0,n.Y)(ye,{children:(0,n.Y)(G.Ay,{loading:a,size:G.QS.Small,columns:Ye,data:t,rowKey:"name",pageSizeOptions:be,defaultPageSize:25})})}):(0,n.Y)(ge,{children:(0,n.Y)(ye,{children:(0,n.Y)(G.Ay,{loading:a,size:G.QS.Small,columns:Ye,data:t,rowKey:"name",pageSizeOptions:be,defaultPageSize:25})})})]}):(0,n.Y)(se,{hasColumns:r,hasError:l,tableName:e})),(0,n.FD)(n.FK,{children:[e&&(0,n.FD)(n.FK,{children:[(null==s?void 0:s.includes(e))&&(u=d,(0,n.Y)(Se,{closable:!1,type:"info",showIcon:!0,message:(0,o.t)("This table already has a dataset"),description:(0,n.FD)(n.FK,{children:[xe,(0,n.Y)("span",{role:"button",onClick:()=>{window.open(null==u?void 0:u.explore_url,"_blank","noreferrer noopener popup=false")},tabIndex:0,className:"view-dataset-button",children:Te})]})})),(0,n.FD)(ce,{position:!a&&r?de.RELATIVE:de.ABSOLUTE,title:e||"",children:[(0,n.Y)(y.F.InsertRowAboveOutlined,{}),e]})]}),c,p]});var u},_e=({tableName:e,dbId:t,catalog:a,schema:i,setHasColumns:d,datasets:c,dhis2Columns:u})=>{const[h,m]=(0,l.useState)([]),[g,y]=(0,l.useState)(!1),[S,v]=(0,l.useState)(!1),f=(0,l.useRef)(e);return(0,l.useEffect)(()=>{if(f.current=e,u&&u.length>0)return console.log("Using DHIS2 generated columns:",u),m(u),null==d||d(!0),v(!1),void y(!1);e&&i&&t&&(async e=>{const{dbId:t,tableName:n,schema:l}=e;y(!0),null==d||d(!1);const i=`/api/v1/database/${t}/table_metadata/${(0,K.zJ)({name:n,catalog:a,schema:l})}`;try{const e=await r.A.get({endpoint:i});if((e=>{let t=!0;if("string"!=typeof(null==e?void 0:e.name)&&(t=!1),t&&!Array.isArray(e.columns)&&(t=!1),t&&e.columns.length>0){const a=e.columns.some((e,t)=>{const a=(e=>{let t=!0;const a="The object provided to isITableColumn does match the interface.";return"string"!=typeof(null==e?void 0:e.name)&&(t=!1,console.error(`${a} The property 'name' is required and must be a string`)),t&&"string"!=typeof(null==e?void 0:e.type)&&(t=!1,console.error(`${a} The property 'type' is required and must be a string`)),t})(e);return a||console.error(`The provided object does not match the IDatabaseTable interface. columns[${t}] is invalid and does not match the ITableColumn interface`),!a});t=!a}return t})(null==e?void 0:e.json)){const t=e.json;t.name===f.current&&(m(t.columns),null==d||d(t.columns.length>0),v(!1))}else m([]),null==d||d(!1),v(!0),(0,p.iB)((0,o.t)("The API response from %s does not match the IDatabaseTable interface.",i)),s.A.error((0,o.t)("The API response from %s does not match the IDatabaseTable interface.",i))}catch(e){m([]),null==d||d(!1),v(!0)}finally{y(!1)}})({tableName:e,dbId:t,schema:i})},[e,t,i,u]),(0,n.Y)(Ie,{columnList:h,hasError:S,loading:g,tableName:e,datasets:c})};var Ee=a(94083),De=a(64457),Ae=a(24777),we=a(42566),Le=a(86784),$e=a(97163),Ce=a(25936),Re=a(29645),Ne=a(88657),Ue=a(24006),Fe=a(34622),ke=a(62412);const{Title:ze,Paragraph:He,Text:Be}=we.o,Pe=v.I4.div`
  ${({theme:e})=>`\n    padding: ${3*e.sizeUnit}px;\n    background: ${e.colorBgContainer};\n    border-radius: ${e.borderRadius}px;\n    margin: ${2*e.sizeUnit}px 0;\n  `}
`,Me=v.I4.div`
  ${({theme:e})=>`\n    margin-bottom: ${3*e.sizeUnit}px;\n    \n    h3, h4 {\n      margin-bottom: ${e.sizeUnit}px;\n      font-weight: 600;\n    }\n  `}
`,Oe=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    border-left: 4px solid ${e.colorPrimary};\n    padding: ${1.5*e.sizeUnit}px ${2*e.sizeUnit}px;\n    margin-bottom: ${2*e.sizeUnit}px;\n    border-radius: ${e.borderRadius}px;\n    font-size: 12px;\n    line-height: 1.5;\n  `}
`,We=v.I4.div`
  ${({theme:e})=>`\n    padding: 12px;\n    background-color: ${e.colorBgElevated};\n    border-bottom: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px ${e.borderRadius}px 0 0;\n  `}
`,je=v.I4.div`
  ${({theme:e})=>`\n    padding: 12px;\n    flex: 1;\n    overflow: auto;\n    background-color: ${e.colorBgContainer};\n    \n    .ant-table-wrapper {\n      .ant-table {\n        font-size: 12px;\n        \n        .ant-table-thead > tr > th {\n          padding: 8px 12px;\n          font-weight: 600;\n          background-color: ${e.colorBgElevated};\n        }\n        \n        .ant-table-tbody > tr > td {\n          padding: 6px 12px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n      }\n    }\n  `}
`,Ke=(0,v.I4)(Re.Input.TextArea)`
  ${({theme:e})=>`\n    font-family: Monaco, Consolas, 'Courier New', monospace;\n    font-size: 12px;\n    background-color: ${e.colorBgContainer};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    padding: 12px;\n  `}
`,Xe=v.I4.div`
  ${({theme:e})=>`\n    background-color: ${e.colorBgContainer};\n    border-radius: ${e.borderRadius}px;\n    overflow: hidden;\n    \n    .ant-table-container {\n      font-size: 12px !important;\n    }\n    \n    .ant-table-cell {\n      max-width: 200px;\n      padding: 6px 12px !important;\n    }\n  `}
`,Ve=(0,v.I4)(Re.Collapse)`
  ${({theme:e})=>`\n    .ant-collapse-item {\n      margin-bottom: ${2*e.sizeUnit}px;\n      border: 1px solid ${e.colorBorder};\n      border-radius: ${e.borderRadius}px !important;\n      overflow: hidden;\n    }\n    \n    .ant-collapse-header {\n      background: ${e.colorBgLayout};\n      font-weight: 500;\n      padding: ${2*e.sizeUnit}px ${3*e.sizeUnit}px !important;\n    }\n    \n    .ant-collapse-content-box {\n      padding: ${2*e.sizeUnit}px !important;\n    }\n  `}
`,Ge=v.I4.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
`,Qe=v.I4.span`
  ${({theme:e})=>`\n    font-size: 14px;\n    font-weight: 600;\n    color: ${e.colorText};\n  `}
`,qe=v.I4.span`
  ${({theme:e})=>`\n    background: ${e.colorPrimary};\n    color: ${e.colorTextLightSolid};\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 12px;\n    font-weight: 500;\n  `}
`;function Ze(e){return e&&e.split("_")[0]||null}const Je=(0,l.forwardRef)(({databaseId:e,endpoint:t,onParametersChange:a,onColumnsChange:i,onDatasetNameChange:s,onSave:d,initialParameters:c={},initialDatasetName:p},u)=>{var h,m;const[y,S]=(0,l.useState)([]),[v,f]=(0,l.useState)([]),[b,Y]=(0,l.useState)(p||""),[x,T]=(0,l.useState)(!1),[I,_]=(0,l.useState)("dx"),[E,D]=(0,l.useState)((null==(h=c.dimension)||null==(h=h.split(";").find(e=>e.startsWith("dx:")))?void 0:h.replace("dx:","").split(";"))||[]),[A,w]=(0,l.useState)((null==(m=c.dimension)||null==(m=m.split(";").find(e=>e.startsWith("pe:")))?void 0:m.replace("pe:","").split(";"))||["LAST_YEAR"]),[L,$]=(0,l.useState)(["USER_ORGUNIT"]),[C,R]=(0,l.useState)("all_levels"),[N,U]=(0,l.useState)(null),[F,k]=(0,l.useState)(!1),[z,H]=(0,l.useState)([]),[B,P]=(0,l.useState)([]),[M,O]=(0,l.useState)(""),[W,j]=(0,l.useState)(!1),K=(0,l.useRef)({}),X=(0,l.useRef)({}),G=(0,l.useRef)();(0,l.useImperativeHandle)(u,()=>({triggerPreview:async()=>{G.current&&await G.current()},openPreviewModal:()=>k(!0)}),[]);const Q=(0,l.useCallback)(e=>{S(e)},[]),q=(0,l.useCallback)(e=>{f(e)},[]),Z=(0,l.useCallback)(e=>{queueMicrotask(()=>{U(e),R(e.hierarchyColumnMode)})},[]);(0,l.useEffect)(()=>{if(!(x||b&&b!==t&&b!==p)){const e=[];if(E.length>0&&y.length>0){const t=y.find(e=>e.id===E[0]);if(t){const a=t.displayName.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,30);e.push(a)}}A.length>0&&e.push(A[0].replace(/\s+/g,"_"));const a=e.length>0?e.join("_"):"dataset",n=(new Date).toISOString().slice(0,10).replace(/-/g,""),l=`${t}_${a}_${n}`;l!==b&&Y(l)}},[E,A,y,t]);const J=(0,l.useRef)(s),ee=(0,l.useRef)(t);(0,l.useEffect)(()=>{J.current=s,ee.current=t}),(0,l.useEffect)(()=>{if(J.current&&b&&b!==ee.current){const e=setTimeout(()=>{null==J.current||J.current(b)},300);return()=>clearTimeout(e)}},[b]),(0,l.useEffect)(()=>{if(!a)return;const e={};if("analytics"===t){const t=[];E.length>0&&t.push(`dx:${E.join(";")}`),A.length>0&&t.push(`pe:${A.join(";")}`),null!=N&&N.ouDimensionValue?t.push(`ou:${N.ouDimensionValue}`):L.length>0&&t.push(`ou:${L.join(";")}`),t.length>0&&(e.dimension=t.join(";")),e.displayProperty="NAME",e.skipMeta="false",e.hierarchyMeta="true",e.hierarchyColumnMode=C,e.outputIdScheme="UID",e.analyticsType="aggregate"}else if("dataValueSets"===t){E.length>0&&(e.dataElement=E.join(",")),A.length>0&&(e.period=A.join(","));const t=L.filter(e=>!e.startsWith("LEVEL-")&&!e.startsWith("USER_ORGUNIT"));t.length>0&&(e.orgUnit=t.join(",")),L.some(e=>e.startsWith("LEVEL-"))&&(e.children="true"),e.hierarchyColumnMode=C,e.outputIdScheme="UID",e.paging="true",e.pageSize="10000"}else E.length>0&&(e.filter=`id:in:[${E.join(",")}]`),e.fields="id,displayName,name,code,created,lastUpdated",e.paging="false";if(a(e),i){const e=[];"analytics"===t&&E.length>0?(console.log("[DHIS2 Columns] Generating analytics columns - selectedData:",E.length,"loadedDimensions:",y.length),e.push({name:(0,ke.DX)("Period"),type:"VARCHAR(255)"}),v.forEach(t=>{e.push({name:(0,ke.DX)(t.displayName),type:"VARCHAR(255)"})}),E.forEach(t=>{const a=y.find(e=>e.id===t),n=(null==a?void 0:a.displayName)||t,l=(0,ke.DX)(n);e.push({name:l,type:"FLOAT"}),console.log("[DHIS2 Columns] Added column:",l,"(from:",n,") for ID:",t)})):"dataValueSets"===t?(e.push({name:(0,ke.DX)("dataElement"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("period"),type:"VARCHAR(255)"}),v.forEach(t=>{e.push({name:(0,ke.DX)(t.displayName),type:"VARCHAR(255)"})}),e.push({name:(0,ke.DX)("value"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("storedBy"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("created"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("lastUpdated"),type:"TIMESTAMP"})):"events"===t?(e.push({name:(0,ke.DX)("event"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("program"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("programStage"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("enrollment"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("trackedEntityInstance"),type:"VARCHAR(255)"}),v.forEach(t=>{e.push({name:(0,ke.DX)(t.displayName),type:"VARCHAR(255)"})}),e.push({name:(0,ke.DX)("eventDate"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("dueDate"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("status"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("created"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("lastUpdated"),type:"TIMESTAMP"})):"enrollments"===t?(e.push({name:(0,ke.DX)("enrollment"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("trackedEntityInstance"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("program"),type:"VARCHAR(255)"}),v.forEach(t=>{e.push({name:(0,ke.DX)(t.displayName),type:"VARCHAR(255)"})}),e.push({name:(0,ke.DX)("enrollmentDate"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("incidentDate"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("status"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("created"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("lastUpdated"),type:"TIMESTAMP"})):"trackedEntityInstances"===t?(e.push({name:(0,ke.DX)("trackedEntityInstance"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("trackedEntityType"),type:"VARCHAR(255)"}),v.forEach(t=>{e.push({name:(0,ke.DX)(t.displayName),type:"VARCHAR(255)"})}),e.push({name:(0,ke.DX)("created"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("lastUpdated"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("inactive"),type:"BOOLEAN"})):(e.push({name:(0,ke.DX)("id"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("displayName"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("name"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("code"),type:"VARCHAR(255)"}),e.push({name:(0,ke.DX)("created"),type:"TIMESTAMP"}),e.push({name:(0,ke.DX)("lastUpdated"),type:"TIMESTAMP"})),console.log("Generated DHIS2 columns for",t,":",e),i(e)}},[E,A,L,t,y,C,N]);const te=async()=>{if(!e){try{Re.message.error("No database selected")}catch{console.error("No database selected")}return}if(0===E.length){try{Re.message.warning("Please select at least one data element or indicator")}catch{console.warn("Please select at least one data element or indicator")}return}const a={};if("analytics"===t){const e=[],t=E.slice(0,1);t.length>0&&e.push(`dx:${t.join(";")}`);const n=A.filter(e=>e.startsWith("LAST_")||e.startsWith("THIS_")).slice(0,1);if(0===n.length&&A.length>0?e.push(`pe:${A[0]}`):n.length>0&&e.push(`pe:${n.join(";")}`),null!=N&&N.ouDimensionValue)e.push(`ou:${N.ouDimensionValue}`);else if(L.length>0){const t=L.find(e=>!e.startsWith("LEVEL-"))||L[0];e.push(`ou:${t}`)}e.length>0&&(a.dimension=e.join(";")),a.displayProperty="NAME",a.skipMeta="false",a.hierarchyMeta="true",a.outputIdScheme="UID",a.analyticsType="aggregate"}else if("dataValueSets"===t){E.length>0&&(a.dataElement=E.join(",")),A.length>0&&(a.period=A.join(","));const e=L.filter(e=>!e.startsWith("LEVEL-")&&!e.startsWith("USER_ORGUNIT"));e.length>0&&(a.orgUnit=e.join(",")),L.some(e=>e.startsWith("LEVEL-"))&&(a.children="true")}else if("events"===t){if(E.length>0&&(a.program=E[0]),L.length>0&&(a.orgUnit=L[0]),A.length>0){const e=A[0];if("THIS_YEAR"===e){const e=(new Date).getFullYear();a.startDate=`${e}-01-01`,a.endDate=`${e}-12-31`}else if("LAST_YEAR"===e){const e=(new Date).getFullYear()-1;a.startDate=`${e}-01-01`,a.endDate=`${e}-12-31`}else if("LAST_12_MONTHS"===e){const e=new Date,t=new Date;t.setMonth(t.getMonth()-12),a.startDate=t.toISOString().split("T")[0],a.endDate=e.toISOString().split("T")[0]}}L.some(e=>e.startsWith("LEVEL-"))&&(a.ouMode="DESCENDANTS"),a.fields="*",a.paging="false"}else if("enrollments"===t){if(E.length>0&&(a.program=E[0]),L.length>0&&(a.ou=L[0]),A.length>0){const e=A[0];if("THIS_YEAR"===e){const e=(new Date).getFullYear();a.programStartDate=`${e}-01-01`,a.programEndDate=`${e}-12-31`}else if("LAST_YEAR"===e){const e=(new Date).getFullYear()-1;a.programStartDate=`${e}-01-01`,a.programEndDate=`${e}-12-31`}}L.some(e=>e.startsWith("LEVEL-"))&&(a.ouMode="DESCENDANTS"),a.fields="*",a.paging="false"}else"trackedEntityInstances"===t?(E.length>0&&(a.program=E[0]),L.length>0&&(a.ou=L[0]),L.some(e=>e.startsWith("LEVEL-"))&&(a.ouMode="DESCENDANTS"),a.fields="*",a.paging="false"):(E.length>0&&(a.filter=`id:in:[${E.join(",")}]`),a.fields="id,displayName,name,code,created,lastUpdated",a.paging="false");const n=JSON.stringify({endpoint:t,params:a});if(X.current[n]){try{Re.message.info("Preview request already in progress. Please wait...")}catch{console.info("Preview request already in progress.")}return}const l=K.current[n];if(l&&Date.now()-l.timestamp<3e5)return console.log("[Preview Cache] Returning cached preview data"),P(l.columns),H(l.data),void k(!0);j(!0),X.current[n]=!0;try{var i,s;const l=[];Object.entries(a).forEach(([e,t])=>{"dimension"===e?t.split(/;(?=(?:dx|pe|ou):)/).forEach(e=>{l.push(`dimension=${e}`)}):l.push(`${e}=${t}`)});const p=`api/${t}?${l.join("&")}`;O(p);const u=[];Object.entries(a).forEach(([e,t])=>{"dimension"===e?t.split(/;(?=(?:dx|pe|ou):)/).forEach(e=>{u.push(`dimension=${encodeURIComponent(e)}`)}):u.push(`${e}=${encodeURIComponent(t)}`)});const h=`-- DHIS2: ${u.join("&")}\nSELECT * FROM ${t} LIMIT 10`;let m,g={};try{var d;if(m=await r.A.post({endpoint:"/api/v1/sqllab/execute/",jsonPayload:{database_id:e,sql:h,schema:"dhis2",runAsync:!1,queryLimit:10}}),null!=(d=m)&&d.json){const{json:e}=m;g=e.data&&e.columns||"success"===e.status&&e.data?e:e.query&&e.query.results?{data:e.query.results.data||[],columns:e.query.results.columns||[]}:"string"==typeof e?JSON.parse(e):e.query_result?{data:e.query_result.data||[],columns:e.query_result.columns||[]}:e}}catch(e){var c;console.error("SQL Lab execute failed:",e);const t=(null==e||null==(c=e.response)?void 0:c.status)||(null==e?void 0:e.status),a=(null==e?void 0:e.message)||"";if(500===t||504===t||a.toLowerCase().includes("timeout"))throw new Error("Preview timed out - the DHIS2 server is responding slowly. This is common for large data queries. The preview is limited to 1 data element and 1 period (10 rows) for speed. You can still create the dataset with all your selections - the actual dataset will be processed with all selected data elements, periods, and org units. Note: Large DHIS2 queries may take several minutes to complete.");throw e}console.log("Parsed payload:",g);const y=(null==(i=g)?void 0:i.data)||[],S=(null==(s=g)?void 0:s.columns)||[];if(console.log("Extracted data:",y.length,"rows, columns:",S),y.length>0&&S.length>0){const e=S.map(e=>({title:"string"==typeof e?e:e.name,dataIndex:"string"==typeof e?e:e.name,key:"string"==typeof e?e:e.name,ellipsis:!0})),t=y.map((e,t)=>({...e,key:t}));K.current[n]={data:t,columns:e,timestamp:Date.now()},P(e),H(t),k(!0),Re.message.success(`Preview loaded: ${y.length} rows (cached for 5 min) - full dataset will include all ${E.length} data element(s) and ${A.length} period(s)`,5)}else{P([]),H([]),k(!0),console.log("Empty response:",g);const e=L.some(e=>e.startsWith("USER_ORGUNIT"));try{e?Re.message.warning((0,o.t)("No data returned. When using USER_ORGUNIT options, ensure the DHIS2 API user has an assigned organisation unit. Try selecting specific org units instead."),8):Re.message.warning((0,o.t)("No data returned. The selected data elements may not have data for the chosen periods and organisation units."),6)}catch{console.warn("Message display failed - likely due to context issue. Data may be empty.")}}}catch(e){console.error("Preview error:",e);let t="Unknown error";null!=e&&e.response?e.response.statusText?t=e.response.statusText:e.response.status&&(t=`HTTP ${e.response.status}`):null!=e&&e.message?t=e.message:"string"==typeof e&&(t=e);try{Re.message.error(`Failed to load preview: ${t}`)}catch{console.error(`Failed to load preview: ${t}`)}}finally{j(!1),X.current[n]=!1}};return(0,l.useEffect)(()=>{G.current=te},[te]),t&&e?(0,n.FD)(Pe,{children:[(0,n.Y)(ze,{level:4,children:(0,o.t)("DHIS2 Query Builder")}),(0,n.Y)(Oe,{children:(0,n.Y)(He,{style:{margin:0},children:(0,o.t)("Build your DHIS2 query visually by selecting data elements, periods, and organization units. No SQL required!")})}),(0,n.FD)(Me,{children:[(0,n.Y)(ze,{level:5,children:(0,o.t)("Dataset Name")}),(0,n.Y)(He,{type:"secondary",children:(0,o.t)("Customize the name for this dataset (auto-generated based on your selections)")}),(0,n.Y)(Re.Input,{value:b,onChange:e=>{Y(e.target.value),T(!0)},placeholder:(0,o.t)("Enter dataset name..."),style:{width:"100%"}})]}),(0,n.Y)(Re.Divider,{}),(0,n.Y)(Ve,{accordion:!0,activeKey:I,onChange:e=>_(e),items:[{key:"dx",label:(0,n.FD)(Ge,{children:[(0,n.FD)(Qe,{children:["ðŸ“Š ",(0,o.t)("Data (dx)")]}),E.length>0&&(0,n.Y)(qe,{children:E.length})]}),children:(0,n.FD)(n.FK,{children:[(0,n.Y)(He,{type:"secondary",style:{marginBottom:12},children:(0,o.t)("Select data elements, indicators, or data sets to include in your query.")}),(0,n.Y)(Ue.e,{databaseId:e,endpoint:t||"analytics",value:E,onChange:D,onDimensionsLoad:Q})]})},{key:"pe",label:(0,n.FD)(Ge,{children:[(0,n.FD)(Qe,{children:["ðŸ“… ",(0,o.t)("Period (pe)")]}),A.length>0&&(0,n.Y)(qe,{children:A.length})]}),children:(0,n.FD)(n.FK,{children:[(0,n.Y)(He,{type:"secondary",style:{marginBottom:12},children:(0,o.t)("Select time periods for your data - relative or fixed.")}),(0,n.Y)(Ne.r,{databaseId:e,value:A,onChange:w})]})},{key:"ou",label:(0,n.FD)(Ge,{children:[(0,n.FD)(Qe,{children:["ðŸ¢ ",(0,o.t)("Organization Units (ou)")]}),L.length>0&&(0,n.Y)(qe,{children:L.length})]}),children:(0,n.FD)(n.FK,{children:[(0,n.Y)(He,{type:"secondary",style:{marginBottom:12},children:(0,o.t)("Select organization units using the tree view, levels, or user-relative options.")}),(0,n.Y)(Fe.y,{databaseId:e,value:L,onChange:$,onLevelsLoad:q,onSelectionChange:Z,hierarchyColumnMode:C,onHierarchyColumnModeChange:R})]})}]}),(0,n.Y)(Re.Divider,{}),(0,n.Y)($e.aF,{title:(0,n.FD)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.Y)("span",{style:{fontSize:18,fontWeight:600},children:"DHIS2 Data Preview"}),z.length>0&&(0,n.FD)(Re.Tag,{color:"blue",children:[z.length," rows"]})]}),show:F,onHide:()=>k(!1),width:1200,footer:(0,n.FD)("div",{style:{display:"flex",gap:8},children:[(0,n.Y)(g.$,{onClick:te,loading:W,disabled:W,children:"Refresh Data"}),(0,n.Y)(g.$,{onClick:()=>{navigator.clipboard.writeText(M),Re.message.success("API URL copied to clipboard!")},disabled:!M,children:"Copy API URL"}),(0,n.Y)(g.$,{type:"primary",onClick:()=>k(!1),children:"Close"})]}),children:W?(0,n.FD)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:600,flexDirection:"column",gap:16},children:[(0,n.Y)(V.R,{}),(0,n.Y)(Be,{type:"secondary",children:"Loading preview data..."})]}):(0,n.FD)("div",{style:{display:"flex",flexDirection:"column",height:600},children:[(0,n.FD)(We,{children:[(0,n.FD)("div",{style:{marginBottom:8,display:"flex",alignItems:"center",gap:8},children:[(0,n.Y)(Be,{strong:!0,style:{fontSize:14},children:"ðŸ”— Generated API URL"}),(0,n.Y)(Re.Tag,{color:"green",children:"Ready to use"})]}),(0,n.Y)(Ke,{value:M,readOnly:!0,autoSize:{minRows:2,maxRows:4}}),(0,n.FD)(He,{type:"secondary",style:{marginTop:8,marginBottom:0,fontSize:12},children:["ðŸ’¡ Use this URL to query DHIS2 directly or paste it into other tools. URL uses readable format with ",(0,n.Y)("code",{children:":"})," and"," ",(0,n.Y)("code",{children:";"})," characters."]})]}),(0,n.Y)(je,{children:z.length>0?(0,n.FD)(n.FK,{children:[(0,n.FD)("div",{style:{marginBottom:12},children:[(0,n.Y)(Be,{strong:!0,style:{fontSize:14},children:"ðŸ“Š Data Sample"}),(0,n.FD)(He,{type:"secondary",style:{marginTop:4,marginBottom:0,fontSize:12},children:["Showing first ",z.length," rows from your query"]})]}),(0,n.Y)(Xe,{children:(0,n.Y)(Re.Table,{columns:B,dataSource:z,scroll:{x:"max-content",y:350},pagination:{pageSize:10,showSizeChanger:!1,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} rows (preview limited to 10 rows)`},bordered:!0})})]}):(0,n.Y)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,n.Y)(Ce.S,{description:"No data to display"})})})]})})]}):null});Je.displayName="DHIS2ParameterBuilder";const et=Je,tt=v.I4.div`
  ${({theme:e})=>`\n    padding: ${4*e.sizeUnit}px;\n    height: 100%;\n    background-color: ${e.colorBgContainer};\n    position: relative;\n    .emptystate {\n      height: auto;\n      margin-top: ${17.5*e.sizeUnit}px;\n    }\n    .section-title {\n      margin-top: ${5.5*e.sizeUnit}px;\n      margin-bottom: ${11*e.sizeUnit}px;\n      font-weight: ${e.fontWeightStrong};\n    }\n    .table-title {\n      margin-top: ${11*e.sizeUnit}px;\n      margin-bottom: ${6*e.sizeUnit}px;\n      font-weight: ${e.fontWeightStrong};\n    }\n    .options-list {\n      overflow: auto;\n      position: absolute;\n      bottom: 0;\n      top: ${92.25*e.sizeUnit}px;\n      left: ${3.25*e.sizeUnit}px;\n      right: 0;\n\n      .no-scrollbar {\n        margin-right: ${4*e.sizeUnit}px;\n      }\n\n      .options {\n        cursor: pointer;\n        padding: ${1.75*e.sizeUnit}px;\n        border-radius: ${e.borderRadius}px;\n        :hover {\n          background-color: ${e.colorFillTertiary}\n        }\n      }\n\n      .options-highlighted {\n        cursor: pointer;\n        padding: ${1.75*e.sizeUnit}px;\n        border-radius: ${e.borderRadius}px;\n        background-color: ${e.colorPrimaryText};\n        color: ${e.colorTextLightSolid};\n      }\n\n      .options, .options-highlighted {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n    }\n    form > span[aria-label="refresh"] {\n      position: absolute;\n      top: ${69*e.sizeUnit}px;\n      left: ${42.75*e.sizeUnit}px;\n      font-size: ${4.25*e.sizeUnit}px;\n    }\n    .table-form {\n      margin-bottom: ${8*e.sizeUnit}px;\n    }\n    .loading-container {\n      position: absolute;\n      top: ${89.75*e.sizeUnit}px;\n      left: 0;\n      right: 0;\n      text-align: center;\n      img {\n        width: ${20*e.sizeUnit}px;\n        margin-bottom: ${2.5*e.sizeUnit}px;\n      }\n      p {\n        color: ${e.colorTextSecondary};\n      }\n    }\n`}
`;function at({setDataset:e,dataset:t,datasetNames:a}){var i,r;const{addDangerToast:s}=(0,De.Yf)(),{createResource:d}=(0,Le.fn)("dataset",(0,o.t)("dataset"),s),c=(0,l.useCallback)(t=>{e({type:h.SelectDatabase,payload:{db:t}})},[e]);(0,l.useEffect)(()=>{const e=(0,Ae.Gq)(Ae.Hh.Database,null);e&&c(e)},[c]);const p=(0,l.useCallback)(e=>(0,n.Y)(Ee.cs,{table:null!=a&&a.includes(e.value)?{...e,extra:{warning_markdown:(0,o.t)("This table already has a dataset")}}:e}),[a]),u="dhis2"===(null==t||null==(i=t.db)?void 0:i.backend)&&(null==t?void 0:t.table_name);return(0,n.FD)(tt,{children:[(0,n.Y)(Ee.Ay,{database:null==t?void 0:t.db,handleError:s,emptyState:(0,n.Y)(Q.p,{image:"empty.svg",title:(0,o.t)("No databases available"),description:(0,n.FD)("span",{children:[(0,o.t)("Manage your databases")," ",(0,n.Y)(we.o.Link,{href:"/databaseview/list",children:(0,o.t)("here")})]}),size:"small"}),onDbChange:c,onCatalogChange:t=>{t&&e({type:h.SelectCatalog,payload:{name:"catalog",value:t}})},onSchemaChange:t=>{t&&e({type:h.SelectSchema,payload:{name:"schema",value:t}})},onTableSelectChange:t=>{e({type:h.SelectTable,payload:{name:"table_name",value:t}})},sqlLabMode:!1,customTableOptionLabelRenderer:p,...(null==t?void 0:t.catalog)&&{catalog:t.catalog},...(null==t?void 0:t.schema)&&{schema:t.schema}}),u&&(0,n.Y)("div",{style:{marginTop:20},children:(0,n.Y)(et,{databaseId:null==(r=t.db)?void 0:r.id,endpoint:t.table_name,initialDatasetName:t.table_name||void 0,onParametersChange:t=>{console.log("DHIS2 Parameters generated:",t),e({type:h.SetDHIS2Parameters,payload:{parameters:t}})},onColumnsChange:t=>{console.log("DHIS2 Columns generated:",t),e({type:h.SetDHIS2Columns,payload:{columns:t}})},onDatasetNameChange:t=>{console.log("DHIS2 Dataset name changed:",t),e({type:h.ChangeDataset,payload:{name:"dataset_name",value:t}})},onSave:async()=>{var e;if(!t)return;const a=t.dataset_name||t.table_name,n={database:null==(e=t.db)?void 0:e.id,catalog:t.catalog,schema:t.schema,table_name:a};if(t.dhis2_parameters){const e=Ze(a)||t.table_name,l=Object.entries(t.dhis2_parameters).map(([e,t])=>`${e}=${t}`).join("&");n.sql=`SELECT * FROM ${e}\n/* DHIS2: table=${e}&${l} */`,console.log("[DHIS2] Creating dataset:",a,"from source table:",e),console.log("[DHIS2] SQL:",n.sql)}try{const e=await d(n);e&&"number"==typeof e&&console.log("[DHIS2] Dataset created with ID:",e)}catch(e){console.error("[DHIS2] Failed to create dataset:",e)}}})})]})}var nt=a(76576),lt=a(81574),it=a(25875),rt=a(50816);const ot=["db","schema","table_name"],st=[rt.ci,rt.q0,rt.ar,rt.R2],dt=(0,De.Ay)(function({datasetObject:e,addDangerToast:t,hasColumns:a=!1,datasets:l}){const s=(0,i.W6)(),d=(0,v.DP)(),{createResource:c}=(0,Le.fn)("dataset",(0,o.t)("dataset"),t),p=(0,o.t)("Select a database table."),u=(t=!0)=>{if(e){var a;const n=e.dataset_name||e.table_name,l={database:null==(a=e.db)?void 0:a.id,catalog:e.catalog,schema:e.schema,table_name:n};if(e.dhis2_parameters){const t=Ze(n)||e.table_name,a=Object.entries(e.dhis2_parameters).map(([e,t])=>`${e}=${t}`).join("&");l.sql=`SELECT * FROM ${t}\n/* DHIS2: table=${t}&${a} */`,console.log("[DHIS2] Creating dataset:",n,"from source table:",t),console.log("[DHIS2] SQL:",l.sql)}c(l).then(a=>{a&&"number"==typeof a&&((0,it.logEvent)(rt.oA,e),(async e=>{try{await r.A.post({endpoint:`/api/v1/dataset/${e}/refresh`}),console.log("[Background Load] Dataset refresh initiated for ID:",e)}catch(e){console.warn("[Background Load] Failed to trigger refresh:",e)}})(a),t?s.push(`/chart/add/?dataset=${e.table_name}`):s.push("/tablemodelview/list/"))})}},h=()=>{u(!1)},m=(0,o.t)("Create and explore dataset"),f=(0,o.t)("Create dataset"),b=!(null!=e&&e.table_name)||!a||(null==l?void 0:l.includes(null==e?void 0:e.table_name));return(0,n.FD)(nt.s,{align:"center",justify:"flex-end",gap:"8px",children:[(0,n.Y)(g.$,{buttonStyle:"secondary",onClick:()=>{if(e){const t=(e=>{let t=0;const a=Object.keys(e).reduce((a,n)=>(ot.includes(n)&&e[n]&&(t+=1),t),0);return st[a]})(e);(0,it.logEvent)(t,e)}else(0,it.logEvent)(rt.ci,{});s.goBack()},children:(0,o.t)("Cancel")}),(0,n.Y)(lt.g,{type:"primary",disabled:b,tooltip:null!=e&&e.table_name?void 0:p,onClick:()=>u(!0),popupRender:()=>(0,n.Y)(S.W1,{items:[{key:"create-only",onClick:h,label:f}]}),icon:(0,n.Y)(y.F.DownOutlined,{iconSize:"xs",iconColor:d.colorTextLightSolid}),trigger:["click"],children:m})]})});var ct=a(36188);const{Title:pt,Paragraph:ut,Text:ht}=we.o,mt=v.I4.div`
  max-width: 600px;
  margin: 0 auto;
`,gt=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    padding: 16px;\n    border-radius: ${e.borderRadius}px;\n    margin-bottom: 16px;\n    border: 1px solid ${e.colorBorder};\n  `}
`,yt=e=>{if(!e)return"N/A";try{const t=e.trim();if(!t.startsWith("dhis2://"))return"N/A";const a=t.substring(8).split("@"),n=a.length>1?a[1]:a[0];if(!n)return"N/A";const l=n.indexOf("/"),i=-1!==l?n.substring(0,l):n;if(!i)return"N/A";try{return new URL(`https://${i}`).hostname||i}catch{return i}}catch{return"N/A"}},St=v.I4.div`
  ${({theme:e})=>"\n    margin-bottom: 16px;\n\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 8px;\n      color: #000;\n    }\n\n    input {\n      width: 100%;\n    }\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n  "}
`,vt=(0,v.I4)(ht)`
  ${({theme:e})=>"\n    color: #ff4d4f;\n    font-size: 12px;\n    margin-top: 4px;\n    display: block;\n  "}
`,ft=(0,v.I4)(ht)`
  ${({theme:e})=>"\n    color: #999;\n    font-size: 12px;\n    margin-top: 4px;\n    display: block;\n  "}
`,bt=e=>{const t=[];if(e.dataElements.length>0){const a=e.dataElements.length;1===a?t.push(e.dataElements[0]):t.push(`${a} Data Elements`)}return e.periods.length>0&&t.push(`${e.periods.length} Periods`),e.orgUnits.length>0&&t.push(`${e.orgUnits.length} Units`),`${t.length>0?t.join(" - "):"DHIS2 Dataset"} ${(new Date).toISOString().slice(0,10).replace(/-/g,"")}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`};function Yt({wizardState:e,updateState:t,errors:a,dataset:i}){var r,o;const[s,d]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!s&&e.dataElements.length>0){const a=bt(e);t({datasetName:a})}},[e.dataElements.length,e.periods.length,e.orgUnits.length,s,t]),(0,n.FD)(mt,{children:[(0,n.FD)("div",{style:{marginBottom:24},children:[(0,n.Y)(pt,{level:4,style:{margin:0,marginBottom:8},children:"Dataset Information"}),(0,n.Y)(ut,{style:{margin:0,color:"#666"},children:"Enter basic information for your DHIS2 dataset."})]}),(0,n.FD)(gt,{children:[(0,n.FD)(St,{children:[(0,n.Y)("label",{children:"Dataset Name *"}),(0,n.Y)(Re.Input,{placeholder:"e.g., Malaria Cases 2024",value:e.datasetName,onChange:e=>{d(!0),t({datasetName:e.target.value})},status:a.datasetName?"error":"",size:"large"}),a.datasetName&&(0,n.Y)(vt,{children:a.datasetName}),(0,n.Y)(ft,{children:s?"You can edit the name or select different data elements/periods/units to update it.":"Dataset name is auto-generated based on your selections. Edit to customize."})]}),(0,n.FD)(St,{children:[(0,n.Y)("label",{children:"Description (Optional)"}),(0,n.Y)(Re.Input.TextArea,{placeholder:"Describe the dataset, intended use, etc.",value:e.description,onChange:e=>t({description:e.target.value}),rows:3,maxLength:500,showCount:!0}),(0,n.Y)(ft,{children:"Help other users understand what data this dataset contains."})]})]}),(0,n.FD)(Re.Card,{type:"inner",title:"Database Connection",style:{marginBottom:16},children:[(0,n.FD)("div",{style:{marginBottom:12},children:[(0,n.Y)(ht,{strong:!0,children:"Database:"}),(0,n.Y)("br",{}),(0,n.Y)(ht,{type:"secondary",style:{fontSize:13},children:(null==i||null==(r=i.db)?void 0:r.database_name)||"Not selected"})]}),(0,n.FD)("div",{children:[(0,n.Y)(ht,{strong:!0,children:"Server URL:"}),(0,n.Y)("br",{}),(0,n.Y)(ht,{type:"secondary",style:{fontSize:13},children:yt(null==i||null==(o=i.db)?void 0:o.sqlalchemy_uri)})]})]})]})}const{Title:xt,Paragraph:Tt,Text:It}=we.o,_t=v.I4.div`
  display: grid;
  grid-template-columns: 1fr 300px;
  gap: 24px;
  align-items: start;
`,Et=v.I4.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
`,Dt=v.I4.div`
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
`,At=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    max-height: 550px;\n    overflow-y: auto;\n    \n    .tree-item {\n      padding: 8px 12px;\n      margin: 4px 0;\n      border-radius: 4px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 8px;\n      transition: all 0.2s ease;\n      \n      &:hover {\n        background: ${e.colorBgContainer};\n      }\n      \n      &.selected {\n        background: ${e.colorPrimaryBg};\n        border-left: 3px solid ${e.colorPrimary};\n        padding-left: 9px;\n      }\n    }\n  `}
`,wt=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    padding: 16px;\n    height: fit-content;\n    position: sticky;\n    top: 0;\n  `}
`,Lt=v.I4.div`
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
`,$t=v.I4.div`
  ${({theme:e})=>`\n    font-weight: 600;\n    padding: 12px;\n    background: ${e.colorBgContainer};\n    border-radius: 4px;\n    margin-top: 8px;\n    font-size: 13px;\n    color: ${e.colorTextSecondary};\n  `}
`,Ct=v.I4.div`
  color: #ff4d4f;
  font-size: 12px;
  margin-bottom: 12px;
  padding: 8px 12px;
  background: #fff1f0;
  border-radius: 4px;
`,Rt=[{label:"Data elements",value:"dataElements"},{label:"Indicators",value:"indicators"},{label:"Data sets",value:"dataSets"},{label:"Program indicators",value:"programIndicators"},{label:"Event data items",value:"eventDataItems"}];function Nt({wizardState:e,updateState:t,errors:a,databaseId:i}){const[o,s]=(0,l.useState)(!1),[d,c]=(0,l.useState)([]),[p,u]=(0,l.useState)([]),[h,m]=(0,l.useState)([]),[g,y]=(0,l.useState)([]),[S]=(0,l.useState)([{label:"All metrics",value:""},{label:"Reporting rate",value:"REPORTING_RATE"},{label:"Reporting rate on time",value:"REPORTING_RATE_ON_TIME"},{label:"Actual reports",value:"ACTUAL_REPORTS"},{label:"Actual reports on time",value:"ACTUAL_REPORTS_ON_TIME"},{label:"Expected reports",value:"EXPECTED_REPORTS"}]),[v,f]=(0,l.useState)("dataElements"),[b,Y]=(0,l.useState)(""),[x,T]=(0,l.useState)(""),[I,_]=(0,l.useState)(""),[E,D]=(0,l.useState)(""),[A,w]=(0,l.useState)(""),[L,$]=(0,l.useState)(""),[C,R]=(0,l.useState)(""),[N,U]=(0,l.useState)(""),[F,k]=(0,l.useState)(""),[z,H]=(0,l.useState)("");(0,l.useEffect)(()=>{i&&(P(),M(),O(),W())},[i]),(0,l.useEffect)(()=>{i&&(Y(""),T(""),_(""),D(""),$(""),R(""),U(""),k(""),H(""),P())},[v]),(0,l.useEffect)(()=>{i&&P()},[L,C,N,F,z,x,I,E]);const B=e=>{const t=new URLSearchParams;return t.append("type",e),"dataElements"===e?(L&&t.append("domainType",L),C&&t.append("valueType",C),N&&t.append("aggregationType",N)):"indicators"===e?C&&t.append("valueType",C):"dataSets"===e?z&&t.append("formType",z):"programIndicators"===e?x&&t.append("programId",x):"eventDataItems"===e&&x&&t.append("programId",x),t.toString()},P=async()=>{s(!0);try{if("all"===v){const e=["indicators","dataElements","dataSets","eventDataItems","programIndicators"],t=(await Promise.all(e.map(e=>r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata?${B(e)}`}).catch(()=>({json:{result:[]}}))))).flatMap(e=>{var t;return(null==(t=e.json)?void 0:t.result)||[]});c(t)}else{var e;const t=await r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata?${B(v)}`});c((null==(e=t.json)?void 0:e.result)||[])}}catch(e){console.error("Error fetching data elements:",e)}finally{s(!1)}},M=async()=>{try{var e,t;const[a,n]=await Promise.all([r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata?type=dataElementGroups`}).catch(()=>({json:{result:[]}})),r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata?type=indicatorGroups`}).catch(()=>({json:{result:[]}}))]),l=[...((null==(e=a.json)?void 0:e.result)||[]).map(e=>({...e,type:"dataElements"})),...((null==(t=n.json)?void 0:t.result)||[]).map(e=>({...e,type:"indicators"}))];u(l)}catch(e){console.error("Error fetching groups:",e),u([])}},O=async()=>{try{var e;const t=await r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata?type=programs`});m((null==(e=t.json)?void 0:e.result)||[])}catch(e){console.error("Error fetching programs:",e),m([])}},W=async()=>{try{var e;const t=await r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata?type=dataSets`});y((null==(e=t.json)?void 0:e.result)||[])}catch(e){console.error("Error fetching datasets:",e),y([])}},j=(0,l.useMemo)(()=>{let e=d;return e=e.filter(e=>e.displayName.toLowerCase().includes(A.toLowerCase())),e},[d,A]),K=(0,l.useMemo)(()=>{const e={};return j.forEach(t=>{const a=t.categoryCombo||"Uncategorized";e[a]||(e[a]=[]),e[a].push(t)}),e},[j]),X=(0,l.useMemo)(()=>"all"===v?p:p.filter(e=>e.type===v),[p,v]),G=(0,l.useMemo)(()=>e.dataElements.map(e=>{var t;return(null==(t=d.find(t=>t.id===e))?void 0:t.displayName)||e}),[e.dataElements,d]);return(0,n.FD)(_t,{children:[(0,n.FD)(Et,{children:[(0,n.FD)("div",{children:[(0,n.Y)(xt,{level:4,children:"Select Data Elements"}),(0,n.Y)(Tt,{children:"Choose the data elements (indicators, measures) for your dataset."})]}),(0,n.FD)(Dt,{children:[(0,n.Y)("span",{style:{fontSize:12,fontWeight:500},children:"Data Type"}),(0,n.Y)(Re.Select,{value:v,onChange:f,style:{flex:1,minWidth:200},options:Rt})]}),"dataElements"===v&&(0,n.FD)(n.FK,{children:[(0,n.FD)(Dt,{children:[(0,n.Y)("span",{style:{fontSize:12,fontWeight:500},children:"Data element group"}),(0,n.Y)(Re.Select,{placeholder:"All groups",value:b||void 0,onChange:Y,allowClear:!0,style:{flex:1,minWidth:150},options:X.filter(e=>"dataElements"===e.type).map(e=>({label:e.displayName,value:e.id}))})]}),(0,n.FD)(Dt,{children:[(0,n.Y)("span",{style:{fontSize:12,fontWeight:500},children:"Disaggregation"}),(0,n.Y)(Re.Select,{placeholder:"Totals only",value:F||void 0,onChange:k,allowClear:!0,style:{flex:1,minWidth:150},options:[{label:"Totals only",value:"TOTALS_ONLY"},{label:"Details only",value:"DETAILS_ONLY"}]})]})]}),"indicators"===v&&(0,n.FD)(Dt,{children:[(0,n.Y)("span",{style:{fontSize:12,fontWeight:500},children:"Indicator group"}),(0,n.Y)(Re.Select,{placeholder:"All groups",value:b||void 0,onChange:Y,allowClear:!0,style:{flex:1,minWidth:150},options:X.filter(e=>"indicators"===e.type).map(e=>({label:e.displayName,value:e.id}))})]}),"dataSets"===v&&(0,n.FD)(n.FK,{children:[(0,n.FD)(Dt,{children:[(0,n.Y)("span",{style:{fontSize:12,fontWeight:500},children:"Data set"}),(0,n.Y)(Re.Select,{placeholder:"All data sets",value:I||void 0,onChange:_,allowClear:!0,style:{flex:1,minWidth:150},options:g.map(e=>({label:e.displayName,value:e.id}))})]}),(0,n.FD)(Dt,{children:[(0,n.Y)("span",{style:{fontSize:12,fontWeight:500},children:"Metric type"}),(0,n.Y)(Re.Select,{placeholder:"All metrics",value:E||void 0,onChange:D,allowClear:!0,style:{flex:1,minWidth:150},options:S})]})]}),"programIndicators"===v&&(0,n.FD)(Dt,{children:[(0,n.Y)("span",{style:{fontSize:12,fontWeight:500},children:"Program"}),(0,n.Y)(Re.Select,{placeholder:"All programs",value:x||void 0,onChange:T,allowClear:!0,style:{flex:1,minWidth:150},options:h.map(e=>({label:e.displayName,value:e.id}))})]}),"eventDataItems"===v&&(0,n.FD)(Dt,{children:[(0,n.Y)("span",{style:{fontSize:12,fontWeight:500},children:"Program"}),(0,n.Y)(Re.Select,{placeholder:"All programs",value:x||void 0,onChange:T,allowClear:!0,style:{flex:1,minWidth:150},options:h.map(e=>({label:e.displayName,value:e.id}))})]}),(0,n.Y)(Re.Input.Search,{placeholder:"Search...",value:A,onChange:e=>w(e.target.value),size:"large"}),a.dataElements&&(0,n.Y)(Ct,{children:a.dataElements}),o?(0,n.Y)("div",{style:{textAlign:"center",padding:"60px 20px"},children:(0,n.Y)(V.R,{})}):0===j.length?(0,n.Y)(Re.Empty,{description:A?"No data elements found":"No data elements available",style:{marginTop:40}}):(0,n.Y)(At,{children:Object.entries(K).map(([a,l])=>(0,n.FD)("div",{children:[(0,n.Y)($t,{children:a}),l.map(a=>(0,n.FD)("div",{className:"tree-item "+(e.dataElements.includes(a.id)?"selected":""),onClick:()=>(a=>{const n=e.dataElements.includes(a)?e.dataElements.filter(e=>e!==a):[...e.dataElements,a];t({dataElements:n})})(a.id),children:[(0,n.Y)("span",{children:a.displayName}),e.dataElements.includes(a.id)&&(0,n.Y)(Re.Badge,{status:"success",text:"Selected"})]},a.id))]},a))})]}),(0,n.FD)(wt,{children:[(0,n.FD)("div",{style:{marginBottom:16},children:[(0,n.FD)(xt,{level:5,style:{margin:0,marginBottom:8},children:[(0,n.Y)(Re.Badge,{count:e.dataElements.length,style:{backgroundColor:"#1890ff"}}),(0,n.Y)("span",{style:{marginLeft:8},children:"Selected"})]}),(0,n.Y)(It,{type:"secondary",style:{fontSize:12},children:0===e.dataElements.length?"No elements selected":`${e.dataElements.length} element${1!==e.dataElements.length?"s":""}`})]}),G.length>0&&(0,n.FD)(Lt,{children:[G.slice(0,4).map((a,l)=>(0,n.Y)(Re.Tag,{closable:!0,onClose:()=>{const a=e.dataElements.filter((e,t)=>t!==l);t({dataElements:a})},style:{maxWidth:"100%"},children:(0,n.Y)("span",{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"80px"},children:a})},e.dataElements[l])),G.length>4&&(0,n.FD)(Re.Tag,{children:["+",G.length-4]})]}),(0,n.Y)(Re.Button,{type:"primary",danger:!0,block:!0,style:{marginTop:16},onClick:()=>t({dataElements:[]}),disabled:0===e.dataElements.length,children:"Clear All"})]})]})}const{Title:Ut,Paragraph:Ft,Text:kt}=we.o,zt=v.I4.div`
  max-width: 1200px;
`,Ht=v.I4.div`
  margin-bottom: 24px;

  &:last-child {
    margin-bottom: 0;
  }
`,Bt=v.I4.h4`
  margin: 0 0 12px 0;
  font-size: 14px;
  font-weight: 600;
  color: #000;
`,Pt=(0,v.I4)(Re.Tabs)`
  .ant-tabs-tab {
    font-weight: 500;
  }
`,Mt=(0,v.I4)(Re.Row)`
  margin-bottom: 16px;
`,Ot=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    padding: 12px;\n    max-height: 400px;\n    overflow-y: auto;\n  `}
`,Wt=v.I4.div`
  padding: 8px;
  display: flex;
  align-items: center;
  gap: 12px;

  &:hover {
    background-color: #f5f5f5;
    border-radius: 4px;
  }
`,jt=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    padding: 16px;\n    margin-top: 24px;\n  `}
`,Kt=v.I4.div`
  color: #ff4d4f;
  font-size: 12px;
  margin-bottom: 16px;
  padding: 8px 12px;
  background: #fff1f0;
  border-radius: 4px;
`,Xt=[{value:"DAILY",label:"Daily"},{value:"WEEKLY",label:"Weekly (Monday)"},{value:"WEEKLY_WED",label:"Weekly (Wednesday)"},{value:"WEEKLY_THU",label:"Weekly (Thursday)"},{value:"WEEKLY_SAT",label:"Weekly (Saturday)"},{value:"WEEKLY_SUN",label:"Weekly (Sunday)"},{value:"BI_WEEKLY",label:"Bi-weekly"},{value:"FOUR_WEEKLY",label:"Four-weekly"},{value:"MONTHLY",label:"Monthly"},{value:"BI_MONTHLY",label:"Bi-monthly"},{value:"QUARTERLY",label:"Quarterly"},{value:"SIX_MONTHLY",label:"Six-monthly (Jan)"},{value:"SIX_MONTHLY_APR",label:"Six-monthly (Apr)"},{value:"YEARLY",label:"Yearly"},{value:"FINANCIAL_APR",label:"Financial Year (Apr)"},{value:"FINANCIAL_JUL",label:"Financial Year (Jul)"},{value:"FINANCIAL_OCT",label:"Financial Year (Oct)"},{value:"FINANCIAL_NOV",label:"Financial Year (Nov)"}],Vt=[{value:"TODAY",label:"Today",type:"DAILY"},{value:"YESTERDAY",label:"Yesterday",type:"DAILY"},{value:"LAST_3_DAYS",label:"Last 3 Days",type:"DAILY"},{value:"LAST_7_DAYS",label:"Last 7 Days",type:"DAILY"},{value:"LAST_14_DAYS",label:"Last 14 Days",type:"DAILY"},{value:"LAST_30_DAYS",label:"Last 30 Days",type:"DAILY"},{value:"LAST_60_DAYS",label:"Last 60 Days",type:"DAILY"},{value:"LAST_90_DAYS",label:"Last 90 Days",type:"DAILY"},{value:"LAST_180_DAYS",label:"Last 180 Days",type:"DAILY"},{value:"LAST_365_DAYS",label:"Last 365 Days",type:"DAILY"},{value:"THIS_WEEK",label:"This Week",type:"WEEKLY"},{value:"LAST_WEEK",label:"Last Week",type:"WEEKLY"},{value:"LAST_4_WEEKS",label:"Last 4 Weeks",type:"WEEKLY"},{value:"LAST_12_WEEKS",label:"Last 12 Weeks",type:"WEEKLY"},{value:"LAST_52_WEEKS",label:"Last 52 Weeks",type:"WEEKLY"},{value:"WEEKS_THIS_YEAR",label:"Weeks This Year",type:"WEEKLY"},{value:"WEEKS_LAST_YEAR",label:"Weeks Last Year",type:"WEEKLY"},{value:"THIS_BIWEEK",label:"This Bi-week",type:"BI_WEEKLY"},{value:"LAST_BIWEEK",label:"Last Bi-week",type:"BI_WEEKLY"},{value:"LAST_4_BIWEEKS",label:"Last 4 Bi-weeks",type:"BI_WEEKLY"},{value:"LAST_12_BIWEEKS",label:"Last 12 Bi-weeks",type:"BI_WEEKLY"},{value:"BIWEEKS_THIS_YEAR",label:"Bi-weeks This Year",type:"BI_WEEKLY"},{value:"BIWEEKS_LAST_YEAR",label:"Bi-weeks Last Year",type:"BI_WEEKLY"},{value:"THIS_MONTH",label:"This Month",type:"MONTHLY"},{value:"LAST_MONTH",label:"Last Month",type:"MONTHLY"},{value:"LAST_3_MONTHS",label:"Last 3 Months",type:"MONTHLY"},{value:"LAST_6_MONTHS",label:"Last 6 Months",type:"MONTHLY"},{value:"LAST_12_MONTHS",label:"Last 12 Months",type:"MONTHLY"},{value:"MONTHS_THIS_YEAR",label:"Months This Year",type:"MONTHLY"},{value:"MONTHS_LAST_YEAR",label:"Months Last Year",type:"MONTHLY"},{value:"THIS_BIMONTH",label:"This Bi-month",type:"BI_MONTHLY"},{value:"LAST_BIMONTH",label:"Last Bi-month",type:"BI_MONTHLY"},{value:"LAST_6_BIMONTHS",label:"Last 6 Bi-months",type:"BI_MONTHLY"},{value:"BIMONTHS_THIS_YEAR",label:"Bi-months This Year",type:"BI_MONTHLY"},{value:"BIMONTHS_LAST_YEAR",label:"Bi-months Last Year",type:"BI_MONTHLY"},{value:"THIS_QUARTER",label:"This Quarter",type:"QUARTERLY"},{value:"LAST_QUARTER",label:"Last Quarter",type:"QUARTERLY"},{value:"LAST_4_QUARTERS",label:"Last 4 Quarters",type:"QUARTERLY"},{value:"QUARTERS_THIS_YEAR",label:"Quarters This Year",type:"QUARTERLY"},{value:"QUARTERS_LAST_YEAR",label:"Quarters Last Year",type:"QUARTERLY"},{value:"THIS_SIX_MONTH",label:"This Six-month",type:"SIX_MONTHLY"},{value:"LAST_SIX_MONTH",label:"Last Six-month",type:"SIX_MONTHLY"},{value:"LAST_2_SIXMONTHS",label:"Last 2 Six-months",type:"SIX_MONTHLY"},{value:"SIXMONTHS_THIS_YEAR",label:"Six-months This Year",type:"SIX_MONTHLY"},{value:"SIXMONTHS_LAST_YEAR",label:"Six-months Last Year",type:"SIX_MONTHLY"},{value:"THIS_YEAR",label:"This Year",type:"YEARLY"},{value:"LAST_YEAR",label:"Last Year",type:"YEARLY"},{value:"LAST_5_YEARS",label:"Last 5 Years",type:"YEARLY"},{value:"LAST_10_YEARS",label:"Last 10 Years",type:"YEARLY"},{value:"THIS_FINANCIAL_YEAR",label:"This Financial Year",type:"FINANCIAL"},{value:"LAST_FINANCIAL_YEAR",label:"Last Financial Year",type:"FINANCIAL"},{value:"LAST_5_FINANCIAL_YEARS",label:"Last 5 Financial Years",type:"FINANCIAL"},{value:"LAST_10_FINANCIAL_YEARS",label:"Last 10 Financial Years",type:"FINANCIAL"}],Gt=[{value:"ALL",label:"All Types"},{value:"DAILY",label:"Daily"},{value:"WEEKLY",label:"Weekly"},{value:"BI_WEEKLY",label:"Bi-weekly"},{value:"MONTHLY",label:"Monthly"},{value:"BI_MONTHLY",label:"Bi-monthly"},{value:"QUARTERLY",label:"Quarterly"},{value:"SIX_MONTHLY",label:"Six-monthly"},{value:"YEARLY",label:"Yearly"},{value:"FINANCIAL",label:"Financial Year"}];function Qt({wizardState:e,updateState:t,errors:a,databaseId:i}){const[o,s]=(0,l.useState)([]),[d,c]=(0,l.useState)([]),[p,u]=(0,l.useState)(!1),[h,m]=(0,l.useState)("YEARLY"),[g,y]=(0,l.useState)((new Date).getFullYear()),[S,v]=(0,l.useState)("ALL"),f=(new Date).getFullYear();(0,l.useEffect)(()=>{const e=Vt.filter(e=>"ALL"===S||e.type===S);s(e.map(e=>({id:e.value,displayName:e.label,type:"RELATIVE",periodType:e.type})))},[S]),(0,l.useEffect)(()=>{b()},[h,g,i]);const b=async()=>{if(i){u(!0);try{var e;console.log("[StepPeriods] Fetching fixed periods:",{fixedPeriodType:h,fixedYear:g,databaseId:i});const t=(null==(e=(await r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata/periods?periodType=${h}&year=${g}`})).json)?void 0:e.result)||[];if(console.log("[StepPeriods] Received periods:",{count:t.length,periodType:h,year:g}),"MONTHLY"===h||"QUARTERLY"===h){const e=t.filter(e=>parseInt(e.id.substring(0,4),10)===g);console.log("[StepPeriods] Filtered periods for year:",{year:g,filteredCount:e.length}),c(e)}else c(t)}catch(e){console.error("[StepPeriods] Error fetching periods:",e),c([])}finally{u(!1)}}},Y=a=>{const n=new Set(e.periods);n.has(a)?(n.delete(a),console.log("[StepPeriods] Deselected period:",a)):(n.add(a),console.log("[StepPeriods] Selected period:",a));const l=Array.from(n);console.log("[StepPeriods] Updated periods:",l),t({periods:l})},x=a=>{const n=new Set(e.periods);a.forEach(e=>{n.add(e.id),console.log("[StepPeriods] Selected all - adding:",e.id)});const l=Array.from(n);console.log("[StepPeriods] Select all result:",l),t({periods:l})},T=a=>{const n=new Set(e.periods);a.forEach(e=>{n.delete(e.id),console.log("[StepPeriods] Deselected all - removing:",e.id)});const l=Array.from(n);console.log("[StepPeriods] Deselect all result:",l),t({periods:l})},I=t=>t.filter(t=>e.periods.includes(t.id)).length;return(0,n.FD)(zt,{children:[(0,n.FD)("div",{style:{marginBottom:24},children:[(0,n.Y)(Ut,{level:4,style:{margin:0,marginBottom:8},children:"Period"}),(0,n.Y)(Ft,{style:{margin:0},children:"Choose time periods for your dataset."})]}),a.periods&&(0,n.Y)(Kt,{children:a.periods}),(0,n.Y)(Pt,{items:[{key:"relative",label:"Relative periods",children:(0,n.FD)(Ht,{children:[(0,n.Y)(Mt,{gutter:[16,16],children:(0,n.Y)(Re.Col,{xs:24,sm:12,children:(0,n.FD)("div",{children:[(0,n.Y)(Bt,{children:"Period type"}),(0,n.Y)(Re.Select,{value:S,onChange:v,options:Gt,style:{width:"100%"}})]})})}),o.length>0?(0,n.FD)(n.FK,{children:[(0,n.FD)(Mt,{gutter:[16,16],children:[(0,n.Y)(Re.Col,{children:(0,n.Y)(Re.Button,{type:"primary",size:"small",onClick:()=>x(o),disabled:I(o)===o.length,children:"Select all"})}),(0,n.Y)(Re.Col,{children:(0,n.Y)(Re.Button,{size:"small",onClick:()=>T(o),disabled:0===I(o),children:"Deselect all"})}),(0,n.Y)(Re.Col,{children:(0,n.FD)(kt,{type:"secondary",style:{fontSize:12},children:[I(o)," of"," ",o.length," selected"]})})]}),(0,n.Y)(Ot,{children:o.map(t=>(0,n.FD)(Wt,{children:[(0,n.Y)(Re.Checkbox,{checked:e.periods.includes(t.id),onChange:()=>Y(t.id)}),(0,n.Y)("span",{children:t.displayName})]},t.id))})]}):(0,n.Y)(Re.Empty,{description:"No relative periods available"})]})},{key:"fixed",label:"Fixed periods",children:(0,n.FD)(Ht,{children:[(0,n.FD)(Mt,{gutter:[16,16],children:[(0,n.Y)(Re.Col,{xs:24,sm:12,children:(0,n.FD)("div",{children:[(0,n.Y)(Bt,{children:"Period type"}),(0,n.Y)(Re.Select,{value:h,onChange:m,options:Xt,style:{width:"100%"}})]})}),("MONTHLY"===h||"QUARTERLY"===h)&&(0,n.Y)(Re.Col,{xs:24,sm:12,children:(0,n.FD)("div",{children:[(0,n.Y)(Bt,{children:"Year"}),(0,n.Y)(Re.InputNumber,{value:g,onChange:e=>y(e||f),min:f-9,max:f+1,style:{width:"100%"}})]})})]}),p?(0,n.Y)("div",{style:{textAlign:"center",padding:"40px"},children:(0,n.Y)(V.R,{})}):d.length>0?(0,n.FD)(n.FK,{children:[(0,n.FD)(Mt,{gutter:[16,16],children:[(0,n.Y)(Re.Col,{children:(0,n.Y)(Re.Button,{type:"primary",size:"small",onClick:()=>x(d),disabled:I(d)===d.length,children:"Select all"})}),(0,n.Y)(Re.Col,{children:(0,n.Y)(Re.Button,{size:"small",onClick:()=>T(d),disabled:0===I(d),children:"Deselect all"})}),(0,n.Y)(Re.Col,{children:(0,n.FD)(kt,{type:"secondary",style:{fontSize:12},children:[I(d)," of"," ",d.length," selected"]})})]}),(0,n.Y)(Ot,{children:d.length>0?d.map(t=>(0,n.FD)(Wt,{children:[(0,n.Y)(Re.Checkbox,{checked:e.periods.includes(t.id),onChange:()=>Y(t.id)}),(0,n.Y)("span",{children:t.displayName})]},t.id)):(0,n.Y)(Re.Empty,{description:"No periods available",style:{padding:"20px"}})})]}):(0,n.Y)(Re.Empty,{description:"No periods available for selected type"})]})}]}),e.periods.length>0&&(0,n.FD)(jt,{children:[(0,n.Y)("div",{style:{marginBottom:12},children:(0,n.FD)(kt,{strong:!0,children:[(0,n.Y)(Re.Badge,{count:e.periods.length,style:{backgroundColor:"#1890ff"}}),(0,n.Y)("span",{style:{marginLeft:8},children:"Periods Selected"})]})}),(0,n.Y)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:e.periods.map(a=>{const l=Vt.find(e=>e.value===a),i=(null==l?void 0:l.label)||a;return(0,n.Y)(Re.Tag,{closable:!0,onClose:()=>{const n=e.periods.filter(e=>e!==a);t({periods:n})},children:i},a)})})]}),e.periods.length>0&&(0,n.Y)(Re.Button,{type:"primary",danger:!0,block:!0,style:{marginTop:16},onClick:()=>t({periods:[]}),children:"Clear All Periods"})]})}var qt=a(12389),Zt=a(22750),Jt=a(2801);const{Title:ea,Paragraph:ta,Text:aa}=we.o,na=v.I4.div`
  display: flex;
  flex-direction: column;
  gap: 24px;
  max-width: 1200px;
`,la=v.I4.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
`,ia=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    padding: 16px;\n  `}
`,ra=v.I4.div`
  display: flex;
  flex-direction: column;
  gap: 12px;
`,oa=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    max-height: 500px;\n    overflow-y: auto;\n    padding: 8px;\n  `}
`,sa=(0,v.I4)(Re.Row)`
  margin-bottom: 16px;
`,da=v.I4.h4`
  margin: 0 0 12px 0;
  font-size: 14px;
  font-weight: 600;
  color: ${({theme:e})=>e.colorTextBase};
`,ca=v.I4.div`
  ${({theme:e})=>`\n    background: ${e.colorBgElevated};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    padding: 16px;\n    margin-top: 24px;\n  `}
`,pa=v.I4.div`
  ${({theme:e})=>`\n    color: ${e.colorErrorText};\n    font-size: 12px;\n    margin-bottom: 12px;\n    padding: 8px 12px;\n    background: ${e.colorErrorBg};\n    border-radius: 4px;\n  `}
`;function ua({wizardState:e,updateState:t,errors:a,databaseId:i}){const o=(0,v.DP)(),[s,d]=(0,l.useState)(!1),[c,p]=(0,l.useState)([]),[u,h]=(0,l.useState)([]),[m,y]=(0,l.useState)([]),[S,f]=(0,l.useState)(""),[b,Y]=(0,l.useState)([]),[x,T]=(0,l.useState)(null),[I,_]=(0,l.useState)(null),[E,D]=(0,l.useState)(!1),[A,w]=(0,l.useState)(!1),[L,$]=(0,l.useState)(!1),C=(0,l.useCallback)(async e=>{d(!0);try{var t;const n=await r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata/?type=organisationUnits`});if(!e)return;const l=(null==(t=n.json)?void 0:t.result)||[];var a;p(l),l.length>0&&Y([(null==(a=l[0])?void 0:a.id)||""])}catch{}finally{e&&d(!1)}},[i]),R=(0,l.useCallback)(async e=>{try{var t;const a=await r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata/?type=organisationUnitLevels`});if(!e)return;const n=(null==(t=a.json)?void 0:t.result)||[];h(n)}catch{}},[i]),N=(0,l.useCallback)(async e=>{try{var t;const a=await r.A.get({endpoint:`/api/v1/database/${i}/dhis2_metadata/?type=organisationUnitGroups`});if(!e)return;const n=(null==(t=a.json)?void 0:t.result)||[];y(n)}catch{}},[i]);(0,l.useEffect)(()=>{let e=!0;return i&&(async()=>{e&&await C(e),e&&await R(e),e&&await N(e)})(),()=>{e=!1}},[i,C,R,N]);const U=(0,l.useMemo)(()=>{let e=c;return S&&(e=e.filter(e=>e.displayName.toLowerCase().includes(S.toLowerCase()))),x&&(e=e.filter(e=>{var t;return(null==(t=e.level)?void 0:t.toString())===x})),e},[c,S,x]),F=(0,l.useMemo)(()=>(e=>{const t=new Map,a=[];return e.forEach(e=>{const n={title:e.displayName,key:e.id,data:e,children:[]};if(t.set(e.id,n),e.parentId){const l=t.get(e.parentId);l?l.children.push(n):a.push(n)}else a.push(n)}),a})(U),[U]),k=(0,l.useMemo)(()=>u.map(e=>({value:e.level.toString(),label:e.displayName})),[u]),z=(0,l.useMemo)(()=>m.map(e=>({value:e.id,label:e.displayName})),[m]);return(0,n.FD)(na,{children:[(0,n.FD)("div",{children:[(0,n.Y)(ea,{level:4,style:{margin:0,marginBottom:8},children:"Organisation Units"}),(0,n.Y)(ta,{style:{margin:0},children:"Choose the geographic areas/organization units for your dataset."})]}),(0,n.FD)(ia,{children:[(0,n.Y)(da,{children:"User organisation unit options"}),(0,n.FD)(ra,{children:[(0,n.FD)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.Y)(Re.Checkbox,{checked:E,onChange:a=>{if(D(a.target.checked),a.target.checked){const a=[...e.orgUnits];a.includes("USER_ORGUNIT")||a.push("USER_ORGUNIT"),t({orgUnits:a})}else{const a=e.orgUnits.filter(e=>"USER_ORGUNIT"!==e);t({orgUnits:a})}}}),(0,n.Y)(aa,{children:"User organisation unit"})]}),(0,n.FD)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.Y)(Re.Checkbox,{checked:A,onChange:a=>{if(w(a.target.checked),a.target.checked){const a=[...e.orgUnits];a.includes("USER_ORGUNIT_CHILDREN")||a.push("USER_ORGUNIT_CHILDREN"),t({orgUnits:a})}else{const a=e.orgUnits.filter(e=>"USER_ORGUNIT_CHILDREN"!==e);t({orgUnits:a})}}}),(0,n.Y)(aa,{children:"User sub-units"})]}),(0,n.FD)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.Y)(Re.Checkbox,{checked:L,onChange:a=>{if($(a.target.checked),a.target.checked){const a=[...e.orgUnits];a.includes("USER_ORGUNIT_GRANDCHILDREN")||a.push("USER_ORGUNIT_GRANDCHILDREN"),t({orgUnits:a})}else{const a=e.orgUnits.filter(e=>"USER_ORGUNIT_GRANDCHILDREN"!==e);t({orgUnits:a})}}}),(0,n.Y)(aa,{children:"User sub-x2-units"})]})]})]}),(0,n.FD)(ia,{children:[(0,n.Y)(da,{children:"Data scope"}),(0,n.Y)(ta,{style:{margin:"0 0 12px 0",fontSize:12,color:o.colorTextSecondary},children:"Choose which organization unit levels to include in the data export"}),(0,n.FD)(Zt.s.Group,{value:e.dataLevelScope||"selected",onChange:e=>{const a=e.target.value;t({dataLevelScope:a,includeChildren:"selected"!==a})},children:[(0,n.FD)("div",{style:{marginBottom:16,padding:"12px",backgroundColor:o.colorBgContainer,borderRadius:4},children:[(0,n.Y)(Zt.s,{value:"selected",children:(0,n.Y)(aa,{style:{fontWeight:500},children:"Selected units only (current level only)"})}),(0,n.Y)("div",{style:{marginLeft:24,marginTop:8,fontSize:12,color:o.colorTextSecondary},children:"Shows data for the exact organization units you select"})]}),(0,n.FD)("div",{style:{marginBottom:16,padding:"12px",backgroundColor:o.colorBgContainer,borderRadius:4},children:[(0,n.Y)(Zt.s,{value:"children",children:(0,n.Y)(aa,{style:{fontWeight:500},children:"Include children (one level down)"})}),(0,n.Y)("div",{style:{marginLeft:24,marginTop:8,fontSize:12,color:o.colorTextSecondary},children:"Includes all direct children of selected units (e.g., Districts if you select a Region)"})]}),(0,n.FD)("div",{style:{marginBottom:16,padding:"12px",backgroundColor:o.colorBgContainer,borderRadius:4},children:[(0,n.Y)(Zt.s,{value:"grandchildren",children:(0,n.Y)(aa,{style:{fontWeight:500},children:"Include grandchildren (two levels down)"})}),(0,n.Y)("div",{style:{marginLeft:24,marginTop:8,fontSize:12,color:o.colorTextSecondary},children:"Includes all descendants up to two levels below (e.g., Sub-counties if you select a Region)"})]}),(0,n.FD)("div",{style:{marginBottom:0,padding:"12px",backgroundColor:o.colorBgContainer,borderRadius:4},children:[(0,n.Y)(Zt.s,{value:"all_levels",children:(0,n.Y)(aa,{style:{fontWeight:500},children:"All levels (facility level)"})}),(0,n.Y)("div",{style:{marginLeft:24,marginTop:8,fontSize:12,color:o.colorTextSecondary},children:"Includes all descendants down to the lowest level (e.g., all Health Facilities)"})]})]})]}),(0,n.FD)(la,{children:[(0,n.FD)("div",{children:[(0,n.Y)(da,{style:{marginBottom:12},children:"Select organisation units"}),(0,n.Y)(Re.Input.Search,{placeholder:"Search organizations...",value:S,onChange:e=>f(e.target.value),size:"large"})]}),(0,n.FD)(sa,{gutter:[16,16],children:[(0,n.Y)(Re.Col,{xs:24,sm:12,children:(0,n.FD)("div",{children:[(0,n.Y)(da,{children:"Filter by level"}),(0,n.Y)(Jt.A,{allowClear:!0,placeholder:"Select a level",value:x,onChange:e=>T(e),options:k,styles:{root:{width:"100%"}}})]})}),(0,n.Y)(Re.Col,{xs:24,sm:12,children:(0,n.FD)("div",{children:[(0,n.Y)(da,{children:"Filter by group"}),(0,n.Y)(Jt.A,{allowClear:!0,placeholder:"Select a group",value:I,onChange:e=>_(e),options:z,styles:{root:{width:"100%"}}})]})})]}),a.orgUnits&&(0,n.Y)(pa,{children:a.orgUnits}),s?(0,n.Y)("div",{style:{textAlign:"center",padding:"60px 20px"},children:(0,n.Y)(V.R,{})}):0===F.length?(0,n.Y)(Ce.S,{description:S?"No organization units found":"No units available",style:{marginTop:40}}):(0,n.Y)(oa,{children:(0,n.Y)(qt.A,{treeData:F,expandedKeys:b,onExpand:e=>Y(e),checkedKeys:e.orgUnits.filter(e=>!e.startsWith("USER_ORGUNIT")),onCheck:a=>{const n=e.orgUnits.filter(e=>e.startsWith("USER_ORGUNIT"));t({orgUnits:[...a,...n]})},checkable:!0,showIcon:!0})})]}),e.orgUnits.length>0&&(0,n.FD)(ca,{children:[(0,n.FD)("div",{style:{marginBottom:16},children:[(0,n.Y)("div",{style:{marginBottom:12},children:(0,n.FD)(aa,{strong:!0,children:[(0,n.Y)(B.E,{count:e.orgUnits.length,style:{backgroundColor:o.colorPrimary}}),(0,n.Y)("span",{style:{marginLeft:8},children:"Selected Units"})]})}),(0,n.Y)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:e.orgUnits.map(a=>{var l;const i="USER_ORGUNIT"===a?"User organisation unit":"USER_ORGUNIT_CHILDREN"===a?"User sub-units":"USER_ORGUNIT_GRANDCHILDREN"===a?"User sub-x2-units":(null==(l=c.find(e=>e.id===a))?void 0:l.displayName)||a;return(0,n.Y)(Re.Tag,{closable:!0,onClose:()=>{const n=e.orgUnits.filter(e=>e!==a);t({orgUnits:n}),"USER_ORGUNIT"===a&&D(!1),"USER_ORGUNIT_CHILDREN"===a&&w(!1),"USER_ORGUNIT_GRANDCHILDREN"===a&&$(!1)},color:"USER_ORGUNIT"===a||"USER_ORGUNIT_CHILDREN"===a||"USER_ORGUNIT_GRANDCHILDREN"===a?"blue":"green",children:i},a)})})]}),(0,n.Y)("div",{style:{paddingTop:12,borderTop:`1px solid ${o.colorBorder}`},children:(0,n.FD)(aa,{children:[(0,n.Y)("strong",{children:"Data scope:"})," ",e.includeChildren?"Include children (descendants)":"Selected units only"]})})]}),e.orgUnits.length>0&&(0,n.Y)(g.$,{type:"primary",danger:!0,block:!0,onClick:()=>t({orgUnits:[]}),children:"Clear All"})]})}const{Title:ha,Paragraph:ma,Text:ga}=we.o,ya=v.I4.div`
  max-width: 100%;
  margin: 0 auto;
`;function Sa({wizardState:e,updateState:t,databaseId:a,dataElements:i,periods:o,orgUnits:s}){const[d,c]=(0,l.useState)(!1),[p,u]=(0,l.useState)([]),[h,m]=(0,l.useState)([]),g=(0,l.useRef)(!0);(0,l.useEffect)(()=>(g.current=!0,(async()=>{a&&i.length>0&&g.current&&await y()})().catch(()=>{}),()=>{g.current=!1}),[a,i,o,s,e.includeChildren,e.dataLevelScope]);const y=async()=>{if(g.current){c(!0);try{const e=[],t=[],n=[],l=async(e,t)=>{const n=await Promise.allSettled(t.map(t=>r.A.get({endpoint:`/api/v1/database/${a}/dhis2_metadata/?type=${t}&search=${e}`})));for(const t of n)if("fulfilled"===t.status){var l;const a=((null==(l=t.value.json)?void 0:l.result)||[]).find(t=>t.id===e);if(a&&a.displayName)return{id:a.id,displayName:a.displayName}}return{id:e,displayName:e}},d=["dataElements","indicators","dataSets","programIndicators"],c=i.map(e=>l(e,d));e.push(...await Promise.all(c));for(const e of o){const a=e.split("|")[1]||e;t.push({id:e,displayName:a})}const p=s.map(async e=>{try{var t;const n=((null==(t=(await r.A.get({endpoint:`/api/v1/database/${a}/dhis2_metadata/?type=organisationUnits&search=${e}`})).json)?void 0:t.result)||[]).find(t=>t.id===e);return n?{id:n.id,displayName:n.displayName,level:n.level,parent:n.parent}:{id:e,displayName:e,level:0,parent:null}}catch{return{id:e,displayName:e,level:0,parent:null}}});n.push(...await Promise.all(p));const u={dataElements:e,periods:t,orgUnits:n};g.current&&await S(u)}catch{g.current&&(u([]),m([]))}finally{g.current&&c(!1)}}},S=async n=>{try{var l,i;const o=await r.A.post({endpoint:`/api/v1/database/${a}/dhis2_preview/columns/`,jsonPayload:{data_elements:n.dataElements,periods:n.periods,org_units:n.orgUnits,include_children:e.includeChildren,data_level_scope:e.dataLevelScope||"selected"}}),s=(null==(l=o.json)?void 0:l.columns)||[],d=(null==(i=o.json)?void 0:i.rows)||[],c={},p={},h={};n.orgUnits.forEach(e=>{c[e.id]=e.displayName}),n.dataElements.forEach(e=>{p[e.id]=e.displayName}),n.periods.forEach(e=>{h[e.id]=e.displayName});const g=s.map(e=>{const t=e.title||e.dataIndex||e.key,a=e.key||e.dataIndex||"",n=e.dataIndex||"";if(n.startsWith("ou_level_"))return{...e,title:t,ellipsis:!0};for(const n in c)if(t.includes(n)||a.includes(n))return{...e,title:c[n],ellipsis:!0};for(const l in p)if(a===`de_${l}`||n===`de_${l}`||t===l||t.includes(l))return{...e,title:p[l],ellipsis:!0};for(const n in h)if(t.includes(n)||a.includes(n))return{...e,title:h[n],ellipsis:!0};return{...e,ellipsis:!0}});console.log("[StepColumnPreview] Generated columns:",{count:g.length,hierarchyLevels:g.filter(e=>{var t;return null==(t=e.dataIndex)?void 0:t.startsWith("ou_level_")}).length,periodColumns:g.filter(e=>"period"===e.dataIndex).length,dataElementColumns:g.filter(e=>{var t;return null==(t=e.dataIndex)?void 0:t.startsWith("de_")}).length,columns:g.map(e=>({name:e.dataIndex||e.key,title:e.title}))}),u(g),m(d.map((e,t)=>({...e,key:`row-${t}`})));const y=g.map(e=>{const t=e.dataIndex||e.key||"",a=t.startsWith("de_");return{name:t,type:a?"FLOAT":"STRING",verbose_name:e.title,is_dttm:"period"===t}});t({columns:y}),console.log("[StepColumnPreview] Updated wizard state with column preview",y)}catch{u([]),m([])}},v=(0,l.useCallback)(()=>({hierarchyCols:p.filter(e=>{var t,a;return(null==(t=e.dataIndex)?void 0:t.startsWith("ou_level_"))||(null==(a=e.key)?void 0:a.startsWith("ou_level_"))}),periodCols:p.filter(e=>"period"===e.dataIndex||"period"===e.key),dataCols:p.filter(e=>{var t,a;return(null==(t=e.dataIndex)?void 0:t.startsWith("de_"))||(null==(a=e.key)?void 0:a.startsWith("de_"))})}),[p]),{hierarchyCols:f,periodCols:b,dataCols:Y}=v();return(0,n.FD)(ya,{children:[(0,n.FD)("div",{style:{marginBottom:16},children:[(0,n.Y)(ha,{level:5,style:{margin:0,marginBottom:4},children:"Column Preview"}),(0,n.Y)(ma,{type:"secondary",style:{margin:0,fontSize:12},children:"Preview of the dataset columns that will be created"})]}),d&&(0,n.Y)("div",{style:{textAlign:"center",padding:"40px 20px"},children:(0,n.Y)(V.R,{})}),d||0!==p.length?!d&&(0,n.FD)(n.FK,{children:[e.includeChildren&&(0,n.Y)(X.F,{message:"Including descendants - hierarchy columns will show full organization unit path",type:"info",showIcon:!0,style:{marginBottom:12}}),(0,n.FD)(va,{children:[(0,n.FD)(ha,{level:5,style:{margin:"0 0 8px 0",fontSize:13},children:["Dataset Columns (",p.length," total)"]}),f.length>0&&(0,n.FD)(fa,{children:[(0,n.FD)(ga,{strong:!0,type:"secondary",children:["Organization Hierarchy (",f.length," levels):"]}),(0,n.Y)(ba,{children:f.map((e,t)=>(0,n.FD)(Ya,{children:["Level ",t+1,": ",(0,n.Y)(ga,{code:!0,children:e.title})]},e.key))})]}),b.length>0&&(0,n.FD)(fa,{children:[(0,n.Y)(ga,{strong:!0,type:"secondary",children:"Time Dimension:"})," ",(0,n.Y)(ga,{code:!0,children:"Period"})]}),Y.length>0&&(0,n.FD)(fa,{children:[(0,n.FD)(ga,{strong:!0,type:"secondary",children:["Data Elements (",Y.length,"):"]}),(0,n.Y)(ba,{children:Y.map(e=>(0,n.FD)(Ya,{children:["â€¢ ",(0,n.Y)(ga,{code:!0,children:e.title})]},e.key))})]})]}),(0,n.Y)("div",{style:{marginBottom:8},children:(0,n.Y)(ga,{strong:!0,children:"Sample Data Preview:"})}),(0,n.Y)("div",{style:{overflowX:"auto",marginBottom:12},children:(0,n.Y)(G.XI,{columns:p,data:h,pagination:!1,scroll:{x:"max-content"}})}),(0,n.Y)(ma,{style:{margin:0},children:(0,n.FD)(ga,{type:"secondary",children:["Showing ",h.length," sample rows with"," ",p.length," columns"]})})]}):(0,n.Y)(Ce.S,{description:"Select data elements, periods, and organization units to see preview",style:{marginTop:20,marginBottom:20}})]})}const va=v.I4.div`
  ${({theme:e})=>`\n    margin-bottom: 16px;\n    padding: 12px 16px;\n    background: ${e.colorBgContainer};\n    border-radius: 6px;\n    border: 1px solid ${e.colorBorder};\n  `}
`,fa=v.I4.div`
  margin-bottom: 8px;
`,ba=v.I4.div`
  margin-left: 12px;
  margin-top: 4px;
`,Ya=v.I4.div`
  ${({theme:e})=>`\n    font-size: 11px;\n    color: ${e.colorTextSecondary};\n    padding: 2px 0;\n  `}
`,{Title:xa,Paragraph:Ta,Text:Ia}=we.o,_a=v.I4.div`
  max-width: 100%;
  margin: 0 auto;
`,Ea=v.I4.div`
  margin-bottom: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
`,Da=v.I4.div`
  display: flex;
  align-items: center;
  gap: 8px;
`,Aa=v.I4.div`
  ${({theme:e})=>`\n    margin-bottom: 16px;\n    padding: 12px 16px;\n    background: ${e.colorBgElevated};\n    border-radius: ${e.borderRadius}px;\n    border: 1px solid ${e.colorBorder};\n  `}
`,wa=v.I4.div`
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
`,La=(0,v.I4)(Ia)`
  font-size: 11px;
  ${({theme:e})=>`\n    background: ${e.colorBgContainer};\n    border: 1px solid ${e.colorBorder};\n  `}
  padding: 2px 8px;
  border-radius: 4px;
`,$a=(0,v.I4)(La)`
  ${()=>"\n    background: #e6f7ff;\n    color: #0050b3;\n    border: 1px solid #91d5ff;\n  "}
  font-weight: 500;
`,Ca=(0,v.I4)(La)`
  ${()=>"\n    background: #f6ffed;\n    color: #274000;\n    border: 1px solid #b7eb8f;\n  "}
  font-weight: 500;
`,Ra=(0,v.I4)(La)`
  ${()=>"\n    background: #fff7e6;\n    color: #7c4500;\n    border: 1px solid #ffd591;\n  "}
  font-weight: 500;
`,Na=[{value:20,label:"20 rows"},{value:50,label:"50 rows"},{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1000 rows"},{value:1e5,label:"All rows"}],Ua=20,Fa=800,ka=e=>`${e.databaseId}:${e.dataElements.join(",")}:${e.periods.join(",")}:${e.orgUnits.join(",")}:${e.endpoint}:${e.limit}:${e.includeChildren}:${e.dataLevelScope}`;function za({wizardState:e,updateState:t,databaseId:a,endpoint:i,dataElements:o,periods:s,orgUnits:d,includeChildren:c=!1}){const[p,u]=(0,l.useState)(!1),[h,m]=(0,l.useState)([]),[y,S]=(0,l.useState)([]),[v,f]=(0,l.useState)(0),[b,Y]=(0,l.useState)(null),[x,T]=(0,l.useState)(Ua),[I,_]=(0,l.useState)({dataElements:{},periods:{},orgUnits:{}}),E=(0,l.useRef)(null),D=(0,l.useRef)(null),A=(0,l.useRef)(null),w=(0,l.useRef)(!0),[L,$]=(0,l.useState)(0),C=(0,l.useCallback)(()=>{m([]),S([]),f(0),Y(null),A.current=null},[]),R=(0,l.useCallback)(()=>{A.current=null,$(e=>e+1)},[]),N=(0,l.useCallback)(async e=>{if(!a||0===e.length)return[];const t=e.map(async e=>{try{var t;const n=((null==(t=(await r.A.get({endpoint:`/api/v1/database/${a}/dhis2_metadata/?type=organisationUnits&search=${e}`})).json)?void 0:t.result)||[]).find(t=>t.id===e);return n?{id:n.id,displayName:n.displayName||n.name||e,level:n.level,parent:n.parent}:{id:e,displayName:e,level:0,parent:null}}catch{return{id:e,displayName:e,level:0,parent:null}}});return Promise.all(t)},[a]),U=(0,l.useCallback)(async(e,t)=>{if(!a||0===e.length)return{};try{const n={},l="dataElements"===t?["dataElements","indicators","dataSets","programIndicators"]:[t],i=async e=>{for(const i of l)try{var t;const l=((null==(t=(await r.A.get({endpoint:`/api/v1/database/${a}/dhis2_metadata/?type=${i}&search=${e}`})).json)?void 0:t.result)||[]).find(t=>t.id===e);if(l&&l.displayName)return void(n[e]=l.displayName||l.name||e)}catch{}n[e]||(n[e]=e)},o=e.map(i);return await Promise.all(o),n}catch{return{}}},[a]),F=(0,l.useCallback)((e,t,a)=>({transformedColumns:t.map(e=>{let t=e.title||e.dataIndex||e.key;const a=e.key||e.dataIndex||"",l=e.dataIndex||"";if(l.startsWith("ou_level_"))return{title:t,dataIndex:l,key:a,width:e.width||140,ellipsis:!0,render:e=>(0,n.Y)(Ia,{type:"secondary",ellipsis:!0,children:null!=e?String(e):"-"})};if("period"===l||"period"===a)return{title:"Period",dataIndex:l,key:a,width:e.width||120,ellipsis:!0,render:e=>(0,n.Y)(Ia,{type:"secondary",ellipsis:!0,children:null!=e?String(e):"-"})};for(const[e,n]of Object.entries(I.dataElements))if(a===`de_${e}`||l===`de_${e}`||t===e||t.includes(e)){t=n;break}return{title:t,dataIndex:e.dataIndex||e.key,key:e.key,width:e.width||120,ellipsis:!0,render:e=>(0,n.Y)(Ia,{type:"secondary",ellipsis:!0,children:null!=e?String(e):"-"})}}),transformedRows:e.map((e,t)=>({...e,key:`row-${t}`}))}),[I]),k=(0,l.useCallback)(async e=>{const a=ka(e),l=A.current?ka(A.current):null;if(console.log("[StepDataPreview] Cache check:",{currentParamsKey:a,lastParamsKey:l,willFetch:a!==l,includeChildren:e.includeChildren}),a===l)return;A.current=e,E.current&&E.current.abort(),E.current=new AbortController;const{signal:i}=E.current;u(!0),Y(null);try{var o,s,d;const a=await U(e.dataElements,"dataElements"),l=await N(e.orgUnits),c={};l.forEach(e=>{c[e.id]=e.displayName});const p={};e.periods.forEach(e=>{p[e]=e.split("|")[1]||e}),_({dataElements:a,periods:p,orgUnits:c}),console.log("[StepDataPreview] Using fetchParams:",{includeChildren:e.includeChildren,dataLevelScope:e.dataLevelScope}),console.log("[StepDataPreview] Org units metadata:",l);const u={data_elements:e.dataElements.map(e=>({id:e,displayName:a[e]||e})),periods:e.periods.map(e=>({id:e,displayName:p[e]||e})),org_units:l,include_children:e.includeChildren,data_level_scope:e.dataLevelScope};console.log("[StepDataPreview] Fetching column structure:",{data_elements:u.data_elements,org_units:u.org_units,include_children:u.include_children,data_level_scope:u.data_level_scope});const h=await r.A.post({endpoint:`/api/v1/database/${e.databaseId}/dhis2_preview/columns/`,jsonPayload:u,signal:i});if(i.aborted||!w.current)return void console.log("[StepDataPreview] Request was aborted or component unmounted");const g=(null==(o=h.json)?void 0:o.columns)||[],y={data_elements:e.dataElements,periods:e.periods,org_units:l,endpoint:e.endpoint,limit:e.limit,offset:0,include_children:e.includeChildren,data_level_scope:e.dataLevelScope};console.log("[StepDataPreview] Fetching data with payload:",{data_elements:y.data_elements,periods:y.periods,org_units:y.org_units,include_children:y.include_children,data_level_scope:y.data_level_scope,limit:y.limit});const v=await r.A.post({endpoint:`/api/v1/database/${e.databaseId}/dhis2_preview/data/`,jsonPayload:y,signal:i});if(i.aborted||!w.current)return void console.log("[StepDataPreview] Request was aborted or component unmounted");const b=(null==(s=v.json)?void 0:s.rows)||[],Y=(null==(d=v.json)?void 0:d.total)||0;console.log("[StepDataPreview] Received response:",{rowCount:b.length,columnCount:g.length,total:Y,includeChildren:e.includeChildren,orgUnits:e.orgUnits});const x=g.map(e=>{const t=e.title||e.dataIndex||e.key,l=e.key||e.dataIndex||"",i=e.dataIndex||"";let r=t;if(i.startsWith("ou_level_"))return{title:r,dataIndex:i,key:l,width:e.width||140,ellipsis:!0,render:e=>(0,n.Y)(Ia,{type:"secondary",ellipsis:!0,children:null!=e?String(e):"-"})};for(const e in c)if(t.includes(e)||l.includes(e)){r=c[e];break}for(const e in a)if(l===`de_${e}`||i===`de_${e}`||t===e||t.includes(e)){r=a[e];break}for(const e in p)if(t.includes(e)||l.includes(e)){r=p[e];break}return{...e,title:r,dataIndex:e.dataIndex||e.key,key:e.key,width:e.width||120,ellipsis:!0,render:e=>(0,n.Y)(Ia,{type:"secondary",ellipsis:!0,children:null!=e?String(e):"-"})}}),T=b.map((e,t)=>({...e,key:`row-${t}`}));m(T),S(x),f(Y);const I=x.map(e=>{const t=e.dataIndex||e.key||"",a=t.startsWith("de_");return{name:t,type:a?"FLOAT":"STRING",verbose_name:e.title,is_dttm:"period"===t}});console.log("[StepDataPreview] Generated column metadata:",{count:I.length,metadata:I}),t({previewData:T,columns:I}),console.log("[StepDataPreview] Updated wizard state with columns")}catch(t){if(i.aborted||!w.current)return void console.log("[StepDataPreview] Error caught but request was aborted or component unmounted");const a=t instanceof Error?t.message:"Failed to load preview data";console.error("[StepDataPreview] Error fetching data:",{message:a,error:t,params:{dataElements:e.dataElements,periods:e.periods,orgUnits:e.orgUnits,includeChildren:e.includeChildren}}),Y(a),m([]),S([]),f(0)}finally{w.current&&u(!1)}},[t,U,N,F]);return(0,l.useEffect)(()=>(a&&o.length>0&&s.length>0&&d.length>0?(D.current&&clearTimeout(D.current),console.log("[StepDataPreview] Scheduling fetch with:",{databaseId:a,dataElementsCount:o.length,periodsCount:s.length,orgUnitsCount:d.length,includeChildren:c,cacheKey:L}),D.current=setTimeout(()=>{console.log("[StepDataPreview] Executing fetch after debounce"),k({dataElements:o,periods:s,orgUnits:d,databaseId:a,endpoint:i,limit:x,includeChildren:c,dataLevelScope:e.dataLevelScope||"selected"})},Fa)):(D.current&&clearTimeout(D.current),console.log("[StepDataPreview] Missing required parameters, resetting preview"),C()),()=>{D.current&&clearTimeout(D.current)}),[a,o,s,d,i,k,C,x,c,L,e.dataLevelScope]),(0,l.useEffect)(()=>(w.current=!0,console.log("[StepDataPreview] Component mounted"),()=>{w.current=!1,E.current&&E.current.abort(),D.current&&clearTimeout(D.current),console.log("[StepDataPreview] Component unmounted")}),[]),(0,n.FD)(_a,{children:[(0,n.Y)("div",{style:{marginBottom:16},children:(0,n.Y)(xa,{level:5,style:{margin:0,marginBottom:4},children:"Data Preview"})}),b&&(0,n.Y)(X.F,{message:"Error loading preview",description:b,type:"error",showIcon:!0,closable:!0,style:{marginBottom:12}}),p&&(0,n.FD)("div",{style:{textAlign:"center",padding:"40px 20px"},children:[(0,n.Y)(V.R,{}),(0,n.Y)(Ia,{type:"secondary",style:{marginTop:16,display:"block"},children:"Loading preview data..."})]}),p||0!==o.length&&0!==s.length&&0!==d.length?p||0!==h.length?!p&&(0,n.FD)(n.FK,{children:[(0,n.FD)(Ea,{children:[(0,n.FD)(Da,{children:[(0,n.Y)(Ia,{children:"Display rows:"}),(0,n.Y)(Jt.A,{options:Na,value:Na.find(e=>e.value===x),onChange:e=>T(e.value),showSearch:!1,ariaLabel:"Select number of rows to display"})]}),(0,n.Y)(g.$,{type:"default",onClick:()=>{console.log("[StepDataPreview] User clicked refresh button"),R()},children:"Refresh Data"})]}),(0,n.FD)(Aa,{children:[(0,n.FD)("div",{style:{marginBottom:12},children:[(0,n.FD)(xa,{level:5,style:{margin:"0 0 4px 0",fontSize:13},children:["Actual Dataset Columns (",y.length," total)"]}),(0,n.Y)(Ia,{type:"secondary",style:{fontSize:12},children:c?"âœ“ Include children: data shows full organization unit hierarchy":"Selected organization units only (no child units)"})]}),(0,n.Y)(wa,{children:y.map((e,t)=>{const a=e.key||e.dataIndex||"";let l=La;return a.startsWith("ou_level_")?l=$a:"period"===a?l=Ca:a.startsWith("de_")&&(l=Ra),(0,n.Y)(l,{code:!0,children:e.title},a||t)})})]}),(0,n.Y)(X.F,{message:1e5===x?`All ${v} rows`:`First ${x} rows of ${v} total`,type:"info",showIcon:!0,style:{marginBottom:12,fontSize:12}}),(0,n.Y)("div",{style:{overflowX:"auto",marginBottom:12},children:(0,n.Y)(G.XI,{columns:y,data:h,pagination:!1,scroll:{x:"max-content"}})}),(0,n.Y)(Ta,{style:{margin:0},children:(0,n.FD)(Ia,{type:"secondary",children:[h.length," rows displayed - ",y.length," columns"]})})]}):(0,n.Y)(Ce.S,{description:"No data available. Please try different selections or check your DHIS2 connection.",style:{marginTop:20,marginBottom:20}}):(0,n.Y)(Ce.S,{description:`Complete all selections: ${0===o.length?"Data Elements, ":""}${0===s.length?"Periods, ":""}${0===d.length?"Organization Units":""}`.replace(/, $/,""),style:{marginTop:20,marginBottom:20}})]})}var Ha=a(4651);const{Title:Ba,Paragraph:Pa,Text:Ma}=we.o,Oa=new Set(["TODAY","YESTERDAY","LAST_3_DAYS","LAST_7_DAYS","LAST_14_DAYS","LAST_30_DAYS","LAST_60_DAYS","LAST_90_DAYS","LAST_180_DAYS","LAST_365_DAYS","THIS_WEEK","LAST_WEEK","LAST_4_WEEKS","LAST_12_WEEKS","LAST_52_WEEKS","WEEKS_THIS_YEAR","WEEKS_LAST_YEAR","THIS_BIWEEK","LAST_BIWEEK","LAST_4_BIWEEKS","LAST_12_BIWEEKS","BIWEEKS_THIS_YEAR","BIWEEKS_LAST_YEAR","THIS_MONTH","LAST_MONTH","LAST_3_MONTHS","LAST_6_MONTHS","LAST_12_MONTHS","MONTHS_THIS_YEAR","MONTHS_LAST_YEAR","THIS_BIMONTH","LAST_BIMONTH","LAST_6_BIMONTHS","BIMONTHS_THIS_YEAR","BIMONTHS_LAST_YEAR","THIS_QUARTER","LAST_QUARTER","LAST_4_QUARTERS","QUARTERS_THIS_YEAR","QUARTERS_LAST_YEAR","THIS_SIX_MONTH","LAST_SIX_MONTH","LAST_2_SIXMONTHS","SIXMONTHS_THIS_YEAR","SIXMONTHS_LAST_YEAR","THIS_YEAR","LAST_YEAR","LAST_5_YEARS","LAST_10_YEARS","THIS_FINANCIAL_YEAR","LAST_FINANCIAL_YEAR","LAST_5_FINANCIAL_YEARS","LAST_10_FINANCIAL_YEARS"]),Wa={TODAY:"Today",YESTERDAY:"Yesterday",LAST_3_DAYS:"Last 3 Days",LAST_7_DAYS:"Last 7 Days",LAST_14_DAYS:"Last 14 Days",LAST_30_DAYS:"Last 30 Days",LAST_60_DAYS:"Last 60 Days",LAST_90_DAYS:"Last 90 Days",LAST_180_DAYS:"Last 180 Days",LAST_365_DAYS:"Last 365 Days",THIS_WEEK:"This Week",LAST_WEEK:"Last Week",LAST_4_WEEKS:"Last 4 Weeks",LAST_12_WEEKS:"Last 12 Weeks",LAST_52_WEEKS:"Last 52 Weeks",WEEKS_THIS_YEAR:"Weeks This Year",WEEKS_LAST_YEAR:"Weeks Last Year",THIS_BIWEEK:"This Bi-week",LAST_BIWEEK:"Last Bi-week",LAST_4_BIWEEKS:"Last 4 Bi-weeks",LAST_12_BIWEEKS:"Last 12 Bi-weeks",BIWEEKS_THIS_YEAR:"Bi-weeks This Year",BIWEEKS_LAST_YEAR:"Bi-weeks Last Year",THIS_MONTH:"This Month",LAST_MONTH:"Last Month",LAST_3_MONTHS:"Last 3 Months",LAST_6_MONTHS:"Last 6 Months",LAST_12_MONTHS:"Last 12 Months",MONTHS_THIS_YEAR:"Months This Year",MONTHS_LAST_YEAR:"Months Last Year",THIS_BIMONTH:"This Bi-month",LAST_BIMONTH:"Last Bi-month",LAST_6_BIMONTHS:"Last 6 Bi-months",BIMONTHS_THIS_YEAR:"Bi-months This Year",BIMONTHS_LAST_YEAR:"Bi-months Last Year",THIS_QUARTER:"This Quarter",LAST_QUARTER:"Last Quarter",LAST_4_QUARTERS:"Last 4 Quarters",QUARTERS_THIS_YEAR:"Quarters This Year",QUARTERS_LAST_YEAR:"Quarters Last Year",THIS_SIX_MONTH:"This Six-month",LAST_SIX_MONTH:"Last Six-month",LAST_2_SIXMONTHS:"Last 2 Six-months",SIXMONTHS_THIS_YEAR:"Six-months This Year",SIXMONTHS_LAST_YEAR:"Six-months Last Year",THIS_YEAR:"This Year",LAST_YEAR:"Last Year",LAST_5_YEARS:"Last 5 Years",LAST_10_YEARS:"Last 10 Years",THIS_FINANCIAL_YEAR:"This Financial Year",LAST_FINANCIAL_YEAR:"Last Financial Year",LAST_5_FINANCIAL_YEARS:"Last 5 Financial Years",LAST_10_FINANCIAL_YEARS:"Last 10 Financial Years"},ja=v.I4.div`
  max-width: 700px;
  margin: 0 auto;
`,Ka=(0,v.I4)(Ha.Z)`
  ${({theme:e})=>"\n    margin-bottom: 16px;\n  "}
`,Xa=v.I4.div`
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
`,Va=v.I4.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 12px;
  margin-top: 12px;
`,Ga=v.I4.div`
  ${({theme:e})=>`\n    padding: 12px;\n    background: ${e.colorBgContainer};\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    font-size: 12px;\n  `}
`,Qa=v.I4.div`
  font-weight: 600;
  margin-bottom: 4px;
`,qa=v.I4.div`
  ${({theme:e})=>`\n    color: ${e.colorTextSecondary};\n    font-size: 11px;\n  `}
`;function Za({wizardState:e,dataset:t,handleSave:a,loading:i,databaseId:o}){var s;const d=(0,v.DP)(),[c,p]=(0,l.useState)(0),[u,h]=(0,l.useState)(!1),m=e=>{const t=e.split("|")[0];return Wa[t]||e},g=(0,l.useMemo)(()=>{const t=[],a=[];return e.periods.forEach(e=>{"RELATIVE"===(e=>{const t=e.split("|")[0];return Oa.has(t)?"RELATIVE":"FIXED"})(e)?t.push(e):a.push(e)}),{relative:t,fixed:a}},[e.periods]),S=(0,l.useCallback)(async()=>{if(o){h(!0);try{var t;const a=(null==(t=(await r.A.post({endpoint:`/api/v1/database/${o}/dhis2_expanded_org_units/`,jsonPayload:{org_units:e.orgUnits,include_children:!0}})).json)?void 0:t.count)||e.orgUnits.length;p(a)}catch{p(e.orgUnits.length)}finally{h(!1)}}},[o,e.orgUnits]);return(0,l.useEffect)(()=>{e.includeChildren&&e.orgUnits.length>0&&o?S():p(e.orgUnits.length)},[e.orgUnits,e.includeChildren,o,S]),i?(0,n.Y)(ja,{children:(0,n.FD)("div",{style:{textAlign:"center",padding:"80px 20px"},children:[(0,n.Y)(V.R,{}),(0,n.Y)(Pa,{style:{marginTop:24,color:d.colorTextSecondary},children:"Creating your DHIS2 dataset... This may take a few moments."})]})}):(0,n.FD)(ja,{children:[(0,n.FD)("div",{style:{marginBottom:24},children:[(0,n.Y)(Ba,{level:4,style:{margin:0,marginBottom:8},children:"Review & Complete Setup"}),(0,n.Y)(Pa,{style:{margin:0,color:d.colorTextSecondary},children:"Verify your dataset configuration before completion."})]}),(0,n.Y)(X.F,{message:"Ready to Create",description:"All required information provided. Your dataset will be created with the configuration below.",type:"success",showIcon:!0,style:{marginBottom:24}}),(0,n.FD)(Ka,{title:"Dataset Information",type:"inner",children:[(0,n.FD)(Re.Row,{gutter:[24,16],children:[(0,n.FD)(Re.Col,{xs:24,sm:12,children:[(0,n.Y)(Ma,{type:"secondary",style:{fontSize:12},children:"Dataset Name"}),(0,n.Y)("br",{}),(0,n.Y)(Ba,{level:5,style:{margin:"8px 0 0 0"},children:e.datasetName})]}),(0,n.FD)(Re.Col,{xs:24,sm:12,children:[(0,n.Y)(Ma,{type:"secondary",style:{fontSize:12},children:"Database"}),(0,n.Y)("br",{}),(0,n.Y)(Ba,{level:5,style:{margin:"8px 0 0 0"},children:null==t||null==(s=t.db)?void 0:s.database_name})]})]}),e.description&&(0,n.FD)(n.FK,{children:[(0,n.Y)(ct.c,{style:{margin:"16px 0"}}),(0,n.FD)("div",{children:[(0,n.Y)(Ma,{type:"secondary",style:{fontSize:12},children:"Description"}),(0,n.Y)("br",{}),(0,n.Y)(Pa,{style:{margin:"8px 0 0 0",color:d.colorTextSecondary},children:e.description})]})]})]}),(0,n.FD)(Re.Row,{gutter:[16,16],style:{marginBottom:24},children:[(0,n.Y)(Re.Col,{xs:24,sm:8,children:(0,n.Y)(Ha.Z,{type:"inner",hoverable:!0,children:(0,n.Y)(Re.Statistic,{title:"Data Elements",value:e.dataElements.length,prefix:(0,n.Y)(y.F.DatabaseOutlined,{}),valueStyle:{color:d.colorPrimary}})})}),(0,n.Y)(Re.Col,{xs:24,sm:8,children:(0,n.Y)(Ha.Z,{type:"inner",hoverable:!0,children:(0,n.Y)(Re.Statistic,{title:"Time Periods",value:e.periods.length,prefix:(0,n.Y)(y.F.CheckCircleOutlined,{}),valueStyle:{color:d.colorSuccess}})})}),(0,n.Y)(Re.Col,{xs:24,sm:8,children:(0,n.Y)(Ha.Z,{type:"inner",hoverable:!0,children:(0,n.Y)(Re.Statistic,{title:e.includeChildren?"Organization Units (with children)":"Organization Units",value:u?"...":c,prefix:e.includeChildren?(0,n.Y)(y.F.WarningOutlined,{}):(0,n.Y)(y.F.CheckCircleOutlined,{}),valueStyle:{color:d.colorWarning},suffix:e.includeChildren&&!u&&c>e.orgUnits.length?`(${e.orgUnits.length} selected)`:""})})})]}),e.periods.length>0&&(0,n.FD)(Ka,{title:"Time Periods Details",type:"inner",children:[g.relative.length>0&&(0,n.FD)("div",{style:{marginBottom:16},children:[(0,n.FD)(Ma,{type:"secondary",style:{fontSize:12,fontWeight:600},children:["RELATIVE PERIODS (",g.relative.length,")"]}),(0,n.Y)(Xa,{children:g.relative.map(e=>(0,n.Y)(Re.Tag,{color:"blue",style:{marginRight:0,fontSize:12,padding:"4px 8px"},children:m(e)},e))})]}),g.fixed.length>0&&(0,n.FD)("div",{children:[(0,n.FD)(Ma,{type:"secondary",style:{fontSize:12,fontWeight:600},children:["FIXED PERIODS (",g.fixed.length,")"]}),(0,n.Y)(Xa,{children:g.fixed.map(e=>(0,n.Y)(Re.Tag,{color:"green",style:{marginRight:0,fontSize:12,padding:"4px 8px"},children:m(e)},e))})]})]}),e.columns.length>0&&(0,n.FD)(Ka,{title:"Dataset Columns",type:"inner",children:[(0,n.FD)(Ma,{type:"secondary",style:{fontSize:12,marginBottom:12},children:["Total: ",e.columns.length," columns will be created"]}),(0,n.Y)(Va,{children:e.columns.map((e,t)=>(0,n.FD)(Ga,{children:[(0,n.Y)(Qa,{children:e.verbose_name||e.name}),(0,n.FD)(qa,{children:["Column: ",e.name]}),e.is_dttm&&(0,n.Y)(qa,{style:{color:d.colorSuccess,marginTop:4},children:"ðŸ“… Time Dimension"})]},e.name||t))})]}),(0,n.FD)(Ha.Z,{style:{marginBottom:16},type:"inner",children:[(0,n.Y)(Ba,{level:5,style:{margin:0,marginBottom:12},children:"What Happens Next"}),(0,n.FD)("ol",{style:{paddingLeft:20,margin:0,lineHeight:"1.7"},children:[(0,n.Y)("li",{children:"Dataset created with your selected parameters"}),(0,n.Y)("li",{children:"Data fetched from DHIS2 in background"}),(0,n.Y)("li",{children:"Visualizations available after data loads"}),(0,n.Y)("li",{children:"Dataset appears in your datasets list"})]})]}),(0,n.FD)(Ha.Z,{style:{marginBottom:24},type:"inner",children:[(0,n.Y)(Ba,{level:5,style:{margin:0,marginBottom:8},children:"Need to Make Changes?"}),(0,n.Y)(Pa,{style:{margin:0,color:d.colorTextSecondary},children:'Use the "Previous" button to modify settings before completion.'})]}),(0,n.Y)(X.F,{message:"Important Note",description:"Do not close this window while the dataset is being created. Processing may take several minutes depending on data size.",type:"warning",showIcon:!0,style:{marginBottom:16}})]})}const{Title:Ja,Text:en,Paragraph:tn}=we.o,an=v.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    background: ${e.colorBgBase};\n  `}
`,nn=v.I4.div`
  ${({theme:e})=>`\n    padding: ${3*e.sizeUnit}px;\n    background: ${e.colorBgElevated};\n    border-bottom: 1px solid ${e.colorBorder};\n  `}
`,ln=v.I4.div`
  ${({theme:e})=>`\n    flex: 1;\n    padding: ${4*e.sizeUnit}px;\n    overflow-y: auto;\n    background: ${e.colorBgBase};\n  `}
`,rn=v.I4.div`
  ${({theme:e})=>`\n    padding: ${3*e.sizeUnit}px;\n    background: ${e.colorBgElevated};\n    border-top: 1px solid ${e.colorBorder};\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  `}
`,on=(0,v.I4)(Re.Space)`
  display: flex;
  gap: 12px;
`,sn=v.I4.div`
  min-height: 400px;
`,dn=v.I4.div`
  ${({theme:e})=>`\n    margin-bottom: ${2*e.sizeUnit}px;\n    font-size: 14px;\n    color: ${e.colorTextSecondary};\n  `}
`,cn=[{key:"info",title:(0,o.t)("Dataset Info"),description:(0,o.t)("Basic information")},{key:"data_elements",title:(0,o.t)("Data Elements"),description:(0,o.t)("Select DE")},{key:"periods",title:(0,o.t)("Time Periods"),description:(0,o.t)("Select PE")},{key:"org_units",title:(0,o.t)("Organization Units"),description:(0,o.t)("Select OU")},{key:"column_preview",title:(0,o.t)("Column Preview"),description:(0,o.t)("Review columns")},{key:"data_preview",title:(0,o.t)("Data Preview"),description:(0,o.t)("Preview data")},{key:"save",title:(0,o.t)("Save Dataset"),description:(0,o.t)("Complete setup")}],pn=e=>`${e||"DHIS2 Dataset"} ${(new Date).toISOString().slice(0,10).replace(/-/g,"")}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`;function un({dataset:e,setDataset:t,setHasColumns:a,datasets:d,onSaveSuccess:c}){const[p,u]=(0,l.useState)(0),[m,y]=(0,l.useState)(!1),{addSuccessToast:S,addDangerToast:v}=(0,De.Yf)(),[f,b]=(0,l.useState)({datasetName:pn(null==e?void 0:e.table_name),description:"",dataElements:[],periods:[],orgUnits:[],includeChildren:!1,columns:(null==e?void 0:e.dhis2_columns)||[],previewData:[]}),[Y,x]=(0,l.useState)({}),T=(0,l.useCallback)(e=>{const t={};switch(e){case 0:f.datasetName.trim()||(t.datasetName=(0,o.t)("Dataset name is required")),null!=d&&d.includes(f.datasetName)&&(t.datasetName=(0,o.t)("Dataset name already exists"));break;case 1:0===f.dataElements.length&&(t.dataElements=(0,o.t)("At least one data element must be selected"));break;case 2:0===f.periods.length&&(t.periods=(0,o.t)("At least one period must be selected"));break;case 3:0===f.orgUnits.length&&(t.orgUnits=(0,o.t)("At least one organization unit must be selected"))}return x(t),0===Object.keys(t).length},[f,d]),I=(0,l.useCallback)(()=>{T(p)&&u(e=>Math.min(e+1,cn.length-1))},[p,T]),_=(0,l.useCallback)(()=>{u(e=>Math.max(e-1,0))},[]),E=(0,i.W6)(),D=(0,l.useCallback)(e=>{b(t=>({...t,...e}))},[]),A=(0,l.useCallback)(async()=>{var n;if(null!=e&&null!=(n=e.db)&&n.id){y(!0);try{const n={dx:f.dataElements.join(";"),pe:f.periods.join(";"),ou:f.orgUnits.join(";")};f.includeChildren&&(n.ouMode="DESCENDANTS");const l=(e=>{if(!e)return"analytics";const t=e.match(/^([a-zA-Z]+)/);return t?t[1]:"analytics"})(f.datasetName),i=`SELECT * FROM ${l}\n/* DHIS2: table=${l}&${Object.entries(n).map(([e,t])=>`${e}=${t}`).join("&")} */`;s.A.info("[DHIS2 Wizard] Creating dataset:",f.datasetName),s.A.info("[DHIS2 Wizard] SQL:",i);const d=(await r.A.post({endpoint:"/api/v1/dataset/",jsonPayload:{database:e.db.id,catalog:e.catalog||null,schema:e.schema||null,table_name:f.datasetName,sql:i}})).json;if(s.A.info("[DHIS2 Wizard] Dataset created:",d),null!=d&&d.id){s.A.info("[DHIS2 Wizard] Saving columns to dataset:",{datasetId:d.id,columnCount:f.columns.length,columns:f.columns});try{const e=f.columns.map((e,t)=>{const a=e.verbose_name||e.name;return{column_name:(0,ke.DX)(a),type:e.type||"STRING",verbose_name:a,is_dttm:e.is_dttm||!1,filterable:!0,groupby:!0,is_active:!0}});s.A.info("[DHIS2 Wizard] Transformed columns for API:",e),await r.A.put({endpoint:`/api/v1/dataset/${d.id}`,jsonPayload:{columns:e}}),s.A.info("[DHIS2 Wizard] Columns saved successfully")}catch(e){s.A.error("[DHIS2 Wizard] Failed to save columns:",e)}S((0,o.t)("Dataset created successfully!")),t({type:h.ChangeDataset,payload:{name:"table_name",value:f.datasetName}}),t({type:h.SetDHIS2Parameters,payload:{parameters:n}}),t({type:h.SetDHIS2Columns,payload:{columns:f.columns}}),a(!0),c?c():E.push(`/chart/add/?dataset=${f.datasetName}`)}else v((0,o.t)("Failed to create dataset - no ID returned"))}catch(e){var l;s.A.error("[DHIS2 Wizard] Save error:",e);const t=(null==e?void 0:e.message)||(null==e||null==(l=e.body)?void 0:l.message)||(0,o.t)("Failed to create dataset");v(t)}finally{y(!1)}}else v((0,o.t)("Database not selected"))},[f,e,t,a,c,E,S,v]),w=cn[p],L=0===p,$=p===cn.length-1;return(0,n.FD)(an,{children:[(0,n.FD)(nn,{children:[(0,n.Y)(Ja,{level:3,style:{marginBottom:0},children:(0,o.t)("DHIS2 Dataset Creator")}),(0,n.Y)(tn,{style:{marginBottom:16,marginTop:8,opacity:.7},children:(0,o.t)("Follow the steps below to create a new DHIS2 dataset")}),(0,n.Y)(Re.Steps,{current:p,onChange:e=>{e<p&&u(e)},responsive:!0,items:cn.map((e,t)=>({...e,status:t<p?"finish":t===p?"process":"wait"}))})]}),(0,n.FD)(ln,{children:[(0,n.FD)(dn,{children:[(0,o.t)("Step %d of %d",p+1,cn.length),":"," ",null==w?void 0:w.title]}),m?(0,n.Y)("div",{style:{textAlign:"center",padding:"40px"},children:(0,n.Y)(V.R,{})}):(0,n.Y)(sn,{children:(()=>{var t,a,l,i,r;switch(p){case 0:return(0,n.Y)(Yt,{wizardState:f,updateState:D,errors:Y,dataset:e});case 1:return(0,n.Y)(Nt,{wizardState:f,updateState:D,errors:Y,databaseId:null==e||null==(t=e.db)?void 0:t.id});case 2:return(0,n.Y)(Qt,{wizardState:f,updateState:D,errors:Y});case 3:return(0,n.Y)(ua,{wizardState:f,updateState:D,errors:Y,databaseId:null==e||null==(a=e.db)?void 0:a.id});case 4:return(0,n.Y)(Sa,{wizardState:f,updateState:D,databaseId:null==e||null==(l=e.db)?void 0:l.id,dataElements:f.dataElements,periods:f.periods,orgUnits:f.orgUnits});case 5:return console.log("[DHIS2Wizard] Rendering DataPreview step with includeChildren:",f.includeChildren),(0,n.Y)(za,{wizardState:f,updateState:D,databaseId:null==e||null==(i=e.db)?void 0:i.id,endpoint:null==e?void 0:e.table_name,dataElements:f.dataElements,periods:f.periods,orgUnits:f.orgUnits,includeChildren:f.includeChildren});case 6:return(0,n.Y)(Za,{wizardState:f,dataset:e,handleSave:A,loading:m,databaseId:null==e||null==(r=e.db)?void 0:r.id});default:return null}})()})]}),(0,n.Y)(ct.c,{style:{margin:0}}),(0,n.FD)(rn,{children:[(0,n.Y)(en,{type:"secondary",style:{fontSize:12},children:(0,o.t)("Step %d of %d",p+1,cn.length)}),(0,n.FD)(on,{align:"center",children:[(0,n.Y)(g.$,{onClick:_,disabled:L,size:"large",children:(0,o.t)("Previous")}),$?(0,n.Y)(g.$,{type:"primary",onClick:A,size:"large",loading:m,danger:!1,children:(0,o.t)("Complete Setup")}):(0,n.Y)(g.$,{type:"primary",onClick:I,size:"large",loading:m,children:(0,o.t)("Next")})]})]})]})}var hn=a(93817);function mn({header:e,leftPanel:t,datasetPanel:a,rightPanel:l,footer:i}){const r=(0,v.DP)();return(0,n.FD)(b,{children:[e&&(0,n.Y)(D,{children:e}),(0,n.FD)(I,{children:[t&&(0,n.Y)(hn.A,{id:"dataset",initialWidth:80*r.sizeUnit,minWidth:80*r.sizeUnit,enable:!0,children:e=>(0,n.Y)(Y,{width:e,children:(0,n.Y)(w,{children:t})})}),(0,n.FD)(x,{children:[(0,n.FD)(_,{children:[a&&(0,n.Y)(L,{children:a}),l&&(0,n.Y)($,{children:l})]}),(0,n.Y)(E,{children:i&&(0,n.Y)(C,{children:i})})]})]})]})}function gn(e,t){const a={...e||{}};switch(t.type){case h.SelectDatabase:return{...a,...t.payload,catalog:null,schema:null,table_name:null};case h.SelectCatalog:return{...a,[t.payload.name]:t.payload.value,schema:null,table_name:null};case h.SelectSchema:return{...a,[t.payload.name]:t.payload.value,table_name:null};case h.SelectTable:return{...a,[t.payload.name]:t.payload.value};case h.ChangeDataset:return{...a,[t.payload.name]:t.payload.value};case h.SetDHIS2Parameters:return{...a,dhis2_parameters:t.payload.parameters};case h.SetDHIS2Columns:return{...a,dhis2_columns:t.payload.columns};default:return null}}const yn="/tablemodelview/list/?pageIndex=0&sortColumn=changed_on_delta_humanized&sortOrder=desc";function Sn(){var e,t;const a=(0,i.W6)(),[r,o]=(0,l.useReducer)(gn,null),[s,d]=(0,l.useState)(!1),[c,p]=(0,l.useState)(!1),[h,m]=(0,l.useState)(!1),{datasets:g,datasetNames:y}=u(null==r?void 0:r.db,null==r?void 0:r.schema),{datasetId:S}=(0,i.g)();(0,l.useEffect)(()=>{Number.isNaN(parseInt(S,10))||p(!0)},[S]),(0,l.useEffect)(()=>{var e;null!=r&&null!=(e=r.db)&&e.backend&&m("dhis2"===r.db.backend)},[null==r||null==(e=r.db)?void 0:e.backend]);const v=()=>{a.push(yn)};if(h&&!c&&null!=r&&null!=(t=r.db)&&t.id&&null!=r&&r.table_name){const e=(y||[]).filter(e=>"string"==typeof e);return(0,n.Y)(un,{dataset:r,setDataset:o,hasColumns:s,setHasColumns:d,datasets:e,onSaveSuccess:v})}return(0,n.Y)(mn,{header:(0,n.Y)(H,{setDataset:o,title:null==r?void 0:r.table_name}),leftPanel:c?null:(0,n.Y)(at,{setDataset:o,dataset:r,datasetNames:y}),datasetPanel:c?(0,n.Y)(j,{id:S}):(0,n.Y)(_e,{tableName:null==r?void 0:r.table_name,dbId:null==r||null==(f=r.db)?void 0:f.id,catalog:null==r?void 0:r.catalog,schema:null==r?void 0:r.schema,setHasColumns:d,datasets:g,dhis2Columns:null==r?void 0:r.dhis2_columns}),footer:(0,n.Y)(dt,{url:yn,datasetObject:r,hasColumns:s,datasets:y})});var f}},73306:(e,t,a)=>{a.d(t,{U:()=>x});var n=a(2445),l=a(17437),i=a(81465),r=a(74098),o=a(8558),s=a(40105),d=a(24002),c=a(98250),p=a(95018),u=a(29645);const h=e=>l.AH`
  display: flex;
  font-size: ${e.fontSizeXL}px;
  font-weight: ${e.fontWeightStrong};
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;

  & .dynamic-title-input {
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding: 0;
    color: ${e.colorText};
    background-color: ${e.colorBgContainer};

    &::placeholder {
      color: ${e.colorTextTertiary};
    }
  }

  & .input-sizer {
    position: absolute;
    left: -9999px;
    display: inline-block;
    white-space: pre;
  }
`,m=(0,d.memo)(({title:e,placeholder:t,onSave:a,canEdit:o,label:s})=>{const m=(0,i.DP)(),[g,y]=(0,d.useState)(!1),[S,v]=(0,d.useState)(!1),[f,b]=(0,d.useState)(e||""),{width:Y,ref:x}=(0,c.uZ)(),{width:T,ref:I}=(0,c.uZ)({refreshMode:"debounce"});(0,d.useEffect)(()=>{b(e)},[e]),(0,d.useEffect)(()=>{if(g&&null!=x&&x.current&&x.current.setSelectionRange){const{length:e}=x.current.value;x.current.setSelectionRange(e,e),x.current.scrollLeft=x.current.scrollWidth}},[g]),(0,d.useLayoutEffect)(()=>{null!=x&&x.current&&(x.current.textContent=f||t)},[f,t,x]),(0,d.useEffect)(()=>{var e;const t=null==(e=x.current)?void 0:e.input;t&&(t.scrollWidth>t.clientWidth?v(!0):v(!1))},[Y,T]);const _=(0,d.useCallback)(()=>{o&&!g&&y(!0)},[o,g]),E=(0,d.useCallback)(()=>{if(!o)return;const t=f.trim();b(t),e!==t&&a(t),y(!1)},[o,f,a,e]),D=(0,d.useCallback)(e=>{o&&g&&b(e.target.value)},[o,g]),A=(0,d.useCallback)(e=>{if(!o)return;e.preventDefault();const{activeElement:t}=document;t&&t instanceof HTMLElement&&t.blur()},[o]);return(0,n.FD)("div",{css:h,ref:I,children:[(0,n.Y)(p.m,{id:"title-tooltip",title:S&&f&&!g?f:null,children:(0,n.Y)(u.Input,{variant:"borderless","aria-label":null!=s?s:(0,r.t)("Title"),className:"dynamic-title-input",value:f,onChange:D,onBlur:E,onClick:_,onPressEnter:A,placeholder:t,css:l.AH`
              ${!o&&"&[disabled] {\n                  cursor: default;\n                }\n              "}
              font-size: ${m.fontSizeXL}px;
              transition: auto;
              ${Y&&Y>0&&l.AH`
                width: ${Y}px;
              `}
            `,disabled:!o})}),(0,n.Y)("span",{ref:x,className:"input-sizer","aria-hidden":!0,tabIndex:-1})]})});var g=a(28827),y=a(54569),S=a(88217);const v=e=>l.AH`
  width: ${8*e.sizeUnit}px;
  height: ${8*e.sizeUnit}px;
  padding: 0;
  border: 1px solid ${e.colorPrimary};

  &.ant-btn > span.anticon {
    line-height: 0;
    transition: inherit;
  }
`,f=e=>l.AH`
  display: flex;
  flex-direction: row;
  align-items: center;
  flex-wrap: nowrap;
  justify-content: space-between;
  background-color: ${e.colorBgContainer};
  height: ${16*e.sizeUnit}px;
  padding: 0 ${4*e.sizeUnit}px;

  .editable-title {
    overflow: hidden;

    & > input[type='button'],
    & > span {
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      white-space: nowrap;
    }
  }

  span[role='button'] {
    display: flex;
    height: 100%;
  }

  .title-panel {
    display: flex;
    align-items: center;
    min-width: 0;
    margin-right: ${12*e.sizeUnit}px;
  }

  .right-button-panel {
    display: flex;
    align-items: center;
  }
`,b=e=>l.AH`
  display: flex;
  align-items: center;
  padding-left: ${2*e.sizeUnit}px;

  & .anticon-star {
    padding: 0 ${e.sizeUnit}px;

    &:first-of-type {
      padding-left: 0;
    }
  }
`,Y=e=>l.AH`
  margin-left: ${2*e.sizeUnit}px;
`,x=({editableTitleProps:e,showTitlePanelItems:t,certificatiedBadgeProps:a,showFaveStar:l,faveStarProps:d,titlePanelAdditionalItems:c,rightPanelAdditionalItems:p,additionalActionsMenu:u,menuDropdownProps:h,showMenuDropdown:x=!0,tooltipProps:T})=>{const I=(0,i.DP)();return(0,n.FD)("div",{css:f,className:"header-with-actions",children:[(0,n.FD)("div",{className:"title-panel",children:[(0,n.Y)(m,{...e}),t&&(0,n.FD)("div",{css:b,children:[(null==a?void 0:a.certifiedBy)&&(0,n.Y)(y.T,{...a}),l&&(0,n.Y)(s.$,{...d}),c]})]}),(0,n.FD)("div",{className:"right-button-panel",children:[p,(0,n.Y)("div",{css:Y,children:x&&(0,n.Y)(g.ms,{trigger:["click"],popupRender:()=>u,...h,children:(0,n.Y)(S.$,{css:v,buttonStyle:"tertiary","aria-label":(0,r.t)("Menu actions trigger"),tooltip:null==T?void 0:T.text,placement:null==T?void 0:T.placement,children:(0,n.Y)(o.F.EllipsisOutlined,{iconColor:I.colorPrimary,iconSize:"l"})})})})]})]})}},93817:(e,t,a)=>{a.d(t,{A:()=>s});var n=a(2445),l=a(33149),i=a(81465),r=a(42323);const o=i.I4.div`
  position: absolute;
  height: 100%;

  :hover .sidebar-resizer::after {
    background-color: ${({theme:e})=>e.colorPrimary};
  }

  .sidebar-resizer {
    // @z-index-above-sticky-header (100) + 1 = 101
    z-index: 101;
  }

  .sidebar-resizer::after {
    display: block;
    content: '';
    width: 1px;
    height: 100%;
    margin: 0 auto;
  }
`,s=({id:e,initialWidth:t,minWidth:a,maxWidth:i,enable:s,children:d})=>{const[c,p]=(0,r.A)(e,t);return(0,n.FD)(n.FK,{children:[(0,n.Y)(o,{children:(0,n.Y)(l.c,{enable:{right:s},handleClasses:{right:"sidebar-resizer",bottom:"hidden",bottomRight:"hidden",bottomLeft:"hidden"},size:{width:c,height:"100%"},minWidth:a,maxWidth:i,onResizeStop:(e,t,a,n)=>p(c+n.width)})}),d(c)]})}}}]);