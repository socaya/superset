"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5306],{43234:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J});var a=n(2445),l=n(24002),i=n(81465),o=n(74098),s=n(79378),r=n(29645),d=n(95018),c=n(94551),m=n(94185),h=n(38961),u=n(56196),y=n(58561),p=n.n(y),f=n(86784),b=n(71323),g=n(64457),_=n(31780),v=n(20237),k=n(51304),S=n(32064),w=n(9876),C=n(90179),T=n.n(C),Y=n(17437),A=n(49113),D=n(7840),F=n(8558),O=n(97163),x=n(88217),E=n(65729),z=n(52167),$=n(45207),H=n(42566);const N=i.I4.div`
  ${({theme:e})=>Y.AH`
    .ace_editor {
      border-radius: ${e.borderRadius}px;
    }
  `}
`,j=i.I4.div`
  ${({theme:e})=>Y.AH`
    --ant-form-item-margin-bottom: ${6*e.sizeUnit}px;

    .system-theme-notice {
      font-size: ${e.fontSizeSM}px;
      font-style: italic;
      margin-bottom: ${4*e.sizeUnit}px;
      display: block;
    }

    .alert-info {
      margin-bottom: ${4*e.sizeUnit}px;
    }

    .apply-button-container {
      margin-top: ${2*e.sizeUnit}px;
      text-align: right;
    }
  `}
`,M=(0,g.Ay)(({addDangerToast:e,addSuccessToast:t,onThemeAdd:n,onThemeApply:s,onHide:c,show:h,theme:u=null,canDevelop:y=!1})=>{var p,b;const g=(0,i.DP)(),{setTemporaryTheme:v}=(0,_.w)(),[k,S]=(0,l.useState)(!0),[w,C]=(0,l.useState)(null),[M,I]=(0,l.useState)(null),[R,U]=(0,l.useState)(!0),[L,B]=(0,l.useState)(!1),J=null!==u,P=!0===(null==w?void 0:w.is_system),K=P,q=y,V=(null==D.A||null==(p=D.A.THEME_MODAL)?void 0:p.THEME_EDITOR_URL)||"https://ant.design/theme-editor",W=(null==D.A||null==(b=D.A.THEME_MODAL)?void 0:b.DOCUMENTATION_URL)||"https://superset.apache.org/docs/configuration/theming/",G=(0,$.p)(null==w?void 0:w.json_data,{enabled:!K,errorPrefix:"Invalid JSON syntax"}),{state:{loading:Q,resource:X},fetchResource:Z,createResource:ee,updateResource:te}=(0,f.fn)("theme",(0,o.t)("theme"),e),ne=(0,l.useCallback)(()=>!(!w||!M||K||w.theme_name===M.theme_name&&w.json_data===M.json_data),[w,M,K]),ae=(0,l.useCallback)(()=>{c(),C(null),I(null),B(!1)},[c]),le=(0,l.useCallback)(()=>{if(J){if(null!=w&&w.id){const e=T()(w,["id","created_by","changed_by","changed_on_delta_humanized"]);te(w.id,e).then(e=>{e&&(n&&n(),ae())})}}else w&&ee(w).then(e=>{e&&(n&&n(),ae())})},[w,J,te,ee,n,ae]),ie=(0,l.useCallback)(()=>{ne()?B(!0):ae()},[ne,ae]),oe=(0,l.useCallback)(()=>{ae()},[ae]),se=(0,l.useCallback)(e=>{if(!e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}},[]),re=(0,l.useCallback)(()=>{if(null!=w&&w.json_data&&se(w.json_data))try{const e=JSON.parse(w.json_data);v(e),s&&s(),t&&t((0,o.t)("Local theme set for preview"))}catch(t){e((0,o.t)("Failed to apply theme: Invalid JSON"))}},[null==w?void 0:w.json_data,se,v,s,t,e]),de=(0,l.useMemo)(()=>J?K?(0,o.t)("View theme properties"):(0,o.t)("Edit theme properties"):(0,o.t)("Add theme"),[J,K]),ce=(0,l.useMemo)(()=>{const e=J?F.F.EditOutlined:F.F.PlusOutlined;return(0,a.Y)(e,{iconSize:"l",css:Y.AH`
          margin: auto ${2*g.sizeUnit}px auto 0;
        `})},[J,g.sizeUnit]),me=(0,l.useCallback)(e=>{const{target:t}=e,n={...w,theme_name:(null==w?void 0:w.theme_name)||"",json_data:(null==w?void 0:w.json_data)||""};n[t.name]=t.value,C(n)},[w]),he=(0,l.useCallback)(e=>{const t={...w,theme_name:(null==w?void 0:w.theme_name)||"",json_data:e};C(t)},[w]),ue=(0,l.useCallback)(()=>{var e;K?S(!0):null!=w&&w.theme_name.length&&null!=w&&null!=(e=w.json_data)&&e.length&&se(w.json_data)?S(!1):S(!0)},[null==w?void 0:w.theme_name,null==w?void 0:w.json_data,K,se]);return(0,l.useEffect)(()=>{if(J&&(null==w||!w.id||u&&(null==u?void 0:u.id)!==w.id||R&&h))null!=u&&u.id&&!Q&&Z(u.id);else if(!J&&(!w||w.id||R&&h)){const e={theme_name:"",json_data:JSON.stringify({},null,2)};C(e),I(e)}},[u,h,J,w,R,Q,Z]),(0,l.useEffect)(()=>{X&&(C(X),I(X))},[X]),(0,l.useEffect)(()=>{ue()},[ue]),(0,l.useEffect)(()=>{R&&h&&U(!1)},[R,h]),(0,A.K)(h&&ne()),(0,a.Y)(O.aF,{disablePrimaryButton:K||k,onHandledPrimaryAction:K?void 0:le,onHide:ie,primaryButtonName:J?(0,o.t)("Save"):(0,o.t)("Add"),show:h,width:"55%",centered:!0,footer:L?(0,a.Y)(m.F,{closable:!1,type:"warning",message:(0,o.t)("You have unsaved changes"),description:(0,o.t)("Your changes will be lost if you leave without saving."),css:{textAlign:"left"},action:(0,a.FD)(r.Space,{children:[(0,a.Y)(x.$,{buttonStyle:"tertiary",onClick:()=>B(!1),children:(0,o.t)("Keep editing")},"keep-editing"),(0,a.Y)(x.$,{buttonStyle:"secondary",onClick:oe,children:(0,o.t)("Discard")},"discard"),(0,a.Y)(x.$,{buttonStyle:"primary",onClick:()=>{B(!1),le()},disabled:k,children:(0,o.t)("Save")},"save")]})}):[(0,a.Y)(x.$,{onClick:ie,buttonStyle:"secondary",children:K?(0,o.t)("Close"):(0,o.t)("Cancel")},"cancel"),...K?[]:[(0,a.Y)(x.$,{onClick:le,disabled:k,buttonStyle:"primary",children:J?(0,o.t)("Save"):(0,o.t)("Add")},"save")]],title:(0,a.FD)(H.o.Title,{level:4,children:[ce,de]}),children:(0,a.Y)(j,{children:(0,a.FD)(E.l,{layout:"vertical",children:[P&&(0,a.Y)(H.o.Text,{type:"secondary",className:"system-theme-notice",children:(0,o.t)("System Theme - Read Only")}),(0,a.Y)(E.l.Item,{label:(0,o.t)("Name"),required:!K,children:(0,a.Y)(r.Input,{name:"theme_name",onChange:me,value:null==w?void 0:w.theme_name,readOnly:K,placeholder:(0,o.t)("Enter theme name")})}),(0,a.FD)(E.l.Item,{label:(0,o.t)("JSON Configuration"),required:!K,children:[(0,a.Y)(m.F,{type:"info",showIcon:!0,closable:!1,className:"alert-info",message:(0,a.FD)("span",{children:[(0,o.t)("Design with")," ",(0,a.Y)("a",{href:V,target:"_blank",rel:"noopener noreferrer",children:(0,o.t)("Ant Design Theme Editor")}),(0,o.t)(", then paste the JSON below. See our")," ",(0,a.Y)("a",{href:W,target:"_blank",rel:"noopener noreferrer",children:(0,o.t)("documentation")}),(0,o.t)(" for details.")]})}),(0,a.Y)(N,{children:(0,a.Y)(z.iN,{showLoadingForImport:!0,name:"json_data",value:(null==w?void 0:w.json_data)||"",onChange:he,tabSize:2,width:"100%",height:"250px",wrapEnabled:!0,readOnly:K,showGutter:!0,showPrintMargin:!1,annotations:G})}),q&&(0,a.Y)("div",{className:"apply-button-container",children:(0,a.Y)(d.m,{title:(0,o.t)("Set local theme for testing (preview only)"),placement:"top",children:(0,a.Y)(x.$,{icon:(0,a.Y)(F.F.ThunderboltOutlined,{}),onClick:re,disabled:!(null!=w&&w.json_data&&se(w.json_data)),buttonStyle:"secondary",children:(0,o.t)("Apply")})})})]})]})})})});var I=n(79605),R=n(57249);const U=i.I4.div`
  align-items: center;
  display: flex;
  gap: ${({theme:e})=>e.sizeUnit}px;

  .ant-tag {
    margin-left: ${({theme:e})=>2*e.sizeUnit}px;
  }
`,L=(0,i.I4)(r.Tag)`
  display: inline-flex;
  align-items: center;
`,B=(0,o.t)("You are importing one or more themes that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?"),J=(0,g.Ay)(function({addDangerToast:e,addSuccessToast:t,user:n}){var i;const{state:{loading:y,resourceCount:g,resourceCollection:C,bulkSelectEnabled:T},hasPerm:Y,fetchData:A,refreshData:D,toggleBulkSelect:O}=(0,f.RU)("theme",(0,o.t)("Themes"),e),{setTemporaryTheme:x,hasDevOverride:E,getAppliedThemeId:z}=(0,_.w)(),[$,H]=(0,l.useState)(!1),[N,j]=(0,l.useState)(null),[J,P]=(0,l.useState)(!1),[K,q]=(0,l.useState)(!1),[V,W]=(0,l.useState)(null),{showConfirm:G,ConfirmModal:Q}=(0,R.f)();(0,l.useEffect)(()=>{if(E()){const e=z();W(e)}else W(null)},[E,z]);const X=Y("can_write"),Z=Y("can_write"),ee=Y("can_write"),te=Y("can_export"),ne=Y("can_write"),ae=Y("can_write"),le=(0,S.Ay)(),ie=(null==le||null==(i=le.common)?void 0:i.theme)||{},oe=Z&&(null==ie?void 0:ie.enableUiThemeAdministration),[se,re]=(0,l.useState)(null),de=(0,l.useCallback)(n=>{if(n.json_data)try{const e=JSON.parse(n.json_data),a=n.id||null;x(e,a),W(a),t((0,o.t)('Local theme set to "%s"',n.theme_name))}catch(t){e((0,o.t)("Failed to set local theme: Invalid JSON configuration"))}},[x,t,e]),ce=(0,l.useCallback)(async t=>{const n=t.map(({id:e})=>e).filter(e=>void 0!==e);P(!0);try{await(0,k.A)("theme",n,()=>{P(!1)})}catch(t){P(!1),e((0,o.t)("There was an issue exporting the selected themes"))}},[e]),me=(0,l.useCallback)(n=>{G({title:(0,o.t)("Set System Default Theme"),body:(0,o.t)('Are you sure you want to set "%s" as the system default theme? This will apply to all users who haven\'t set a personal preference.',n.theme_name),onConfirm:async()=>{try{await(a=n.id,s.A.put({endpoint:`/api/v1/theme/${a}/set_system_default`})),D(),t((0,o.t)('"%s" is now the system default theme',n.theme_name))}catch(t){e((0,o.t)("Failed to set system default theme: %s",t.message))}var a}})},[G,D,t,e]),he=(0,l.useCallback)(n=>{G({title:(0,o.t)("Set System Dark Theme"),body:(0,o.t)('Are you sure you want to set "%s" as the system dark theme? This will apply to all users who haven\'t set a personal preference.',n.theme_name),onConfirm:async()=>{try{await(a=n.id,s.A.put({endpoint:`/api/v1/theme/${a}/set_system_dark`})),D(),t((0,o.t)('"%s" is now the system dark theme',n.theme_name))}catch(t){e((0,o.t)("Failed to set system dark theme: %s",t.message))}var a}})},[G,D,t,e]),ue=(0,l.useCallback)(()=>{G({title:(0,o.t)("Remove System Default Theme"),body:(0,o.t)("Are you sure you want to remove the system default theme? The application will fall back to the configuration file default."),onConfirm:async()=>{try{await s.A.delete({endpoint:"/api/v1/theme/unset_system_default"}),D(),t((0,o.t)("System default theme removed"))}catch(t){e((0,o.t)("Failed to remove system default theme: %s",t.message))}}})},[G,D,t,e]),ye=(0,l.useCallback)(()=>{G({title:(0,o.t)("Remove System Dark Theme"),body:(0,o.t)("Are you sure you want to remove the system dark theme? The application will fall back to the configuration file dark theme."),onConfirm:async()=>{try{await s.A.delete({endpoint:"/api/v1/theme/unset_system_dark"}),D(),t((0,o.t)("System dark theme removed"))}catch(t){e((0,o.t)("Failed to remove system dark theme: %s",t.message))}}})},[G,D,t,e]),pe=[{id:"theme_name",desc:!0}],fe=(0,l.useMemo)(()=>[{Cell:({row:{original:e}})=>{const t=E()&&V&&e.id===V;return(0,a.FD)(U,{children:[e.theme_name,t&&(0,a.Y)(d.m,{title:(0,o.t)("This theme is set locally for your session"),children:(0,a.Y)(r.Tag,{color:"success",children:(0,o.t)("Local")})}),e.is_system&&(0,a.Y)(d.m,{title:(0,o.t)("Defined through system configuration."),children:(0,a.Y)(r.Tag,{color:"processing",children:(0,o.t)("System")})}),e.is_system_default&&(0,a.Y)(d.m,{title:(0,o.t)("This is the system default theme"),children:(0,a.Y)(L,{color:"warning",icon:(0,a.Y)(F.F.SunOutlined,{}),children:(0,o.t)("Default")})}),e.is_system_dark&&(0,a.Y)(d.m,{title:(0,o.t)("This is the system dark theme"),children:(0,a.Y)(L,{color:"default",icon:(0,a.Y)(F.F.MoonOutlined,{}),children:(0,o.t)("Dark")})})]})},Header:(0,o.t)("Name"),accessor:"theme_name",id:"theme_name"},{Cell:({row:{original:{changed_on_delta_humanized:e,changed_by:t}}})=>(0,a.Y)(w.UW,{date:e,user:t}),Header:(0,o.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",disableSortBy:!0,id:"changed_on_delta_humanized"},{Cell:({row:{original:t}})=>{const n=[ae?{label:"apply-action",tooltip:(0,o.t)("Set local theme. Will be applied to your session until unset."),placement:"bottom",icon:"ThunderboltOutlined",onClick:()=>de(t)}:null,Z?{label:"edit-action",tooltip:t.is_system?(0,o.t)("View theme"):(0,o.t)("Edit theme"),placement:"bottom",icon:t.is_system?"EyeOutlined":"EditOutlined",onClick:()=>(j(t),void H(!0))}:null,te?{label:"export-action",tooltip:(0,o.t)("Export theme"),placement:"bottom",icon:"UploadOutlined",onClick:()=>ce([t])}:null,oe&&!t.is_system_default?{label:"set-default-action",tooltip:(0,o.t)("Set as system default theme"),placement:"bottom",icon:"SunOutlined",onClick:()=>me(t)}:null,oe&&t.is_system_default?{label:"unset-default-action",tooltip:(0,o.t)("Remove as system default theme"),placement:"bottom",icon:"StopOutlined",onClick:()=>ue()}:null,oe&&!t.is_system_dark?{label:"set-dark-action",tooltip:(0,o.t)("Set as system dark theme"),placement:"bottom",icon:"MoonOutlined",onClick:()=>he(t)}:null,oe&&t.is_system_dark?{label:"unset-dark-action",tooltip:(0,o.t)("Remove as system dark theme"),placement:"bottom",icon:"StopOutlined",onClick:()=>ye()}:null,ee&&!t.is_system?{label:"delete-action",tooltip:(0,o.t)("Delete theme"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>{t.is_system_default||t.is_system_dark?e((0,o.t)("Cannot delete theme that is set as system default or dark theme")):re(t)}}:null].filter(e=>!!e);return(0,a.Y)(w.kv,{actions:n})},Header:(0,o.t)("Actions"),id:"actions",disableSortBy:!0,hidden:!(Z||ee||ae||te),size:"xl"},{accessor:I.H.ChangedBy,hidden:!0,id:I.H.ChangedBy}],[Z,ee,ae,te,E,V,oe,e,de,ce,me,ue,he,ye]),be={name:(0,o.t)("Themes")},ge=[];ne&&ge.push({name:(0,a.Y)(d.m,{id:"import-tooltip",title:(0,o.t)("Import themes"),placement:"bottomRight",children:(0,a.Y)(F.F.DownloadOutlined,{iconSize:"l"})}),buttonStyle:"link",onClick:()=>{q(!0)}}),(ee||te)&&ge.push({name:(0,o.t)("Bulk select"),onClick:O,buttonStyle:"secondary"}),X&&ge.push({name:(0,a.Y)(a.FK,{children:(0,o.t)("Theme")}),buttonStyle:"primary",icon:(0,a.Y)(F.F.PlusOutlined,{iconSize:"m"}),onClick:()=>{j(null),H(!0)}}),be.buttons=ge;const _e=(0,l.useMemo)(()=>[{Header:(0,o.t)("Name"),key:"search",id:"theme_name",input:"search",operator:w.c0.Contains},{Header:(0,o.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:w.c0.RelationOneMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,b.u1)("theme","changed_by",(0,b.JF)(e=>(0,o.t)("An error occurred while fetching theme datasource values: %s",e)),n),paginate:!0}],[n]);return(0,a.FD)(a.FK,{children:[(0,a.Y)(v.A,{...be}),(0,a.Y)(M,{addDangerToast:e,theme:N,onThemeAdd:()=>D(),onThemeApply:function(){W(null)},onHide:()=>H(!1),show:$,canDevelop:Z}),(0,a.Y)(w.zb,{resourceName:"theme",resourceLabel:(0,o.t)("theme"),passwordsNeededMessage:"",confirmOverwriteMessage:B,addDangerToast:e,addSuccessToast:t,onModelImport:()=>{q(!1),D(),t((0,o.t)("Theme imported"))},show:K,onHide:()=>{q(!1)}}),se&&(0,a.Y)(c.T,{description:(0,a.FD)(r.Space,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,a.Y)("div",{children:(0,o.t)("This action will permanently delete the theme.")}),(0,a.Y)(m.F,{type:"warning",showIcon:!0,closable:!1,message:(0,o.t)("Any dashboards using this theme will be automatically dissociated from it.")})]}),onConfirm:()=>{se&&(({id:n,theme_name:a})=>{s.A.delete({endpoint:`/api/v1/theme/${n}`}).then(()=>{D(),re(null),t((0,o.t)("Deleted: %s",a))},(0,b.JF)(t=>e((0,o.t)("There was an issue deleting %s: %s",a,t))))})(se)},onHide:()=>re(null),open:!0,title:(0,o.t)("Delete Theme?")}),(0,a.Y)(h.h,{title:(0,o.t)("Please confirm"),description:(0,a.FD)(r.Space,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,a.Y)("div",{children:(0,o.t)("Are you sure you want to delete the selected themes?")}),(0,a.Y)(m.F,{type:"warning",showIcon:!0,closable:!1,message:(0,o.t)("Any dashboards using these themes will be automatically dissociated from them.")})]}),onConfirm:n=>{const a=n.filter(e=>!e.is_system&&!e.is_system_default&&!e.is_system_dark);0!==a.length?(a.length!==n.length&&e((0,o.t)("Skipped %d system themes that cannot be deleted",n.length-a.length)),s.A.delete({endpoint:`/api/v1/theme/?q=${p().encode(a.map(({id:e})=>e))}`}).then(({json:e={}})=>{D(),t(e.message)},(0,b.JF)(t=>e((0,o.t)("There was an issue deleting the selected themes: %s",t))))):e((0,o.t)("Cannot delete system themes"))},children:n=>{const l=[];return ee&&l.push({key:"delete",name:(0,o.t)("Delete"),onSelect:n,type:"danger"}),te&&l.push({key:"export",name:(0,o.t)("Export"),type:"primary",onSelect:ce}),(0,a.Y)(w.uO,{className:"themes-list-view",columns:fe,count:g,data:C,fetchData:A,filters:_e,initialSort:pe,loading:y,pageSize:25,bulkActions:l,bulkSelectEnabled:T,disableBulkSelect:O,addDangerToast:e,addSuccessToast:t,refreshData:D})}}),J&&(0,a.Y)(u.R,{}),Q]})})},49113:(e,t,n)=>{n.d(t,{K:()=>l});var a=n(24002);const l=(e,t)=>{(0,a.useEffect)(()=>{const n=n=>{e&&(n.preventDefault(),n.returnValue=t||"")};return window.addEventListener("beforeunload",n),()=>window.removeEventListener("beforeunload",n)},[e,t])}},57249:(e,t,n)=>{n.d(t,{f:()=>y});var a=n(2445),l=n(24002),i=n(81465),o=n(74098),s=n(8558),r=n(97163),d=n(88217),c=n(42566);const m=i.I4.span`
  margin-right: ${({theme:e})=>2*e.sizeUnit}px;
`,h=(0,a.Y)(s.F.QuestionCircleOutlined,{iconSize:"m"}),u=({show:e,onHide:t,onConfirm:n,title:l,body:i,confirmText:s=(0,o.t)("Confirm"),cancelText:u=(0,o.t)("Cancel"),confirmButtonStyle:y="primary",icon:p=h,loading:f=!1})=>(0,a.Y)(r.aF,{centered:!0,responsive:!0,onHide:t,show:e,width:"600px",title:(0,a.FD)(a.FK,{children:[(0,a.Y)(m,{children:p}),l]}),footer:(0,a.FD)(a.FK,{children:[(0,a.Y)(d.$,{buttonStyle:"secondary",onClick:t,disabled:f,children:u}),(0,a.Y)(d.$,{buttonStyle:y,onClick:n,loading:f,children:s})]}),children:"string"==typeof i?(0,a.Y)(c.o.Text,{children:i}):i}),y=()=>{const[e,t]=(0,l.useState)(null),[n,i]=(0,l.useState)(!1),o=(0,l.useCallback)(e=>{t(e)},[]),s=(0,l.useCallback)(()=>{n||t(null)},[n]),r=(0,l.useCallback)(async()=>{if(e)try{i(!0),await e.onConfirm(),t(null)}catch(e){console.error("Confirm action failed:",e)}finally{i(!1)}},[e]);return{showConfirm:o,ConfirmModal:e?(0,a.Y)(u,{show:!!e,onHide:s,onConfirm:r,title:e.title,body:e.body,confirmText:e.confirmText,cancelText:e.cancelText,confirmButtonStyle:e.confirmButtonStyle,icon:e.icon,loading:n}):null}}}}]);