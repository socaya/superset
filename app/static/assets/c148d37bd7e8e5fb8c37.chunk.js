"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7917],{63634:(t,e,i)=>{i.r(e),i.d(e,{default:()=>Ut});var r=i(2445),s=i(24002),n=i(81465),o=i(7889),a=i(38221),l=i.n(a),h=i(61225),c=i(44294),u=i(11854),d=i(83407),g=i(27063),m=i(74971);const p=[-16e6,-7279e3,205e5,11e6];var f=i(60764),_=i(9703),T=i(18036),x=i.n(T),E=i(60258),C=i(32861),v=i(98837);const S=({vizType:t,theme:e,height:i,width:n,chartConfig:o,locale:a})=>{const[l,c]=(0,s.useState)();(0,s.useEffect)(()=>{(async t=>{const e=(0,C.A)(),i=await e.getAsPromise(t);c(()=>i)})(t)},[t]);const u=(0,E.U1)({reducer:(t={common:{locale:a}})=>t});return(0,r.Y)(v.a,{theme:e,children:(0,r.Y)(h.Kq,{store:u,children:void 0===l?(0,r.Y)(r.FK,{}):(0,r.Y)(l,{...o.properties,height:i,width:n})})})},R=(t,e,i,s,n,o)=>(0,r.Y)(S,{vizType:t,chartConfig:e,width:i,height:s,theme:n,locale:o}),F=t=>({type:t.type,features:t.features.map(t=>({type:t.type,geometry:t.geometry,properties:Object.keys(t.properties).filter(t=>"refs"!==t).reduce((e,i)=>({...e,[i]:t.properties[i]}),{})}))}),y=(t,e)=>{const i=F(t),r=F(e);return JSON.stringify(i)===JSON.stringify(r)},w=i.p+"loading.cff8a5da.gif";class P extends f.A{constructor(t){super(t),this.charts=[],this.chartConfigs={type:"FeatureCollection",features:[]},this.chartSizeValues={},this.chartVizType=void 0,this.div=void 0,this.loadingMask=void 0,this.chartBackgroundCssColor="",this.chartBackgroundBorderRadius=0,this.theme=void 0,this.locale=void 0,this.chartVizType=t.chartVizType,t.chartConfigs&&(this.chartConfigs=t.chartConfigs),t.chartSizeValues&&(this.chartSizeValues=t.chartSizeValues),t.chartBackgroundCssColor&&(this.chartBackgroundCssColor=t.chartBackgroundCssColor),t.chartBackgroundBorderRadius&&(this.chartBackgroundBorderRadius=t.chartBackgroundBorderRadius),t.theme&&(this.theme=t.theme),t.locale&&(this.locale=t.locale);const e=document.createElement("img");e.src=w,e.style.position="relative",e.style.width="50px",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",this.loadingMask=document.createElement("div"),this.loadingMask.style.position="relative",this.loadingMask.style.height="100%",this.loadingMask.appendChild(e),this.div=document.createElement("div"),t.onMouseOver&&(this.div.onmouseover=t.onMouseOver),t.onMouseOut&&(this.div.onmouseout=t.onMouseOut)}setChartConfig(t,e=!1){this.chartConfigs=t,e||this.changed()}setChartVizType(t,e=!1){this.chartVizType=t,e||this.changed()}setChartSizeValues(t,e=!1){this.chartSizeValues=t,e||this.changed()}setChartBackgroundCssColor(t,e=!1){this.chartBackgroundCssColor=t,e||this.changed()}setChartBackgroundBorderRadius(t,e=!1){this.chartBackgroundBorderRadius=t,e||this.changed()}removeAllChartElements(){this.charts.forEach(t=>{x().unmountComponentAtNode(t.htmlElement),t.htmlElement.remove()}),this.charts=[]}createCharts(t){const e=this.chartConfigs.features.map(e=>{const i=document.createElement("div");let r=0,s=0;this.chartSizeValues[t]&&(r=this.chartSizeValues[t].width,s=this.chartSizeValues[t].height);const n=R(this.chartVizType,e,r,s,this.theme,this.locale);return x().render(n,i),{htmlElement:i,coordinate:(o=e.geometry,(new g.default).readGeometry(o,{featureProjection:"EPSG:3857"}).getCoordinates()),width:r,height:s,feature:e};var o});this.charts=e}updateCharts(t){const e=this.charts.map(e=>{let i=0,r=0;if(this.chartSizeValues[t]&&(i=this.chartSizeValues[t].width,r=this.chartSizeValues[t].height),i===e.width&&r===e.height)return e;const s=R(this.chartVizType,e.feature,i,r,this.theme,this.locale);return x().render(s,e.htmlElement),{...e,width:i,height:r}});this.charts=e}render(t){if(!t)return this.div;const{viewState:e}=t,i=Math.round(e.zoom);if(e.nextResolution)return this.loadingMask;0===this.charts.length?this.createCharts(i):this.updateCharts(i),this.charts.forEach(e=>{const{htmlElement:i,coordinate:r,width:s,height:n}=e,o=[...r],[a,l]=(0,_.Bb)(t.coordinateToPixelTransform,o);i.style.left=a-s/2+"px",i.style.top=l-n/2+"px",i.style.position="absolute",i.style["background-color"]=this.chartBackgroundCssColor,i.style["border-radius"]=`${this.chartBackgroundBorderRadius}%`});const r=this.charts.map(t=>t.htmlElement);return this.div.replaceChildren(...r),this.div}}var A=i(33591),z=i.n(A);const j="preload",I="useInterimTilesOnError";class b extends f.A{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get(j)}setPreload(t){this.set(j,t)}getUseInterimTilesOnError(){return this.get(I)}setUseInterimTilesOnError(t){this.set(I,t)}getData(t){return super.getData(t)}}const M=b;var O=i(41623),L=i(79332),G=i(6837),Y=i(11078),k=i(4087),X=i(93474);class Z extends L.A{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(G.A.CHANGE)}release(){this.state===Y.A.ERROR&&this.setState(Y.A.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==Y.A.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==Y.A.LOADED){t.interimTile=null;break}t.getState()==Y.A.LOADING?e=t:t.getState()==Y.A.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==Y.A.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){(0,k.b0)()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const r=e-i+1e3/60;return r>=this.transition_?1:(0,X.a6)(r/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const W=Z;var D=i(68711),U=i(14837);const V=class extends W{constructor(t,e,i,r,s,n){super(t,e,n),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,null!==r&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=Y.A.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Y.A.ERROR,this.unlistenImage_(),this.image_=function(){const t=(0,D.Y)(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Y.A.LOADED:this.state=Y.A.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==Y.A.ERROR&&(this.state=Y.A.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Y.A.IDLE&&(this.state=Y.A.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=(0,U.f)(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};var q=i(70915),K=i(61597);const B=class{constructor(t,e,i,r,s,n){this.sourceProj_=t,this.targetProj_=e;let o={};const a=(0,d.getTransform)(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return o[e]||(o[e]=a(t)),o[e]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&(0,q.getWidth)(r)>=(0,q.getWidth)(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?(0,q.getWidth)(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?(0,q.getWidth)(this.targetProj_.getExtent()):null;const l=(0,q.getTopLeft)(i),h=(0,q.getTopRight)(i),c=(0,q.getBottomRight)(i),u=(0,q.getBottomLeft)(i),g=this.transformInv_(l),m=this.transformInv_(h),p=this.transformInv_(c),f=this.transformInv_(u),_=10+(n?Math.max(0,Math.ceil(Math.log2((0,q.getArea)(i)/(n*n*256*256)))):0);if(this.addQuad_(l,h,c,u,g,m,p,f,_),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach(function(e,i,r){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])}),this.triangles_.forEach(e=>{if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const r=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-r<this.sourceWorldWidth_/2&&(e.source=i)}})}o={}}addTriangle_(t,e,i,r,s,n){this.triangles_.push({source:[r,s,n],target:[t,e,i]})}addQuad_(t,e,i,r,s,n,o,a,l){const h=(0,q.boundingExtent)([s,n,o,a]),c=this.sourceWorldWidth_?(0,q.getWidth)(h)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&c>.5&&c<1;let g=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const s=(0,q.boundingExtent)([t,e,i,r]);g=(0,q.getWidth)(s)/this.targetWorldWidth_>.25||g}!d&&this.sourceProj_.isGlobal()&&c&&(g=c>.25||g)}if(!g&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!(0,q.intersects)(h,this.maxSourceExtent_))return;let m=0;if(!(g||isFinite(s[0])&&isFinite(s[1])&&isFinite(n[0])&&isFinite(n[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])))if(l>0)g=!0;else if(m=(isFinite(s[0])&&isFinite(s[1])?0:8)+(isFinite(n[0])&&isFinite(n[1])?0:4)+(isFinite(o[0])&&isFinite(o[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1),1!=m&&2!=m&&4!=m&&8!=m)return;if(l>0){if(!g){const e=[(t[0]+i[0])/2,(t[1]+i[1])/2],r=this.transformInv_(e);let n;n=d?((0,K.xP)(s[0],u)+(0,K.xP)(o[0],u))/2-(0,K.xP)(r[0],u):(s[0]+o[0])/2-r[0];const a=(s[1]+o[1])/2-r[1];g=n*n+a*a>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const h=[(e[0]+i[0])/2,(e[1]+i[1])/2],c=this.transformInv_(h),u=[(r[0]+t[0])/2,(r[1]+t[1])/2],d=this.transformInv_(u);this.addQuad_(t,e,h,u,s,n,c,d,l-1),this.addQuad_(u,h,i,r,d,c,o,a,l-1)}else{const h=[(t[0]+e[0])/2,(t[1]+e[1])/2],c=this.transformInv_(h),u=[(i[0]+r[0])/2,(i[1]+r[1])/2],d=this.transformInv_(u);this.addQuad_(t,h,u,r,s,c,d,a,l-1),this.addQuad_(h,e,i,u,c,n,o,d,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}11&m||this.addTriangle_(t,i,r,s,o,a),14&m||this.addTriangle_(t,i,e,s,o,n),m&&(13&m||this.addTriangle_(e,r,t,n,a,s),7&m||this.addTriangle_(e,r,i,n,a,o))}calculateSourceExtent(){const t=(0,q.createEmpty)();return this.triangles_.forEach(function(e,i,r){const s=e.source;(0,q.extendCoordinate)(t,s[0]),(0,q.extendCoordinate)(t,s[1]),(0,q.extendCoordinate)(t,s[2])}),t}getTriangles(){return this.triangles_}};let N;const H=[];function Q(t,e,i,r,s){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(r,s),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,r)+1,Math.max(i,s)),t.restore()}function $(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function J(t,e,i,r){const s=(0,d.transform)(i,e,t);let n=(0,d.getPointResolution)(e,r,i);const o=e.getMetersPerUnit();void 0!==o&&(n*=o);const a=t.getMetersPerUnit();void 0!==a&&(n/=a);const l=t.getExtent();if(!l||(0,q.containsCoordinate)(l,s)){const e=(0,d.getPointResolution)(t,n,s)/n;isFinite(e)&&e>0&&(n/=e)}return n}var tt=i(9438);const et=class extends W{constructor(t,e,i,r,s,n,o,a,l,h,c,u){super(s,Y.A.IDLE,{interpolate:!!u}),this.renderEdges_=void 0!==c&&c,this.pixelRatio_=o,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=n||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const d=r.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const p=g?(0,q.getIntersection)(d,g):d;if(0===(0,q.getArea)(p))return void(this.state=Y.A.EMPTY);const f=t.getExtent();f&&(m=m?(0,q.getIntersection)(m,f):f);const _=r.getResolution(this.wrappedTileCoord_[0]),T=function(t,e,i,r){const s=(0,q.getCenter)(i);let n=J(t,e,s,r);return(!isFinite(n)||n<=0)&&(0,q.forEachCorner)(i,function(i){return n=J(t,e,i,r),isFinite(n)&&n>0}),n}(t,i,p,_);if(!isFinite(T)||T<=0)return void(this.state=Y.A.EMPTY);const x=void 0!==h?h:.5;if(this.triangulation_=new B(t,i,p,m,T*x,_),0===this.triangulation_.getTriangles().length)return void(this.state=Y.A.EMPTY);this.sourceZ_=e.getZForResolution(T);let E=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(E[1]=(0,K.qE)(E[1],m[1],m[3]),E[3]=(0,K.qE)(E[3],m[1],m[3])):E=(0,q.getIntersection)(E,m)),(0,q.getArea)(E)){const t=e.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let e=t.minX;e<=t.maxX;e++)for(let i=t.minY;i<=t.maxY;i++){const t=l(this.sourceZ_,e,i,o);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=Y.A.EMPTY)}else this.state=Y.A.EMPTY}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==Y.A.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,0===t.length)this.state=Y.A.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r="number"==typeof i?i:i[0],s="number"==typeof i?i:i[1],n=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function(t,e,i,r,s,n,o,a,l,h,c,u){const d=(0,D.Y)(Math.round(i*t),Math.round(i*e),H);if(u||(d.imageSmoothingEnabled=!1),0===l.length)return d.canvas;function g(t){return Math.round(t*i)/i}d.scale(i,i),d.globalCompositeOperation="lighter";const m=(0,q.createEmpty)();l.forEach(function(t,e,i){(0,q.extend)(m,t.extent)});const p=(0,q.getWidth)(m),f=(0,q.getHeight)(m),_=(0,D.Y)(Math.round(i*p/r),Math.round(i*f/r),H);u||(_.imageSmoothingEnabled=!1);const T=i/r;l.forEach(function(t,e,i){const r=t.extent[0]-m[0],s=-(t.extent[3]-m[3]),n=(0,q.getWidth)(t.extent),o=(0,q.getHeight)(t.extent);t.image.width>0&&t.image.height>0&&_.drawImage(t.image,h,h,t.image.width-2*h,t.image.height-2*h,r*T,s*T,n*T,o*T)});const x=(0,q.getTopLeft)(o);return a.getTriangles().forEach(function(t,e,s){const o=t.source,a=t.target;let l=o[0][0],h=o[0][1],c=o[1][0],p=o[1][1],f=o[2][0],T=o[2][1];const E=g((a[0][0]-x[0])/n),C=g(-(a[0][1]-x[1])/n),v=g((a[1][0]-x[0])/n),S=g(-(a[1][1]-x[1])/n),R=g((a[2][0]-x[0])/n),F=g(-(a[2][1]-x[1])/n),y=l,w=h;l=0,h=0,c-=y,p-=w,f-=y,T-=w;const P=[[c,p,0,0,v-E],[f,T,0,0,R-E],[0,0,c,p,S-C],[0,0,f,T,F-C]],A=(0,K.KU)(P);if(A){if(d.save(),d.beginPath(),function(){if(void 0===N){const t=(0,D.Y)(6,6,H);t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",Q(t,4,5,4,0),Q(t,4,5,0,5);const e=t.getImageData(0,0,3,3).data;N=$(e,0)||$(e,4)||$(e,8),(0,D.Yg)(t),H.push(t.canvas)}return N}()||!u){d.moveTo(v,S);const t=4,e=E-v,i=C-S;for(let r=0;r<t;r++)d.lineTo(v+g((r+1)*e/t),S+g(r*i/(t-1))),r!=t-1&&d.lineTo(v+g((r+1)*e/t),S+g((r+1)*i/(t-1)));d.lineTo(R,F)}else d.moveTo(v,S),d.lineTo(E,C),d.lineTo(R,F);d.clip(),d.transform(A[0],A[2],A[1],A[3],E,C),d.translate(m[0]-y,m[3]-w),d.scale(r/i,-r/i),d.drawImage(_.canvas,0,0),d.restore()}}),(0,D.Yg)(_),H.push(_.canvas),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(t,e,i){const r=t.target,s=(r[0][0]-x[0])/n,o=-(r[0][1]-x[1])/n,a=(r[1][0]-x[0])/n,l=-(r[1][1]-x[1])/n,h=(r[2][0]-x[0])/n,c=-(r[2][1]-x[1])/n;d.beginPath(),d.moveTo(a,l),d.lineTo(s,o),d.lineTo(h,c),d.closePath(),d.stroke()}),d.restore()),d.canvas}(r,s,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),n,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=Y.A.LOADED}this.changed()}load(){if(this.state==Y.A.IDLE){this.state=Y.A.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const i=e.getState();if(i==Y.A.IDLE||i==Y.A.LOADING){t++;const i=(0,tt.KT)(e,G.A.CHANGE,function(r){const s=e.getState();s!=Y.A.LOADED&&s!=Y.A.ERROR&&s!=Y.A.EMPTY||((0,tt.JH)(i),t--,0===t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,e,i){t.getState()==Y.A.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(tt.JH),this.sourcesListenerKeys_=null}release(){this.canvas_&&((0,D.Yg)(this.canvas_.getContext("2d")),H.push(this.canvas_),this.canvas_=null),super.release()}};class it{constructor(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function rt(t,e,i,r,s){return void 0!==s?(s.minX=t,s.maxX=e,s.minY=i,s.maxY=r,s):new it(t,e,i,r)}const st=it;var nt=i(66514),ot=i(6782);class at extends O.A{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,q.createEmpty)(),this.tmpTileRange_=new st(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),r=e.getUseInterimTilesOnError();return i==Y.A.LOADED||i==Y.A.EMPTY||i==Y.A.ERROR&&!r}getTile(t,e,i,r){const s=r.pixelRatio,n=r.viewState.projection,o=this.getLayer();let a=o.getSource().getTile(t,e,i,s,n);return a.getState()==Y.A.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=(0,_.Bb)(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!(0,q.containsCoordinate)(s,r))return null;const n=e.pixelRatio,o=e.viewState.projection,a=e.viewState,l=i.getRenderSource(),h=l.getTileGridForProjection(a.projection),c=l.getTilePixelRatio(e.pixelRatio);for(let t=h.getZForResolution(a.resolution);t>=h.getMinZoom();--t){const e=h.getTileCoordForCoordAndZ(r,t),i=l.getTile(t,e[1],e[2],n,o);if(!(i instanceof V||i instanceof et)||i instanceof et&&i.getState()===Y.A.EMPTY)return null;if(i.getState()!==Y.A.LOADED)continue;const s=h.getOrigin(t),u=(0,ot.xq)(h.getTileSize(t)),d=h.getResolution(t),g=Math.floor(c*((r[0]-s[0])/d-e[1]*u[0])),m=Math.floor(c*((s[1]-r[1])/d-e[2]*u[1])),p=Math.round(c*l.getGutterForProjection(a.projection));return this.getImageData(i.getImage(),g+p,m+p)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],r=t.viewState,s=r.projection,n=r.resolution,o=r.center,a=r.rotation,l=t.pixelRatio,h=this.getLayer(),c=h.getSource(),u=c.getRevision(),g=c.getTileGridForProjection(s),m=g.getZForResolution(n,c.zDirection),p=g.getResolution(m);let f=t.extent;const T=t.viewState.resolution,x=c.getTilePixelRatio(l),E=Math.round((0,q.getWidth)(f)/T*l),C=Math.round((0,q.getHeight)(f)/T*l),v=i.extent&&(0,d.fromUserExtent)(i.extent,s);v&&(f=(0,q.getIntersection)(f,(0,d.fromUserExtent)(i.extent,s)));const S=p*E/2/x,R=p*C/2/x,F=[o[0]-S,o[1]-R,o[0]+S,o[1]+R],y=g.getTileRangeForExtentAndZ(f,m),w={};w[m]={};const P=this.createLoadedTileFinder(c,s,w),A=this.tmpExtent,z=this.tmpTileRange_;this.newTiles_=!1;const j=a?(0,q.getRotatedViewport)(r.center,T,a,t.size):void 0;for(let e=y.minX;e<=y.maxX;++e)for(let r=y.minY;r<=y.maxY;++r){if(a&&!g.tileCoordIntersectsViewport([m,e,r],j))continue;const s=this.getTile(m,e,r,t);if(this.isDrawableTile(s)){const e=(0,k.v6)(this);if(s.getState()==Y.A.LOADED){w[m][s.tileCoord.toString()]=s;let t=s.inTransition(e);t&&1!==i.opacity&&(s.endTransition(e),t=!1),this.newTiles_||!t&&this.renderedTiles.includes(s)||(this.newTiles_=!0)}if(1===s.getAlpha(e,t.time))continue}const n=g.getTileCoordChildTileRange(s.tileCoord,z,A);let o=!1;n&&(o=P(m+1,n)),o||g.forEachTileCoordParentTileRange(s.tileCoord,P,z,A)}const I=p/n*l/x;(0,_.Zz)(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/l,1/l,a,-E/2,-C/2);const b=(0,_.dI)(this.pixelTransform);this.useContainer(e,b,this.getBackground(t));const M=this.context,O=M.canvas;(0,_.T9)(this.inversePixelTransform,this.pixelTransform),(0,_.Zz)(this.tempTransform,E/2,C/2,I,I,0,-E/2,-C/2),O.width!=E||O.height!=C?(O.width=E,O.height=C):this.containerReused||M.clearRect(0,0,E,C),v&&this.clipUnrotated(M,t,v),c.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,t),this.renderedTiles.length=0;let L,G,X,Z=Object.keys(w).map(Number);Z.sort(nt.V_),1!==i.opacity||this.containerReused&&!c.getOpaque(t.viewState.projection)?(L=[],G=[]):Z=Z.reverse();for(let e=Z.length-1;e>=0;--e){const i=Z[e],r=c.getTilePixelSize(i,l,s),n=g.getResolution(i)/p,o=r[0]*n*I,a=r[1]*n*I,h=g.getTileCoordForCoordAndZ((0,q.getTopLeft)(F),i),u=g.getTileCoordExtent(h),d=(0,_.Bb)(this.tempTransform,[x*(u[0]-F[0])/p,x*(F[3]-u[3])/p]),f=x*c.getGutterForProjection(s),T=w[i];for(const e in T){const r=T[e],s=r.tileCoord,n=h[1]-s[1],l=Math.round(d[0]-(n-1)*o),u=h[2]-s[2],g=Math.round(d[1]-(u-1)*a),p=Math.round(d[0]-n*o),_=Math.round(d[1]-u*a),x=l-p,E=g-_,C=m===i,v=C&&1!==r.getAlpha((0,k.v6)(this),t.time);let S=!1;if(!v)if(L){X=[p,_,p+x,_,p+x,_+E,p,_+E];for(let t=0,e=L.length;t<e;++t)if(m!==i&&i<G[t]){const e=L[t];(0,q.intersects)([p,_,p+x,_+E],[e[0],e[3],e[4],e[7]])&&(S||(M.save(),S=!0),M.beginPath(),M.moveTo(X[0],X[1]),M.lineTo(X[2],X[3]),M.lineTo(X[4],X[5]),M.lineTo(X[6],X[7]),M.moveTo(e[6],e[7]),M.lineTo(e[4],e[5]),M.lineTo(e[2],e[3]),M.lineTo(e[0],e[1]),M.clip())}L.push(X),G.push(i)}else M.clearRect(p,_,x,E);this.drawTileImage(r,t,p,_,x,E,f,C),L&&!v?(S&&M.restore(),this.renderedTiles.unshift(r)):this.renderedTiles.push(r),this.updateUsedTiles(t.usedTiles,c,r)}}return this.renderedRevision=u,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!(0,q.equals)(this.renderedExtent_,F),this.renderedExtent_=F,this.renderedPixelRatio=l,this.renderedProjection=s,this.manageTilePyramid(t,c,g,l,s,f,m,h.getPreload()),this.scheduleExpireCache(t,c),this.postRender(M,t),i.extent&&M.restore(),M.imageSmoothingEnabled=!0,b!==O.style.transform&&(O.style.transform=b),this.container}drawTileImage(t,e,i,r,s,n,o,a){const l=this.getTileImage(t);if(!l)return;const h=(0,k.v6)(this),c=e.layerStatesArray[e.layerIndex],u=c.opacity*(a?t.getAlpha(h,e.time):1),d=u!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(l,o,o,l.width-2*o,l.height-2*o,i,r,s,n),d&&this.context.restore(),u!==c.opacity?e.animate=!0:a&&t.endTransition(h)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(t,e,i){const r=(0,k.v6)(t);r in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[r])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const r=(0,k.v6)(e);r in t||(t[r]={}),t[r][i.getKey()]=!0}manageTilePyramid(t,e,i,r,s,n,o,a,l){const h=(0,k.v6)(e);h in t.wantedTiles||(t.wantedTiles[h]={});const c=t.wantedTiles[h],u=t.tileQueue,d=i.getMinZoom(),g=t.viewState.rotation,m=g?(0,q.getRotatedViewport)(t.viewState.center,t.viewState.resolution,g,t.size):void 0;let p,f,_,T,x,E,C=0;for(E=d;E<=o;++E)for(f=i.getTileRangeForExtentAndZ(n,E,f),_=i.getResolution(E),T=f.minX;T<=f.maxX;++T)for(x=f.minY;x<=f.maxY;++x)g&&!i.tileCoordIntersectsViewport([E,T,x],m)||(o-E<=a?(++C,p=e.getTile(E,T,x,r,s),p.getState()==Y.A.IDLE&&(c[p.getKey()]=!0,u.isKeyQueued(p.getKey())||u.enqueue([p,h,i.getTileCoordCenter(p.tileCoord),_])),void 0!==l&&l(p)):e.useTile(E,T,x,s));e.updateCacheSize(C,s)}}const lt=at,ht=class extends M{constructor(t){super(t)}createRenderer(){return new lt(this)}};var ct=i(90588);const ut=class{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return(0,ct.v)(void 0!==i,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return(0,ct.v)(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){(0,ct.v)(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}};function dt(t,e,i,r){return void 0!==r?(r[0]=t,r[1]=e,r[2]=i,r):[t,e,i]}function gt(t,e,i){return t+"/"+e+"/"+i}function mt(t){return gt(t[0],t[1],t[2])}function pt(t){return(t[1]<<t[0])+t[2]}const ft=class extends ut{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0===this.getCount())return;const t=this.peekFirstKey().split("/").map(Number)[0];this.forEach(e=>{e.tileCoord[0]!==t&&(this.remove(mt(e.tileCoord)),e.release())})}};var _t=i(1685),Tt=i(16444),xt=i(57115),Et=i(4350);const Ct=[0,0,0],vt=class{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,(0,ct.v)((0,nt.WC)(this.resolutions_,function(t,e){return e-t},!0),17),!t.origins)for(let t=0,i=this.resolutions_.length-1;t<i;++t)if(e){if(this.resolutions_[t]/this.resolutions_[t+1]!==e){e=void 0;break}}else e=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,(0,ct.v)(this.origins_.length==this.resolutions_.length,20));const i=t.extent;void 0===i||this.origin_||this.origins_||(this.origin_=(0,q.getTopLeft)(i)),(0,ct.v)(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,(0,ct.v)(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:xt.R,(0,ct.v)(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){const r=new st(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(i){const t=this.getTileRangeForExtentAndZ(i,e);r.minX=Math.max(t.minX,r.minX),r.maxX=Math.min(t.maxX,r.maxX),r.minY=Math.max(t.minY,r.minY),r.maxY=Math.min(t.maxY,r.maxY)}return r},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const r=this.getTileRangeForExtentAndZ(t,e);for(let t=r.minX,s=r.maxX;t<=s;++t)for(let s=r.minY,n=r.maxY;s<=n;++s)i([e,t,s])}forEachTileCoordParentTileRange(t,e,i,r){let s,n,o,a=null,l=t[0]-1;for(2===this.zoomFactor_?(n=t[1],o=t[2]):a=this.getTileCoordExtent(t,r);l>=this.minZoom;){if(2===this.zoomFactor_?(n=Math.floor(n/2),o=Math.floor(o/2),s=rt(n,n,o,o,i)):s=this.getTileRangeForExtentAndZ(a,l,i),e(l,s))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*t[1],r=2*t[2];return rt(i,i+1,r,r+1,e)}const r=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],s=t[1],n=t[2];if(e===r)return rt(s,n,s,n,i);if(this.zoomFactor_){const t=Math.pow(this.zoomFactor_,e-r),o=Math.floor(s*t),a=Math.floor(n*t);return e<r?rt(o,o,a,a,i):rt(o,Math.floor(t*(s+1))-1,a,Math.floor(t*(n+1))-1,i)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Ct);const r=Ct[1],s=Ct[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Ct),rt(r,Ct[1],s,Ct[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=(0,ot.xq)(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=(0,ot.xq)(this.getTileSize(t[0]),this.tmpSize_),n=i[0]+t[1]*s[0]*r,o=i[1]-(t[2]+1)*s[1]*r,a=n+s[0]*r,l=o+s[1]*r;return(0,q.createOrUpdate)(n,o,a,l,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,r,s){const n=this.getZForResolution(i),o=i/this.getResolution(n),a=this.getOrigin(n),l=(0,ot.xq)(this.getTileSize(n),this.tmpSize_);let h=o*(t-a[0])/i/l[0],c=o*(a[1]-e)/i/l[1];return r?(h=(0,K.mk)(h,5)-1,c=(0,K.mk)(c,5)-1):(h=(0,K.RI)(h,5),c=(0,K.RI)(c,5)),dt(n,h,c,s)}getTileCoordForXYAndZ_(t,e,i,r,s){const n=this.getOrigin(i),o=this.getResolution(i),a=(0,ot.xq)(this.getTileSize(i),this.tmpSize_);let l=(t-n[0])/o/a[0],h=(n[1]-e)/o/a[1];return r?(l=(0,K.mk)(l,5)-1,h=(0,K.mk)(h,5)-1):(l=(0,K.RI)(l,5),h=(0,K.RI)(h,5)),dt(i,l,h,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=(0,nt.FT)(this.resolutions_,t,e||0);return(0,K.qE)(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return(0,Et.sj)(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i}};function St(t){let e=t.getDefaultTileGrid();return e||(e=function(t){return function(t,e,i,r){r=void 0!==r?r:"top-left";const s=Rt(t,e,i);return new vt({extent:t,origin:(0,q.getCorner)(t,r),resolutions:s,tileSize:i})}(Ft(t),void 0,void 0,void 0)}(t),t.setDefaultTileGrid(e)),e}function Rt(t,e,i,r){e=void 0!==e?e:xt.L,i=(0,ot.xq)(void 0!==i?i:xt.R);const s=(0,q.getHeight)(t),n=(0,q.getWidth)(t);r=r>0?r:Math.max(n/i[0],s/i[1]);const o=e+1,a=new Array(o);for(let t=0;t<o;++t)a[t]=r/Math.pow(2,t);return a}function Ft(t){let e=(t=(0,d.get)(t)).getExtent();if(!e){const i=180*d.METERS_PER_UNIT.degrees/t.getMetersPerUnit();e=(0,q.createOrUpdate)(-i,-i,i,i)}return e}class yt extends Tt.A{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;this.tileGrid&&(0,ot.xq)(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new ft(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,r){const s=this.getTileCacheForProjection(t);if(!s)return!1;let n,o,a,l=!0;for(let t=i.minX;t<=i.maxX;++t)for(let h=i.minY;h<=i.maxY;++h)o=gt(e,t,h),a=!1,s.containsKey(o)&&(n=s.get(o),a=n.getState()===Y.A.LOADED,a&&(a=!1!==r(n))),a||(l=!1);return l}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,r,s){return(0,k.b0)()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:St(t)}getTileCacheForProjection(t){const e=this.getProjection();return(0,ct.v)(null===e||(0,d.equivalent)(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),n=(0,ot.xq)(r.getTileSize(t),this.tmpSize);return 1==s?n:(0,ot.hs)(n,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function(t,e,i){const r=e[0],s=t.getTileCoordCenter(e),n=Ft(i);if(!(0,q.containsCoordinate)(n,s)){const e=(0,q.getWidth)(n),i=Math.ceil((n[0]-s[0])/e);return s[0]+=e*i,t.getTileCoordForCoordAndZ(s,r)}return e}(i,t,e)),function(t,e){const i=t[0],r=t[1],s=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;const n=e.getFullTileRange(i);return!n||n.containsXY(r,s)}(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,r){}}class wt extends _t.Ay{constructor(t,e){super(t),this.tile=e}}const Pt=yt;function At(t,e){const i=/\{z\}/g,r=/\{x\}/g,s=/\{y\}/g,n=/\{-y\}/g;return function(o,a,l){if(o)return t.replace(i,o[0].toString()).replace(r,o[1].toString()).replace(s,o[2].toString()).replace(n,function(){const t=o[0],i=e.getFullTileRange(t);return(0,ct.v)(i,55),(i.getHeight()-o[2]-1).toString()})}}class zt extends Pt{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===zt.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=(0,k.v6)(e),r=e.getState();let s;r==Y.A.LOADING?(this.tileLoadingKeys_[i]=!0,s="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==Y.A.ERROR?"tileloaderror":r==Y.A.LOADED?"tileloadend":void 0),null!=s&&this.dispatchEvent(new wt(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){const e=function(t){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(t);if(i){const r=i[1].charCodeAt(0),s=i[2].charCodeAt(0);let n;for(n=r;n<=s;++n)e.push(t.replace(i[0],String.fromCharCode(n)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(t),i){const r=parseInt(i[2],10);for(let s=parseInt(i[1],10);s<=r;s++)e.push(t.replace(i[0],s.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){const i=t.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=At(t[s],e);return function(t){return 1===t.length?t[0]:function(e,i,r){if(!e)return;const s=pt(e),n=(0,K.xP)(s,t.length);return t[n](e,i,r)}}(r)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const r=gt(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}const jt=zt;function It(t,e){t.getImage().src=e}const bt=class extends jt{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:It,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:V,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const t in this.tileCacheForProjection){const r=this.tileCacheForProjection[t];r.expireCache(r==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!(0,d.equivalent)(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!(0,d.equivalent)(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||(0,d.equivalent)(e,t)))return this.tileGrid;const i=(0,k.v6)(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=St(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||(0,d.equivalent)(e,t))return this.tileCache;const i=(0,k.v6)(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new ft(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(t,e,i,r,s,n){const o=[t,e,i],a=this.getTileCoordForTileUrlFunction(o,s),l=a?this.tileUrlFunction(a,r,s):void 0,h=new this.tileClass(o,void 0!==l?Y.A.IDLE:Y.A.EMPTY,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=n,h.addEventListener(G.A.CHANGE,this.handleTileChange.bind(this)),h}getTile(t,e,i,r,s){const n=this.getProjection();if(!n||!s||(0,d.equivalent)(n,s))return this.getTileInternal(t,e,i,r,n||s);const o=this.getTileCacheForProjection(s),a=[t,e,i];let l;const h=mt(a);o.containsKey(h)&&(l=o.get(h));const c=this.getKey();if(l&&l.key==c)return l;const u=this.getTileGridForProjection(n),g=this.getTileGridForProjection(s),m=this.getTileCoordForTileUrlFunction(a,s),p=new et(n,u,s,g,a,m,this.getTilePixelRatio(r),this.getGutter(),(t,e,i,r)=>this.getTileInternal(t,e,i,r,n),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return p.key=c,l?(p.interimTile=l,p.refreshInterimChain(),o.replace(h,p)):o.set(h,p),p}getTileInternal(t,e,i,r,s){let n=null;const o=gt(t,e,i),a=this.getKey();if(this.tileCache.containsKey(o)){if(n=this.tileCache.get(o),n.key!=a){const l=n;n=this.createTile_(t,e,i,r,s,a),l.getState()==Y.A.IDLE?n.interimTile=l.interimTile:n.interimTile=l,n.refreshInterimChain(),this.tileCache.replace(o,n)}}else n=this.createTile_(t,e,i,r,s,a),this.tileCache.set(o,n);return n}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(t,e){const i=(0,d.get)(t);if(i){const t=(0,k.v6)(i);t in this.tileGridForProjection||(this.tileGridForProjection[t]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},Mt="1.3.0";function Ot(t,e){const i=[];Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&i.push(t+"="+encodeURIComponent(e[t]))});const r=i.join("&");return t=t.replace(/[?&]$/,""),(t+=t.includes("?")?"&":"?")+r}const Lt=class extends bt{constructor(t){t=t||{};const e=Object.assign({},t.params),i=!("TRANSPARENT"in e)||e.TRANSPARENT;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!i,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=void 0===t.hidpi||t.hidpi,this.tmpExtent_=(0,q.createEmpty)(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,i,r){const s=(0,d.get)(i),n=this.getProjection();let o=this.getTileGrid();o||(o=this.getTileGridForProjection(s));const a=o.getZForResolution(e,this.zDirection),l=o.getTileCoordForCoordAndZ(t,a);if(o.getResolutions().length<=l[0])return;let h=o.getResolution(l[0]),c=o.getTileCoordExtent(l,this.tmpExtent_),u=(0,ot.xq)(o.getTileSize(l[0]),this.tmpSize);const g=this.gutter_;0!==g&&(u=(0,ot.r)(u,g,this.tmpSize),c=(0,q.buffer)(c,h*g,c)),n&&n!==s&&(h=J(n,s,t,h),c=(0,d.transformExtent)(c,s,n),t=(0,d.transform)(t,s,n));const m={SERVICE:"WMS",VERSION:Mt,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(m,this.params_,r);const p=Math.floor((t[0]-c[0])/h),f=Math.floor((c[3]-t[1])/h);return m[this.v13_?"I":"X"]=p,m[this.v13_?"J":"Y"]=f,this.getRequestUrl_(l,u,c,1,n||s,m)}getLegendUrl(t,e){if(void 0===this.urls[0])return;const i={SERVICE:"WMS",VERSION:Mt,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){const t=this.params_.LAYERS;if(Array.isArray(t)&&1!==t.length)return;i.LAYER=t}if(void 0!==t){const e=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i.SCALE=t*e/r}return Object.assign(i,e),Ot(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,i,r,s,n){const o=this.urls;if(!o)return;if(n.WIDTH=e[0],n.HEIGHT=e[1],n[this.v13_?"CRS":"SRS"]=s.getCode(),"STYLES"in this.params_||(n.STYLES=""),1!=r)switch(this.serverType_){case"geoserver":const t=90*r+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+t:n.FORMAT_OPTIONS="dpi:"+t;break;case"mapserver":n.MAP_RESOLUTION=90*r;break;case"carmentaserver":case"qgis":n.DPI=90*r;break;default:(0,ct.v)(!1,52)}const a=s.getAxisOrientation(),l=i;if(this.v13_&&"ne"==a.substr(0,2)){let t;t=i[0],l[0]=i[1],l[1]=t,t=i[2],l[2]=i[3],l[3]=t}let h;return n.BBOX=l.join(","),h=1==o.length?o[0]:o[(0,K.xP)(pt(t),o.length)],Ot(h,n)}getTilePixelRatio(t){return this.hidpi_&&void 0!==this.serverType_?t:1}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||Mt;this.v13_=function(t){const e=(""+t).split("."),i="1.3".split(".");for(let t=0;t<Math.max(e.length,i.length);t++){const r=parseInt(e[t]||"0",10),s=parseInt(i[t]||"0",10);if(r>s)return 1;if(s>r)return-1}return 0}(t)>=0}tileUrlFunction(t,e,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=t[0])return;1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);const s=r.getResolution(t[0]);let n=r.getTileCoordExtent(t,this.tmpExtent_),o=(0,ot.xq)(r.getTileSize(t[0]),this.tmpSize);const a=this.gutter_;0!==a&&(o=(0,ot.r)(o,a,this.tmpSize),n=(0,q.buffer)(n,s*a,n)),1!=e&&(o=(0,ot.hs)(o,e,this.tmpSize));const l={SERVICE:"WMS",VERSION:Mt,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return Object.assign(l,this.params_),this.getRequestUrl_(t,o,n,e,i,l)}};var Gt=i(60942),Yt=i(96079);const kt=class extends bt{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:function(t){const e=t||{},i=e.extent||(0,d.get)("EPSG:3857").getExtent(),r={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Rt(i,e.maxZoom,e.tileSize,e.maxResolution)};return new vt(r)}({extent:Ft(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}},Xt=(t,e,i)=>{const r={WMS:["1.3.0","1.1.1"],WFS:["2.0.2","2.0.0","1.1.0"]}[i];r.reverse();const s=r.indexOf(t);if(-1===s)return!1;const n=r.indexOf(e);return-1!==n&&s<n},Zt=async t=>{let e;return(t=>"WMS"===t.type)(t)?e=(t=>{const{url:e,layersParam:i,version:r,attribution:s}=t;return new ht({source:new Lt({url:e,params:{LAYERS:i,VERSION:r},attributions:s})})})(t):(t=>"WFS"===t.type)(t)?e=await(async t=>{var e;const{url:i,typeName:r,maxFeatures:s,version:n="1.1.0",style:o,attribution:a}=t,l=new m.default({format:new g.default,attributions:a,url:t=>{const e=new URL(i),o=e.searchParams;o.append("service","wfs"),o.append("request","GetFeature"),o.append("outputFormat","application/json"),o.append("srsName","EPSG:3857"),o.append("version",n);let a="typeNames";if(Xt(n,"2.0.0","WFS")&&(a="typeName"),o.append(a,r),o.append("bbox",t.join(",")),s){let t="count";Xt(n,"2.0.0","WFS")&&(t="maxFeatures"),o.append(t,s.toString())}return e.toString()},strategy:Gt.Qk});let h;if(o){const t=new(z());if(h=await t.writeStyle(o),h.errors)return void console.warn("Could not create ol-style",h.errors)}return new Yt.default({source:l,style:null==(e=h)?void 0:e.output})})(t):(t=>"XYZ"===t.type)(t)?e=(t=>{const{url:e,attribution:i}=t;return new ht({source:new kt({url:e,attributions:i})})})(t):console.warn("Provided layerconfig is not recognized"),e},Wt=t=>{const{height:e,width:i,mapId:n,olMap:o,chartConfigs:a,chartSize:f,chartVizType:_,layerConfigs:T,mapView:x,chartBackgroundColor:E,chartBackgroundBorderRadius:C,setControlValue:v,theme:S}=t,R=(0,h.d4)(t=>{var e;return null==t||null==(e=t.common)?void 0:e.locale}),[F,w]=(0,s.useState)(a),[A,z]=(0,s.useState)(x);return(0,s.useEffect)(()=>{o.setTarget(n)},[o,n]),(0,s.useEffect)(()=>{o.updateSize()},[o,i,e]),(0,s.useEffect)(()=>{w(t=>y(a,t)?t:a)},[a]),(0,s.useEffect)(()=>{z(t=>{const e=t.fixedZoom===x.fixedZoom,i=t.fixedLongitude===x.fixedLongitude,r=t.fixedLatitude===x.fixedLatitude,s=t.mode===x.mode;return e&&i&&r&&s?t:x})},[x]),(0,s.useEffect)(()=>{const t=o.getView(),{mode:e,fixedLatitude:i,fixedLongitude:r,fixedZoom:s}=x;switch(e){case"CUSTOM":{const e=new c.default([r,i]);e.transform("EPSG:4326","EPSG:3857"),t.setZoom(s),t.setCenter(e.getCoordinates());break}default:{((t,e)=>{const i=t.getView(),r=(t=>{if(0===t.length)return;const e=new m.default;return e.addFeatures(t),e.getExtent()})((new g.default).readFeatures(e,{featureProjection:"EPSG:3857"}))||p;i.fit(r,{size:[250,250]})})(o,a);const e=t.getZoom(),i=t.getCenter();if(!i)return;const r=new c.default(i);r.transform("EPSG:3857","EPSG:4326");const[s,n]=r.getCoordinates();v("map_view",{...x,zoom:e,longitude:s,latitude:n,fixedLatitude:n,fixedLongitude:s,fixedZoom:e});break}}},[]),(0,s.useEffect)(()=>{o.getLayers().getArray().filter(t=>!(t instanceof P)).forEach(t=>{o.removeLayer(t)}),(async t=>{const e=t.map(Zt);(await Promise.allSettled(e)).forEach((e,i)=>{"fulfilled"===e.status&&e.value?o.getLayers().insertAt(0,e.value):console.warn(`Layer could not be created: ${t[i]}`)})})(T)},[o,T]),(0,s.useEffect)(()=>{const{fixedLatitude:t,fixedLongitude:e,fixedZoom:i}=A,r=o.getView(),s=function(t,e=100){let i;return function(...r){clearTimeout(i),i=window.setTimeout(()=>t.apply(this,r),e)}}(r=>{(r=>{const s=r.target,n=s.getCenter(),o=s.getZoom();if(!n)return;const[a,l]=(0,d.toLonLat)(n);v("map_view",{...A,zoom:o,longitude:a,latitude:l,fixedLatitude:t,fixedLongitude:e,fixedZoom:i})})(r)}),n=r.on("change",s);return()=>{(0,u.e)(n)}},[o,v,A,F]),(0,s.useEffect)(()=>{if("FIT_DATA"===A.mode){const t=o.getLayers().getArray().find(t=>t instanceof P);if(!t)return;const e=t.getExtent();if(!e)return;o.getView().fit(e,{size:[250,250]})}},[o,A.mode]),(0,s.useEffect)(()=>{const t=o.getView(),e=l()(t=>{(t=>{const e=t.target.getZoom();if(!e)return;const i=Math.round(f.configs.zoom),r=Math.round(e);if(i===r)return;const s={...f,configs:{...f.configs,zoom:r}};v("chart_size",s)})(t)},100),i=t.on("change:resolution",e);return()=>{(0,u.e)(i)}},[o,v,f]),(0,s.useEffect)(()=>{const t=o.getLayers(),e=t.getArray().find(t=>t instanceof P),{r:i,g:r,b:s,a:n}=E,a=`rgba(${i}, ${r}, ${s}, ${n})`;if(e){let t=!1;_!==e.chartVizType&&(e.setChartVizType(_,!0),t=!0),y(F,e.chartConfigs)||(e.setChartConfig(F,!0),t=!0),e.setChartBackgroundBorderRadius(C,!0),e.setChartBackgroundCssColor(a,!0),e.setChartSizeValues(f.values,!0),t&&e.removeAllChartElements(),e.changed()}else{t.forEach(t=>{t instanceof P&&(t.removeAllChartElements(),o.removeLayer(t))});const e=()=>{o.getInteractions().forEach(t=>{t.setActive(!1)})},i=()=>{o.getInteractions().forEach(t=>{t.setActive(!0)})},r=new P({name:"openlayers-chart-layer",chartConfigs:F,chartVizType:_,chartSizeValues:f.values,chartBackgroundCssColor:a,chartBackgroundBorderRadius:C,onMouseOver:e,onMouseOut:i,theme:S,locale:R});o.addLayer(r)}},[o,S,F,_,f.values,E,C,R]),(0,r.Y)("div",{id:n,style:{height:`${e}px`,width:`${i}px`}})};i(44089);const Dt=n.I4.div`
  height: ${({height:t})=>t}px;
  width: ${({width:t})=>t}px;
`;function Ut(t){const{height:e,width:i}=t,a=(0,n.DP)(),l=(0,s.createRef)(),[h]=(0,s.useState)(`cartodiagram-plugin-${Math.floor(1e6*Math.random())}`),[c]=(0,s.useState)(new o.default({}));return(0,r.Y)(Dt,{ref:l,height:e,width:i,theme:a,children:(0,r.Y)(Wt,{mapId:h,olMap:c,...t})})}}}]);