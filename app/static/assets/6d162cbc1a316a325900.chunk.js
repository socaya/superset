"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3405],{832:(t,e,a)=>{a.d(e,{c:()=>k,y:()=>C});var o=a(2404),r=a.n(o),l=a(2445),i=a(24002),n=a(67413),s=a(35942),c=a(14503),d=a(28027),u=a(50871),p=a(98456),f=a(48238),h=a(92123),m=a(51316),g=a(20605);const{getScale:_}=c;function b(t,e){const a=t.color_picker||{r:0,g:0,b:0,a:1},o=[a.r,a.g,a.b,255*a.a],r=t.color_scheme,l=_(r);let i={};return t.color_scheme_type===h.wP.color_breakpoints?i=(0,m.BK)(t.color_breakpoints):e.forEach(e=>{if(null!=e.cat_color&&!i.hasOwnProperty(e.cat_color)){let r;r=t.dimension?(0,u.hexToRGB)(l(e.cat_color,t.sliceId),255*a.a):o,i[e.cat_color]={color:r,enabled:!0}}}),i}const y=t=>{const e=(0,i.useRef)(null),a=(0,i.useCallback)(()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,f.A)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e},[t]),[o,r]=(0,i.useState)(b(t.formData,t.payload.data.features||[])),[n,c]=(0,i.useState)(t.payload.form_data),[m,y]=(0,i.useState)(a());(0,i.useEffect)(()=>{if(t.payload.form_data!==n){const e=t.payload.data.features||[],o=b(t.formData,e);y(a()),c(t.payload.form_data),r(o)}},[a,t,n]);const w=(0,i.useCallback)(t=>{const{current:a}=e;a&&a.setTooltip(t)},[]),C=(0,i.useCallback)((t,e,a)=>{const o=e.color_scheme,r=_(o);let l;switch(a){case h.wP.fixed_color:{l=e.color_picker||{r:0,g:0,b:0,a:100};const a=[l.r,l.g,l.b,255*l.a];return t.map(t=>({...t,color:a}))}case h.wP.categorical_palette:if(!e.dimension){const a=e.color_picker||{r:0,g:0,b:0,a:100},o=[a.r,a.g,a.b,255*a.a];return t.map(t=>({...t,color:o}))}return t.map(t=>({...t,color:(0,u.hexToRGB)(r(t.cat_color,e.slice_id))}));case h.wP.color_breakpoints:{const a=e.default_breakpoint_color?[e.default_breakpoint_color.r,e.default_breakpoint_color.g,e.default_breakpoint_color.b,255*e.default_breakpoint_color.a]:[g.DL.r,g.DL.g,g.DL.b,255*g.DL.a];return t.map(t=>{var o;const r=null==(o=e.color_breakpoints)?void 0:o.find(e=>t.metric>=e.minValue&&t.metric<=e.maxValue);if(r){const e=[r.color.r,r.color.g,r.color.b,255*r.color.a];return{...t,color:e}}return{...t,color:a}})}default:return[]}},[]),k=(0,i.useCallback)(()=>{const{getLayer:e,getHighlightLayer:a,payload:r,formData:l,onAddFilter:i,onContextMenu:n,filterState:s,setDataMask:c,emitCrossFilters:d}=t;let u=r.data.features?[...r.data.features]:[];const f=l.color_scheme_type;u=C(u,l,f),l.js_data_mutator&&(u=(0,p.A)(l.js_data_mutator)(u)),l.dimension&&(u=u.filter(t=>{var e;return null==(e=o[t.cat_color])?void 0:e.enabled}));const h={formData:l,payload:{...r,data:{...r.data,features:u}},onAddFilter:i,setTooltip:w,datasource:t.datasource,onContextMenu:n,filterState:s,setDataMask:c,emitCrossFilters:d},m=e(h);return d&&null!=s&&s.value&&a?[m,a(h)]:[m]},[C,o,t,w]),D=(0,i.useCallback)(t=>{const e=o[t],a={...o,[t]:{...e,enabled:!e.enabled}};Object.values(a).every(t=>!t.enabled)&&Object.values(a).forEach(t=>{t.enabled=!0}),r(a)},[o]),v=(0,i.useCallback)(t=>{const e={...o};Object.values(e).forEach(t=>{t.enabled=!1}),e[t].enabled=!0,r(e)},[o]);return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(s.S,{ref:e,viewport:m,layers:k(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,l.Y)(d.A,{forceCategorical:!0,categories:o,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:v,toggleCategory:D})]})},w=(0,i.memo)(y);function C(t,e,a){return(0,i.memo)(o=>{const c=(0,i.useRef)(),u=(0,n.Z)(o.formData),p=(0,n.Z)(o.filterState),h=(0,n.Z)(o.payload),[g,_]=(0,i.useState)((0,m.BK)(o.formData.color_breakpoints)||[]),[b,y]=(0,i.useState)((()=>{const{width:t,height:a,formData:r}=o;return r.autozoom?(0,f.A)(o.viewport,{width:t,height:a,points:e(o.payload.data.features)}):o.viewport})()),w=(0,i.useCallback)(t=>{const{current:e}=c;e&&(null==e||e.setTooltip(t))},[]),C=(0,i.useCallback)(e=>{const{formData:o,payload:r,onAddFilter:l,filterState:i,setDataMask:n,onContextMenu:s,emitCrossFilters:c}=e,d={formData:o,payload:r,onAddFilter:l,setTooltip:w,setDataMask:n,onContextMenu:s,filterState:i,emitCrossFilters:c},u=t(d);return c&&null!=i&&i.value&&a?[u,a(d)]:[u]},[w]);(0,i.useEffect)(()=>{const t=(0,m.BK)(o.formData.color_breakpoints);_(t)},[o]);const[k,D]=(0,i.useState)(C(o));(0,i.useEffect)(()=>{const t={...u,...p,viewport:null},e={...o.formData,...o.filterState,viewport:null};r()(t,e)&&h===o.payload||D(C(o))},[C,u,p,h,o]);const{formData:v,payload:S,setControlValue:A,height:x,width:F}=o;return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(s.S,{ref:c,mapboxApiAccessToken:S.data.mapboxApiKey,viewport:b,layers:k,mapStyle:v.mapbox_style,setControlValue:A,width:F,height:x,onViewportChange:y}),(0,l.Y)(d.A,{forceCategorical:!0,categories:g,format:o.formData.legend_format,position:o.formData.legend_position})]})})}function k(t,e,a){return function(o){const{datasource:r,formData:i,height:n,payload:s,setControlValue:c,viewport:d,width:u,setDataMask:p,filterState:f,onContextMenu:h,emitCrossFilters:m}=o;return(0,l.Y)(w,{datasource:r,formData:i,mapboxApiKey:s.data.mapboxApiKey,setControlValue:c,viewport:d,getLayer:t,getHighlightLayer:a,payload:s,getPoints:e,width:u,height:n,setDataMask:p,onContextMenu:h,filterState:f,emitCrossFilters:m})}}},93405:(t,e,a)=>{a.r(e),a.d(e,{default:()=>h,getHighlightLayer:()=>f,getLayer:()=>u,getPoints:()=>p});var o=a(2445),r=a(23096),l=a(83860),i=a(98456),n=a(832),s=a(42828),c=a(51316);function d(t){return(0,s.j1)(t,t=>(0,o.FD)("div",{className:"deckgl-tooltip",children:[s.EO.position(t),s.EO.category(t)]}))}const u=function({formData:t,payload:e,onContextMenu:a,filterState:o,setDataMask:n,setTooltip:s,emitCrossFilters:c}){const u=t,p=u.color_picker,f=[p.r,p.g,p.b,255*p.a];let h=e.data.features.map(t=>({...t,path:t.path,width:u.line_width,color:f}));return u.js_data_mutator&&(h=(0,i.A)(u.js_data_mutator)(h)),new r.A({id:`path-layer-${u.slice_id}`,getColor:t=>t.color,getPath:t=>t.path,getWidth:t=>t.width,data:h,rounded:!0,widthScale:1,widthUnits:u.line_width_unit,...(0,l.T$)({formData:u,setTooltip:s,setTooltipContent:d(u),setDataMask:n,filterState:o,onContextMenu:a,emitCrossFilters:c}),opacity:null!=o&&o.value?.3:1})};function p(t){let e=[];return t.forEach(t=>{e=e.concat(t.path)}),e}const f=function({formData:t,payload:e,filterState:a}){const o=t,l=c.Fe;let n=e.data.features.map(t=>({...t,path:t.path,width:o.line_width,color:l}));o.js_data_mutator&&(n=(0,i.A)(o.js_data_mutator)(n));const s=n.filter(t=>JSON.stringify(t.path).replaceAll(" ","")===(null==a?void 0:a.value[0]));return new r.A({id:`path-highlight-layer-${o.slice_id}`,getColor:()=>c.Fe,getPath:t=>t.path,getWidth:t=>t.width,data:s,rounded:!0,widthScale:1,widthUnits:o.line_width_unit})},h=(0,n.y)(u,p,f)}}]);