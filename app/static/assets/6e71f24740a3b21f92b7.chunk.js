"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1437],{20033:(e,t,n)=>{n.d(t,{wv:()=>d,x9:()=>h});var i=n(62193),a=n.n(i),r=n(58561),l=n.n(r),s=n(90924),o=n(79378),c=n(59744);const d=" : ",u=(e,t)=>`${e}${d}${t}`,p=(e,t)=>e.replace("T00:00:00","")||(t?"-∞":"∞"),m=(e,t="col")=>{const n=e.split(d);return 1===n.length?e:`${p(n[0],!0)} ≤ ${t} < ${p(n[1])}`},h=async(e,t="col",n)=>{let i,r;if(a()(n))i=l().encode_uri(e),r=`/api/v1/time_range/?q=${i}`;else{const t=(0,s.A)(n).map(t=>({timeRange:e,shift:t}));i=l().encode_uri([{timeRange:e},...t]),r=`/api/v1/time_range/?q=${i}`}try{var h;const e=await o.A.get({endpoint:r});if(a()(n)){var g,b;const n=u((null==e||null==(g=e.json)||null==(g=g.result[0])?void 0:g.since)||"",(null==e||null==(b=e.json)||null==(b=b.result[0])?void 0:b.until)||"");return{value:m(n,t)}}const i=null==e||null==(h=e.json)?void 0:h.result.map(e=>u(e.since,e.until));return{value:i.slice(1).map(e=>((e,t,n="col")=>{const i=e.split(d),a=t.split(d);return`${n}: ${p(i[0],!0)} to ${p(i[1])} vs\n  ${p(a[0],!0)} to ${p(a[1])}`})(i[0],e,t))}}catch(e){const t=await(0,c.h4)(e);return{error:t.message||t.error||e.statusText}}}},39242:(e,t,n)=>{n.d(t,{t:()=>h});var i=n(20033);const a=String.raw`\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?(?:(?:[+-]\d\d:\d\d)|Z)?`,r=String.raw`(?:TODAY|NOW)`,l=String.raw`[+-]?[1-9][0-9]*`,s=String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`,o=RegExp(String.raw`^DATEADD\(DATETIME\("(${a}|${r})"\),\s(${l}),\s(${s})\)$`,"i"),c=RegExp(String.raw`^${a}$|^${r}$`,"i"),d=["now","today"],u=new Date;u.setHours(0,0,0,0);const p=new Date;p.setHours(0,0,0,0);const m={sinceDatetime:u.setDate(u.getDate()-7).toString(),sinceMode:"relative",sinceGrain:"day",sinceGrainValue:-7,untilDatetime:p.toString(),untilMode:"specific",untilGrain:"day",untilGrainValue:7,anchorMode:"now",anchorValue:"now"},h=e=>{const t=e.split(i.wv);if(2===t.length){const[e,n]=t;if(c.test(e)&&c.test(n)){const t=d.includes(e)?e:"specific",i=d.includes(n)?n:"specific";return{customRange:{...m,sinceDatetime:e,untilDatetime:n,sinceMode:t,untilMode:i},matchedFlag:!0}}const i=e.match(o);if(i&&c.test(n)&&e.includes(n)){const[e,t,a]=i.slice(1),r=d.includes(n)?n:"specific";return{customRange:{...m,sinceGrain:a,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilDatetime:e,sinceMode:"relative",untilMode:r},matchedFlag:!0}}const a=n.match(o);if(c.test(e)&&a&&n.includes(e)){const[t,n,i]=[...a.slice(1)],r=d.includes(e)?e:"specific";return{customRange:{...m,untilGrain:i,untilGrainValue:parseInt(n,10),sinceDatetime:t,untilDatetime:t,untilMode:"relative",sinceMode:r},matchedFlag:!0}}if(i&&a){const[e,t,n]=[...i.slice(1)],[r,l,s]=[...a.slice(1)];if(e===r)return{customRange:{...m,sinceGrain:n,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilGrain:s,untilGrainValue:parseInt(l,10),untilDatetime:r,anchorValue:e,sinceMode:"relative",untilMode:"relative",anchorMode:"now"===e?"now":"specific"},matchedFlag:!0}}}return{customRange:m,matchedFlag:!1}}},39591:(e,t,n)=>{n.d(t,{A:()=>r,P:()=>a});var i=n(24002);const a={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"},r=({isVertical:e,isHorizontal:t}={isVertical:!1,isHorizontal:!0})=>{const[n,a]=(0,i.useState)(!0),r=(0,i.useRef)(null),[l,s]=(0,i.useState)(0),[o,c]=(0,i.useState)(0),[d,u]=(0,i.useState)(0),[p,m]=(0,i.useState)(0);return(0,i.useEffect)(()=>{var e,t,n,i,a,l,o,d;s(null!=(e=null==(t=r.current)?void 0:t.offsetWidth)?e:0),c(null!=(n=null==(i=r.current)?void 0:i.scrollWidth)?n:0),u(null!=(a=null==(l=r.current)?void 0:l.offsetHeight)?a:0),m(null!=(o=null==(d=r.current)?void 0:d.scrollHeight)?o:0)}),(0,i.useEffect)(()=>{a(e&&d<p||t&&l<o)},[l,o,d,p,e,t]),[r,n]}},46506:(e,t,n)=>{n.d(t,{A:()=>u});var i=n(2445),a=n(74098),r=n(17437),l=n(81465),s=n(95018),o=n(8558),c=n(96611);function d(e,t,n){switch(e){case c.Or.Working:return n.colorPrimaryText;case c.Or.Error:return n.colorErrorText;case c.Or.Success:case c.Or.Noop:return n.colorSuccessText;case c.Or.Grace:return n.colorErrorText;default:return n.colorText}}function u({state:e,isReportEnabled:t=!1}){const n=(0,l.DP)(),u={icon:o.F.CheckOutlined,label:"",status:""};switch(e){case c.Or.Success:u.icon=o.F.CheckOutlined,u.label=t?(0,a.t)("Report sent"):(0,a.t)("Alert triggered, notification sent"),u.status=c.Or.Success;break;case c.Or.Working:u.icon=o.F.Running,u.label=t?(0,a.t)("Report sending"):(0,a.t)("Alert running"),u.status=c.Or.Working;break;case c.Or.Error:u.icon=o.F.CloseOutlined,u.label=t?(0,a.t)("Report failed"):(0,a.t)("Alert failed"),u.status=c.Or.Error;break;case c.Or.Noop:u.icon=o.F.CheckOutlined,u.label=(0,a.t)("Nothing triggered"),u.status=c.Or.Noop;break;case c.Or.Grace:u.icon=o.F.WarningOutlined,u.label=(0,a.t)("Alert Triggered, In Grace Period"),u.status=c.Or.Grace;break;default:u.icon=o.F.CheckOutlined,u.label=(0,a.t)("Nothing triggered"),u.status=c.Or.Noop}const p=u.icon,m=e===c.Or.Working;return(0,i.Y)(s.m,{title:u.label,placement:"bottomLeft",children:(0,i.Y)("span",{css:m?r.AH`
                display: inline-flex;
                align-items: center;
                justify-content: center;
                transform: scale(1.8);
              `:void 0,children:(0,i.Y)(p,{iconSize:"m",iconColor:d(u.status,0,n)})})})}},63084:(e,t,n)=>{n.r(t),n.d(t,{default:()=>G});var i=n(2445),a=n(24002),r=n(61574),l=n(1763),s=n(74098),o=n(10992),c=n(81465),d=n(17437),u=n(79378),p=n(59674),m=n(95018),h=(n(53581),n(98720),n(8558));p.XV.updateLocale("en",{calendar:{lastDay:"[Yesterday at] LTS",sameDay:"[Today at] LTS",nextDay:"[Tomorrow at] LTS",lastWeek:"[last] dddd [at] LTS",nextWeek:"dddd [at] LTS",sameElse:"L"}});const g=c.I4.span`
  color: ${({theme:e})=>e.colorText};
`,b=({updatedAt:e,update:t})=>{const n=(0,c.DP)(),[r,l]=(0,a.useState)((0,p.XV)(e));return(0,a.useEffect)(()=>{l(()=>(0,p.XV)(e));const t=setInterval(()=>{l(()=>(0,p.XV)(e))},6e4);return()=>clearInterval(t)},[e]),(0,i.FD)(g,{children:[(0,s.t)("Last Updated %s",r.isValid()?r.calendar():"--"),t&&(0,i.Y)(h.F.SyncOutlined,{css:d.AH`
            margin-left: ${2*n.sizeUnit}px;
          `,onClick:t})]})};var f=n(94551),w=n(38961),v=n(9876),y=n(20237),S=n(29645),O=n(85923),k=n(64457),A=n(46506),D=n(96611);const E=e=>d.AH`
  color: ${e.colorIcon};
  margin-right: ${2*e.sizeUnit}px;
  vertical-align: middle;
`;function T({type:e}){const t={icon:null,label:""};switch(e){case D.yV.Email:t.icon=(0,i.Y)(h.F.MailOutlined,{css:E,iconSize:"l"}),t.label=D.yV.Email;break;case D.yV.Slack:case D.yV.SlackV2:t.icon=(0,i.Y)(h.F.SlackOutlined,{css:E,iconSize:"l"}),t.label=D.yV.Slack;break;default:t.icon=null,t.label=""}return t.icon?(0,i.Y)(m.m,{title:t.label,placement:"bottom",children:t.icon}):null}var $=n(86784),C=n(71323),R=n(47305),x=n(70023),_=n(79605),z=n(66124);const Y=(0,l.a)(),F={[D.Or.Success]:(0,s.t)("Success"),[D.Or.Working]:(0,s.t)("Working"),[D.Or.Error]:(0,s.t)("Error"),[D.Or.Noop]:(0,s.t)("Not triggered"),[D.Or.Grace]:(0,s.t)("On Grace")},H=(0,o.A)({requestType:"rison",method:"DELETE",endpoint:"/api/v1/report/"}),M=c.I4.div`
  ${({theme:e})=>d.AH`
    margin-top: ${e.sizeUnit}px;
    width: 100%;
    padding: ${2*e.sizeUnit}px 0px ${3*e.sizeUnit}px;
  `}
`,V=c.I4.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  > *:first-child {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,N=Y.get("alertsreports.header.icon"),G=(0,k.Ay)(function({addDangerToast:e,isReportEnabled:t=!1,user:n,addSuccessToast:l}){const o=t?(0,s.t)("Report"):(0,s.t)("Alert"),c=t?(0,s.t)("reports"):(0,s.t)("alerts"),d=t?"Reports":"Alerts",g=(0,a.useMemo)(()=>[{id:"type",operator:v.c0.Equals,value:t?"Report":"Alert"}],[t]),{state:{loading:k,resourceCount:E,resourceCollection:Y,bulkSelectEnabled:G,lastFetched:W},hasPerm:L,fetchData:I,setResourceCollection:U,refreshData:B,toggleBulkSelect:P}=(0,$.RU)("report",(0,s.t)("report"),e,!0,void 0,g),{updateResource:j}=(0,$.fn)("report",(0,s.t)("reports"),e),[q,X]=(0,a.useState)(!1),[J,K]=(0,a.useState)(null),[Q,Z]=(0,a.useState)(null);function ee(e){K(e),X(!0)}const te=L("can_write"),ne=L("can_write"),ie=L("can_write");(0,a.useEffect)(()=>{G&&ne&&P()},[t]);const ae=[{id:"name",desc:!0}],re=(0,a.useCallback)((e,t)=>{if(null!=e&&e.id){const n=e.id,i=[...Y];U(i.map(n=>(null==n?void 0:n.id)===e.id?{...n,active:t}:n)),j(n,{active:t},!1,!1).then().catch(()=>U(i))}},[Y,U,j]),le=(0,a.useMemo)(()=>[{Cell:({row:{original:{last_state:e}}})=>(0,i.Y)(A.A,{state:e,isReportEnabled:t}),accessor:"last_state",size:"xs",disableSortBy:!0,id:"last_state"},{Cell:({row:{original:{last_eval_dttm:e}}})=>e?p.XV.utc(e).local().format(O.QU):"",accessor:"last_eval_dttm",Header:(0,s.t)("Last run"),size:"lg",id:"last_eval_dttm"},{accessor:"name",Header:(0,s.t)("Name"),size:"xxl",id:"name"},{Header:(0,s.t)("Schedule"),accessor:"crontab_humanized",size:"xl",Cell:({row:{original:{crontab_humanized:e="",timezone:t}}})=>(0,i.Y)(m.m,{title:`${e} (${t})`,placement:"topLeft",children:(0,i.Y)("span",{children:`${e} (${t})`})}),id:"crontab_humanized"},{Cell:({row:{original:{recipients:e}}})=>e.map(e=>(0,i.Y)(T,{type:e.type},e.id)),accessor:"recipients",Header:(0,s.t)("Notification method"),disableSortBy:!0,size:"lg",id:"recipients"},{Cell:({row:{original:{owners:e=[]}}})=>(0,i.Y)(v.WM,{users:e}),Header:(0,s.t)("Owners"),id:"owners",disableSortBy:!0,size:"xl"},{Cell:({row:{original:{changed_on_delta_humanized:e,changed_by:t}}})=>(0,i.Y)(v.UW,{date:e,user:t}),Header:(0,s.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",id:"changed_on_delta_humanized"},{Cell:({row:{original:e}})=>{const t=e.owners.map(e=>e.id).includes(n.userId)||(0,R.N6)(n);return(0,i.Y)(S.Switch,{disabled:!t,checked:e.active,onClick:t=>re(e,t),size:"small"})},Header:(0,s.t)("Active"),accessor:"active",id:"active",size:"sm"},{Cell:({row:{original:e}})=>{const t=(0,r.W6)(),a=e.owners.map(e=>e.id).includes(n.userId)||(0,R.N6)(n),l=[te?{label:"execution-log-action",tooltip:(0,s.t)("Execution log"),placement:"bottom",icon:"FileTextOutlined",onClick:()=>t.push(`/${e.type.toLowerCase()}/${e.id}/log`)}:null,te?{label:a?"edit-action":"preview-action",tooltip:a?(0,s.t)("Edit"):(0,s.t)("View"),placement:"bottom",icon:a?"EditOutlined":"Binoculars",onClick:()=>ee(e)}:null,a&&ne?{label:"delete-action",tooltip:(0,s.t)("Delete"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>Z(e)}:null].filter(e=>null!==e);return(0,i.Y)(v.kv,{actions:l})},Header:(0,s.t)("Actions"),id:"actions",hidden:!te&&!ne,disableSortBy:!0,size:"lg"},{accessor:_.H.ChangedBy,hidden:!0,id:_.H.ChangedBy}],[ne,te,t,re]),se=[];ne&&se.push({name:(0,s.t)("Bulk select"),onClick:P,buttonStyle:"secondary"}),ie&&se.push({icon:(0,i.Y)(h.F.PlusOutlined,{iconSize:"m"}),name:(0,s.t)(o),buttonStyle:"primary",onClick:()=>{ee(null)}});const oe={title:(0,s.t)("No %s yet",c),image:"filter-results.svg",buttonAction:()=>ee(null),buttonText:ie?(0,i.FD)(i.FK,{children:[(0,i.Y)(h.F.PlusOutlined,{iconSize:"m"}),o," "]}):null},ce=(0,a.useMemo)(()=>[{Header:(0,s.t)("Name"),key:"search",id:"name",input:"search",operator:v.c0.Contains},{Header:(0,s.t)("Owner"),key:"owner",id:"owners",input:"select",operator:v.c0.RelationManyMany,unfilteredLabel:(0,s.t)("All"),fetchSelects:(0,C.u1)("report","owners",(0,C.JF)(e=>(0,s.t)("An error occurred while fetching owners values: %s",e)),n),paginate:!0,dropdownStyle:{minWidth:z.f8}},{Header:(0,s.t)("Status"),key:"status",id:"last_state",input:"select",operator:v.c0.Equals,unfilteredLabel:"Any",selects:[{label:F[D.Or.Success],value:D.Or.Success},{label:F[D.Or.Working],value:D.Or.Working},{label:F[D.Or.Error],value:D.Or.Error},{label:F[D.Or.Noop],value:D.Or.Noop},{label:F[D.Or.Grace],value:D.Or.Grace}]},{Header:(0,s.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:v.c0.RelationOneMany,unfilteredLabel:(0,s.t)("All"),fetchSelects:(0,C.u1)("report","changed_by",(0,C.JF)(e=>(0,s.t)("An error occurred while fetching dataset datasource values: %s",e)),n),paginate:!0,dropdownStyle:{minWidth:z.f8}}],[]),de=N?(0,i.FD)(V,{children:[(0,i.Y)("div",{children:(0,s.t)("Alerts & reports")}),(0,i.Y)(N,{})]}):(0,s.t)("Alerts & reports");return(0,i.FD)(i.FK,{children:[(0,i.Y)(y.A,{activeChild:d,name:de,tabs:[{name:"Alerts",label:(0,s.t)("Alerts"),url:"/alert/list/",usesRouter:!0,id:"alert-tab","aria-controls":"alert-list"},{name:"Reports",label:(0,s.t)("Reports"),url:"/report/list/",usesRouter:!0,id:"report-tab","aria-controls":"report-list"}],buttons:se,children:(0,i.Y)(M,{children:(0,i.Y)(b,{updatedAt:W,update:()=>B()})})}),(0,i.Y)(x.Ay,{alert:J,addDangerToast:e,layer:J,onHide:()=>{X(!1),K(null),B()},show:q,isReport:t},(null==J?void 0:J.id)||`${(new Date).getTime()}`),Q&&(0,i.Y)(f.T,{description:(0,s.t)("This action will permanently delete %s.",Q.name),onConfirm:()=>{Q&&(({id:t,name:n})=>{u.A.delete({endpoint:`/api/v1/report/${t}`}).then(()=>{B(),Z(null),l((0,s.t)("Deleted: %s",n))},(0,C.JF)(t=>e((0,s.t)("There was an issue deleting %s: %s",n,t))))})(Q)},onHide:()=>Z(null),open:!0,title:(0,s.t)("Delete %s?",o)}),(0,i.Y)(w.h,{title:(0,s.t)("Please confirm"),description:(0,s.t)("Are you sure you want to delete the selected %s?",c),onConfirm:async t=>{try{const{message:e}=await H(t.map(({id:e})=>e));B(),l(e)}catch(t){(0,C.JF)(t=>e((0,s.t)("There was an issue deleting the selected %s: %s",c,t)))(t)}},children:n=>{const a=ne?[{key:"delete",name:(0,s.t)("Delete"),onSelect:n,type:"danger"}]:[];return(0,i.Y)("div",{id:t?"report-list":"alert-list",role:"tabpanel","aria-labelledby":t?"report-tab":"alert-tab",children:(0,i.Y)(v.uO,{className:"alerts-list-view",columns:le,count:E,data:Y,emptyState:oe,fetchData:I,filters:ce,initialSort:ae,loading:k,bulkActions:a,bulkSelectEnabled:G,disableBulkSelect:P,refreshData:B,addDangerToast:e,addSuccessToast:l,pageSize:25})})}})]})})}}]);