"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9710],{43850:(e,t,a)=>{a.d(t,{A:()=>h});var o=a(71677),i=a(48186),l=a(37604),r=a(9226),n=a(23096),s=a(33232),d=a(71704);const g=[0,0,0,255],c={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:g},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class u extends o.A{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&i.A.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const t=this.state.paths.slice(),a=e.dataChanged.map(e=>(0,d.J)({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)}));this.setState({paths:t,pathsDiff:a})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:a,positionFormat:o,_normalize:i}=this.props,r=[],n="XY"===o?2:3,{startRow:d,endRow:g}=e,{iterable:c,objectInfo:u}=(0,l.X)(t,d,g);for(const e of c){u.index++;let t=a(e,u);i&&(t=s.S8(t,n));const{holeIndices:o}=t,l=t.positions||t;if(o)for(let t=0;t<=o.length;t++){const a=l.slice(o[t-1]||0,o[t]||l.length);r.push(this.getSubLayerRow({path:a},e,u.index))}else r.push(this.getSubLayerRow({path:l},e,u.index))}return r}renderLayers(){const{data:e,_dataDiff:t,stroked:a,filled:o,extruded:i,wireframe:l,_normalize:s,_windingOrder:d,elevationScale:c,transitions:u,positionFormat:h}=this.props,{lineWidthUnits:p,lineWidthScale:f,lineWidthMinPixels:m,lineWidthMaxPixels:y,lineJointRounded:_,lineMiterLimit:b,lineDashJustified:C}=this.props,{getFillColor:v,getLineColor:L,getLineWidth:S,getLineDashArray:w,getElevation:k,getPolygon:A,updateTriggers:D,material:P}=this.props,{paths:x,pathsDiff:F}=this.state,M=this.getSubLayerClass("fill",r.A),W=this.getSubLayerClass("stroke",n.A),T=this.shouldRenderSubLayer("fill",x)&&new M({_dataDiff:t,extruded:i,elevationScale:c,filled:o,wireframe:l,_normalize:s,_windingOrder:d,getElevation:k,getFillColor:v,getLineColor:i&&l?L:g,material:P,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:D&&{getPolygon:D.getPolygon,getElevation:D.getElevation,getFillColor:D.getFillColor,lineColors:i&&l,getLineColor:D.getLineColor}}),{data:e,positionFormat:h,getPolygon:A});return[!i&&T,!i&&a&&this.shouldRenderSubLayer("stroke",x)&&new W({_dataDiff:F&&(()=>F),widthUnits:p,widthScale:f,widthMinPixels:m,widthMaxPixels:y,jointRounded:_,miterLimit:b,dashJustified:C,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(L),getWidth:this.getSubLayerAccessor(S),getDashArray:this.getSubLayerAccessor(w)},this.getSubLayerProps({id:"stroke",updateTriggers:D&&{getWidth:D.getLineWidth,getColor:D.getLineColor,getDashArray:D.getLineDashArray}}),{data:x,positionFormat:h,getPath:e=>e.path}),i&&T]}}u.layerName="PolygonLayer",u.defaultProps=c;const h=u},69710:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v,getLayer:()=>_,getPoints:()=>b});var o=a(2445),i=a(24002),l=a(74098),r=a(43850),n=a(28027),s=a(52480),d=a(51316),g=a(83860),c=a(98456);function u(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var h=a(48238),p=a(35942),f=a(92123),m=a(20605),y=a(42828);const _=function({formData:e,payload:t,setTooltip:a,filterState:i,setDataMask:n,onContextMenu:h,onSelect:p,emitCrossFilters:_}){const b=e,C=b.fill_color_picker,v=b.stroke_color_picker,L=b.default_breakpoint_color;let S=[...t.data.features];b.js_data_mutator&&(S=(0,c.A)(b.js_data_mutator)(S));const w=b.color_scheme_type,k=b.metric?b.metric.label||b.metric:null,A=e=>e[k];let D;switch(w){case f.wP.fixed_color:D=()=>[C.r,C.g,C.b,255*C.a];break;case f.wP.linear_palette:D=null===b.metric?()=>[C.r,C.g,C.b,255*C.a]:(0,d.L6)(b,S,A);break;case f.wP.color_breakpoints:{const e=b.color_breakpoints;D=t=>{var a;const o=(0,g.JV)(A,t,e),i=void 0!==o&&(null==(a=e[o-1])?void 0:a.color);return i?[i.r,i.g,i.b,255]:L?[L.r,L.g,L.b,255*L.a]:[m.DL.r,m.DL.g,m.DL.b,255*m.DL.a]};break}default:D=()=>[C.r,C.g,C.b,255*C.a]}const P=e=>{var t;const a=D(e)||d.LC,o=u(e),l=JSON.stringify(o).replaceAll(" ","")===(null==i||null==(t=i.value)?void 0:t[0]);return null!=i&&i.value&&!l&&(a[3]/=3),a},x=(0,y.j1)(b,e=>function(e,t,a){var i,r,n;return(0,o.FD)("div",{className:"deckgl-tooltip",children:[(null==(i=e.object)?void 0:i.name)&&(0,o.Y)(s.A,{label:`${(0,l.t)("name")}: `,value:`${e.object.name}`}),(null==(r=e.object)?void 0:r[null==t?void 0:t.line_column])&&(0,o.Y)(s.A,{label:`${t.line_column}: `,value:`${e.object[t.line_column]}`}),y.EO.centroid(e),y.EO.category(e),(null==t?void 0:t.metric)&&(0,o.Y)(s.A,{label:`${a}: `,value:`${null==(n=e.object)?void 0:n[a]}`})]})}(e,b,k));return new r.A({id:`path-layer-${b.slice_id}`,data:S,filled:b.filled,stroked:b.stroked,getPolygon:u,getFillColor:P,getLineColor:v?[v.r,v.g,v.b,255*v.a]:void 0,getLineWidth:b.line_width,extruded:b.extruded,lineWidthUnits:b.line_width_unit,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,P),elevationScale:b.multiplier,fp64:!0,opacity:b.opacity?b.opacity/100:1,...(0,g.T$)({formData:b,setTooltip:a,setTooltipContent:x,onSelect:p,filterState:i,onContextMenu:h,setDataMask:n,emitCrossFilters:_})})};function b(e){return e.flatMap(u)}const C=e=>{const t=(0,i.useRef)(),a=(0,i.useCallback)(()=>{let t={...e.viewport};if(e.formData.autozoom){const a=e.payload.data.features||[];t=(0,h.A)(t,{width:e.width,height:e.height,points:b(a)})}return t.zoom<0&&(t.zoom=0),t},[e]),[l,r]=(0,i.useState)(a()),[s,g]=(0,i.useState)(e.payload.form_data);(0,i.useEffect)(()=>{const{payload:t}=e;t.form_data!==s&&(r(a()),g(t.form_data))},[a,e,s,l]);const c=(0,i.useCallback)(e=>{const{current:a}=t;a&&a.setTooltip(e)},[]),u=(0,i.useCallback)(()=>{const{formData:t,payload:a,onAddFilter:o,onContextMenu:i,setDataMask:l,filterState:r,emitCrossFilters:n}=e;return void 0===e.payload.data.features?[]:[_({formData:t,payload:a,onAddFilter:o,setTooltip:c,onContextMenu:i,setDataMask:l,filterState:r,emitCrossFilters:n})]},[c,e]),{payload:m,formData:y,setControlValue:C}=e,v=y.metric?y.metric.label||y.metric:null,L=y.color_scheme_type===f.wP.color_breakpoints?(0,d.BK)(y.color_breakpoints):(0,d.y1)(y,m.data.features,e=>e[v]);return(0,o.FD)("div",{style:{position:"relative"},children:[(0,o.Y)(p.S,{ref:t,viewport:l,layers:u(),setControlValue:C,mapStyle:y.mapbox_style,mapboxApiAccessToken:m.data.mapboxApiKey,width:e.width,height:e.height}),null!==y.metric&&(0,o.Y)(n.A,{categories:L,position:y.legend_position,format:y.legend_format})]})},v=(0,i.memo)(C)}}]);