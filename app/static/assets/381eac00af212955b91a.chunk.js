"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8968],{1600:(e,t,a)=>{a.d(t,{A:()=>u});var o=a(2445),s=a(24002),r=a(74098),i=a(81465),n=a(55204),l=a(8558),d=a(77627);const c=i.I4.div`
  position: relative;

  &:hover {
    .copy-button {
      visibility: visible;
    }
  }

  .copy-button {
    position: absolute;
    top: 40px;
    right: 16px;
    z-index: 10;
    visibility: hidden;
    margin: -4px;
    padding: 4px;
    background: ${({theme:e})=>e.colorBgContainer};
    border-radius: ${({theme:e})=>e.borderRadius}px;
    color: ${({theme:e})=>e.colorIcon};
    cursor: pointer;
    transition: all 0.2s ease;

    &:hover {
      background: ${({theme:e})=>e.colorFillContentHover};
      color: ${({theme:e})=>e.colorIconHover};
    }

    &:focus {
      visibility: visible;
      outline: 2px solid ${({theme:e})=>e.colorPrimary};
      outline-offset: 2px;
    }
  }
`;function u({addDangerToast:e,addSuccessToast:t,children:a,language:i,...u}){function h(a){(0,d.A)(()=>Promise.resolve(a)).then(()=>{t&&t((0,r.t)("Code Copied!"))}).catch(()=>{e&&e((0,r.t)("Sorry, your browser does not support copying."))})}return(0,s.useEffect)(()=>{(0,n.Fq)([i])},[i]),(0,o.FD)(c,{children:[(0,o.Y)(l.F.CopyOutlined,{className:"copy-button",tabIndex:0,role:"button","aria-label":(0,r.t)("Copy code to clipboard"),onClick:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.blur(),h(a)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),h(a))}}),(0,o.Y)(n.Ay,{language:i,...u,children:a})]})}},22070:(e,t,a)=>{a.d(t,{F:()=>s});var o=a(74098);const s={name:(0,o.t)("SQL"),tabs:[{name:"Saved queries",label:(0,o.t)("Saved queries"),url:"/savedqueryview/list/",usesRouter:!0},{name:"Query history",label:(0,o.t)("Query history"),url:"/sqllab/history/",usesRouter:!0}]}},43857:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var o=a(2445),s=a(74098),r=a(81465),i=a(79378),n=a(99106),l=a(24002),d=a(61574),c=a(71519),u=a(58561),h=a.n(u),p=a(71323),y=a(61225),b=a(95018),g=a(23576),m=a(94551),v=a(38961),S=a(56196),f=a(64457),w=a(86784),q=a(9876),k=a(51304),T=a(20237),C=a(22070),D=a(79605),x=a(47068),_=a(57771),F=a(8558),A=a(77627),Y=a(97163),H=a(88217),P=a(1600),$=a(63178);const I=r.I4.div`
  color: ${({theme:e})=>e.colorPrimary};
  font-size: ${({theme:e})=>e.fontSizeSM}px;
  margin-bottom: 0;
`,z=r.I4.div`
  color: ${({theme:e})=>e.colorTextLabel};
  font-size: ${({theme:e})=>e.fontSize}px;
  padding-top: ${({theme:e})=>e.sizeUnit}px;
`,Q=(0,r.I4)(Y.aF)`
  .ant-modal-body {
    padding: 24px;
  }
`,O=(0,f.Ay)(({fetchData:e,onHide:t,openInSqlLab:a,queries:r,savedQuery:i,show:n,addDangerToast:l,addSuccessToast:d})=>{const{handleKeyPress:c,handleDataChange:u,disablePrevious:h,disableNext:p}=(0,$.A)({queries:r,currentQueryId:i.id,fetchData:e});return(0,o.Y)("div",{role:"none",onKeyUp:c,children:(0,o.FD)(Q,{onHide:t,show:n,title:(0,s.t)("Query preview"),width:800,footer:(0,o.FD)(o.FK,{children:[(0,o.Y)(H.$,{buttonStyle:"secondary",disabled:h,onClick:()=>u(!0),children:(0,s.t)("Previous")},"previous-saved-query"),(0,o.Y)(H.$,{buttonStyle:"secondary",disabled:p,onClick:()=>u(!1),children:(0,s.t)("Next")},"next-saved-query"),(0,o.Y)(H.$,{onClick:({metaKey:e})=>a(i.id,Boolean(e)),children:(0,s.t)("Open in SQL Lab")},"open-in-sql-lab")]}),children:[(0,o.Y)(I,{children:(0,s.t)("Query name")}),(0,o.Y)(z,{children:i.label}),(0,o.Y)(P.A,{language:"sql",addDangerToast:l,addSuccessToast:d,children:i.sql||""})]})})});var B=a(90886);const L=(0,s.t)('The passwords for the databases below are needed in order to import them together with the saved queries. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),K=(0,s.t)("You are importing one or more saved queries that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?"),N=r.I4.div`
  .count {
    margin-left: 5px;
    color: ${({theme:e})=>e.colorPrimary};
    text-decoration: underline;
    cursor: pointer;
  }
`,E=r.I4.div`
  color: ${({theme:e})=>e.colorText};
`,R=(0,f.Ay)(function({addDangerToast:e,addSuccessToast:t,user:a}){const{state:{loading:r,resourceCount:u,resourceCollection:f,bulkSelectEnabled:Y},hasPerm:H,fetchData:P,toggleBulkSelect:$,refreshData:I}=(0,w.RU)("saved_query",(0,s.t)("Saved queries"),e),{roles:z}=(0,y.d4)(e=>e.user),Q=(0,B.L)("can_read","Tag",z),[R,M]=(0,l.useState)(null),[U,J]=(0,l.useState)(null),[j,G]=(0,l.useState)(!1),[W,V]=(0,l.useState)([]),[X,Z]=(0,l.useState)(!1),[ee,te]=(0,l.useState)([]),[ae,oe]=(0,l.useState)([]),[se,re]=(0,l.useState)([]),ie=(0,d.W6)(),ne=H("can_write"),le=H("can_write"),de=H("can_write"),ce=H("can_export"),ue=(0,l.useCallback)(t=>{i.A.get({endpoint:`/api/v1/saved_query/${t}`}).then(({json:e={}})=>{J({...e.result})},(0,p.JF)(t=>e((0,s.t)("There was an issue previewing the selected query %s",t))))},[e]),he={activeChild:"Saved queries",...C.F},pe=[];ne&&pe.push({name:(0,o.Y)(b.m,{id:"import-tooltip",title:(0,s.t)("Import queries"),placement:"bottomRight",children:(0,o.Y)(F.F.DownloadOutlined,{iconSize:"l"})}),buttonStyle:"link",onClick:()=>{G(!0)}}),de&&pe.push({name:(0,s.t)("Bulk select"),onClick:$,buttonStyle:"secondary"}),pe.push({icon:(0,o.Y)(F.F.PlusOutlined,{iconSize:"m"}),name:(0,s.t)("Query"),buttonStyle:"primary",onClick:()=>{ie.push("/sqllab?new=true")}}),he.buttons=pe;const ye=(a,o)=>{(0,A.A)(()=>Promise.resolve(`${window.location.origin}/sqllab?savedQueryId=${a}`)).then(()=>{t((0,s.t)("Link Copied!"))}).catch(()=>{e((0,s.t)("Sorry, your browser does not support copying."))}),o?window.open(`/sqllab?savedQueryId=${a}`):ie.push(`/sqllab?savedQueryId=${a}`)},be=(0,l.useCallback)(async a=>{try{const e={dbId:a.db_id,name:a.label,schema:a.schema,catalog:a.catalog,sql:a.sql,autorun:!1,templateParams:null},o=await i.A.post({endpoint:"/api/v1/sqllab/permalink",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),{url:r}=o.json;await navigator.clipboard.writeText(r),t((0,s.t)("Link Copied!"))}catch(t){e((0,s.t)("There was an error generating the permalink."))}},[e,t]),ge=async t=>{const a=t.map(({id:e})=>e);Z(!0);try{await(0,k.A)("saved_query",a,()=>{Z(!1)})}catch(t){Z(!1),e((0,s.t)("There was an issue exporting the selected queries"))}},me=[{id:"changed_on_delta_humanized",desc:!0}],ve=(0,l.useMemo)(()=>[{accessor:"label",Header:(0,s.t)("Name"),size:"xxl",Cell:({row:{original:{id:e,label:t}}})=>(0,o.Y)(c.N_,{to:`/sqllab?savedQueryId=${e}`,children:t}),id:"label"},{accessor:"description",Header:(0,s.t)("Description"),size:"xl",id:"description"},{accessor:"database.database_name",Header:(0,s.t)("Database"),size:"lg",id:"database.database_name"},{accessor:"database",hidden:!0,disableSortBy:!0,id:"database"},{accessor:"schema",Header:(0,s.t)("Schema"),size:"lg",id:"schema"},{Cell:({row:{original:{sql_tables:e=[]}}})=>{const t=e.map(e=>e.table),a=(null==t?void 0:t.shift())||"";return t.length?(0,o.FD)(N,{children:[(0,o.Y)("span",{children:a}),(0,o.Y)(g.A,{placement:"right",title:(0,s.t)("TABLES"),trigger:"click",content:(0,o.Y)(o.FK,{children:t.map(e=>(0,o.Y)(E,{children:e},e))}),children:(0,o.FD)("span",{className:"count",children:["(+",t.length,")"]})})]}):a},accessor:"sql_tables",Header:(0,s.t)("Tables"),size:"lg",disableSortBy:!0,id:"sql_tables"},{Cell:({row:{original:{tags:e=[]}}})=>(0,o.Y)(q.Sk,{tags:e.filter(e=>e.type===x.U.Custom)}),Header:(0,s.t)("Tags"),accessor:"tags",disableSortBy:!0,hidden:!(0,n.G7)(n.TO.TaggingSystem),id:"tags"},{Cell:({row:{original:{changed_by:e,changed_on_delta_humanized:t}}})=>(0,o.Y)(q.UW,{user:e,date:t}),Header:(0,s.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",id:"changed_on_delta_humanized"},{Cell:({row:{original:e}})=>{const t=[{label:"preview-action",tooltip:(0,s.t)("Query preview"),placement:"bottom",icon:"Binoculars",onClick:()=>{ue(e.id)}},le&&{label:"edit-action",tooltip:(0,s.t)("Edit query"),placement:"bottom",icon:"EditOutlined",onClick:({metaKey:t})=>ye(e.id,Boolean(t))},{label:"copy-action",tooltip:(0,s.t)("Copy query URL"),placement:"bottom",icon:"CopyOutlined",onClick:()=>be(e)},ce&&{label:"export-action",tooltip:(0,s.t)("Export query"),placement:"bottom",icon:"UploadOutlined",onClick:()=>ge([e])},de&&{label:"delete-action",tooltip:(0,s.t)("Delete query"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>M(e)}].filter(e=>!!e);return(0,o.Y)(q.kv,{actions:t})},Header:(0,s.t)("Actions"),id:"actions",disableSortBy:!0},{accessor:D.H.ChangedBy,hidden:!0,id:D.H.ChangedBy}],[de,le,ce,be,ue]),Se=(0,l.useMemo)(()=>[{Header:(0,s.t)("Search"),id:"label",key:"search",input:"search",operator:q.c0.AllText,toolTipDescription:"Searches all text fields: Name, Description, Database & Schema"},{Header:(0,s.t)("Database"),key:"database",id:"database",input:"select",operator:q.c0.RelationOneMany,unfilteredLabel:(0,s.t)("All"),fetchSelects:(0,p.u1)("saved_query","database",(0,p.JF)(t=>e((0,s.t)("An error occurred while fetching dataset datasource values: %s",t)))),paginate:!0},{Header:(0,s.t)("Schema"),id:"schema",key:"schema",input:"select",operator:q.c0.Equals,unfilteredLabel:"All",fetchSelects:(0,p.$C)("saved_query","schema",(0,p.JF)(t=>e((0,s.t)("An error occurred while fetching schema values: %s",t)))),paginate:!0},...(0,n.G7)(n.TO.TaggingSystem)&&Q?[{Header:(0,s.t)("Tag"),id:"tags",key:"tags",input:"select",operator:q.c0.SavedQueryTagById,fetchSelects:_.m}]:[],{Header:(0,s.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:q.c0.RelationOneMany,unfilteredLabel:(0,s.t)("All"),fetchSelects:(0,p.u1)("saved_query","changed_by",(0,p.JF)(e=>(0,s.t)("An error occurred while fetching dataset datasource values: %s",e)),a),paginate:!0}],[e]);return(0,o.FD)(o.FK,{children:[(0,o.Y)(T.A,{...he}),R&&(0,o.Y)(m.T,{description:(0,s.t)("This action will permanently delete the saved query."),onConfirm:()=>{R&&(({id:a,label:o})=>{i.A.delete({endpoint:`/api/v1/saved_query/${a}`}).then(()=>{I(),M(null),t((0,s.t)("Deleted: %s",o))},(0,p.JF)(t=>e((0,s.t)("There was an issue deleting %s: %s",o,t))))})(R)},onHide:()=>M(null),open:!0,title:(0,s.t)("Delete Query?")}),U&&(0,o.Y)(O,{fetchData:ue,onHide:()=>J(null),savedQuery:U,queries:f,openInSqlLab:ye,show:!0}),(0,o.Y)(v.h,{title:(0,s.t)("Please confirm"),description:(0,s.t)("Are you sure you want to delete the selected queries?"),onConfirm:a=>{i.A.delete({endpoint:`/api/v1/saved_query/?q=${h().encode(a.map(({id:e})=>e))}`}).then(({json:e={}})=>{I(),t(e.message)},(0,p.JF)(t=>e((0,s.t)("There was an issue deleting the selected queries: %s",t))))},children:a=>{const i=(0,n.G7)(n.TO.TaggingSystem),l=[];return de&&l.push({key:"delete",name:(0,s.t)("Delete"),onSelect:a,type:"danger"}),ce&&l.push({key:"export",name:(0,s.t)("Export"),type:"primary",onSelect:ge}),(0,o.Y)(q.uO,{className:"saved_query-list-view",columns:ve,count:u,data:f,fetchData:P,filters:Se,initialSort:me,loading:r,pageSize:25,bulkActions:l,addSuccessToast:t,addDangerToast:e,bulkSelectEnabled:Y,disableBulkSelect:$,highlightRowId:null==U?void 0:U.id,enableBulkTag:i,bulkTagResourceName:"query",refreshData:I})}}),(0,o.Y)(q.zb,{resourceName:"saved_query",resourceLabel:(0,s.t)("queries"),passwordsNeededMessage:L,confirmOverwriteMessage:K,addDangerToast:e,addSuccessToast:t,onModelImport:()=>{G(!1),I(),t((0,s.t)("Query imported"))},show:j,onHide:()=>{G(!1)},passwordFields:W,setPasswordFields:V,sshTunnelPasswordFields:ee,setSSHTunnelPasswordFields:te,sshTunnelPrivateKeyFields:ae,setSSHTunnelPrivateKeyFields:oe,sshTunnelPrivateKeyPasswordFields:se,setSSHTunnelPrivateKeyPasswordFields:re}),X&&(0,o.Y)(S.R,{})]})})},63178:(e,t,a)=>{a.d(t,{A:()=>s});var o=a(24002);function s({queries:e,fetchData:t,currentQueryId:a}){const s=e.findIndex(e=>e.id===a),[r,i]=(0,o.useState)(s),[n,l]=(0,o.useState)(!1),[d,c]=(0,o.useState)(!1);function u(){l(0===r),c(r===e.length-1)}function h(a){const o=r+(a?-1:1);o>=0&&o<e.length&&(t(e[o].id),i(o),u())}return(0,o.useEffect)(()=>{u()}),{handleKeyPress:function(t){r>=0&&r<e.length&&("ArrowDown"===t.key||"k"===t.key?(t.preventDefault(),h(!1)):"ArrowUp"!==t.key&&"j"!==t.key||(t.preventDefault(),h(!0)))},handleDataChange:h,disablePrevious:n,disableNext:d}}}}]);