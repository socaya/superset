"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5134],{2987:(e,t,a)=>{function s(e){const t="CssEditor-css",a=document.head||document.getElementsByTagName("head")[0],s=document.querySelector(`.${t}`)||function(e){const t=document.createElement("style");return t.className=e,t.type="text/css",t}(t);return"styleSheet"in s?s.styleSheet.cssText=e:s.innerHTML=e,a.appendChild(s),function(){s.remove()}}a.d(t,{A:()=>s})},15244:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(74098),r=a(91003);const n=[{value:r.It,label:(0,s.t)("Small"),className:"header-style-option header-small"},{value:r.W9,label:(0,s.t)("Medium"),className:"header-style-option header-medium"},{value:r.GY,label:(0,s.t)("Large"),className:"header-style-option header-large"}]},25377:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(74098),r=a(91003);const n=[{value:r.kn,label:(0,s.t)("Transparent"),className:"background--transparent"},{value:r.X0,label:(0,s.t)("Solid"),className:"background--white"}]},33132:(e,t,a)=>{a.d(t,{R:()=>r,W:()=>s});const s=(e,t)=>Object.fromEntries(Object.values(e).filter(e=>e[t]).map(e=>[e.id,e[t]])),r=({chartConfiguration:e,nativeFilters:t,dataMask:a,allSliceIds:s})=>{const r={},n=Object.values(a).some(({id:e})=>{var a;const s=null==t||null==(a=t[e])||null==(a=a.scope)?void 0:a.selectedLayers;return s&&s.length>0});let i=[],o=[];return n&&Object.values(a).forEach(({id:e})=>{var a,s;const r=null==t||null==(a=t[e])||null==(a=a.scope)?void 0:a.selectedLayers,n=(null==t||null==(s=t[e])||null==(s=s.scope)?void 0:s.excluded)||[];r&&r.length>0&&(i=r,o=n)}),Object.values(a).forEach(({id:a,extraFormData:l={}})=>{var d,c,u,h,p,b,m,f,g;let v=null!=(d=null!=(c=null!=(u=null==t||null==(h=t[a])?void 0:h.chartsInScope)?u:null==e||null==(p=e[parseInt(a,10)])||null==(p=p.crossFilters)?void 0:p.chartsInScope)?c:s)?d:[];const y=null==t||null==(b=t[a])?void 0:b.filterType,S=null==t||null==(m=t[a])?void 0:m.targets;let w,I=null==t||null==(f=t[a])||null==(f=f.scope)?void 0:f.selectedLayers,E=(null==t||null==(g=t[a])||null==(g=g.scope)?void 0:g.excluded)||[];if(!n||I&&0!==I.length||(I=i,E=o),I&&I.length>0){const e=(e=>{const t={},a=new Set;return e.forEach(e=>{const s=e.match(/^chart-(\d+)-layer-(\d+)$/);if(s){const e=parseInt(s[1],10),r=parseInt(s[2],10);Number.isNaN(e)||(t[e]||(t[e]=[]),t[e].push(r),a.add(e))}}),{layerMap:t,chartIds:a}})(I);w=e.layerMap;const t=new Set(e.chartIds);v.forEach(e=>{E.includes(e)||I.some(t=>t.startsWith(`chart-${e}-layer-`))||t.add(e)}),v=Array.from(t)}else v=v.filter(e=>!E.includes(e));r[a]={scope:v,targets:S||[],values:l,filterType:y,...w&&{layerScope:w}}}),r}},37926:(e,t,a)=>{a.d(t,{d:()=>i,z:()=>n});var s=a(10900);function r(e,t){return e.length===Object.keys(t).length}function n(e,t,a){var n;let i=[];const o=Object.keys(a).includes(e)&&(0,s.Ub)(t),l=Array.isArray(t.scope)?t.scope:null!=(n=t.chartsInScope)?n:[];o&&(i=function(e,t,a){if(!t[e])return[];const s=[...a.filter(t=>String(t)!==e),Number(e)],n=new Set(a);return Object.values(t).reduce((a,i)=>i.slice_id===Number(e)?a:r(s,t)?(a.push(i.slice_id),a):(n.has(i.slice_id)&&a.push(i.slice_id),a),[])}(e,a,l));const d=t;return(!o||(0,s.ve)(d)||(0,s.qQ)(d))&&(i=function(e,t){if(r(t,e))return Object.keys(e).map(Number);const a=new Set(t);return Object.values(e).reduce((e,t)=>(a.has(t.slice_id)&&e.push(t.slice_id),e),[])}(a,l)),i}function i(e,t){const{customization:a,chartId:s}=e,{dataset:r}=a;if(s)return[s];if(!r)return[];const n=String(r);return Object.values(t).filter(e=>{const t=e.datasource;return!!t&&String(t).split("__")[0]===n}).map(e=>e.slice_id)}},68064:(e,t,a)=>{a.d(t,{QU:()=>m,VE:()=>c,d2:()=>u,nB:()=>l,tb:()=>d});var s=a(5556),r=a.n(s),n=a(29624),i=a(25377),o=a(15244);const l=r().shape({id:r().string.isRequired,type:r().oneOf(Object.values(n.Ay)).isRequired,parents:r().arrayOf(r().string),children:r().arrayOf(r().string),meta:r().shape({width:r().number,height:r().number,headerSize:r().oneOf(o.A.map(e=>e.value)),background:r().oneOf(i.A.map(e=>e.value)),chartId:r().number})}),d=r().shape({id:r().number.isRequired,chartAlert:r().string,chartStatus:r().string,chartUpdateEndTime:r().number,chartUpdateStartTime:r().number,latestQueryFormData:r().object,queryController:r().shape({abort:r().func}),queriesResponse:r().arrayOf(r().object),triggerQuery:r().bool,lastRendered:r().number}),c=r().shape({slice_id:r().number.isRequired,slice_url:r().string.isRequired,slice_name:r().string.isRequired,datasource:r().string,datasource_name:r().string,datasource_link:r().string,changed_on:r().number.isRequired,modified:r().string,viz_type:r().string.isRequired,description:r().string,description_markeddown:r().string,owners:r().arrayOf(r().string)}),u=r().shape({chartId:r().number.isRequired,componentId:r().string.isRequired,filterName:r().string.isRequired,datasourceId:r().string.isRequired,directPathToFilter:r().arrayOf(r().string).isRequired,isDateFilter:r().bool.isRequired,isInstantFilter:r().bool.isRequired,columns:r().object,labels:r().object,scopes:r().object}),h=(r().shape({sliceIds:r().arrayOf(r().number),expandedSlices:r().object,editMode:r().bool,isPublished:r().bool,colorNamespace:r().string,colorScheme:r().string,updatedColorScheme:r().bool,hasUnsavedChanges:r().bool}),r().shape({id:r().number,metadata:r().object,slug:r().string,dash_edit_perm:r().bool,dash_save_perm:r().bool,common:r().object,userId:r().string}),r().shape({value:r().oneOfType([r().number,r().string]).isRequired,label:r().string.isRequired})),p={value:r().oneOfType([r().number,r().string]).isRequired,label:r().string.isRequired,children:r().arrayOf(r().oneOfType([r().shape((b=()=>p,()=>b().apply(void 0,arguments))),h]))};var b;const m=r().oneOfType([r().shape(p),h])},75134:(e,t,a)=>{a.r(t),a.d(t,{DashboardPage:()=>he,DashboardPageIdContext:()=>le,default:()=>pe});var s=a(2445),r=a(24002),n=a(17437),i=a(61574),o=a(81465),l=a(74098),d=a(61225),c=a(10381),u=a(64457),h=a(56196),p=a(98244),b=a(31700),m=a(30483),f=a(2987),g=a(33132),v=a(24425),y=a(24777),S=a(85923),w=a(31296),I=a(11767),E=a(78929),O=a(82960),R=a(5556),x=a.n(R),C=a(9876),_=a(32064),j=a(29624);function D(e){return Object.values(e).reduce((e,t)=>(t&&t.type===j.oT&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e),[])}var T=a(68064),k=a(50816),q=a(37203),F=a(95553);const M=[j.oT,j.xY,j.rG];function $(e){return!Object.values(e).some(({type:e})=>e&&M.includes(e))}var U=a(37926);const z={actions:x().shape({addSliceToDashboard:x().func.isRequired,removeSliceFromDashboard:x().func.isRequired,triggerQuery:x().func.isRequired,logEvent:x().func.isRequired,clearDataMaskState:x().func.isRequired}).isRequired,dashboardId:x().number.isRequired,editMode:x().bool,isPublished:x().bool,hasUnsavedChanges:x().bool,slices:x().objectOf(T.VE).isRequired,activeFilters:x().object.isRequired,chartConfiguration:x().object,datasources:x().object.isRequired,ownDataCharts:x().object.isRequired,layout:x().object.isRequired,impressionId:x().string.isRequired,timeout:x().number,userId:x().string,children:x().node};class A extends r.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",A.unload):window.removeEventListener("beforeunload",A.unload)}static unload(){const e=(0,l.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,a;super(e),this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(a=e.ownDataCharts)?a:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){const e=(0,_.Ay)(),{editMode:t,isPublished:a,layout:s}=this.props,r={is_soft_navigation:k.Vy.timeOriginOffset>0,is_edit_mode:t,mount_duration:k.Vy.getTimestamp(),is_empty:$(s),is_published:a,bootstrap_data_length:e.length},n=(0,F.A)();n&&(r.target_id=n),this.props.actions.logEvent(k.es,r),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:k.Vy.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts()}componentDidUpdate(e){this.applyCharts();const t=D(e.layout),a=D(this.props.layout);e.dashboardId===this.props.dashboardId&&(t.length<a.length?a.filter(e=>-1===t.indexOf(e)).forEach(e=>{return this.props.actions.addSliceToDashboard(e,(t=this.props.layout,a=e,Object.values(t).find(e=>e&&e.type===j.oT&&e.meta&&e.meta.chartId===a)));var t,a}):t.length>a.length&&t.filter(e=>-1===a.indexOf(e)).forEach(e=>this.props.actions.removeSliceFromDashboard(e)))}applyCharts(){const{activeFilters:e,ownDataCharts:t,chartConfiguration:a,hasUnsavedChanges:s,editMode:r}=this.props,{appliedFilters:n,appliedOwnDataCharts:i}=this;a&&(r||(0,q.r$)(i,t,{ignoreUndefined:!0})&&(0,q.r$)(n,e,{ignoreUndefined:!0})||this.applyFilters(),s?A.onBeforeUnload(!0):A.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:k.Vy.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(k.Xj,{...this.visibilityEventData,duration:k.Vy.getTimestamp()-e})}}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:a,slices:s}=this.props,r=Object.keys(t),n=Object.keys(e),i=new Set(r.concat(n)),o=((e,t)=>{const a=Object.keys(e),s=Object.keys(t),r=(n=a,i=s,[...n.filter(e=>!i.includes(e)),...i.filter(e=>!n.includes(e))]).filter(a=>e[a]||t[a]);var n,i;return new Set([...a,...s]).forEach(a=>{(0,q.r$)(e[a],t[a])||r.push(a)}),[...new Set(r)]})(a,this.appliedOwnDataCharts);[...i].forEach(a=>{if(!r.includes(a)&&n.includes(a))o.push(...(0,U.z)(a,e[a],s));else if(n.includes(a)){if((0,q.r$)(e[a].values,t[a].values,{ignoreUndefined:!0})||o.push(...(0,U.z)(a,t[a],s)),!(0,q.r$)(e[a].scope,t[a].scope)){const s=(t[a].scope||[]).concat(e[a].scope||[]);o.push(...s)}}else o.push(...(0,U.z)(a,t[a],s))}),this.refreshCharts([...new Set(o)]),this.appliedFilters=t,this.appliedOwnDataCharts=a}refreshCharts(e){e.forEach(e=>{this.props.actions.triggerQuery(!0,e)})}render(){return this.context.loading?(0,s.Y)(h.R,{}):this.props.children}}A.contextType=C.bf,A.propTypes=z,A.defaultProps={timeout:60,userId:""};const P=A;var L=a(50880),N=a(25875),V=a(35352);const Y=(0,d.Ng)(function(e){var t,a;const{datasources:s,sliceEntities:r,dashboardInfo:n,dashboardState:i,dashboardLayout:o,impressionId:l}=e;return{timeout:null==(t=n.common)||null==(t=t.conf)?void 0:t.SUPERSET_WEBSERVER_TIMEOUT,userId:n.userId,dashboardId:n.id,editMode:i.editMode,isPublished:i.isPublished,hasUnsavedChanges:i.hasUnsavedChanges,datasources:s,chartConfiguration:null==(a=n.metadata)?void 0:a.chart_configuration,slices:r.slices,layout:o.present,impressionId:l}},function(e){return{actions:(0,O.zH)({setDatasources:m.nC,clearDataMaskState:V.V9,addSliceToDashboard:I.ft,removeSliceFromDashboard:I.Hg,triggerQuery:L.triggerQuery,logEvent:N.logEvent},e)}})(P);var H=a(31780);function W({children:e,themeId:t}){const a=(0,H.w)(),[n,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{t?(async()=>{try{const e=await a.createDashboardThemeProvider(String(t));i(e)}catch(e){console.error("Failed to load dashboard theme:",e),i(null)}})():i(null)},[t,a]),t?n?(0,s.Y)(n.SupersetThemeProvider,{children:e}):(0,s.Y)(h.R,{}):(0,s.Y)(s.FK,{children:e})}var B=a(43561);const Q=e=>n.AH`
  body {
    h1 {
      font-weight: ${e.fontWeightStrong};
      line-height: 1.4;
      font-size: ${e.fontSizeXXL}px;
      letter-spacing: -0.2px;
      margin-top: ${3*e.sizeUnit}px;
      margin-bottom: ${3*e.sizeUnit}px;
    }

    h2 {
      font-weight: ${e.fontWeightStrong};
      line-height: 1.4;
      font-size: ${e.fontSizeXL}px;
      margin-top: ${3*e.sizeUnit}px;
      margin-bottom: ${2*e.sizeUnit}px;
    }

    h3,
    h4,
    h5,
    h6 {
      font-weight: ${e.fontWeightStrong};
      line-height: 1.4;
      font-size: ${e.fontSizeLG}px;
      letter-spacing: 0.2px;
      margin-top: ${2*e.sizeUnit}px;
      margin-bottom: ${e.sizeUnit}px;
    }
  }
`,X=e=>n.AH`
  .header-title a {
    margin: ${e.sizeUnit/2}px;
    padding: ${e.sizeUnit/2}px;
  }
  .header-controls {
    &,
    &:hover {
      margin-top: ${e.sizeUnit}px;
    }
  }
`,K=e=>n.AH`
  .ant-dropdown-menu.chart-context-menu {
    min-width: ${43*e.sizeUnit}px;
  }
  .ant-dropdown-menu-submenu.chart-context-submenu {
    max-width: ${60*e.sizeUnit}px;
    min-width: ${40*e.sizeUnit}px;
  }
`,G=e=>n.AH`
  a,
  .ant-tabs-tabpane,
  .ant-tabs-tab-btn,
  .superset-button,
  .superset-button.ant-dropdown-trigger,
  .header-controls span {
    &:focus-visible {
      box-shadow: 0 0 0 2px ${e.colorPrimaryText};
      border-radius: ${e.borderRadius}px;
      outline: none;
      text-decoration: none;
    }
    &:not(
      .superset-button,
      .ant-menu-item,
      a,
      .fave-unfave-icon,
      .ant-tabs-tabpane,
      .header-controls span
    ) {
      &:focus-visible {
        padding: ${e.sizeUnit/2}px;
      }
    }
  }
`;var J=a(71086),Z=a.n(J),ee=a(44383),te=a.n(ee),ae=a(78752);const se={},re=()=>{const e=(0,y.Gq)(y.Hh.DashboardExploreContext,{});return Z()(e,e=>!e.isRedundant)},ne=(e,t)=>{const a=re();(0,y.SO)(y.Hh.DashboardExploreContext,{...a,[e]:{...t,dashboardPageId:e}})},ie=(0,c.Mz)([e=>e.dashboardInfo.metadata,e=>e.dashboardInfo.id,e=>{var t;return null==(t=e.dashboardState)?void 0:t.colorScheme},e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters},e=>e.dataMask,e=>{var t;return(null==(t=e.dashboardState)?void 0:t.sliceIds)||[]}],(e,t,a,s,r,n)=>{const i=Object.keys(s).reduce((e,t)=>(e[t]=te()(s[t],["chartsInScope"]),e),{}),o=(0,g.R)({chartConfiguration:(null==e?void 0:e.chart_configuration)||se,nativeFilters:s,dataMask:r,allSliceIds:n});return{labelsColor:(null==e?void 0:e.label_colors)||se,labelsColorMap:(null==e?void 0:e.map_label_colors)||se,sharedLabelsColors:(0,ae.ik)(null==e?void 0:e.shared_label_colors),colorScheme:a,chartConfiguration:(null==e?void 0:e.chart_configuration)||se,nativeFilters:i,dataMask:r,dashboardId:t,filterBoxFilters:(0,v.ug)(),activeFilters:o}}),oe=({dashboardPageId:e})=>{const t=(0,d.d4)(ie);return(0,r.useEffect)(()=>(ne(e,t),()=>{ne(e,{...t,isRedundant:!0})}),[t,e]),null},le=(0,r.createContext)(""),de=(0,r.lazy)(()=>Promise.all([a.e(8096),a.e(7596),a.e(683),a.e(4295),a.e(2312),a.e(2773),a.e(8121),a.e(5191),a.e(23),a.e(1875),a.e(371),a.e(8483),a.e(5026)]).then(a.bind(a,6976))),ce=(0,c.Mz)(e=>e.dataMask,e=>(0,g.W)(e,"ownState")),ue=(0,c.Mz)([e=>{var t;return null==(t=e.dashboardInfo.metadata)?void 0:t.chart_configuration},e=>e.nativeFilters.filters,e=>e.dataMask,e=>e.dashboardState.sliceIds],(e,t,a,s)=>({...(0,v.ug)(),...(0,g.R)({chartConfiguration:e,nativeFilters:t,dataMask:a,allSliceIds:s})})),he=({idOrSlug:e})=>{var t;const a=(0,o.DP)(),c=(0,d.wA)(),g=(0,i.W6)(),v=(0,r.useMemo)(()=>(0,B.Ak)(),[]),O=(0,d.d4)(({dashboardInfo:e})=>e&&Object.keys(e).length>0),R=(0,d.d4)(e=>e.dashboardInfo.theme),{addDangerToast:x}=(0,u.Yf)(),{result:C,error:_}=(0,p.MZ)(e),{result:j,error:D}=(0,p.DT)(e),{result:T,error:k,status:q}=(0,p.RO)(e),F=(0,r.useRef)(!1),M=_||D,$=Boolean(C&&j),{dashboard_title:U,id:z=0}=C||{},A=(0,d.d4)(e=>e.dashboardInfo.css)||(null==C?void 0:C.css);(0,r.useEffect)(()=>{const e=()=>{const e=re();(0,y.SO)(y.Hh.DashboardExploreContext,{...e,[v]:{...e[v],isRedundant:!0}})};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[v]),(0,r.useEffect)(()=>{c((0,I.wh)(q))},[c,q]),(0,r.useEffect)(()=>{z&&async function(){const e=(0,w.P3)(S.vX.permalinkKey),t=(0,w.P3)(S.vX.nativeFiltersKey),a=(0,w.P3)(S.vX.nativeFilters);let s,r=t||{};if(e){const t=await(0,E.J)(e);t&&({dataMask:r,activeTabs:s}=t.state)}else t&&(r=await(0,E.I8)(z,t));a&&(r=a),$&&(F.current||(F.current=!0),c((0,b.M)({history:g,dashboard:C,charts:j,activeTabs:s,dataMask:r})))}()},[$]),(0,r.useEffect)(()=>(U&&(document.title=U),()=>{document.title="Superset"}),[U]),(0,r.useEffect)(()=>"string"==typeof A?(0,f.A)(A):()=>{},[A]),(0,r.useEffect)(()=>{k?x((0,l.t)("Error loading chart datasources. Filters may not work correctly.")):c((0,m.nC)(T))},[x,T,k,c]);const P=(0,d.d4)(ce),L=(0,d.d4)(ue);if(M)throw M;const N=(0,r.useMemo)(()=>[n.AH`
  .filter-card-tooltip {
    &.ant-tooltip-placement-bottom {
      padding-top: 0;
      & .ant-tooltip-arrow {
        top: -13px;
      }
    }
  }
`,Q(a),K(a),G(a),X(a)],[a]);if(M)throw M;const V=(0,r.useMemo)(()=>(0,s.Y)(de,{}),[]);return(0,s.FD)(s.FK,{children:[(0,s.Y)(n.mL,{styles:N}),$&&O?(0,s.FD)(s.FK,{children:[(0,s.Y)(oe,{dashboardPageId:v}),(0,s.Y)(le.Provider,{value:v,children:(0,s.Y)(W,{themeId:void 0!==R?null==R?void 0:R.id:null==C||null==(t=C.theme)?void 0:t.id,children:(0,s.Y)(Y,{activeFilters:L,ownDataCharts:P,children:V})})})]}):(0,s.Y)(h.R,{})]})},pe=he},78929:(e,t,a)=>{a.d(t,{Au:()=>o,I8:()=>l,J:()=>d,l6:()=>i});var s=a(79378),r=a(75574);const n=(e,t,a)=>{let s=`/api/v1/dashboard/${e}/filter_state`;return t&&(s=s.concat(`/${t}`)),a&&(s=s.concat(`?tab_id=${a}`)),s},i=(e,t,a,i)=>s.A.put({endpoint:n(e,a,i),jsonPayload:{value:t}}).then(e=>e.json.message).catch(e=>(r.A.error(e),null)),o=(e,t,a)=>s.A.post({endpoint:n(e,void 0,a),jsonPayload:{value:t}}).then(e=>e.json.key).catch(e=>(r.A.error(e),null)),l=(e,t)=>s.A.get({endpoint:n(e,t)}).then(({json:e})=>JSON.parse(e.value)).catch(e=>(r.A.error(e),null)),d=e=>s.A.get({endpoint:`/api/v1/dashboard/permalink/${e}`}).then(({json:e})=>e).catch(e=>(r.A.error(e),null))}}]);