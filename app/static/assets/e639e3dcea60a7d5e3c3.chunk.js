"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[371],{3189:(e,t,n)=>{n.d(t,{a:()=>o});const o=()=>{var e;return null==(e=window)||null==(e=e.navigator)?void 0:e.webdriver}},11908:(e,t,n)=>{n.d(t,{A:()=>p});var o=n(2445),a=n(24002),i=n(74098),r=n(90924),l=n(81465),s=n(59744),d=n(56196),c=n(50880),u=n(60063);const h=l.I4.div`
  height: 100%;
  display: flex;
  flex-direction: column;
  gap: ${({theme:e})=>4*e.sizeUnit}px;
`,p=({latestQueryFormData:e})=>{const[t,n]=(0,a.useState)([]),[l,p]=(0,a.useState)(!1),[m,g]=(0,a.useState)(null);return(0,a.useEffect)(()=>{p(!0),(0,c.getChartDataRequest)({formData:e,resultFormat:"json",resultType:"query"}).then(({json:e})=>{n((0,r.A)(e.result)),p(!1),g(null)}).catch(e=>{(0,s.h4)(e).then(({error:t,message:n})=>{g(t||n||e.statusText||(0,i.t)("Sorry, An error occurred")),p(!1)})})},[JSON.stringify(e)]),l?(0,o.Y)(d.R,{}):m?(0,o.Y)("pre",{children:m}):(0,o.Y)(h,{children:t.map((t,n)=>t.query?(0,o.Y)(u.A,{datasource:e.datasource,sql:t.query,language:"sql"},`query-${n}`):null)})}},12389:(e,t,n)=>{n.d(t,{A:()=>o});const o=n(29645).Tree},13981:(e,t,n)=>{n.d(t,{Gs:()=>a,x4:()=>o});const o=(e,t,n=Number.MAX_SAFE_INTEGER,o=0)=>{const a=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),i=Math.min(32*t,n)+32+o;return a-e<i?a-i:e},a=(e,t,n=0,a=Number.MAX_SAFE_INTEGER,i=0)=>{const r=e+4+32*n+4;return o(r,t,a,i)-r}},14244:(e,t,n)=>{n.d(t,{P:()=>s});var o=n(74098),a=n(59744),i=n(24002),r=n(61574),l=n(49113);const s=({hasUnsavedChanges:e,onSave:t,isSaveModalVisible:n=!1,manualSaveOnUnsavedChanges:s=!1})=>{const d=(0,r.W6)(),[c,u]=(0,i.useState)(!1),h=(0,i.useRef)(null),p=(0,i.useRef)(()=>{}),m=(0,i.useRef)(!1),g=(0,i.useCallback)(()=>{u(!1),null==h.current||h.current()},[]),v=(0,i.useCallback)(async()=>{try{s&&(m.current=!0),await t(),u(!1)}catch(e){const t=await(0,a.h4)(e);throw new Error(t.message||t.error||(0,o.t)("Sorry, an error occurred"),{cause:e})}},[s,t]),f=(0,i.useCallback)(()=>{m.current=!0,t()},[t]),b=(0,i.useCallback)(({pathname:e})=>{if(!m.current)return h.current=()=>{null==p.current||p.current(),d.push(e)},u(!0),!1;m.current=!1},[d]);return(0,i.useEffect)(()=>{if(!e)return;const t=d.block(b);return p.current=t,()=>t()},[b,e,d]),(0,i.useEffect)(()=>{!n&&m.current&&(u(!1),m.current=!1)},[n]),(0,l.K)(e),{showModal:c,setShowModal:u,handleConfirmNavigation:g,handleSaveAndCloseModal:v,triggerManualSave:f}}},14584:(e,t,n)=>{n.d(t,{B3:()=>S,Bt:()=>b,Gh:()=>y,JG:()=>A,JU:()=>v,Px:()=>F,XB:()=>D,a2:()=>g,f$:()=>w,p6:()=>_,yJ:()=>m});var o=n(2445),a=n(24002),i=n(30535),r=n(26206),l=n(74098),s=n(17437),d=n(81465),c=n(8558),u=n(95018),h=n(5250),p=n(47980);const m=d.I4.div`
  margin-bottom: ${({theme:e})=>e.sizeUnit}px;
  :last-child {
    margin-bottom: 0;
  }
`,g=d.I4.div`
  display: flex;
  align-items: center;
  width: 100%;
  font-size: ${({theme:e})=>e.fontSizeSM}px;
  height: ${({theme:e})=>6*e.sizeUnit}px;
  background-color: ${({theme:e})=>e.colorBgLayout};
  border-radius: 3px;
  cursor: ${({withCaret:e})=>e?"pointer":"default"};
  :hover {
    background-color: ${({theme:e})=>e.colorPrimaryBgHover};
  }
`,v=d.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${e.sizeUnit}px;\n    svg {\n      margin-right: ${e.sizeUnit}px;\n    }\n    .type-label {\n      margin-right: ${2*e.sizeUnit}px;\n      margin-left: ${e.sizeUnit}px;\n      font-weight: ${e.fontWeightNormal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}
`,f=d.I4.span`
  overflow: hidden;
  text-overflow: ellipsis;
`,b=d.I4.div`
  height: 100%;
  border-left: solid 1px ${({theme:e})=>e.colorSplit};
  margin-left: auto;
`,y=d.I4.div`
  height: auto;
  width: ${({theme:e})=>6*e.sizeUnit}px;
  border-right: solid 1px ${({theme:e})=>e.colorBorder};
  cursor: pointer;
`,x=(0,d.I4)(h.I)`
  margin: 0 ${({theme:e})=>e.sizeUnit}px;
`,S=d.I4.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,_=d.I4.div`
  padding: ${({theme:e})=>e.sizeUnit}px;
  border: solid 1px ${({theme:e})=>e.colorSplit};
  border-radius: ${({theme:e})=>e.borderRadius}px;
`,C=s.i7`
  0% {
    right: 100%;
  }
  50% {
    left: 4px;
  }
  90% {
    right: 4px;
  }
  100% {
    left: 100%;
  }
`,w=d.I4.div`
  ${({theme:e,isLoading:t,canDrop:n,isDragging:o,isOver:a})=>`\n  position: relative;\n  padding: ${e.sizeUnit}px;\n  border: ${!t&&o?`dashed 1px ${n?e.colorSplit:e.colorErrorBgHover}`:`solid 1px ${t&&o?e.colorWarningBgHover:e.colorBorder}`};\n  border-radius: ${e.borderRadius}px;\n  &:before,\n  &:after {\n    content: ' ';\n    position: absolute;\n    border-radius: ${e.borderRadius}px;\n  }\n  &:before {\n    display: ${o||t?"block":"none"};\n    background-color: ${n?e.colorPrimary:e.colorErrorBgHover};\n    z-index: 10;\n    opacity: 10%;\n    top: 1px;\n    right: 1px;\n    bottom: 1px;\n    left: 1px;\n  }\n  &:after {\n    display: ${t||n&&a?"block":"none"};\n    background-color: ${t?e.colorFillTertiary:e.colorPrimary};\n    z-index: 11;\n    opacity: 35%;\n    top: ${-e.sizeUnit}px;\n    right: ${-e.sizeUnit}px;\n    bottom: ${-e.sizeUnit}px;\n    left: ${-e.sizeUnit}px;\n    cursor: ${t?"wait":"auto"};\n  }\n  `}

  &:before {
    ${({theme:e,isLoading:t})=>t&&s.AH`
        animation: ${C} 2s ease-in infinite;
        background: linear-gradient(currentColor 0 0) 0 100%/0% 3px no-repeat;
        background-size: 100% ${e.sizeUnit/2}px;
        top: auto;
        right: ${e.sizeUnit}px;
        left: ${e.sizeUnit}px;
        bottom: -${e.sizeUnit/2}px;
        height: ${e.sizeUnit/2}px;
      `};
  }
`,A=d.I4.div`
  display: flex;
  align-items: center;
  width: 100%;
  height: ${({theme:e})=>6*e.sizeUnit}px;
  padding-left: ${({theme:e})=>e.sizeUnit}px;
  font-size: ${({theme:e})=>e.fontSizeSM}px;
  color: ${({theme:e})=>e.colorTextSecondary};
  border: dashed 1px ${({theme:e})=>e.colorSplit};
  border-radius: ${({theme:e})=>e.borderRadius}px;
  cursor: ${({cancelHover:e})=>e?"inherit":"pointer"};

  :hover {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colorFillSecondary};
  }

  :active {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colorFillTertiary};
  }
  svg {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,D=d.I4.button`
  display: flex;
  align-items: center;
  justify-content: center;
  height: ${({theme:e})=>4*e.sizeUnit}px;
  width: ${({theme:e})=>4*e.sizeUnit}px;
  padding: 0;
  background-color: ${({theme:e})=>e.colorPrimaryText};
  border: none;
  border-radius: 2px;
  cursor: pointer;

  :disabled {
    cursor: not-allowed;
    background-color: ${({theme:e})=>e.colorBgContainerDisabled};
  }
`,F=({label:e,savedMetric:t,adhocMetric:n,onRemove:h,onMoveLabel:S,onDropLabel:_,withCaret:C,isFunction:w,type:A,index:D,isExtra:F,datasourceWarningMessage:T,tooltipTitle:E,multi:$=!0,...Y})=>{const I=(0,d.DP)(),k=(0,a.useRef)(null),M=(0,a.useRef)(null),z=null==t?void 0:t.metric_name,[,R]=(0,r.H)({accept:A,drop(){$&&(null==_||_())},hover(e,t){var n;if(!$)return;if(!k.current)return;const{dragIndex:o}=e,a=D;if(o===a)return;const i=null==(n=k.current)?void 0:n.getBoundingClientRect(),r=(i.bottom-i.top)/2,l=t.getClientOffset(),s=null!=l&&l.y?(null==l?void 0:l.y)-i.top:0;o<a&&s<r||o>a&&s>r||(null==S||S(o,a),e.dragIndex=a)}}),[{isDragging:O},N]=(0,i.i)({item:{type:A,dragIndex:D,value:null!=t&&t.metric_name?t:n},collect:e=>({isDragging:e.isDragging()})});return N(R(k)),(0,o.Y)(m,{ref:k,children:(0,o.FD)(g,{withCaret:C,...Y,css:s.AH`
        text-align: center;
      `,children:[(0,o.Y)(y,{role:"button",onClick:h,children:(0,o.Y)(c.F.CloseOutlined,{iconSize:"m",iconColor:I.colorIcon,css:s.AH`
            vertical-align: sub;
          `})}),(0,o.FD)(v,{children:[w&&(0,o.Y)(c.F.FunctionOutlined,{iconSize:"m"}),(()=>{const n=!O&&"string"==typeof e&&E&&e&&E!==e||!O&&M&&M.current&&M.current.scrollWidth>M.current.clientWidth;return t&&z?(0,o.Y)(p.b,{metric:t,labelRef:M,shouldShowTooltip:!O}):n?(0,o.Y)(u.m,{title:E||e,children:(0,o.Y)(f,{ref:M,children:e})}):(0,o.Y)(f,{ref:M,children:e})})()]}),(!!T||F)&&(0,o.Y)(x,{type:"warning",placement:"top",tooltip:T||(0,l.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),C&&(0,o.Y)(b,{children:(0,o.Y)(c.F.RightOutlined,{iconSize:"m",css:s.AH`
              margin: ${I.sizeUnit}px;
            `,iconColor:I.colorIcon})})]})})}},15008:(e,t,n)=>{n.d(t,{S:()=>i});var o=n(61225),a=n(90886);const i=()=>{const e=(0,o.d4)(e=>{var t;return(0,a.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)}),t=(0,o.d4)(e=>{var t;return(0,a.L)("can_write","ExploreFormDataRestApi",null==(t=e.user)?void 0:t.roles)}),n=(0,o.d4)(e=>{var t;return(0,a.L)("can_samples","Datasource",null==(t=e.user)?void 0:t.roles)}),i=(0,o.d4)(e=>{var t;return(0,a.L)("can_csv","Superset",null==(t=e.user)?void 0:t.roles)}),r=(0,o.d4)(e=>{var t;return(0,a.L)("can_drill","Dashboard",null==(t=e.user)?void 0:t.roles)}),l=(0,o.d4)(e=>{var t;return(0,a.L)("can_get_drill_info","Dataset",null==(t=e.user)?void 0:t.roles)});return{canExplore:e,canWriteExploreFormData:t,canDatasourceSamples:n,canDownload:i,canDrill:r,canDrillBy:(e||r)&&t&&l,canDrillToDetail:(e||r)&&n&&l,canViewQuery:(0,o.d4)(e=>{var t;return(0,a.L)("can_view_query","Dashboard",null==(t=e.user)?void 0:t.roles)}),canViewTable:(0,o.d4)(e=>{var t;return(0,a.L)("can_view_chart_as_table","Dashboard",null==(t=e.user)?void 0:t.roles)})}}},16143:(e,t,n)=>{n.d(t,{$r:()=>y,TN:()=>v,XS:()=>x,ZY:()=>f});var o=n(38221),a=n.n(o),i=n(2445),r=n(24002),l=n(74098),s=n(17437),d=n(81465),c=n(29645),u=n(8558),h=n(88217),p=n(23575),m=n(4810),g=n(93590);(0,d.I4)(h.$)`
  font-size: ${({theme:e})=>e.fontSizeSM}px;

  // needed to override button's first-of-type margin: 0
  && {
    margin: 0 ${({theme:e})=>2*e.sizeUnit}px;
  }

  i {
    padding: 0 ${({theme:e})=>e.sizeUnit}px;
  }
`;const v=({data:e,columns:t})=>(0,i.Y)(m.$,{text:e&&t?(0,g.L)(e,t):"",wrapped:!1,copyNode:(0,i.Y)(u.F.CopyOutlined,{iconSize:"l","aria-label":(0,l.t)("Copy"),role:"button",css:s.AH`
          &.anticon > * {
            line-height: 0;
          }
        `})}),f=({onChangeHandler:e,shouldFocus:t=!1})=>{const n=(0,r.useRef)(null);(0,r.useEffect)(()=>{n.current&&t&&n.current.focus()},[t]);const o=(0,d.DP)(),h=a()(e,p.Y.SLOW_DEBOUNCE);return(0,i.Y)(c.Input,{prefix:(0,i.Y)(u.F.SearchOutlined,{iconSize:"l"}),placeholder:(0,l.t)("Search"),onChange:e=>{const t=e.target.value;h(t)},css:s.AH`
        width: 200px;
        margin-right: ${2*o.sizeUnit}px;
      `,ref:n})};function b(e){let t=e;return t=t.replace(/\./g,"_"),t=t.replace(/\s+/g,"_"),t=t.replace(/[()]/g,""),t=t.replace(/-/g,"_"),t=t.replace(/_+/g,"_"),t=t.replace(/^_+|_+$/g,""),t}const y=(e,t)=>{const n=(0,r.useMemo)(()=>{var e;return null!=(e=null==t?void 0:t.map(e=>Object.values(e).map(e=>null!=e?e.toString().toLowerCase():(0,l.t)("N/A"))))?e:[]},[t]);return(0,r.useMemo)(()=>null!=t&&t.length&&e?t.filter((t,o)=>n[o].some(t=>null==t?void 0:t.includes(e.toLowerCase()))):t||[],[t,e,n])},x=(e,t,n,o,a,l)=>(0,r.useMemo)(()=>{if(!e||null==n||!n.length)return[];const t=new Map;return e.forEach(e=>{const n=b(e);t.set(n,e)}),e.map((t,n)=>{const o=b(t);return{id:o||n,Header:t,accessor:n=>{if(Array.isArray(n)){const t=null==e?void 0:e.findIndex(e=>b(e)===o);return void 0!==t&&t>-1?n[t]:void 0}if(void 0!==n[t])return n[t];if(void 0!==n[o])return n[o];const a=Object.keys(n).find(e=>b(e)===o);return a?n[a]:void 0},Cell:({value:e,row:n})=>{const a=(0,d.DP)();let r=e;if(void 0===r&&n&&n.original)if(void 0!==n.original[t])r=n.original[t];else if(void 0!==n.original[o])r=n.original[o];else{const e=Object.keys(n.original).find(e=>b(e)===o);e&&(r=n.original[e])}if(!0===r)return p.Y.BOOL_TRUE_DISPLAY;if(!1===r)return p.Y.BOOL_FALSE_DISPLAY;if(null==r)return(0,i.Y)("span",{style:{color:a.colorTextTertiary},children:p.Y.NULL_DISPLAY});if("object"==typeof r){if(r instanceof Response)return`Response: ${r.status} ${r.url||""}`;try{return(0,i.Y)("pre",{style:{maxWidth:300,whiteSpace:"pre-wrap",margin:0,padding:0},children:JSON.stringify(r,null,2)})}catch(e){return"[object Object]"}}return String(r)},...null==l?void 0:l[o]}})},[e,n,l])},19171:(e,t,n)=>{n.d(t,{e:()=>l});var o=n(58180),a=n(49239),i=n(28674);const r={"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",IN:"IN","NOT IN":"NOT IN",LIKE:"LIKE",ILIKE:"ILIKE",REGEX:"REGEX","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL","IS TRUE":"IS TRUE","IS FALSE":"IS FALSE","LATEST PARTITION":({datasource:e})=>`= '{{ presto.latest_partition('${e.schema}.${e.datasource_name}') }}'`},l=(e,{useSimple:t}={useSimple:!1})=>{if((0,o.md)(e)||t){const{subject:t,operator:n}=e,o="comparator"in e?e.comparator:void 0,l=n&&n===a.nS[a.ux.LatestPartition].operation?r[n](e):r[n];return(0,i.zJ)(t,l,o)}return(0,o.wF)(e)?e.sqlExpression:""}},20941:(e,t,n)=>{n.d(t,{A:()=>Z});var o=n(2445),a=n(24002),i=n(23805),r=n.n(i),l=n(5556),s=n.n(l),d=n(2801),c=n(88217),u=n(8558),h=n(9876),p=n(81465),m=n(79378),g=n(74098),v=n(21325),f=n(97566),b=n(94229),y=n(95018),x=n(29645),S=n(74842),_=n(99106),C=n(17437),w=n(49239),A=n(40795),D=n(93590),F=n(81500),T=n(38221),E=n.n(T),$=n(90924),Y=n(58561),I=n.n(Y);const k={parsedAdvancedDataType:"",advancedDataTypeOperatorList:[],errorMessage:""};var M=n(54775),z=n(61972),R=n(52451);const O=(0,p.I4)(d.A)`
  .ant-select-selector::after {
    content: ${({labelText:e})=>e||"\\A0"};
    display: inline-block;
    white-space: nowrap;
    color: ${({theme:e})=>e.colorTextSecondary};
    width: max-content;
  }
`,N=e=>{var t,n;const{onSubjectChange:i,onOperatorChange:r,isOperatorRelevant:l,onComparatorChange:s,onDatePickerChange:c}=(e=>{const t=(0,z.IM)(),n=(t,n)=>{var o;const a=null==(o=e.datasource.columns)?void 0:o.find(e=>e.column_name===n),i=!!a&&("BOOL"===a.type||"BOOLEAN"===a.type),r=!!a&&("INT"===a.type||"INTEGER"===a.type),l=!!a&&!!a.expression;if(t&&t===w.ux.LatestPartition){const{partitionColumn:t}=e;return t&&n&&n===t}return(!t||t!==w.ux.TemporalRange)&&(t===w.ux.IsTrue||t===w.ux.IsFalse?i||r||l:i?t===w.ux.IsNull||t===w.ux.IsNotNull:e.adhocFilter.clause!==R.v.Having||-1!==w._T.indexOf(t))};return{onSubjectChange:o=>{const a=e.options.find(e=>"column_name"in e&&e.column_name===o||"optionName"in e&&e.optionName===o);let i,r="";a&&"column_name"in a?(r=a.column_name,i=R.v.Where):a&&"saved_metric_name"in a?(r=a.saved_metric_name,i=R.v.Having):null!=a&&a.label&&(r=a.label,i=R.v.Having);let{operator:l,operatorId:s,comparator:d}=e.adhocFilter;l=l&&s&&n(s,r)?w.nS[s].operation:null,(0,S.A)(l)||(l=w.ux.In,s=w.ux.In,d=void 0),(0,F.D)(o,e.datasource)&&(r=o,l=w.ux.TemporalRange,s=w.ux.TemporalRange,d=t),e.onChange(e.adhocFilter.duplicateWith({subject:r,clause:i,operator:l,expressionType:R.A.Simple,operatorId:s,comparator:d}))},onOperatorChange:t=>{const n=e.adhocFilter.comparator;let o;o=w.sJ.has(t)?Array.isArray(n)?n:[n].filter(e=>e):Array.isArray(n)?n[0]:n,t&&w.Wy.has(t)?e.onChange(e.adhocFilter.duplicateWith({subject:e.adhocFilter.subject,clause:R.v.Where,operatorId:t,operator:w.nS[t].operation,expressionType:R.A.Sql,datasource:e.datasource})):e.onChange(e.adhocFilter.duplicateWith({operatorId:t,operator:w.nS[t].operation,comparator:o,expressionType:R.A.Simple}))},onComparatorChange:t=>{e.onChange(e.adhocFilter.duplicateWith({comparator:t,expressionType:R.A.Simple}))},isOperatorRelevant:n,clearOperator:()=>{e.onChange(e.adhocFilter.duplicateWith({operatorId:void 0,operator:void 0}))},onDatePickerChange:(t,n)=>{e.onChange(e.adhocFilter.duplicateWith({subject:t,operator:w.ux.TemporalRange,comparator:n,expressionType:R.A.Simple}))}}})(e),[u,h]=(0,a.useState)([]),[v,f]=(0,a.useState)(e.adhocFilter.comparator),[b,T]=(0,a.useState)(!1),{advancedDataTypesState:Y,subjectAdvancedDataType:N,fetchAdvancedDataTypeValueCallback:L,fetchSubjectAdvancedDataType:U}=(e=>{const[t,n]=(0,a.useState)(k),[o,i]=(0,a.useState)(),r=(0,a.useCallback)((t,o,a)=>{const i=(0,$.A)(t);a?E()(()=>{const t=`/api/v1/advanced_data_type/convert?q=${I().encode({type:a,values:i})}`;m.A.get({endpoint:t}).then(({json:t})=>{n({parsedAdvancedDataType:t.result.display_value,advancedDataTypeOperatorList:t.result.valid_filter_operators,errorMessage:t.result.error_message}),e(!t.result.error_message)}).catch(()=>{n({parsedAdvancedDataType:"",advancedDataTypeOperatorList:o.advancedDataTypeOperatorList,errorMessage:(0,g.t)("Failed to retrieve advanced type")}),e(!1)})},600)():n(k)},[e]);return{advancedDataTypesState:t,subjectAdvancedDataType:o,setAdvancedDataTypesState:n,fetchAdvancedDataTypeValueCallback:r,fetchSubjectAdvancedDataType:e=>{const t=e.options.find(t=>"column_name"in t&&t.column_name===e.adhocFilter.subject||"optionName"in t&&t.optionName===e.adhocFilter.subject);t&&"advanced_data_type"in t?i(t.advanced_data_type):e.validHandler(!0)}}})(e.validHandler),q=(e,t)=>N?l(e,t)&&Y.advancedDataTypeOperatorList.includes(e):l(e,t),H=()=>{const e=(()=>{const e=Array.isArray(v)?v.filter(e=>u.includes(e)).length:0;return u?u.length-e:0})(),t=(0,g.t)("%s option(s)",e);return e?t:""};let j=e.options;const{subject:P,operator:V,operatorId:B}=e.adhocFilter,W={ariaLabel:(0,g.t)("Select subject"),value:null!=P?P:void 0,onChange:e=>{f(void 0),i(e)},notFoundContent:(0,g.t)("No such column found. To filter on a metric, try the Custom SQL tab."),autoFocus:!P,placeholder:""};W.placeholder=e.adhocFilter.clause===R.v.Where?(0,g.t)("%s column(s)",j.length):(0,g.t)("To filter on a metric, use Custom SQL tab."),j=e.options.filter(e=>"column_name"in e&&e.column_name);const G={placeholder:(0,g.t)("%s operator(s)",(null!=(t=e.operators)?t:w.RX).filter(e=>q(e,P)).length),value:B,onChange:r,autoFocus:!!W.value&&!V,ariaLabel:(0,g.t)("Select operator")},Q=!!W.value&&!!G.value,K={allowClear:!0,allowNewOptions:!0,ariaLabel:(0,g.t)("Comparator option"),mode:w.sJ.has(B)?"multiple":"single",loading:b,value:v,onChange:s,notFoundContent:(0,g.t)("Type a value here"),disabled:w.Sd.includes(B),placeholder:H(),autoFocus:Q},X=v&&v.length>0&&H(),J=(0,M.w)({columnName:e.adhocFilter.subject,timeRange:e.adhocFilter.operator===w.ux.TemporalRange?e.adhocFilter.comparator:void 0,datasource:e.datasource,onChange:c});(0,a.useEffect)(()=>{J||(()=>{const{datasource:t}=e,n=e.adhocFilter.subject,o=e.adhocFilter.clause===R.v.Having;if(n&&t&&t.filter_select&&!o){const e=new AbortController,{signal:o}=e;b&&e.abort(),T(!0),m.A.get({signal:o,endpoint:`/api/v1/datasource/${t.type}/${t.id}/column/${n}/values/`}).then(({json:e})=>{h(e.result.map(e=>({value:e,label:(0,D.ed)(e)}))),T(!1)}).catch(()=>{h([]),T(!1)})}})()},[e.adhocFilter.subject]),(0,a.useEffect)(()=>{(0,_.G7)(_.TO.EnableAdvancedDataTypes)&&U(e)},[e.adhocFilter.subject]),(0,a.useEffect)(()=>{(0,_.G7)(_.TO.EnableAdvancedDataTypes)&&L(void 0===v?"":v,Y,N)},[v,N,L]),(0,a.useEffect)(()=>{(0,_.G7)(_.TO.EnableAdvancedDataTypes)&&f(e.adhocFilter.comparator)},[e.adhocFilter.comparator]);const Z=(0,p.DP)(),ee=(0,o.Y)(d.A,{css:{marginTop:4*Z.sizeUnit,marginBottom:4*Z.sizeUnit},options:j.map(e=>{return{value:"column_name"in e&&e.column_name||"optionName"in e&&e.optionName||"",key:"id"in e&&e.id||"optionName"in e&&e.optionName||void 0,label:(t=e,(0,o.Y)(A.A,{option:t}))};var t}),...W}),te=(0,o.FD)(o.FK,{children:[(0,o.Y)(d.A,{options:(null!=(n=e.operators)?n:w.RX).filter(e=>q(e,P)).map((e,t)=>({value:e,label:w.nS[e].display,key:e,order:t})),...G}),w.sJ.has(B)||u.length>0?(0,o.Y)(y.m,{title:Y.errorMessage||Y.parsedAdvancedDataType,children:(0,o.Y)(O,{css:C.AH`
              margin-top: ${4*Z.sizeUnit}px;
            `,labelText:X,options:u,...K})}):(0,o.FD)(y.m,{title:Y.errorMessage||Y.parsedAdvancedDataType,children:[(0,o.Y)("div",{css:C.AH`
              margin-top: ${4*Z.sizeUnit}px;
            `}),(0,o.Y)(x.Input,{name:"filter-value",ref:e=>{e&&Q&&e.focus()},onChange:e=>{const{value:t}=e.target;f(t),s(t)},value:v,placeholder:(0,g.t)("Filter value (case sensitive)"),disabled:w.Sd.includes(B)})]})]});return(0,o.FD)(o.FK,{children:[ee,null!=J?J:te]})};var L,U=n(48582),q=n(64216),H=n(51014);!function(e){e.COLUMN="column",e.METRIC="metric",e.WHERE="where",e.HAVING="having"}(L||(L={}));const j=(0,p.I4)(d.A)`
  ${({theme:e})=>`\n    width: ${30*e.sizeUnit}px;\n    marginRight: ${e.sizeUnit}px;\n  `}
`;function P({adhocFilter:e,onChange:t,options:n,height:i,datasource:r}){const l=(0,a.useRef)(null),s=(0,p.DP)();(0,a.useEffect)(()=>{var e;null==l||null==(e=l.current)||e.editor.resize()},[e]);const d=(0,a.useMemo)(()=>U.A.concat((0,q.r)(n.filter(e=>"object"==typeof e&&null!==e&&"column_name"in e&&"string"==typeof e.column_name&&"type"in e))),[U.A]),c=(0,a.useMemo)(()=>Object.values(R.v).map(e=>({label:e,value:e})),[R.v]);return(0,o.FD)("span",{children:[(0,o.FD)("div",{className:"filter-edit-clause-section",children:[(0,o.Y)("div",{children:(0,o.Y)(j,{options:c,ariaLabel:(0,g.t)("Select column"),placeholder:(0,g.t)("choose WHERE or HAVING..."),value:e.clause,onChange:n=>{t(e.duplicateWith({clause:n,expressionType:R.A.Sql}))}})}),(0,o.FD)("span",{className:"filter-edit-clause-info",children:[(0,o.Y)("strong",{children:"WHERE"})," ",(0,g.t)("Filters by columns"),(0,o.Y)("br",{}),(0,o.Y)("strong",{children:"HAVING"})," ",(0,g.t)("Filters by metrics")]})]}),(0,o.Y)("div",{css:C.AH`
          margin-top: ${4*s.sizeUnit}px;
        `,children:(0,o.Y)(H.A,{ref:l,keywords:d.map(e=>"string"==typeof e?e:e.value||e.name||e),height:i-130+"px",onChange:n=>{t(e.duplicateWith({sqlExpression:n,expressionType:R.A.Sql}))},width:"100%",showGutter:!1,value:e.sqlExpression||e.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0,showValidation:!0,expressionType:"HAVING"===e.clause?L.HAVING:L.WHERE,datasourceId:null==r?void 0:r.id,datasourceType:null==r?void 0:r.type})})]})}const V={adhocFilter:s().instanceOf(b.A).isRequired,onChange:s().func.isRequired,onClose:s().func.isRequired,onResize:s().func.isRequired,options:s().arrayOf(s().oneOfType([s().shape({column_name:s().string,type:s().string}),s().shape({saved_metric_name:s().string.isRequired}),f.A])).isRequired,datasource:s().object,partitionColumn:s().string,theme:s().object,sections:s().arrayOf(s().string),operators:s().arrayOf(s().string),requireSave:s().bool},B=p.I4.div`
  .adhoc-filter-edit-tabs > .nav-tabs {
    margin-bottom: ${({theme:e})=>2*e.sizeUnit}px;

    & > li > a {
      padding: ${({theme:e})=>e.sizeUnit}px;
    }
  }

  #filter-edit-popover {
    max-width: none;
  }

  .filter-edit-clause-info {
    font-size: ${({theme:e})=>e.fontSizeXS}px;
  }

  .filter-edit-clause-section {
    display: flex;
    flex-direction: row;
    gap: ${({theme:e})=>5*e.sizeUnit}px;
  }

  .adhoc-filter-simple-column-dropdown {
    margin-top: ${({theme:e})=>5*e.sizeUnit}px;
  }
`,W=p.I4.div`
  margin-top: ${({theme:e})=>2*e.sizeUnit}px;
`,G=p.I4.div`
  margin-top: ${({theme:e})=>2*e.sizeUnit}px;
  margin-bottom: ${({theme:e})=>12*e.sizeUnit}px;
`;class Q extends a.Component{constructor(e){var t;super(e),this.onSave=this.onSave.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onAdhocFilterChange=this.onAdhocFilterChange.bind(this),this.setSimpleTabIsValid=this.setSimpleTabIsValid.bind(this),this.adjustHeight=this.adjustHeight.bind(this),this.onTabChange=this.onTabChange.bind(this),this.loadLayerOptions=this.loadLayerOptions.bind(this),this.onLayerChange=this.onLayerChange.bind(this),this.state={adhocFilter:this.props.adhocFilter,width:w._R,height:w.Z_,activeKey:(null==(t=this.props)||null==(t=t.adhocFilter)?void 0:t.expressionType)||"SIMPLE",isSimpleTabValid:!0,selectedLayers:[{id:null,value:-1,label:"All"}],layerOptions:[],hasLayerFilterScopeChanged:!1},this.popoverContentRef=(0,a.createRef)()}componentDidMount(){var e;document.addEventListener("mouseup",this.onMouseUp),null!=(e=this.props.adhocFilter)&&e.deck_slices&&this.props.adhocFilter.deck_slices.length>0&&this.loadLayerOptions(0,100).then(e=>{var t;this.setState({layerOptions:e.data});const n=null==(t=this.props.adhocFilter)?void 0:t.layerFilterScope;if(n){const t=n.map(t=>e.data.find(e=>e.value===t));this.setState({selectedLayers:t})}})}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onAdhocFilterChange(e){this.setState({adhocFilter:e})}setSimpleTabIsValid(e){this.setState({isSimpleTabValid:e})}onSave(){if(!(this.state.adhocFilter.deck_slices&&this.state.adhocFilter.deck_slices.length>0))return this.props.onChange(this.state.adhocFilter),void this.props.onClose();const e=this.state.selectedLayers.map(e=>r()(e)?e.value:e),t={...this.state.adhocFilter,layerFilterScope:e};this.setState({hasLayerFilterScopeChanged:!1}),this.props.onChange(t),this.props.onClose()}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),w._R),height:Math.max(this.dragStartHeight+(e.clientY-this.dragStartY),w.Z_)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.setState({activeKey:e})}adjustHeight(e){this.setState(t=>({height:t.height+e}))}loadLayerOptions(e,t){const n=I().encode({columns:["id","slice_name","viz_type"],filters:[{col:"viz_type",opr:"sw",value:"deck"}],page:e,page_size:t,order_column:"slice_name",order_direction:"asc"});return m.A.get({endpoint:`/api/v1/chart/?q=${n}`}).then(e=>{var t,n;if(null==e||null==(t=e.json)||!t.result)return{data:[{id:null,value:-1,label:"All"}],totalCount:1};const o=(null==(n=this.props.adhocFilter)?void 0:n.deck_slices)||[],a=[{id:null,value:-1,label:"All"},...e.json.result.map(e=>{const t=o.indexOf(e.id);return{id:e.id,value:t>=0?t:e.id,label:e.slice_name,sliceIndex:t}}).filter(e=>-1!==e.sliceIndex).map(({sliceIndex:e,...t})=>t)];return{data:a,totalCount:a.length}})}onLayerChange(e){let t=e;e&&0!==e.length?e.length>1&&e.some(e=>-1===e.value||-1===e)&&(t=-1===e[e.length-1].value||-1===e[e.length-1]?[{id:null,value:-1,label:"All"}]:e.filter(e=>-1!==e.value).filter(e=>-1!==e)):t=[{id:null,value:-1,label:"All"}],this.setState({selectedLayers:t}),this.setState({hasLayerFilterScopeChanged:!0})}render(){const{adhocFilter:e,options:t,onChange:n,onClose:a,onResize:i,datasource:r,partitionColumn:l,theme:s,operators:p,requireSave:m,...f}=this.props,{adhocFilter:b,selectedLayers:y,hasLayerFilterScopeChanged:x}=this.state,S=b.isValid(),_=m||!b.equals(e)||x,C=b.deck_slices&&b.deck_slices.length>0;return(0,o.FD)(B,{id:"filter-edit-popover",...f,ref:this.popoverContentRef,children:[(0,o.Y)(v.Ay,{id:"adhoc-filter-edit-tabs",defaultActiveKey:b.expressionType,className:"adhoc-filter-edit-tabs",style:{minHeight:this.state.height,width:this.state.width},allowOverflow:!0,onChange:this.onTabChange,items:[{key:R.A.Simple,label:(0,g.t)("Simple"),children:(0,o.Y)(h.tH,{children:(0,o.Y)(N,{operators:p,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:r,onHeightChange:this.adjustHeight,partitionColumn:l,popoverRef:this.popoverContentRef.current,validHandler:this.setSimpleTabIsValid})})},{key:R.A.Sql,label:(0,g.t)("Custom SQL"),children:(0,o.Y)(h.tH,{children:(0,o.Y)(P,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height,activeKey:this.state.activeKey,datasource:r})})}]}),C&&(0,o.Y)(G,{children:(0,o.Y)(d.A,{options:this.state.layerOptions,onChange:this.onLayerChange,value:y,mode:"multiple"})}),(0,o.FD)(W,{children:[(0,o.Y)(c.$,{buttonStyle:"secondary",buttonSize:"small",onClick:this.props.onClose,cta:!0,children:(0,g.t)("Close")}),(0,o.Y)(c.$,{disabled:!S||!this.state.isSimpleTabValid||!_,buttonStyle:"primary",buttonSize:"small",onClick:this.onSave,cta:!0,children:(0,g.t)("Save")}),(0,o.Y)(u.F.ArrowsAltOutlined,{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"edit-popover-resize"})]})]})}}Q.propTypes=V;var K=n(37986),X=n(13817);class J extends a.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.state={popoverVisible:!1}}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1)}togglePopover(e){this.setState({popoverVisible:e})}render(){const{adhocFilter:e,isControlledComponent:t}=this.props,{visible:n,togglePopover:a,closePopover:i}=t?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},r=(0,o.Y)(K.y,{children:(0,o.Y)(Q,{adhocFilter:e,options:this.props.options,datasource:this.props.datasource,partitionColumn:this.props.partitionColumn,onResize:this.onPopoverResize,onClose:i,sections:this.props.sections,operators:this.props.operators,onChange:this.props.onFilterEdit,requireSave:this.props.requireSave})});return(0,o.Y)(X.A,{trigger:"click",content:r,defaultOpen:n,open:n,onOpenChange:a,destroyTooltipOnHide:!0,children:this.props.children})}}const Z=J},21275:(e,t,n)=>{n.d(t,{A:()=>Be});var o,a=n(61225),i=n(82960),r=n(50880),l=n(25875),s=n(2445),d=n(24002),c=n(74098),u=n(81465),h=n(75574),p=n(99106),m=n(90924),g=n(79104),v=n(56196),f=n(80711),b=n(9876),y=n(50816),x=n(85923),S=n(31296),_=n(3189);!function(e){e.Explore="explore",e.Dashboard="dashboard"}(o||(o={}));var C,w=n(59246),A=n(88055),D=n.n(A),F=n(2404),T=n.n(F),E=n(4124),$=n.n(E),Y=n(5556),I=n.n(Y),k=n(81115),M=n(18749),z=n(7741),R=n(42152),O=n(18036),N=n.n(O),L=n(1763),U=n(15008),q=n(28827),H=n(35352),j=n(17437),P=n(74842),V=n(71519),B=n(88217),W=n(97163),G=n(76576),Q=n(29645),K=n(94185),X=n(75134),J=n(94921),Z=n(68690),ee=n(75388),te=n(64457),ne=n(90886),oe=n(28674),ae=n(60838);function ie({formData:e,result:t,dataset:n,onContextMenu:o,inContextMenu:a}){const i=(0,d.useMemo)(()=>({onContextMenu:o}),[o]);return(0,s.Y)("div",{css:j.AH`
        width: 100%;
        height: 100%;
        min-height: 0;
      `,children:(0,s.Y)(R.A,{disableErrorBoundary:!0,chartType:e.viz_type,enableNoResults:!0,datasource:n,formData:e,queriesData:t,hooks:i,inContextMenu:a,height:"100%",width:"100%"})})}!function(e){e[e.Chart=0]="Chart",e[e.Table=1]="Table"}(C||(C={}));var re=n(22750),le=n(37201),se=n(21325);const de=u.I4.div`
  ${({theme:e})=>j.AH`
    & .pagination-container {
      bottom: ${4*-e.sizeUnit}px;
    }
  `}
`,ce="adhoc_filters",ue=({formData:e,closeModal:t})=>{const n=(0,a.wA)(),{addDangerToast:o}=(0,te.Yf)(),i=(0,u.DP)(),[r,h]=(0,d.useState)(""),p=(0,d.useContext)(X.DashboardPageIdContext),m=(0,d.useCallback)(()=>{n((0,l.logEvent)(y.Ro,{slice_id:e.slice_id}))},[n,e.slice_id]),g=(0,a.d4)(e=>{var t;return(0,ne.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)}),[v,f]=e.datasource.split("__");(0,d.useEffect)(()=>{(0,ae.n)()||(0,J.T)(Number(v),f,e,0).then(e=>{h(`/explore/?form_data_key=${e}&dashboard_page_id=${p}`)}).catch(()=>{o((0,c.t)("Failed to generate chart edit URL"))})},[o,p,v,f,e]);const b=!r||!g;return(0,s.FD)(s.FK,{children:[!(0,ae.n)()&&(0,s.Y)(B.$,{buttonStyle:"secondary",buttonSize:"small",onClick:m,disabled:b,tooltip:b?(0,c.t)("You do not have sufficient permissions to edit the chart"):void 0,children:(0,s.Y)(V.N_,{css:j.AH`
              &:hover {
                text-decoration: none;
              }
            `,to:r,children:(0,c.t)("Edit chart")})}),(0,s.Y)(B.$,{buttonStyle:"primary",buttonSize:"small",onClick:t,css:j.AH`
          margin-left: ${2*i.sizeUnit}px;
        `,children:(0,c.t)("Close")})]})};function he({column:e,dataset:t,drillByConfig:n,formData:o,onHideModal:i,canDownload:h}){const p=(0,a.wA)(),g=(0,u.DP)(),{addDangerToast:f}=(0,te.Yf)(),[b,x]=(0,d.useState)(!0),[S,_]=(0,d.useState)([{...n,column:e}]);(0,d.useEffect)(()=>{p((0,l.logEvent)(y.bD,{slice_id:o.slice_id}))},[p,o.slice_id]);const{column:w,groupbyFieldName:A=n.groupbyFieldName}=S[S.length-1]||{},D=(0,d.useMemo)(()=>(0,m.A)(o[A]).map(e=>{var n;return null==(n=t.columns)?void 0:n.find(t=>t.column_name===e)}).filter(P.A),[t.columns,o,A]),{displayModeToggle:F,drillByDisplayMode:T}=(()=>{const[e,t]=(0,d.useState)(C.Chart);return{displayModeToggle:(0,d.useMemo)(()=>(0,s.Y)("div",{css:e=>j.AH`
          margin-bottom: ${6*e.sizeUnit}px;
        `,children:(0,s.Y)(re.s.GroupWrapper,{onChange:({target:{value:e}})=>{t(e)},defaultValue:C.Chart,options:[{label:(0,c.t)("Chart"),value:C.Chart},{label:(0,c.t)("Table"),value:C.Table}],optionType:"button",buttonStyle:"outline"})}),[]),drillByDisplayMode:e}})(),[E,$]=(0,d.useState)(),Y=((e,t,n)=>(0,P.A)(e)?1===e.length?(0,s.Y)(de,{children:(0,s.Y)(le.U,{colnames:e[0].colnames,coltypes:e[0].coltypes,rowcount:e[0].sql_rowcount,data:e[0].data,dataSize:15,datasourceId:t,isVisible:!0,canDownload:n})}):(0,s.Y)(se.Ay,{defaultActiveKey:"result-tab-0",items:e.map((e,o)=>({key:`result-tab-${o}`,label:(0,c.t)("Results %s",o+1),children:(0,s.Y)(de,{children:(0,s.Y)(le.U,{colnames:e.colnames,coltypes:e.coltypes,data:e.data,rowcount:e.sql_rowcount,dataSize:15,datasourceId:t,isVisible:!0,canDownload:n})})}))}):(0,s.Y)("div",{}))(E,o.datasource,h),[I,k]=(0,d.useState)(o),[M,z]=(0,d.useState)([...D,e].filter(P.A)),[R,O]=(0,d.useState)([{groupby:D,filters:n.filters},{groupby:e||[]}]),N=(0,d.useCallback)((e,t=A)=>Array.isArray(o[t])?[e.column_name]:e.column_name,[o,A]),L=(0,d.useCallback)(e=>e.reduce((e,t)=>{null!=t&&t.groupbyFieldName&&t.column&&(e.formData[t.groupbyFieldName]=N(t.column,t.groupbyFieldName),e.overriddenGroupbyFields.add(t.groupbyFieldName));const n=(null==t?void 0:t.adhocFilterFieldName)||ce;return e.formData[n]=[...(0,m.A)(e[n]),...(0,m.A)(t.filters).map(e=>(0,Z.r)(e))],e.overriddenAdhocFilterFields.add(n),e},{formData:{},overriddenGroupbyFields:new Set,overriddenAdhocFilterFields:new Set}),[N]),U=(0,d.useCallback)(()=>S.reduce((e,t)=>{const n=t.adhocFilterFieldName||ce;return e[n]=[...e[n]||[],...t.filters.map(e=>(0,Z.r)(e))],e},{}),[S]),q=(0,d.useCallback)((e,t)=>{p((0,l.logEvent)(y.g$,{slice_id:o.slice_id})),_(e=>e.slice(0,t)),O(e=>{const n=e.slice(0,t+1);return delete n[n.length-1].filters,n}),z(e=>e.slice(0,t)),k(()=>{if(0===t)return o;const{formData:e,overriddenAdhocFilterFields:n}=L(S.slice(0,t)),a={...o,...e};return n.forEach(t=>({...a,[t]:[...o[t],...e[t]]})),a})},[p,S,o,L]),H=R.map((e,t)=>{const n=t<R.length-1,o=(0,m.A)(e.groupby).length>0,a=(0,m.A)(e.filters).length>0;if(!o&&!a)return;const i=(0,m.A)(e.groupby).map(e=>e.verbose_name||e.column_name).join(", ");return{title:`${i} ${a?`(${(0,m.A)(e.filters).map(e=>{var t;return null!=(t=e.formattedVal)?t:String(e.val)}).join(", ")})`:""}`.trim(),onClick:n?()=>q(e,t):void 0}}).filter(e=>void 0!==e),V=(0,d.useMemo)(()=>{let e={...I};w&&A&&(e[A]=N(w));const t=U();return Object.keys(t).forEach(n=>{e={...e,[n]:[...(0,m.A)(o[n]),...t[n]]}}),e.slice_id=0,delete e.slice_name,delete e.dashboards,e},[I,w,A,U,N,o]);(0,d.useEffect)(()=>{z(e=>!w||e.some(e=>e.column_name===w.column_name)?e:[...e,w])},[w]);const B=(0,d.useCallback)((e,t)=>{p((0,l.logEvent)(y.gi,{drill_depth:S.length+1,slice_id:o.slice_id})),k(V),_(n=>[...n,{...t,column:e}]),O(n=>{const o=[...n,{groupby:e}];return o[o.length-2].filters=t.filters,o})},[p,S.length,V,o.slice_id]),X=(0,d.useMemo)(()=>({drillBy:{excludedColumns:M,openNewModal:!1}}),[M]),{contextMenu:J,inContextMenu:ne,onContextMenu:ae}=((e,t,n,o,a)=>{const i=(0,d.useRef)(null),[r,l]=(0,d.useState)(!1),c=(0,d.useCallback)((...e)=>{l(!1),null==n||n(...e)},[n]),u=(0,d.useCallback)(()=>{l(!1)},[]);return{contextMenu:(0,d.useMemo)(()=>(0,s.Y)(Te,{ref:i,id:0,formData:t,onSelection:c,onClose:u,displayedItems:o,additionalConfig:a}),[a,0,o,t,u,c]),inContextMenu:r,onContextMenu:(e,t,n)=>{var o;null==(o=i.current)||o.open(e,t,n),l(!0)}}})(0,I,B,Ae.DrillBy,X),he=(0,a.d4)(e=>{const t=Object.values(e.dashboardLayout.present).find(e=>{var t;return(null==(t=e.meta)?void 0:t.chartId)===o.slice_id});return(null==t?void 0:t.meta.sliceNameOverride)||(null==t?void 0:t.meta.sliceName)});(0,d.useEffect)(()=>{if(V){const[e]=(0,oe.Mp)(V);x(!0),$(void 0),(0,r.getChartDataRequest)({formData:V}).then(({response:t,json:n})=>(0,r.handleChartDataResponse)(t,n,e)).then(e=>{$(e)}).catch(()=>{f((0,c.t)("Failed to load chart data."))}).finally(()=>{x(!1)})}},[f,V]);const{metadataBar:pe}=(0,ee.M)({dataset:t});return(0,s.Y)(W.aF,{css:j.AH`
        .ant-modal-footer {
          border-top: none;
        }
      `,show:!0,onHide:null!=i?i:()=>null,name:(0,c.t)("Drill by: %s",he),title:(0,c.t)("Drill by: %s",he),footer:(0,s.Y)(ue,{formData:V}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*g.sizeUnit,minWidth:128*g.sizeUnit,defaultSize:{width:"auto",height:"80vh"}},draggable:!0,destroyOnHidden:!0,maskClosable:!1,children:(0,s.FD)(G.s,{vertical:!0,gap:g.sizeUnit,css:j.AH`
          height: 100%;
        `,children:[pe,(0,s.Y)(Q.Breadcrumb,{css:j.AH`
            margin-bottom: ${2*g.sizeUnit}px;
          `,items:H,itemRender:(e,t,n,o)=>n.indexOf(e)===n.length-1?(0,s.FD)("span",{children:[e.title,o]}):(0,s.Y)("span",{role:"button",tabIndex:0,onClick:e.onClick,css:j.AH`
                  cursor: pointer;
                `,children:e.title})}),F,b&&(0,s.Y)(v.R,{}),!b&&!E&&(0,s.Y)(K.F,{type:"error",message:(0,c.t)("There was an error loading the chart data")}),T===C.Chart&&E&&(0,s.Y)(ie,{dataset:t,formData:V,result:E,onContextMenu:ae,inContextMenu:ne}),T===C.Table&&E&&Y,J]})})}var pe=n(28522),me=n(52791),ge=n(13981),ve=n(38221),fe=n.n(ve),be=n(23575),ye=n(8558),xe=n(23576),Se=n(5373),_e=n(70353),Ce=n(27915);const we=({drillByConfig:e,formData:t,onSelection:n=()=>{},onClick:o=()=>{},onCloseMenu:a=()=>{},openNewModal:i=!0,excludedColumns:r,onDrillBy:l,dataset:h,isLoadingDataset:p=!1,...g})=>{const f=(0,u.DP)(),[b,y]=(0,d.useState)(""),[x,S]=(0,d.useState)(""),[_,C]=(0,d.useState)(!1),w=(0,d.useRef)(null),A=(0,d.useRef)(null),D=(0,d.useMemo)(()=>h?(0,m.A)(h.drillable_columns):[],[h]),F=D.length>10,T=(0,d.useCallback)((t,r)=>{o(t),n(r,e),i&&l&&h&&l(r,h),C(!1),a()},[e,o,n,i,l,h,a]);(0,d.useEffect)(()=>{let e;return _?e=setTimeout(()=>{var e;null==(e=w.current)||null==(e=e.input)||e.focus({preventScroll:!0})},100):(y(""),S("")),()=>{e&&clearTimeout(e)}},[_]);const E=null==e?void 0:e.groupbyFieldName,$=(0,d.useMemo)(()=>{var e;return null==(e=(0,M.A)().get(t.viz_type))?void 0:e.behaviors.find(e=>e===k.nS.DrillBy)},[t.viz_type]),Y=(0,d.useMemo)(()=>fe()(e=>{S(e)},be.Y.FAST_DEBOUNCE),[]),I=(0,d.useMemo)(()=>D.filter(e=>!((null==r?void 0:r.map(e=>e.column_name))||[]).includes(e.column_name)).filter(e=>(e.verbose_name||e.column_name).toLowerCase().includes(x.toLowerCase())),[D,x,r]);let z;if($?E||(z=(0,c.t)("Drill by is not available for this data point")):z=(0,c.t)("Drill by is not yet supported for this chart type"),!0===t.matrixify_enable_vertical_layout||!0===t.matrixify_enable_horizontal_layout)return null;const R=!$||!E,O=(0,s.FD)("div",{role:"menu",tabIndex:0,css:j.AH`
        width: 220px;
        max-width: 220px;
        .ant-input-affix-wrapper {
          margin-bottom: ${2*f.sizeUnit}px;
        }
      `,onClick:e=>e.stopPropagation(),children:[F&&(0,s.Y)(Q.Input,{ref:w,prefix:(0,s.Y)(ye.F.SearchOutlined,{iconSize:"l",iconColor:f.colorIcon}),onChange:e=>{var t;e.stopPropagation(),t=e.target.value,y(t),Y(t)},placeholder:(0,c.t)("Search columns"),onClick:e=>{e.nativeEvent.stopImmediatePropagation()},allowClear:!0,css:j.AH`
            width: 100%;
            box-shadow: none;
          `,value:b}),p?(0,s.Y)("div",{css:j.AH`
            padding: ${3*f.sizeUnit}px 0;
          `,children:(0,s.Y)(v.R,{position:"inline-centered"})}):I.length?(0,s.Y)(Se.Y1,{width:"100%",height:200,itemSize:35,itemCount:I.length,itemData:{columns:I},overscanCount:20,children:({index:e,data:t,style:n})=>{const{columns:o}=t,a=o[e];return(0,s.Y)(Ce.Gn,{tooltipText:a.verbose_name||a.column_name,onClick:e=>T(e,a),style:n,children:a.verbose_name||a.column_name})}}):(0,s.Y)("div",{css:j.AH`
            padding: ${2*f.sizeUnit}px;
            color: ${f.colorTextDisabled};
            text-align: center;
          `,children:(0,c.t)("No columns found")})]}),N=(0,s.FD)("div",{ref:A,role:"button",tabIndex:R?-1:0,css:j.AH`
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: ${R?"not-allowed":"pointer"};
        color: ${R?f.colorTextDisabled:"inherit"};
        &:hover {
          background: transparent;
        }
      `,onClick:()=>!R&&C(!_),onKeyDown:e=>{R||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),C(!_))},children:[(0,s.Y)("span",{children:(0,c.t)("Drill by")}),R?(0,s.Y)(_e.C,{title:z}):(0,s.Y)(ye.F.RightOutlined,{iconSize:"s",iconColor:f.colorTextTertiary})]});return R?N:(0,s.Y)(xe.A,{content:O,placement:"rightTop",open:_,onOpenChange:C,trigger:["hover","click"],arrow:!1,styles:{root:{paddingLeft:0},body:{padding:2*f.sizeUnit,boxShadow:f.boxShadow,borderRadius:f.borderRadius}},...g,children:N})};var Ae,De=n(30747);!function(e){e[e.CrossFilter=0]="CrossFilter",e[e.DrillToDetail=1]="DrillToDetail",e[e.DrillBy=2]="DrillBy",e[e.All=3]="All"}(Ae||(Ae={}));const Fe=({id:e,formData:t,onSelection:n,onClose:o,displayedItems:i=Ae.All,additionalConfig:r},l)=>{var h,g,v,f,b;const y=(0,a.wA)(),x=(0,u.DP)(),{canDrillToDetail:S,canDrillBy:_,canDownload:C}=(0,U.S)(),A=(0,a.d4)(({dashboardInfo:e})=>e.crossFiltersEnabled),D=(0,a.d4)(({dashboardInfo:e})=>e.id),[F,T]=(0,d.useState)([]),[E,$]=(0,d.useState)(!1),Y=e=>i===Ae.All||(0,m.A)(i).includes(e),[{filters:I,clientX:z,clientY:R},O]=(0,d.useState)({clientX:0,clientY:0}),j=(0,d.useMemo)(()=>{if(!I)return I;const e=null==I?void 0:I.matrixifyContext;if(!e)return I;const t=I.drillBy?{...I.drillBy,filters:[...I.drillBy.filters||[],...e.cellFilters||[]]}:void 0;return{...I,drillBy:t}},[I]),P=(0,d.useMemo)(()=>{const e=null==I?void 0:I.matrixifyContext;return(null==e?void 0:e.cellFormData)||t},[I,t]),[V,B]=(0,d.useState)(!1),[W,G]=(0,d.useState)(),[Q,K]=(0,d.useState)(!1),X=(0,d.useCallback)(()=>{$(!1),o()},[o]),J=(0,d.useCallback)(e=>{G(e),K(!0)},[]),Z=(0,L.a)().get("load.drillby.options"),ee=(0,d.useCallback)(()=>{K(!1)},[]),te=[],ne=(0,p.G7)(p.TO.DrillToDetail)&&S&&Y(Ae.DrillToDetail),oe=(0,p.G7)(p.TO.DrillBy)&&_&&Y(Ae.DrillBy)&&!(!0===t.matrixify_enable_vertical_layout||!0===t.matrixify_enable_horizontal_layout),ae=(0,pe.t_)(t.datasource,D,t,!S&&!_),ie=ae.status===w.bk.Loading,re=(0,d.useMemo)(()=>{if(ae.status!==w.bk.Complete)return;if(!oe)return ae.result;const e=ae.result,n=(0,m.A)(e.columns).filter(e=>{var n,o,a,i;return(!Z||e.groupby)&&!(0,m.A)(t[null!=(n=null==I||null==(o=I.drillBy)?void 0:o.groupbyFieldName)?n:""]).includes(e.column_name)&&e.column_name!==t.x_axis&&(null==(a=(0,m.A)(null==r||null==(i=r.drillBy)?void 0:i.excludedColumns))?void 0:a.every(t=>t.column_name!==e.column_name))});return{...e,drillable_columns:n}},[ae.status,ae.result,oe,null==j||null==(h=j.drillBy)?void 0:h.groupbyFieldName,t.x_axis,t[null!=(g=null==j||null==(v=j.drillBy)?void 0:v.groupbyFieldName)?g:""],null==r||null==(f=r.drillBy)?void 0:f.excludedColumns,Z]),le=Y(Ae.CrossFilter),se=null==(b=(0,M.A)().get(t.viz_type))||null==(b=b.behaviors)?void 0:b.includes(k.nS.InteractiveChart);let de=0;le&&(de+=1),ne&&(de+=2),oe&&(de+=1),0===de&&(de=1);const ce=(0,me.R)({formData:P,filters:null==I?void 0:I.drillToDetail,setFilters:T,isContextMenu:!0,contextMenuY:R,onSelection:n,submenuIndex:le?2:1,setShowModal:B,dataset:re,isLoadingDataset:ie,...(null==r?void 0:r.drillToDetail)||{}});if(le){var ue;const t=!se||!A||!(null!=I&&I.crossFilter);let n=null;t?A?se?null!=I&&I.crossFilter||(n=(0,s.Y)(s.FK,{children:(0,s.Y)("div",{children:(0,c.t)("You can't apply cross-filter on this data point.")})})):n=(0,s.Y)(s.FK,{children:(0,s.Y)("div",{children:(0,c.t)("This visualization type does not support cross-filtering.")})}):n=(0,s.Y)(s.FK,{children:(0,s.Y)("div",{children:(0,c.t)("Cross-filtering is not enabled for this dashboard.")})}):n=(0,s.FD)(s.FK,{children:[(0,s.Y)("div",{children:(0,c.t)("Cross-filter will be applied to all of the charts that use this dataset.")}),(0,s.Y)("div",{children:(0,c.t)("You can also just click on the chart to apply cross-filter.")})]}),te.push({key:"cross-filtering-menu-item",label:null!=I&&null!=(ue=I.crossFilter)&&ue.isCurrentValueSelected?(0,c.t)("Remove cross-filter"):(0,s.FD)("span",{children:[(0,c.t)("Add cross-filter"),(0,s.Y)(_e.C,{title:n,color:t?void 0:x.colorIcon})]}),disabled:t,onClick:()=>{null!=I&&I.crossFilter&&y((0,H.Mv)(e,I.crossFilter.dataMask))}},...de>1?[{key:"divider-1",type:"divider"}]:[])}if(ne&&te.push(...ce),oe){var ve,fe;te.length>0&&te.push({key:"divider-drill-by",type:"divider"});const e=null==j||null==(ve=j.drillBy)?void 0:ve.groupbyFieldName,o=!(null==(fe=(0,M.A)().get(t.viz_type))?void 0:fe.behaviors.find(e=>e===k.nS.DrillBy))||!e;te.push({key:"drill-by-submenu",disabled:o,label:(0,s.Y)(we,{drillByConfig:null==j?void 0:j.drillBy,onSelection:n,onCloseMenu:X,formData:t,onDrillBy:J,dataset:re,isLoadingDataset:ie,...(null==r?void 0:r.drillBy)||{}})})}const be=(0,d.useCallback)((t,n,o)=>{var a;const i=(0,ge.x4)(n,de);O({clientX:t,clientY:i,filters:o}),null==(a=document.getElementById(`hidden-span-${e}`))||a.click()},[e,de]);return(0,d.useImperativeHandle)(l,()=>({open:be}),[be]),N().createPortal((0,s.FD)(s.FK,{children:[(0,s.Y)(q.ms,{menu:{items:te.length>0?te:[{key:"no-actions",label:(0,c.t)("No actions"),disabled:!0}],onClick:()=>{$(!1),o()}},dropdownRender:e=>(0,s.Y)("div",{children:e}),trigger:["click"],onOpenChange:e=>{$(e)},open:E,children:(0,s.Y)("span",{id:`hidden-span-${e}`,css:{visibility:"hidden",position:"fixed",top:R,left:z,width:1,height:1}})}),ne&&(0,s.Y)(De.A,{initialFilters:F,chartId:e,formData:P,showModal:V,onHideModal:()=>{B(!1)},dataset:re}),Q&&W&&re&&(null==j?void 0:j.drillBy)&&(0,s.Y)(he,{column:W,drillByConfig:null==j?void 0:j.drillBy,formData:t,onHideModal:ee,dataset:re,canDownload:C})]}),document.body)},Te=(0,d.forwardRef)(Fe),Ee={annotationData:I().object,actions:I().object,chartId:I().number.isRequired,datasource:I().object,initialValues:I().object,formData:I().object.isRequired,latestQueryFormData:I().object,labelsColor:I().object,labelsColorMap:I().object,height:I().number,width:I().number,setControlValue:I().func,vizType:I().string.isRequired,triggerRender:I().bool,chartAlert:I().string,chartStatus:I().string,queriesResponse:I().arrayOf(I().object),triggerQuery:I().bool,chartIsStale:I().bool,addFilter:I().func,setDataMask:I().func,onFilterMenuOpen:I().func,onFilterMenuClose:I().func,ownState:I().object,postTransformProps:I().func,source:I().oneOf([o.Dashboard,o.Explore]),emitCrossFilters:I().bool},$e={},Ye=[k.nS.InteractiveChart],Ie={addFilter:()=>$e,onFilterMenuOpen:()=>$e,onFilterMenuClose:()=>$e,initialValues:$e,setControlValue(){},triggerRender:!1};class ke extends d.Component{constructor(e){var t,n;super(e);const a=null==(t=(0,M.A)().get(null!=(n=e.formData.viz_type)?n:e.vizType))?void 0:t.suppressContextMenu;this.state={showContextMenu:e.source===o.Dashboard&&!a&&(0,p.G7)(p.TO.DrillToDetail),inContextMenu:!1,legendState:void 0,legendIndex:0,dhis2Data:null,dhis2DataLoading:!1,dhis2Error:null},this.hasQueryResponseChange=!1,this.dhis2FetchAborted=!1,this.contextMenuRef=(0,d.createRef)(),this.handleAddFilter=this.handleAddFilter.bind(this),this.handleRenderSuccess=this.handleRenderSuccess.bind(this),this.handleRenderFailure=this.handleRenderFailure.bind(this),this.handleSetControlValue=this.handleSetControlValue.bind(this),this.handleOnContextMenu=this.handleOnContextMenu.bind(this),this.handleContextMenuSelected=this.handleContextMenuSelected.bind(this),this.handleContextMenuClosed=this.handleContextMenuClosed.bind(this),this.handleLegendStateChanged=this.handleLegendStateChanged.bind(this),this.onContextMenuFallback=this.onContextMenuFallback.bind(this),this.handleLegendScroll=this.handleLegendScroll.bind(this),this.hooks={onAddFilter:this.handleAddFilter,onContextMenu:this.state.showContextMenu?this.handleOnContextMenu:void 0,onError:this.handleRenderFailure,setControlValue:this.handleSetControlValue,onFilterMenuOpen:this.props.onFilterMenuOpen,onFilterMenuClose:this.props.onFilterMenuClose,onLegendStateChanged:this.handleLegendStateChanged,setDataMask:e=>{var t;null==(t=this.props.actions)||t.updateDataMask(this.props.chartId,e)},onLegendScroll:this.handleLegendScroll},this.mutableQueriesResponse=D()(this.props.queriesResponse)}shouldComponentUpdate(e,t){var n;if(e.queriesResponse&&["success","rendered"].indexOf(e.chartStatus)>-1&&(null==(n=e.queriesResponse)||null==(n=n[0])||!n.error)){if(!T()(this.state,t))return!0;this.hasQueryResponseChange=e.queriesResponse!==this.props.queriesResponse,this.hasQueryResponseChange&&(this.mutableQueriesResponse=D()(e.queriesResponse));const n=()=>(!0===e.formData.matrixify_enable_vertical_layout||!0===e.formData.matrixify_enable_horizontal_layout)&&Object.keys(e.formData).filter(e=>e.startsWith("matrixify_")).some(t=>!T()(e.formData[t],this.props.formData[t]));return this.hasQueryResponseChange||!T()(e.datasource,this.props.datasource)||e.annotationData!==this.props.annotationData||e.ownState!==this.props.ownState||e.filterState!==this.props.filterState||e.height!==this.props.height||e.width!==this.props.width||e.triggerRender||e.labelsColor!==this.props.labelsColor||e.labelsColorMap!==this.props.labelsColorMap||e.formData.color_scheme!==this.props.formData.color_scheme||e.formData.stack!==this.props.formData.stack||e.formData.subcategories!==this.props.formData.subcategories||e.cacheBusterProp!==this.props.cacheBusterProp||e.emitCrossFilters!==this.props.emitCrossFilters||e.postTransformProps!==this.props.postTransformProps||n()}return!1}handleAddFilter(e,t,n=!0,o=!0){this.props.addFilter(e,t,n,o)}handleRenderSuccess(){const{actions:e,chartStatus:t,chartId:n,vizType:o}=this.props;["loading","rendered"].indexOf(t)<0&&e.chartRenderingSucceeded(n),this.hasQueryResponseChange&&e.logEvent(y.tE,{slice_id:n,viz_type:o,start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:y.Vy.getTimestamp()-this.renderStartTime})}handleRenderFailure(e,t){const{actions:n,chartId:o}=this.props;h.A.warn(e),n.chartRenderingFailed(e.toString(),o,t?t.componentStack:null),this.hasQueryResponseChange&&n.logEvent(y.tE,{slice_id:o,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:y.Vy.getTimestamp()-this.renderStartTime})}handleSetControlValue(...e){const{setControlValue:t}=this.props;t&&t(...e)}handleOnContextMenu(e,t,n){this.contextMenuRef.current.open(e,t,n),this.setState({inContextMenu:!0})}handleContextMenuSelected(){this.setState({inContextMenu:!1})}handleContextMenuClosed(){this.setState({inContextMenu:!1})}handleLegendStateChanged(e){this.setState({legendState:e})}onContextMenuFallback(e){this.state.inContextMenu||(e.preventDefault(),this.handleOnContextMenu(e.clientX,e.clientY))}handleLegendScroll(e){this.setState({legendIndex:e})}render(){var e,t;const{chartAlert:n,chartStatus:a,chartId:i,emitCrossFilters:r}=this.props;if("loading"===a||n||null===a)return null;this.renderStartTime=y.Vy.getTimestamp();const{width:l,height:d,datasource:u,annotationData:h,initialValues:p,ownState:m,filterState:g,chartIsStale:v,formData:b,latestQueryFormData:x,postTransformProps:S}=this.props,_=v&&x?x:b,C=_.viz_type||this.props.vizType,w=$()(C),A=C===z.Y.Table?`superset-chart-${w}`:w;let D;const F=(0,c.t)("No results were returned for this query"),T=this.props.source===o.Explore?(0,c.t)("Make sure that the controls are configured properly and the datasource contains data for the selected time range"):void 0,E="chart.svg";D=l>300&&d>220?(0,s.Y)(f.p,{size:"large",title:F,description:T,image:E}):(0,s.Y)(f.p,{title:F,image:E,size:"small"});const Y=null!=(e=(0,M.A)().get(b.viz_type))&&e.behaviors.find(e=>e===k.nS.DrillToDetail)?{inContextMenu:this.state.inContextMenu}:{},I=!(null!=b&&b.server_pagination&&((null==m||null==(t=m.searchText)?void 0:t.length)||0)>0);return(0,s.FD)(s.FK,{children:[this.state.showContextMenu&&(0,s.Y)(Te,{ref:this.contextMenuRef,id:i,formData:_,onSelection:this.handleContextMenuSelected,onClose:this.handleContextMenuClosed}),(0,s.Y)("div",{onContextMenu:this.state.showContextMenu?this.onContextMenuFallback:void 0,children:(0,s.Y)(R.A,{disableErrorBoundary:!0,id:`chart-id-${i}`,className:A,chartType:C,width:l,height:d,annotationData:h,datasource:u,initialValues:p,formData:_,ownState:m,filterState:g,hooks:this.hooks,behaviors:Ye,queriesData:this.mutableQueriesResponse,onRenderSuccess:this.handleRenderSuccess,onRenderFailure:this.handleRenderFailure,noResults:D,postTransformProps:S,emitCrossFilters:r,legendState:this.state.legendState,enableNoResults:I,legendIndex:this.state.legendIndex,...Y},`${i}`)})]})}}ke.propTypes=Ee,ke.defaultProps=Ie;const Me=ke;var ze=n(98244);const Re=({chartId:e,error:t,...n})=>{const{result:o}=(0,ze.RG)(e),a=t&&{...t,extra:{...t.extra,owners:o}};return(0,s.Y)(b.x6,{...n,error:a,title:"Data error"})};var Oe=n(99609);const Ne={},Le=(0,c.t)("The dataset associated with this chart no longer exists"),Ue={addFilter:()=>Ne,onFilterMenuOpen:()=>Ne,onFilterMenuClose:()=>Ne,initialValues:Ne,setControlValue:()=>Ne,triggerRender:!1,dashboardId:void 0,chartStackTrace:void 0,force:!1,isInView:!0},qe=u.I4.div`
  min-height: ${e=>e.height}px;
  position: relative;

  .chart-tooltip {
    opacity: 0.75;
    font-size: ${({theme:e})=>e.fontSizeSM}px;
  }

  .slice_container {
    display: flex;
    flex-direction: column;
    justify-content: center;

    height: ${e=>e.height}px;

    .pivot_table tbody tr {
      font-feature-settings: 'tnum' 1;
    }

    .alert {
      margin: ${({theme:e})=>2*e.sizeUnit}px;
    }
  }
`,He=u.I4.div`
  position: absolute;
  left: 50%;
  top: 50%;
  width: 80%;
  transform: translate(-50%, -50%);
`,je=u.I4.span`
  display: block;
  text-align: center;
  margin: ${({theme:e})=>4*e.sizeUnit}px auto;
  width: fit-content;
  color: ${({theme:e})=>e.colorText};
`;class Pe extends d.PureComponent{constructor(e){super(e),this.renderStartTime=void 0,this.handleRenderContainerFailure=this.handleRenderContainerFailure.bind(this)}componentDidMount(){this.props.triggerQuery&&this.runQuery()}componentDidUpdate(){this.props.triggerQuery&&this.runQuery()}runQuery(){this.props.actions.postChartFormData(this.props.formData,Boolean(this.props.force||(0,S.P3)(x.vX.force)),this.props.timeout,this.props.chartId,this.props.dashboardId,this.props.ownState)}handleRenderContainerFailure(e,t){const{actions:n,chartId:o}=this.props;h.A.warn(e),n.chartRenderingFailed(e.toString(),o,t?t.componentStack:null),n.logEvent(y.tE,{slice_id:o,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:y.Vy.getTimestamp()-this.renderStartTime})}renderErrorMessage(e){var t;const{chartId:n,chartAlert:a,chartStackTrace:i,datasource:r,dashboardId:l,height:d,datasetsStatus:c}=this.props,u=null==e||null==(t=e.errors)?void 0:t[0],h=a||(null==e?void 0:e.message);return void 0!==a&&a!==Le&&r===g.As&&c!==w.bk.Error?(0,s.Y)(qe,{"data-ui-anchor":"chart",className:"chart-container",height:d,children:(0,s.Y)(v.R,{size:this.props.dashboardId?"s":"m",muted:!!this.props.dashboardId})},n):(0,s.Y)(Re,{chartId:n,error:u,subtitle:h,link:e?e.link:void 0,source:l?o.Dashboard:o.Explore,stackTrace:i},n)}renderSpinner(e){const t=e?(0,c.t)("Waiting on %s",e):(0,c.t)("Waiting on database...");return(0,s.FD)(He,{children:[(0,s.Y)(v.R,{position:"inline-centered",size:this.props.dashboardId?"s":"m",muted:!!this.props.dashboardId}),(0,s.Y)(je,{children:t})]})}renderChartContainer(){return(0,s.Y)("div",{className:"slice_container",children:this.props.isInView||!(0,p.G7)(p.TO.DashboardVirtualization)||(0,_.a)()?(0,s.Y)(Me,{...this.props,source:this.props.dashboardId?"dashboard":"explore"}):(0,s.Y)(v.R,{size:this.props.dashboardId?"s":"m",muted:!!this.props.dashboardId})})}render(){var e;const{height:t,chartAlert:n,chartStatus:o,datasource:a,errorMessage:i,chartIsStale:r,queriesResponse:l=[],width:d}=this.props,u=null==a||null==(e=a.database)?void 0:e.name,h="loading"===o;return"failed"===o?null==l?void 0:l.map(e=>this.renderErrorMessage(e)):i&&0===(0,m.A)(l).length?(0,s.Y)(f.p,{size:"large",title:(0,c.t)("Add required control values to preview chart"),description:(0,Oe.w)(!0),image:"chart.svg"}):h||n||i||!r||0!==(0,m.A)(l).length?(0,s.Y)(b.tH,{onError:this.handleRenderContainerFailure,showMessage:!1,children:(0,s.Y)(qe,{"data-ui-anchor":"chart",className:"chart-container",height:t,width:d,children:h?this.renderSpinner(u):this.renderChartContainer()})}):(0,s.Y)(f.p,{size:"large",title:(0,c.t)("Your chart is ready to go!"),description:(0,s.FD)("span",{children:[(0,c.t)('Click on "Create chart" button in the control panel on the left to preview a visualization or')," ",(0,s.Y)("span",{role:"button",tabIndex:0,onClick:this.props.onQuery,children:(0,c.t)("click here")}),"."]}),image:"chart.svg"})}}Pe.defaultProps=Ue;const Ve=Pe,Be=(0,a.Ng)(null,function(e){return{actions:(0,i.zH)({...r,updateDataMask:H.Mv,logEvent:l.logEvent},e)}})(Ve)},25948:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(5556),a=n.n(o);const i=a().shape({column_name:a().string,type:a().string})},26965:(e,t,n)=>{n.d(t,{aV:()=>s,hF:()=>r,lW:()=>l});const o={heatmap:{maxDimensions:1,dimensionNames:["column"],warningMessage:(e,t)=>`Heatmap charts only support one column dimension. Using "${e[0]}" only. Additional columns (${t.join(", ")}) will be ignored.`},heatmap_v2:{maxDimensions:1,dimensionNames:["column"],warningMessage:(e,t)=>`Heatmap charts only support one column dimension. Using "${e[0]}" only. Additional columns (${t.join(", ")}) will be ignored.`},waterfall:{maxDimensions:1,dimensionNames:["dimension"],warningMessage:(e,t)=>`Waterfall charts only support one dimension. Using "${e[0]}" only. Additional columns (${t.join(", ")}) will be ignored.`},word_cloud:{maxDimensions:1,dimensionNames:["series"],warningMessage:(e,t)=>`Word cloud charts only support one series dimension. Using "${e[0]}" only. Additional columns (${t.join(", ")}) will be ignored.`},graph_chart:{maxDimensions:2,dimensionNames:["source","target"],warningMessage:(e,t)=>`Graph charts only support two dimensions (source and target). Using "${e[0]}" for source and "${e[1]}" for target. Additional columns (${t.join(", ")}) will be ignored.`},sankey_v2:{maxDimensions:2,dimensionNames:["source","target"],warningMessage:(e,t)=>`Sankey charts only support two dimensions (source and target). Using "${e[0]}" for source and "${e[1]}" for target. Additional columns (${t.join(", ")}) will be ignored.`},bubble_v2:{maxDimensions:2,dimensionNames:["series","entity"],warningMessage:(e,t)=>`Bubble charts only support two dimensions (series and entity). Using "${e[0]}" for series and "${e[1]}" for entity. Additional columns (${t.join(", ")}) will be ignored.`}},a=["big_number","big_number_total","pop_kpi","cal_heatmap","country_map","gantt","world_map","deck_arc","deck_geojson","deck_grid","deck_hex","deck_heatmap","deck_multi","deck_polygon","deck_scatter","deck_screengrid","deck_contour","deck_path"],i=["heatmap","heatmap_v2","waterfall"];function r(e){return i.includes(e)}function l(e){return a.includes(e)}function s(e,t){const n=function(e){return o[e]||null}(e);if(!n||t.length<=n.maxDimensions)return{limitedColumns:t,ignoredColumns:[]};const a=t.slice(0,n.maxDimensions),i=t.slice(n.maxDimensions);return{limitedColumns:a,ignoredColumns:i,warning:n.warningMessage(a,i)}}},27310:(e,t,n)=>{n.d(t,{_h:()=>z,ih:()=>A});var o,a=n(2445),i=n(24002),r=n(81465),l=n(99106),s=n(74098),d=n(8558),c=n(21325),u=n(24777);!function(e){e.Results="results",e.Samples="samples"}(o||(o={}));var h=n(18749),p=n(90924),m=n(59744),g=n(56196),v=n(80711),f=n(50880),b=n(37201),y=n(54037);const x=r.I4.pre`
  margin-top: ${({theme:e})=>4*e.sizeUnit+"px"};
`,S=r.I4.div`
  ${()=>"\n    display: flex;\n    height: 100%;\n    flex-direction: column;\n    "}
`,_=new WeakMap,C=({isRequest:e,queryFormData:t,queryForce:n,ownState:o,errorMessage:r,setForceQuery:l,isVisible:d,dataSize:c=50,canDownload:u})=>{var C;const w=(0,h.A)().get((null==t?void 0:t.viz_type)||(null==t?void 0:t.vizType)),[A,D]=(0,i.useState)([]),[F,T]=(0,i.useState)(!0),[E,$]=(0,i.useState)(""),Y=null!=(C=null==w?void 0:w.queryObjectCount)?C:1,I=null==w?void 0:w.dynamicQueryObjectCount,k=(0,i.useCallback)(()=>{},[]);if((0,i.useEffect)(()=>{r||(e&&_.has(t)&&(D((0,p.A)(_.get(t))),$(""),n&&(null==l||l(!1)),T(!1)),e&&!_.has(t)&&(T(!0),(0,f.getChartDataRequest)({formData:t,force:n,resultFormat:"json",resultType:"results",ownState:o}).then(({json:e})=>{D((0,p.A)(e.result)),$(""),_.set(t,e.result),n&&(null==l||l(!1))}).catch(e=>{(0,m.h4)(e).then(({error:e,message:t})=>{$(e||t||(0,s.t)("Sorry, an error occurred"))})}).finally(()=>{T(!1)})))},[t,e]),(0,i.useEffect)(()=>{r&&T(!1)},[r]),F)return Array(Y).fill((0,a.Y)(g.R,{}));if(r){const e=(0,s.t)("Run a query to display results");return Array(Y).fill((0,a.Y)(v.p,{image:"document.svg",title:e,size:"small"}))}if(E){const e=(0,a.FD)(a.FK,{children:[(0,a.Y)(y.x,{data:[],columnNames:[],columnTypes:[],rowcount:0,datasourceId:t.datasource,onInputChange:k,isLoading:!1,canDownload:u}),(0,a.Y)(x,{children:E})]});return Array(Y).fill(e)}if(0===A.length){const e=(0,s.t)("No results were returned for this query");return Array(Y).fill((0,a.Y)(v.p,{image:"document.svg",title:e,size:"small"}))}return(I?A:A.slice(0,Y)).map((e,n)=>(0,a.Y)(S,{children:(0,a.Y)(b.U,{data:e.data,colnames:e.colnames,coltypes:e.coltypes,rowcount:e.rowcount,dataSize:c,datasourceId:t.datasource,isVisible:d,canDownload:u})},n))},w=r.I4.div`
  display: flex;
  flex-direction: column;
  height: 100%;

  .ant-tabs {
    height: 100%;
  }

  .ant-tabs-content {
    height: 100%;
  }

  .ant-tabs-tabpane {
    display: flex;
    flex-direction: column;
  }

  .table-condensed {
    overflow: auto;
  }
`,A=({isRequest:e,queryFormData:t,queryForce:n,ownState:i,errorMessage:r,setForceQuery:l,isVisible:d,dataSize:u=50,canDownload:h})=>{const p=C({errorMessage:r,queryFormData:t,queryForce:n,ownState:i,isRequest:e,setForceQuery:l,dataSize:u,isVisible:d,canDownload:h});if(1===p.length)return(0,a.Y)(w,{children:p[0]});const m=p.map((e,t)=>({key:0===t?o.Results:`${o.Results} ${t+1}`,label:0===t?(0,s.t)("Results"):(0,s.t)("Results %s",t+1),children:e}));return(0,a.Y)(w,{children:(0,a.Y)(c.Ay,{items:m})})};var D=n(79378),F=n(50659),T=n(18009),E=n(16143);const $=r.I4.pre`
  margin-top: ${({theme:e})=>4*e.sizeUnit+"px"};
`,Y=new WeakSet,I=({isRequest:e,datasource:t,queryForce:n,setForceQuery:o,dataSize:r=50,isVisible:l,canDownload:d})=>{const[c,u]=(0,i.useState)(""),[h,m]=(0,i.useState)([]),[b,x]=(0,i.useState)([]),[S,_]=(0,i.useState)([]),[C,w]=(0,i.useState)(!1),[A,I]=(0,i.useState)(0),[k,M]=(0,i.useState)(""),[z,R]=(0,i.useState)(!1),O=(0,i.useMemo)(()=>`${t.id}__${t.type}`,[t]);(0,i.useEffect)(()=>{e&&n&&Y.delete(t);const a=t.sql;if(a&&(a.includes("/* DHIS2:")||a.includes("-- DHIS2:")))return R(!0),void(Y.has(t)&&!n||(w(!0),async function(e){try{var t,n,o;const a=e.sql,i=null==(t=e.database)?void 0:t.id;if(!i)throw new Error("Database ID not found in datasource");const r=await D.A.post({endpoint:`/api/v1/database/${i}/dhis2_preview/data/`,jsonPayload:{sql:a,limit:100,offset:0}}),l=(null==(n=r.json)?void 0:n.rows)||[],s=(null==(o=r.json)?void 0:o.columns)||[];if(0===l.length||0===s.length)return null;const d=s.map(e=>e.name||e.label||e),c=l.map(e=>Array.isArray(e)?e:d.map(t=>e[t])),u=s.map(e=>e.type||"string");return{data:c,colnames:d,coltypes:u,rowcount:c.length}}catch(e){throw console.error("[SamplesPane] Failed to load DHIS2 sample data:",e),e}}(t).then(e=>{e&&(m(e.data),x(e.colnames),_(e.coltypes),I(e.rowcount),M(""),Y.add(t))}).catch(e=>{m([]),x([]),_([]),M(`Failed to load DHIS2 data: ${e.message}`)}).finally(()=>{w(!1),n&&(null==o||o(!1))})));R(!1),e&&!Y.has(t)&&(w(!0),(0,f.getDatasourceSamples)(t.type,t.id,n,{}).then(e=>{m((0,p.A)(e.data)),x((0,p.A)(e.colnames)),_((0,p.A)(e.coltypes)),I(e.rowcount),M(""),Y.add(t),n&&(null==o||o(!1))}).catch(e=>{m([]),x([]),_([]),M(`${e.name}: ${e.message}`)}).finally(()=>{w(!1)}))},[t,e,n,o]);const N=(0,i.useMemo)(()=>h&&b?h.map(e=>{const t={};return Array.isArray(e)?b.forEach((n,o)=>{t[n]=e[o]}):e&&"object"==typeof e?b.forEach(n=>{if(n in e)t[n]=e[n];else{const o=Object.keys(e).find(e=>{const t=e.replace(/[.\-\s()]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),o=n.replace(/[.\-\s()]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");return t.toLowerCase()===o.toLowerCase()});t[n]=o?e[o]:void 0}}):b.forEach(e=>{t[e]=void 0}),t}):[],[h,b]),L=(0,E.XS)(b,S,N,O,l,{}),U=(0,E.$r)(c,N),q=(0,i.useCallback)(e=>u(e),[]);if(C)return(0,a.Y)(g.R,{});if(k)return(0,a.FD)(a.FK,{children:[(0,a.Y)(y.x,{data:U,columnNames:b,columnTypes:S,rowcount:A,datasourceId:O,onInputChange:q,isLoading:C,canDownload:d}),(0,a.Y)($,{children:k})]});if(0===h.length){let e,t=(0,s.t)("No samples were returned for this dataset");return z&&(t=(0,s.t)("DHIS2 Dataset"),e=(0,s.t)("DHIS2 datasets load data dynamically from the API. View sample data by running a chart visualization.")),(0,a.Y)(v.p,{image:"document.svg",title:t,description:e})}return(0,a.FD)(a.FK,{children:[(0,a.Y)(y.x,{data:U,columnNames:b,columnTypes:S,rowcount:A,datasourceId:O,onInputChange:q,isLoading:C,canDownload:d}),(0,a.Y)(F.Q,{columns:L,data:U,pageSize:r,noDataText:(0,s.t)("No results"),emptyWrapperType:F.V.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,size:T.QS.Small,small:!0})]})},k=r.I4.div`
  ${()=>"\n    display: flex;\n    height: 100%;\n    flex-direction: column;\n    "}
`,M=r.I4.div`
  ${({theme:e})=>`\n    position: relative;\n    background-color: ${e.colorBgContainer};\n    z-index: 5;\n    overflow: hidden;\n\n    .ant-tabs {\n      height: 100%;\n    }\n\n    .ant-tabs-content-holder {\n      height: 100%;\n    }\n\n    .ant-tabs-content {\n      height: 100%;\n    }\n\n    .ant-tabs-tabpane {\n      height: 100%;\n      position: relative;\n\n      .table-condensed {\n        height: 100%;\n        overflow: auto;\n        margin-bottom: ${4*e.sizeUnit}px;\n\n        .table {\n          margin-bottom: ${2*e.sizeUnit}px;\n        }\n      }\n     .pagination-container > ul[role='navigation'] {\n        margin-top: 0;\n      }\n    }\n  `}
`,z=({queryFormData:e,datasource:t,queryForce:n,onCollapseChange:r,chartStatus:h,ownState:p,errorMessage:m,setForceQuery:g,canDownload:v})=>{const[f,b]=(0,i.useState)(o.Results),[y,x]=(0,i.useState)({results:!1,samples:!1}),[S,_]=(0,i.useState)(!(0,l.G7)(l.TO.DatapanelClosedByDefault)&&(0,u.Gq)(u.Hh.IsDatapanelOpen,!1));(0,i.useEffect)(()=>{(0,l.G7)(l.TO.DatapanelClosedByDefault)||(0,u.SO)(u.Hh.IsDatapanelOpen,S)},[S]),(0,i.useEffect)(()=>{S||x({results:!1,samples:!1}),S&&f.startsWith(o.Results)&&h&&"loading"!==h&&x({results:!0,samples:!1}),S&&f===o.Samples&&x({results:!1,samples:!0})},[S,f,h]);const w=(0,i.useCallback)(e=>{r(e),_(e)},[r]),A=(0,i.useCallback)((e,t)=>{S?e===f&&(t.preventDefault(),w(!1)):w(!0),b(e)},[f,w,S]),D=(0,i.useMemo)(()=>{const e=S?(0,a.Y)(d.F.UpOutlined,{"aria-label":(0,s.t)("Collapse data panel")}):(0,a.Y)(d.F.DownOutlined,{"aria-label":(0,s.t)("Expand data panel")});return(0,a.Y)("div",{children:S?(0,a.Y)("span",{role:"button",tabIndex:0,onClick:()=>w(!1),children:e}):(0,a.Y)("span",{role:"button",tabIndex:0,onClick:()=>w(!0),children:e})})},[w,S]),F=[...C({errorMessage:m,queryFormData:e,queryForce:n,ownState:p,isRequest:y.results,setForceQuery:g,isVisible:o.Results===f,canDownload:v}).map((e,t)=>({key:0===t?o.Results:`${o.Results} ${t+1}`,label:0===t?(0,s.t)("Results"):(0,s.t)("Results %s",t+1),children:e})),{key:o.Samples,label:(0,s.t)("Samples"),children:(0,a.Y)(k,{children:(0,a.Y)(I,{datasource:t,queryForce:n,isRequest:y.samples,setForceQuery:g,isVisible:o.Samples===f,canDownload:v})})}];return(0,a.Y)(M,{children:(0,a.Y)(c.Ay,{tabBarExtraContent:D,activeKey:S?f:"",onTabClick:A,items:F})})}},27915:(e,t,n)=>{n.d(t,{Gn:()=>c,i2:()=>d});var o=n(2445),a=(n(24002),n(39591)),i=n(17437),r=n(81465),l=n(76576),s=n(95018);const d=({tooltipText:e,children:t})=>{const[n,r]=(0,a.A)();return(0,o.Y)(s.m,{title:r?e:null,children:(0,o.Y)("div",{ref:n,css:i.AH`
          max-width: 100%;
          ${a.P};
        `,children:t})})},c=({tooltipText:e,children:t,onClick:n,style:d})=>{const c=(0,r.DP)(),[u,h]=(0,a.A)();return(0,o.Y)(l.s,{role:"menuitem",tabIndex:0,onClick:n,align:"center",style:d,css:i.AH`
        cursor: pointer;
        padding-left: ${c.paddingXS}px;
        &:hover {
          background-color: ${c.colorBgTextHover};
        }
        &:active {
          background-color: ${c.colorBgTextActive};
        }
      `,children:(0,o.Y)(s.m,{title:h?e:null,children:(0,o.Y)("div",{ref:u,css:i.AH`
            max-width: 100%;
            ${a.P};
          `,children:t})})})}},28522:(e,t,n)=>{n.d(t,{t_:()=>d});var o=n(1763),a=n(90924),i=n(75574),r=n(24002),l=n(61269),s=n(59246);const d=(e,t,n,d=!1)=>{const[c,u]=(0,r.useState)({status:s.bk.Loading,result:null,error:null});return(0,r.useEffect)(()=>{d?u({status:s.bk.Complete,result:{},error:null}):(async()=>{try{const d=(e=>Number("string"==typeof e?e.split("__")[0]:e))(e),c=(0,o.a)().get("load.drillby.options");let h;if(c&&n){var r;const e=await c(d,n);h=null==e||null==(r=e.json)?void 0:r.result}else{const e=`/api/v1/dataset/${d}/drill_info/?q=(dashboard_id:${t})`;try{const{json:t}=await(0,l.w)({endpoint:e}),{result:n}=t;h=n}catch(t){throw i.A.error("Failed to load dataset: ",t),l.e.delete(e),t}}const p=(e=>{const t={};return(0,a.A)(null==e?void 0:e.columns).forEach(e=>{t[e.column_name]=e.verbose_name||e.column_name}),(0,a.A)(null==e?void 0:e.metrics).forEach(e=>{t[e.metric_name]=e.verbose_name||e.metric_name}),t})(h);u({status:s.bk.Complete,result:{...h,verbose_map:p},error:null})}catch(e){u({status:s.bk.Error,result:null,error:e instanceof Error?e:new Error(String(e))})}})()},[e,t,n,d]),c}},30747:(e,t,n)=>{n.d(t,{A:()=>B});var o=n(2445),a=n(24002),i=n(61574),r=n(81465),l=n(74098),s=n(17437),d=n(88217),c=n(97163),u=n(61225),h=n(75134),p=n(60838),m=n(90886),g=n(90924),v=n(58516),f=n(98250),b=n(23575);const y=function({value:e}){return(0,o.Y)("span",{children:e?b.Y.BOOL_TRUE_DISPLAY:b.Y.BOOL_FALSE_DISPLAY})},x=r.I4.span`
  color: ${({theme:e})=>e.colorTextSecondary};
`,S=function(){return(0,o.Y)(x,{children:b.Y.NULL_DISPLAY})};var _=n(15222),C=n(58083);const w=function({format:e=_.A.DATABASE_DATETIME,value:t}){return t?(0,o.Y)("span",{children:(0,C.mo)(e).format(t)}):(0,o.Y)(S,{})};var A=n(56196),D=n(80711),F=n(50880),T=n(18009),E=n(23576),$=n(22750),Y=n(8558);const I=function(e){const{headerTitle:t,groupTitle:n,groupOptions:i,value:l,onChange:d}=e,c=(0,r.DP)(),[u,h]=(0,a.useState)(!1);return(0,o.FD)("div",{css:s.AH`
        display: flex;
        align-items: center;
      `,children:[(0,o.Y)(E.A,{trigger:"click",open:u,content:(0,o.FD)("div",{children:[(0,o.Y)("div",{css:s.AH`
                font-weight: ${c.fontWeightStrong};
                margin-bottom: ${c.sizeUnit}px;
              `,children:n}),(0,o.Y)($.s.GroupWrapper,{spaceConfig:{direction:"vertical",size:4,wrap:!1,align:"start"},value:l,onChange:e=>{d(e.target.value),h(!1)},options:i})]}),placement:"bottomLeft",arrow:{pointAtCenter:!0},children:(0,o.Y)(Y.F.SettingOutlined,{iconSize:"m",iconColor:c.colorIcon,css:s.AH`
            margin-top: ${.75*c.sizeUnit}px;
            margin-right: ${c.sizeUnit}px;
          `,onClick:()=>h(!0)})}),t]})};var k=n(75388),M=n(33700),z=n(91920),R=n(90625);function O({filters:e,setFilters:t,totalCount:n,loading:i,onReload:d}){const c=(0,r.DP)(),u=(0,a.useMemo)(()=>Object.assign({},...e.map(e=>({[(0,z.q0)(e.col)?e.col.label:e.col]:e}))),[e]),h=(0,a.useCallback)(e=>{const n={...u};delete n[e],t([...Object.values(n)])},[u,t]),p=(0,a.useMemo)(()=>Object.entries(u).map(([e,{val:t,formattedVal:n}])=>({colName:e,val:null!=n?n:t})).sort((e,t)=>e.colName.localeCompare(t.colName)),[u]);return(0,o.FD)("div",{css:s.AH`
        display: flex;
        justify-content: space-between;
        padding: ${c.sizeUnit/2}px 0;
        margin-bottom: ${2*c.sizeUnit}px;
      `,children:[(0,o.Y)("div",{css:s.AH`
          display: flex;
          flex-wrap: wrap;
        `,children:p.map(({colName:e,val:t},n)=>(0,o.FD)(M.v,{editable:!0,onDelete:h.bind(null,e),index:n,id:n,name:`${e}=${t}`,children:[(0,o.Y)("span",{css:s.AH`
                margin-right: ${c.sizeUnit}px;
              `,children:e}),(0,o.Y)("strong",{children:t})]},e))}),(0,o.FD)("div",{css:s.AH`
          display: flex;
          align-items: center;
          height: min-content;
        `,children:[(0,o.Y)(R.A,{loading:i&&!n,rowcount:n}),(0,o.Y)(Y.F.ReloadOutlined,{iconColor:c.colorIcon,iconSize:"l","aria-label":(0,l.t)("Reload"),role:"button",onClick:d})]})]})}var N=n(90179),L=n.n(N),U=n(47837);const q=50;function H({children:e}){const{ref:t,height:n}=(0,f.uZ)();return(0,o.Y)("div",{ref:t,css:{flex:1},children:(0,a.cloneElement)(e,{height:n})})}var j;function P({formData:e,initialFilters:t,dataset:n}){var i;const d=(0,r.DP)(),[c,h]=(0,a.useState)(0),p=(0,a.useRef)(c),[m,f]=(0,a.useState)(t),[b,x]=(0,a.useState)(!1),[_,C]=(0,a.useState)(""),[E,$]=(0,a.useState)(new Map),[Y,M]=(0,a.useState)({}),z=(0,u.d4)(({dashboardInfo:e})=>e.id),R=(0,u.d4)(e=>e.common.conf.SAMPLES_ROW_LIMIT),[N,P]=(0,a.useMemo)(()=>e.datasource.split("__"),[e.datasource]),{metadataBar:V}=(0,k.M)({dataset:n}),B=(0,a.useMemo)(()=>{const e=E.get(c);return e?(p.current=c,e):E.get(p.current)},[c,E]),W=(0,a.useMemo)(()=>(null==B?void 0:B.colNames.map((e,t)=>{var a,i;return{key:e,dataIndex:e,title:(null==B?void 0:B.colTypes[t])===v.GenericDataType.Temporal?(0,o.Y)(I,{headerTitle:(null==n||null==(a=n.verbose_map)?void 0:a[e])||e,groupTitle:(0,l.t)("Formatting"),groupOptions:[{label:(0,l.t)("Original value"),value:j.Original},{label:(0,l.t)("Formatted value"),value:j.Formatted}],value:Y[e]===j.Original?j.Original:j.Formatted,onChange:t=>M(n=>({...n,[e]:parseInt(t,10)}))}):(null==n||null==(i=n.verbose_map)?void 0:i[e])||e,render:n=>!0===n||!1===n?(0,o.Y)(y,{value:n}):null===n?(0,o.Y)(S,{}):(null==B?void 0:B.colTypes[t])===v.GenericDataType.Temporal&&Y[e]!==j.Original&&("number"==typeof n||n instanceof Date)?(0,o.Y)(w,{value:n}):String(n),width:150}}))||[],[null==B?void 0:B.colNames,null==B?void 0:B.colTypes,Y,null==n?void 0:n.verbose_map]),G=(0,a.useMemo)(()=>(null==B?void 0:B.data.map((e,t)=>null==B?void 0:B.colNames.reduce((t,n)=>({...t,[n]:e[n]}),{key:t})))||[],[null==B?void 0:B.colNames,null==B?void 0:B.data]),Q=(0,a.useCallback)(()=>{C(""),$(new Map),h(0)},[]);(0,a.useEffect)(()=>{C(""),$(new Map),h(0)},[m]),(0,a.useEffect)(()=>{if(E.has(c)&&[...E.keys()].at(-1)!==c){const e=new Map(E);e.delete(c),$(e.set(c,E.get(c)))}},[c,E]),(0,a.useEffect)(()=>{if(!_&&!b&&!E.has(c)){var t;x(!0);const n=null!=(t=function(e,t){if(!e)return;const n=(0,U.A)(e),o=L()(n.extras,"having"),a=[...(0,g.A)(n.filters),...(0,g.A)(t).map(e=>L()(e,"formattedVal"))];return{granularity:n.granularity,time_range:n.time_range,filters:a,extras:o}}(e,m))?t:{},o=Math.ceil(R/q);(0,F.getDatasourceSamples)(P,N,!1,n,q,c+1,z).then(e=>{$(new Map([...[...E.entries()].slice(1-o),[c,{total:e.total_count,data:e.data,colNames:(0,g.A)(e.colnames),colTypes:(0,g.A)(e.coltypes)}]])),C("")}).catch(e=>{C(`${e.name}: ${e.message}`)}).finally(()=>{x(!1)})}},[R,N,P,m,e,b,c,_,E]);const K=!_&&!E.size,X=null==(i=e.allow_render_html)||i;let J=null;if(_)J=(0,o.Y)("pre",{css:s.AH`
          margin-top: ${4*d.sizeUnit}px;
        `,children:_});else if(K)J=(0,o.Y)(A.R,{});else if(0===(null==B?void 0:B.total)){const e=(0,l.t)("No rows were returned for this dataset");J=(0,o.Y)(D.p,{image:"document.svg",title:e})}else J=(0,o.Y)(H,{children:(0,o.Y)(T.Ay,{data:G,columns:W,size:T.QS.Small,defaultPageSize:q,recordCount:null==B?void 0:B.total,usePagination:!0,loading:b,onChange:e=>h(e.current?e.current-1:0),resizable:!0,virtualize:!0,allowHTML:X})});return(0,o.FD)(o.FK,{children:[!K&&V,!K&&(0,o.Y)(O,{filters:m,setFilters:f,totalCount:null==B?void 0:B.total,loading:b,onReload:Q}),J]})}!function(e){e[e.Original=0]="Original",e[e.Formatted=1]="Formatted"}(j||(j={}));const V=({canExplore:e,closeModal:t,exploreChart:n})=>{const a=(0,r.DP)();return(0,o.FD)(o.FK,{children:[!(0,p.n)()&&(0,o.Y)(d.$,{buttonStyle:"secondary",buttonSize:"small",onClick:n,disabled:!e,tooltip:e?void 0:(0,l.t)("You do not have sufficient permissions to edit the chart"),children:(0,l.t)("Edit chart")}),(0,o.Y)(d.$,{buttonStyle:"primary",buttonSize:"small",onClick:t,css:s.AH`
          margin-left: ${2*a.sizeUnit}px;
        `,children:(0,l.t)("Close")})]})};function B({chartId:e,formData:t,initialFilters:n,showModal:d,onHideModal:p,dataset:g}){const v=(0,r.DP)(),f=(0,i.W6)(),b=(0,a.useContext)(h.DashboardPageIdContext),{slice_name:y}=(0,u.d4)(t=>{var n;return(null==(n=t.sliceEntities)||null==(n=n.slices)?void 0:n[e])||{}}),x=(0,u.d4)(e=>{var t;return(0,m.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)}),S=(0,a.useMemo)(()=>`/explore/?dashboard_page_id=${b}&slice_id=${e}`,[e,b]),_=(0,a.useCallback)(()=>{f.push(S)},[S,f]);return(0,o.Y)(c.aF,{show:d,onHide:null!=p?p:()=>null,css:s.AH`
        .ant-modal-body {
          display: flex;
          flex-direction: column;
        }
      `,name:(0,l.t)("Drill to detail: %s",y),title:(0,l.t)("Drill to detail: %s",y),footer:(0,o.Y)(V,{exploreChart:_,canExplore:x}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*v.sizeUnit,minWidth:128*v.sizeUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnHidden:!0,maskClosable:!1,children:(0,o.Y)(P,{formData:t,initialFilters:n,dataset:g})})}},34505:(e,t,n)=>{n.d(t,{A:()=>m});var o=n(2404),a=n.n(o),i=n(92026),r=n(37203),l=n(26965);function s(e){return Object.entries(e).map(([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t})).filter(e=>null!==e.val)}var d=n(33132);const c={},u={},h=(e,t)=>{const n={};return t.forEach(t=>{const o=(0,i.J8)(e,[t]);o.filters&&o.filters.length>0&&(n[t]=o.filters)}),n};function p(e){const t=[];return Array.isArray(e)&&e.forEach(e=>{"string"==typeof e?t.push(e):e&&"object"==typeof e&&"column_name"in e&&t.push(e.column_name)}),t}function m({chart:e,filters:t,nativeFilters:n,chartConfiguration:o,chartCustomizationItems:m,colorScheme:g,ownColorScheme:v,colorNamespace:f,sliceId:b,dataMask:y,extraControls:x,labelsColor:S,labelsColorMap:_,sharedLabelsColors:C,allSliceIds:w,chartCustomization:A,activeFilters:D}){var F;const T=u[b],E=(0,r.r$)(null==T?void 0:T.dataMask,y,{ignoreUndefined:!0});if(c[b]===t&&(0,r.r$)(null==T?void 0:T.own_color_scheme,v)&&(0,r.r$)(null==T?void 0:T.color_scheme,g)&&(0,r.r$)(null==T?void 0:T.color_namespace,f,{ignoreUndefined:!0})&&(0,r.r$)(null==T?void 0:T.label_colors,S,{ignoreUndefined:!0})&&(0,r.r$)(null==T?void 0:T.map_label_colors,_,{ignoreUndefined:!0})&&a()(null==T?void 0:T.shared_label_colors,C)&&T&&E&&(0,r.r$)(null==T?void 0:T.extraControls,x,{ignoreUndefined:!0})&&(0,r.r$)(null==T?void 0:T.chart_customization,A,{ignoreUndefined:!0}))return T;const $=D||(0,d.R)({chartConfiguration:o,nativeFilters:n,dataMask:y,allSliceIds:w});let Y={};const I=Object.entries($).filter(([,t])=>t.scope.includes(e.id)).map(([e])=>e);if(I.length){var k;Y={extra_form_data:(0,i.J8)(y,I)};const t="deck_multi"===(null==(k=e.form_data)?void 0:k.viz_type),n=D&&Object.values(D).some(e=>e.layerScope);if(t||n){const e=h(y,I);Y.filter_data_mapping=e}}let M;const z="deck_multi"===(null==(F=e.form_data)?void 0:F.viz_type),R=D&&Object.values(D).some(e=>e.layerScope);(z||R)&&(M={},Object.entries($).forEach(([t,n])=>{var o;null!=(o=n.layerScope)&&o[e.id]&&(M[t]=n.layerScope[e.id])}),0===Object.keys(M).length&&(M=void 0));const O={};Object.entries(y).forEach(([e,t])=>{if(e.startsWith("chart_customization_")){var n;const o=null==(n=t.filterState)?void 0:n.value;Array.isArray(o)&&(O[e]={selectedValues:o})}});const N=function(e,t,n){var o,a,i,r,s;if(!e||0===e.length)return{};const d=null==(o=t.form_data)?void 0:o.datasource;if(!d)return{};const c=String(d).split("__")[0],u=e.filter(e=>{var n;if(e.removed)return!1;const o=null==(n=e.customization)?void 0:n.dataset;if(!o)return!1;const a=String(o),i=c===a,r=!e.chartId||e.chartId===t.id;return i&&r}),h=null==(a=t.form_data)?void 0:a.viz_type;if((0,l.lW)(h))return{};const m=function(e){var t,n,o,a,i,r,l,s;const d=new Set,c=null==(t=e.form_data)?void 0:t.viz_type;(Array.isArray(null==(n=e.form_data)?void 0:n.groupby)?e.form_data.groupby:null!=(o=e.form_data)&&o.groupby?[e.form_data.groupby]:[]).forEach(e=>d.add(e));const u=null==(a=e.form_data)?void 0:a.x_axis;u&&"heatmap"!==c&&"heatmap_v2"!==c&&d.add(u),((null==(i=e.form_data)?void 0:i.metrics)||[]).forEach(e=>{if("string"==typeof e)d.add(e);else if(e&&"object"==typeof e&&"column"in e){const t=e.column;"string"==typeof t?d.add(t):t&&"object"==typeof t&&"column_name"in t&&d.add(t.column_name)}});const h=null==(r=e.form_data)?void 0:r.series;h&&d.add(h);const m=null==(l=e.form_data)?void 0:l.entity;m&&d.add(m);const g=null==(s=e.form_data)?void 0:s.target;var v,f;return g&&d.add(g),"box_plot"===c&&p((null==(v=e.form_data)?void 0:v.columns)||[]).forEach(e=>d.add(e)),"pivot_table_v2"===c&&p((null==(f=e.form_data)?void 0:f.groupbyColumns)||[]).forEach(e=>d.add(e)),d}(t),g=Array.isArray(null==(i=t.form_data)?void 0:i.groupby)?t.form_data.groupby:null!=(r=t.form_data)&&r.groupby?[t.form_data.groupby]:[],v=null==(s=t.form_data)?void 0:s.x_axis,f=[],b=[];let y,x=!1;u.forEach(e=>{var t;const{customization:o}=e;if(!o)return;const a=`chart_customization_${e.id}`,i=(null==(t=n[a])?void 0:t.selectedValues)||[],r=function(e){if("string"==typeof e.column)return[e.column];if(Array.isArray(e.column))return e.column.filter(e=>"string"==typeof e&&""!==e.trim());if("object"==typeof e.column&&null!==e.column){const t=e.column,n=t.column_name||t.name||String(t);if(n&&""!==n.trim())return[n]}return[]}(o);if(0===r.length)return;const s=r.filter(e=>!m.has(e));if(0!==s.length){if((0,l.hF)(h)){if(!x&&s.length>0){const e=s[0];f.includes(e)||(f.push(e),x=!0)}s.length>1&&(0,l.aV)(h,s)}else s.forEach(e=>{f.includes(e)||f.push(e)});r.forEach(e=>{i.length>0&&b.push({col:e,op:"IN",val:i})}),o.sortFilter&&o.sortMetric&&(y=[JSON.stringify([o.sortMetric,!o.sortAscending])])}});const S=function(e,t,n,o){const a={};if(0===t.length)return a;if(null!=e&&e.startsWith("echarts_timeseries")||null!=e&&e.startsWith("echarts_area"))if(o){const e=t.filter(e=>e!==o);a.groupby=e.length>0?e:n}else a.groupby=t.length>0?t:n;else if("word_cloud"===e){const{limitedColumns:n}=(0,l.aV)(e,t);a.series=n[0],a.groupby=[]}else if("heatmap"===e||"heatmap_v2"===e)a.groupby=t.length>0?[t[0]]:n.filter(e=>e!==o);else if("waterfall"===e){const{limitedColumns:n}=(0,l.aV)(e,t);a.groupby=[n[0]]}else if("sunburst_v2"===e)a.columns=t,a.groupby=[];else if("graph_chart"===e){const{limitedColumns:n}=(0,l.aV)(e,t);a.source=n[0],n.length>1&&(a.target=n[1])}else if("sankey_v2"===e){const{limitedColumns:n}=(0,l.aV)(e,t);a.source=n[0],n.length>1&&(a.target=n[1])}else if(["chord"].includes(e))a.groupby=[...n,...t];else if("bubble_v2"===e){const{limitedColumns:n}=(0,l.aV)(e,t);a.series=n[0],n.length>1&&(a.entity=n[1]),a.groupby=[]}else"pivot_table_v2"===e?a.groupbyColumns=t:a.groupby=t;return a}(h,f,g,v);return b.length>0&&(S.filters=b),y&&(S.order_by_cols=y),S}(m||[],e,O),L={...e.form_data,chart_id:e.id,label_colors:S,shared_label_colors:C,map_label_colors:_,...g&&{color_scheme:g},...v&&{own_color_scheme:v},extra_filters:s(t),...Y,...x,...N,...A&&{chart_customization:A},...M&&{layer_filter_scope:M}};return c[b]=t,u[b]={...L,dataMask:y,extraControls:x,...A&&{chart_customization:A}},L}},35382:(e,t,n)=>{n.d(t,{A:()=>l,t:()=>a});var o=n(49239);const a={SIMPLE:"SIMPLE",SQL:"SQL"};function i(e){if(e.sqlExpression&&o.Vw.test(e.sqlExpression)){const t=e.sqlExpression.indexOf(")"),n=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&n>0)return e.sqlExpression.substring(n+1,t)}return null}function r(e){if(e.sqlExpression&&o.Vw.test(e.sqlExpression)){const t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}class l{constructor(e){if(this.expressionType=e.expressionType||a.SIMPLE,this.expressionType===a.SIMPLE){const t=i(e);this.column=e.column||t&&{column_name:t},this.aggregate=e.aggregate||r(e),this.sqlExpression=null}else this.expressionType===a.SQL&&(this.sqlExpression=e.sqlExpression,this.column=null,this.aggregate=null);this.datasourceWarning=!!e.datasourceWarning,this.hasCustomLabel=!(!e.hasCustomLabel||!e.label),this.label=this.hasCustomLabel?e.label:this.getDefaultLabel(),this.optionName=e.optionName||`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}getDefaultLabel(){return this.translateToSql({useVerboseName:!0})}translateToSql(e={useVerboseName:!1,transformCountDistinct:!1}){if(this.expressionType===a.SIMPLE){var t,n;const a=this.aggregate||"",i=e.useVerboseName&&null!=(t=this.column)&&t.verbose_name?`(${this.column.verbose_name})`:null!=(n=this.column)&&n.column_name?`(${this.column.column_name})`:"";return e.transformCountDistinct&&a===o.dq.COUNT_DISTINCT&&/^\(.*\)$/.test(i)?`COUNT(DISTINCT ${i.slice(1,-1)})`:a+i}return this.expressionType===a.SQL?this.sqlExpression:""}duplicateWith(e){return new l({...this,...e})}equals(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}isValid(){return this.expressionType===a.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===a.SQL&&!!this.sqlExpression}inferSqlExpressionAggregate(){return r(this)}inferSqlExpressionColumn(){return i(this)}}},37201:(e,t,n)=>{n.d(t,{U:()=>c});var o=n(2445),a=n(24002),i=n(74098),r=n(50659),l=n(18009),s=n(16143),d=n(54037);const c=({data:e,colnames:t,coltypes:n,rowcount:c,datasourceId:u,dataSize:h=50,isVisible:p,canDownload:m})=>{const[g,v]=(0,a.useState)(""),f=(0,a.useMemo)(()=>{if(!e||!t||0===e.length)return[];const n=e[0];return n&&"object"==typeof n&&!Array.isArray(n)?e:e.map(e=>{const n={};return t.forEach((t,o)=>{n[t]=Array.isArray(e)?e[o]:null}),n})},[e,t]),b=(0,s.XS)(t,n,f,u,p,{}),y=(0,s.$r)(g,f),x=(0,a.useCallback)(e=>v(e),[]);return(0,o.FD)(o.FK,{children:[(0,o.Y)(d.x,{data:y,columnNames:t,columnTypes:n,rowcount:c,datasourceId:u,onInputChange:x,isLoading:!1,canDownload:m}),(0,o.Y)(r.Q,{columns:b,size:l.QS.Small,data:y,pageSize:h,noDataText:(0,i.t)("No results"),emptyWrapperType:r.V.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,small:!0})]})}},37986:(e,t,n)=>{n.d(t,{y:()=>o});const o=n(81465).I4.div`
  .edit-popover-resize {
    transform: scaleX(-1);
    float: right;
    margin-top: ${({theme:e})=>4*e.sizeUnit}px;
    margin-right: ${({theme:e})=>-1*e.sizeUnit}px;
    color: ${({theme:e})=>e.colorIcon};
    cursor: nwse-resize;
  }
  .filter-sql-editor {
    border: ${({theme:e})=>e.colorBorder} solid thin;
  }
`},40795:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(5556),a=n.n(o),i=n(25948),r=n(97566),l=n(47980),s=n(2445);const d={option:a().oneOfType([i.A,a().shape({saved_metric_name:a().string.isRequired}),r.A]).isRequired};function c({option:e}){return e.saved_metric_name?(0,s.Y)(l.V,{column:{column_name:e.saved_metric_name,type:"expression"},showType:!0}):e.column_name?(0,s.Y)(l.V,{column:e,showType:!0}):e.label?(0,s.Y)(l.V,{column:{column_name:e.label,type:"expression"},showType:!0}):null}c.propTypes=d},48582:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(81237);const a=["AND","AS","ASC","AVG","BY","CASE","COUNT","CREATE","CROSS","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","ELSE","END","FOREIGN","FROM","GRANT","GROUP","HAVING","IF","INNER","INSERT","JOIN","KEY","LEFT","LIMIT","MAX","MIN","NATURAL","NOT","NULL","OFFSET","ON","OR","ORDER","OUTER","PRIMARY","REFERENCES","RIGHT","SELECT","SUM","TABLE","THEN","TYPE","UNION","UPDATE","WHEN","WHERE"].concat(["BIGINT","BINARY","BIT","CHAR","DATE","DECIMAL","DOUBLE","FLOAT","INT","INTEGER","MONEY","NUMBER","NUMERIC","REAL","SET","TEXT","TIMESTAMP","VARCHAR"]).map(e=>({meta:"sql",name:e,score:o.lI,value:e}))},49113:(e,t,n)=>{n.d(t,{K:()=>a});var o=n(24002);const a=(e,t)=>{(0,o.useEffect)(()=>{const n=n=>{e&&(n.preventDefault(),n.returnValue=t||"")};return window.addEventListener("beforeunload",n),()=>window.removeEventListener("beforeunload",n)},[e,t])}},51014:(e,t,n)=>{n.d(t,{A:()=>g});var o=n(2445),a=n(24002),i=n(74098),r=n(79378),l=n(81465),s=n(8558),d=n(52167),c=n(88217),u=n(76576),h=n(95018);const p=l.I4.div`
  display: flex;
  align-items: center;
  gap: ${({theme:e})=>e.sizeUnit}px;
  color: ${({theme:e,isError:t,isUnverified:n,isValidating:o})=>n||o?e.colorTextTertiary:t?e.colorErrorText:e.colorSuccessText};
  font-size: ${({theme:e})=>e.fontSizeSM}px;
  flex: 1;
  min-width: 0;

  span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,m=(0,a.forwardRef)(({value:e,onChange:t,showValidation:n=!1,expressionType:l="column",datasourceId:m,datasourceType:g,clause:v,onValidationComplete:f,...b},y)=>{var x;const[S,_]=(0,a.useState)(!1),[C,w]=(0,a.useState)(null);(0,a.useEffect)(()=>{(null!==C||S)&&(w(null),_(!1))},[e]);const A=(0,a.useCallback)(async()=>{if(!e||!m||!g){const t={message:e?(0,i.t)("Datasource is required for validation"):(0,i.t)("Expression cannot be empty")};return w({isValid:!1,errors:[t]}),void(null==f||f(!1,[t]))}_(!0),w(null);try{const t=`/api/v1/datasource/${g}/${m}/validate_expression/`,n={expression:e,expression_type:l,clause:v},o=(await r.A.post({endpoint:t,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})).json;o.result&&o.result.length>0?(w({isValid:!1,errors:o.result}),null==f||f(!1,o.result)):(w({isValid:!0}),null==f||f(!0))}catch(e){console.error("Error validating expression:",e);const t={message:(0,i.t)("Failed to validate expression. Please try again.")};w({isValid:!1,errors:[t]}),null==f||f(!1,[t])}finally{_(!1)}},[e,l,m,g,v,f]),D=(0,a.useCallback)(e=>{t(e),null!==C&&w(null)},[t,C]);return(0,o.FD)(u.s,{vertical:!0,gap:"middle",children:[(0,o.Y)(d.YU,{ref:y,value:e,onChange:D,...b}),n&&(0,o.FD)(u.s,{align:"center",gap:"small",style:{minHeight:32},children:[(0,o.Y)(h.m,{title:(0,i.t)("Validate your expression"),children:(0,o.Y)(c.$,{buttonSize:"small",buttonStyle:C?"secondary":"primary",loading:S,onClick:A,disabled:!e||!m||S,icon:(0,o.Y)(s.F.CaretRightFilled,{}),"aria-label":(0,i.t)("Validate your expression")})}),(0,o.Y)(p,{isError:!!C&&!C.isValid,isUnverified:!C&&!S,isValidating:S,children:S?(0,o.Y)("span",{children:(0,i.t)("Validating...")}):C?(0,o.Y)(o.FK,{children:C.isValid?(0,o.FD)(o.FK,{children:[(0,o.Y)(s.F.CheckCircleOutlined,{}),(0,o.Y)("span",{children:(0,i.t)("Valid SQL expression")})]}):(0,o.FD)(o.FK,{children:[(0,o.Y)(s.F.WarningOutlined,{}),(0,o.Y)(h.m,{title:(null==(x=C.errors)?void 0:x.map(e=>e.message).join("\n"))||(0,i.t)("Invalid expression"),placement:"top",children:(0,o.Y)("span",{children:C.errors&&C.errors.length>0?C.errors[0].message:(0,i.t)("Invalid expression")})})]})}):(0,o.FD)(o.FK,{children:[(0,o.Y)(s.F.WarningOutlined,{}),(0,o.Y)("span",{children:(0,i.t)("Unverified")})]})})]})]})});m.displayName="SQLEditorWithValidation";const g=m},52451:(e,t,n)=>{var o,a;n.d(t,{A:()=>o,v:()=>a}),function(e){e.Simple="SIMPLE",e.Sql="SQL"}(o||(o={})),function(e){e.Having="HAVING",e.Where="WHERE"}(a||(a={}))},52791:(e,t,n)=>{n.d(t,{R:()=>_});var o=n(62193),a=n.n(o),i=n(2445),r=n(24002),l=n(74098),s=n(17437),d=n(18749),c=n(81465),u=n(91402),h=n(81115),p=n(7566),m=n(61225),g=n(13981),v=n(70353),f=n(27915);const b=(0,l.t)("Drill to detail"),y=(0,l.t)("Drill to detail by"),x={DATABASE:(0,l.t)("Drill to detail is disabled for this database. Change the database settings to enable it."),NO_AGGREGATIONS:(0,l.t)("Drill to detail is disabled because this chart does not group data by dimension value."),NO_FILTERS:(0,l.t)("Right-click on a dimension value to drill to detail by that value."),NOT_SUPPORTED:(0,l.t)("Drill to detail by value is not yet supported for this chart type.")},S=(0,c.I4)(({children:e,stripHTML:t=!1})=>{const n=t&&"string"==typeof e?(0,p.zF)(e):e;return(0,i.Y)("span",{children:n})})`
  ${({theme:e})=>`\n     font-weight: ${e.fontWeightStrong};\n     color: ${e.colorPrimary};\n   `}
`,_=({formData:e,filters:t=[],isContextMenu:n=!1,contextMenuY:o=0,onSelection:c=()=>null,onClick:p=()=>null,submenuIndex:_=0,setFilters:C,setShowModal:w,key:A,...D})=>{const F=(0,m.d4)(({datasources:t})=>{var n;return null==(n=t[e.datasource])||null==(n=n.database)?void 0:n.disable_drill_to_detail}),T=(0,r.useCallback)((e,t)=>{p(t),c(),C(e),w(!0)},[p,c,C,w]),E=(0,r.useMemo)(()=>{var t;return null==(t=(0,d.A)().get(e.viz_type))?void 0:t.behaviors.find(e=>e===h.nS.DrillToDetail)},[e.viz_type]),$=(0,r.useMemo)(()=>{const{metrics:t}=(0,u.A)(e);return a()(t)},[e]),Y=(0,r.useMemo)(()=>(0,g.Gs)(o,t.length>1?t.length+1:t.length,_),[o,t.length,_]);let I,k;F?(I=x.DATABASE,k=x.DATABASE):E?$?(I=x.NO_AGGREGATIONS,k=x.NO_AGGREGATIONS):null!=t&&t.length||(k=x.NO_FILTERS):k=x.NOT_SUPPORTED;const M=I?{key:"drill-to-detail-disabled",disabled:!0,label:(0,i.FD)("div",{css:s.AH`
              white-space: normal;
              max-width: 160px;
            `,children:[b,(0,i.Y)(v.C,{title:I})]}),...D}:{key:"drill-to-detail",onClick:T.bind(null,[]),label:b},z=n?k?{key:"drill-to-detail-by-disabled",disabled:!0,label:(0,i.FD)("div",{css:s.AH`
                white-space: normal;
                max-width: 160px;
              `,children:[y,(0,i.Y)(v.C,{title:k})]}),...D}:{key:A||"drill-to-detail-by",label:y,popupOffset:[0,Y],popupClassName:"chart-context-submenu",children:[...t.map((e,t)=>({key:`drill-detail-filter-${t}`,onClick:T.bind(null,[e]),label:(0,i.Y)("div",{css:s.AH`
                    max-width: 200px;
                  `,children:(0,i.Y)(f.i2,{tooltipText:`${y} ${e.formattedVal}`,"aria-label":`${y} ${e.formattedVal}`,children:(0,i.FD)("span",{css:s.AH`
                        display: inline;
                      `,children:[y," ",(0,i.Y)(S,{stripHTML:!0,children:e.formattedVal})]})})})})),...t.length>1?[{key:"drill-detail-filter-all",onClick:T.bind(null,t),label:(0,i.FD)("div",{"aria-label":`${y} ${(0,l.t)("all")}`,css:s.AH`
                          max-width: 200px;
                        `,children:[`${y} `,(0,i.Y)(S,{stripHTML:!1,children:(0,l.t)("all")})]})}]:[]],...D}:null,R=[M];return z&&R.push(z),R}},54037:(e,t,n)=>{n.d(t,{x:()=>v});var o=n(65611),a=n.n(o),i=n(2445),r=n(81465),l=n(17437),s=n(58516),d=n(24002),c=n(16143),u=n(93590),h=n(90924),p=n(24777),m=n(90625);const g=r.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    align-items: center;\n    padding-bottom: ${2*e.sizeUnit}px;\n    justify-content: space-between;\n\n    span {\n      flex-shrink: 0;\n    }\n  `}
`,v=({data:e,datasourceId:t,onInputChange:n,columnNames:o,columnTypes:r,rowcount:v,isLoading:f,canDownload:b})=>{const y=(e=>{const t=(0,p.Gq)(p.Hh.ExploreDataTableOriginalFormattedTimeColumns,{});return void 0===e?[]:(0,h.A)(t[e])})(t),x=a()(o,r).filter(([e,t])=>t===s.GenericDataType.Temporal&&e&&!y.includes(e)).map(([e])=>e),S=(0,d.useMemo)(()=>(0,u.bE)(e,x),[e,x]);return(0,i.FD)(g,{children:[(0,i.Y)(c.ZY,{onChangeHandler:n,shouldFocus:!0}),(0,i.FD)("div",{css:l.AH`
          display: flex;
          align-items: center;
        `,children:[(0,i.Y)(m.A,{rowcount:v,loading:f}),b&&(0,i.Y)(c.TN,{data:S,columns:o})]})]})}},54775:(e,t,n)=>{n.d(t,{w:()=>g,K:()=>s});var o=n(24002),a=n(31463),i=n(20033),r=n(49239),l=n(52451);const s=e=>{const[t,n]=(0,o.useState)({});return(0,o.useEffect)(()=>{e.operator===r.ux.TemporalRange&&e.expressionType===l.A.Simple||n({}),e.operator===r.ux.TemporalRange&&e.comparator===a.WC&&n({actualTimeRange:`${e.subject} (${a.WC})`,title:a.WC}),e.operator===r.ux.TemporalRange&&e.expressionType===l.A.Simple&&e.comparator!==a.WC&&t.title!==e.comparator&&(0,i.x9)(e.comparator,e.subject).then(({value:t,error:o})=>{n(o?{actualTimeRange:`${e.subject} (${e.comparator})`,title:o}:{actualTimeRange:null!=t?t:"",title:e.comparator})})},[e]),t};var d=n(2445),c=n(1763),u=n(74098),h=n(81500),p=n(66492),m=n(18865);const g=({columnName:e,timeRange:t,datasource:n,onChange:o})=>{const a=(0,c.a)().get("filter.dateFilterControl"),i=null!=a?a:p.A;return(0,h.D)(e,n)?(0,d.FD)(d.FK,{children:[(0,d.Y)(m.A,{label:(0,u.t)("Time Range")}),(0,d.Y)(i,{value:t,name:"time_range",onChange:t=>o(e,t)})]}):void 0}},55169:(e,t,n)=>{n.d(t,{k:()=>x,v:()=>f});var o=n(2445),a=n(24002),i=n(61225),r=n(1763),l=n(67413),s=n(74098),d=n(17437),c=n(81465),u=n(99106),h=n(29645),p=n(93590),m=n(45898),g=n(97475);const v=(0,r.a)();var f;!function(e){e.Charts="charts",e.Dashboards="dashboards"}(f||(f={}));const b=c.I4.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  > *:first-child {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,y=v.get("report-modal.dropdown.item.icon"),x=({dashboardId:e,chart:t,showReportModal:n,setCurrentReportDeleting:r})=>{const c=(0,i.wA)(),v=e||(null==t?void 0:t.id),x=e?f.Dashboards:f.Charts,S=(0,i.d4)(e=>v&&((e.reports||{})[x]||{})[v]||null),_=(0,i.d4)(e=>e.user),C=(0,l.Z)(e),w=()=>!!(0,u.G7)(u.TO.AlertReports)&&(!(null==_||!_.userId)&&(!!v&&Object.keys(_.roles||[]).map(e=>_.roles[e].filter(e=>"menu_access"===e[0]&&"Manage"===e[1])).some(e=>e.length>0))),A=w()&&!!(e&&C!==e||null!=t&&t.id);if((0,a.useEffect)(()=>{A&&c((0,m.LQ)({userId:_.userId,filterField:e?"dashboard_id":"chart_id",creationMethod:e?"dashboards":"charts",resourceId:v}))},[c,A,null==_?void 0:_.userId,e,v]),!w())return null;const D=()=>n();return S&&S.id?{key:"email-report-manage",type:"submenu",label:(0,s.t)("Manage email report"),children:[{key:"toggle-active",label:(0,o.FD)(g.t3,{children:[(0,o.Y)(h.Checkbox,{checked:S.active||!1,onChange:p.fZ,css:e=>d.AH`
                margin-right: ${e.sizeUnit}px;
              `}),(0,s.t)("Email reports active")]}),onClick:()=>{null!=S&&S.id&&c((0,m.PM)(S,!S.active))}},{key:"edit-report",label:(0,s.t)("Edit email report"),onClick:D},{key:"delete-report",label:(0,s.t)("Delete email report"),onClick:()=>r(S),danger:!0}]}:{key:"email-report-setup",type:"submenu",label:(0,s.t)("Manage email report"),children:[{key:"set-up-report",label:y?(0,o.FD)(b,{children:[(0,o.Y)("div",{children:(0,s.t)("Set up an email report")}),(0,o.Y)(y,{})]}):(0,s.t)("Set up an email report"),onClick:D}]}}},56702:(e,t,n)=>{n.d(t,{A:()=>H});var o,a,i=n(2445),r=n(24002),l=n(7741),s=n(74098),d=n(59744),c=n(61225),u=n(45898),h=n(29645),p=n(32202),m=n(94185),g=n(29027),v=n(8558),f=n(42566),b=n(22750),y=n(64457);!function(e){e.Dashboards="dashboards",e.Charts="charts"}(o||(o={})),function(e){e.Text="TEXT",e.PNG="PNG",e.CSV="CSV"}(a||(a={}));var x=n(86784),S=n(70023),_=n(55169),C=n(81465),w=n(17437),A=n(97163),D=n(9679),F=n(88217);const T=(0,C.I4)(A.aF)`
  .ant-modal-body {
    padding: 0;
  }
`,E=C.I4.div`
  padding: ${({theme:e})=>`${3*e.sizeUnit}px ${4*e.sizeUnit}px ${2*e.sizeUnit}px`};
  label {
    font-size: ${({theme:e})=>e.fontSizeSM}px;
    color: ${({theme:e})=>e.colorTextSecondary};
  }
`,$=C.I4.div`
  border-top: 1px solid ${({theme:e})=>e.colorSplit};
  padding: ${({theme:e})=>`${4*e.sizeUnit}px ${4*e.sizeUnit}px ${6*e.sizeUnit}px`};
  .ant-select {
    width: 100%;
  }
  .control-label {
    font-size: ${({theme:e})=>e.fontSizeSM}px;
    color: ${({theme:e})=>e.colorTextSecondary};
  }
`,Y=C.I4.span`
  span {
    margin-right: ${({theme:e})=>2*e.sizeUnit}px;
    vertical-align: middle;
  }
  .text {
    vertical-align: middle;
  }
`,I=C.I4.div`
  margin-bottom: ${({theme:e})=>7*e.sizeUnit}px;

  h4 {
    margin-bottom: ${({theme:e})=>3*e.sizeUnit}px;
  }
`,k=(0,C.I4)(D.l)`
  margin-bottom: ${({theme:e})=>3*e.sizeUnit}px;
  width: ${({theme:e})=>120*e.sizeUnit}px;
`,M=C.I4.p`
  color: ${({theme:e})=>e.colorError};
`,z=w.AH`
  margin-bottom: 0;
`,R=(0,C.I4)(F.$)`
  width: ${({theme:e})=>40*e.sizeUnit}px;
`,O=e=>w.AH`
  margin: ${3*e.sizeUnit}px 0 ${2*e.sizeUnit}px;
`,N=C.I4.div`
  margin: ${({theme:e})=>8*e.sizeUnit}px 0
    ${({theme:e})=>4*e.sizeUnit}px;
`,L=((0,C.I4)(b.s)`
  display: block;
  line-height: ${({theme:e})=>8*e.sizeUnit}px;
`,[l.Y.PivotTable,"table",l.Y.PairedTTest]),U={crontab:"0 12 * * 1"},q={},H=(0,y.Ay)(function({onHide:e,show:t=!1,dashboardId:n,chart:o,userId:l,userEmail:y,ccEmail:C,bccEmail:A,creationMethod:D,dashboardName:F,chartName:H}){var j;const P=null==o||null==(j=o.sliceFormData)?void 0:j.viz_type,V=!!o,B=V&&P&&L.includes(P),W=B?a.Text:a.PNG,G=F||H,Q=(0,r.useMemo)(()=>({...U,name:G?(0,s.t)("Weekly Report for %s",G):(0,s.t)("Weekly Report")}),[G]),K=(0,r.useCallback)((e,t)=>"reset"===t?Q:{...e,...t},[Q]),[X,J]=(0,r.useReducer)(K,Q),[Z,ee]=(0,r.useState)(),te=(0,c.wA)(),ne=(0,c.d4)(e=>{const t=n?_.v.Dashboards:_.v.Charts;return(0,x.oi)(e,t,n||(null==o?void 0:o.id))||q}),oe=ne&&Object.keys(ne).length;(0,r.useEffect)(()=>{J(oe?ne:"reset")},[oe,ne]);const ae=(0,i.FD)(Y,{children:[(0,i.Y)(v.F.CalendarOutlined,{}),(0,i.Y)("span",{className:"text",children:oe?(0,s.t)("Edit email report"):(0,s.t)("Schedule a new email report")})]}),ie=(0,i.FD)(i.FK,{children:[(0,i.Y)(R,{onClick:e,children:(0,s.t)("Cancel")},"back"),(0,i.Y)(R,{buttonStyle:"primary",onClick:async()=>{const t={type:"Report",active:!0,force_screenshot:!1,custom_width:X.custom_width,creation_method:D,dashboard:n,chart:null==o?void 0:o.id,owners:[l],recipients:[{recipient_config_json:{target:y,ccTarget:C,bccTarget:A},type:"Email"}],name:X.name,description:X.description,crontab:X.crontab,report_format:X.report_format||W,timezone:X.timezone};J({isSubmitting:!0,error:void 0});try{oe?await te((0,u.Zp)(X.id,t)):await te((0,u.ef)(t)),e()}catch(e){const{error:t}=await(0,d.h4)(e);J({error:t})}J({isSubmitting:!1})},disabled:!X.name,loading:X.isSubmitting,children:oe?(0,s.t)("Save"):(0,s.t)("Add")},"submit")]}),re=(0,i.FD)(i.FK,{children:[(0,i.Y)(N,{children:(0,i.Y)(f.o.Title,{level:4,children:(0,s.t)("Message content")})}),(0,i.Y)("div",{className:"inline-container",children:(0,i.Y)(b.s.GroupWrapper,{spaceConfig:{direction:"vertical",size:"middle",align:"start",wrap:!1},onChange:e=>{J({report_format:e.target.value})},value:X.report_format||W,options:[{label:(0,s.t)("Text embedded in email"),value:a.Text},{label:(0,s.t)("Image (PNG) embedded in email"),value:a.PNG},{label:(0,s.t)("Formatted CSV attached in email"),value:a.CSV}]})})]}),le=(0,i.FD)(S.tu,{children:[(0,i.Y)("div",{className:"control-label",css:O,children:(0,s.t)("Screenshot width")}),(0,i.Y)("div",{className:"input-container",children:(0,i.Y)(h.Input,{type:"number",name:"custom_width",value:(null==X?void 0:X.custom_width)||"",placeholder:(0,s.t)("Input custom width in pixels"),onChange:e=>{J({custom_width:parseInt(e.target.value,10)||null})}})})]});return(0,i.FD)(T,{show:t,onHide:e,title:ae,footer:ie,width:"432",centered:!0,children:[(0,i.FD)(E,{children:[(0,i.Y)(p.M,{id:"name",name:"name",value:X.name||"",placeholder:Q.name,required:!0,validationMethods:{onChange:({target:e})=>J({name:e.value})},label:(0,s.t)("Report Name")}),(0,i.Y)(p.M,{id:"description",name:"description",value:(null==X?void 0:X.description)||"",validationMethods:{onChange:({target:e})=>{J({description:e.value})}},label:(0,s.t)("Description"),placeholder:(0,s.t)("Include a description that will be sent with your report"),css:z})]}),(0,i.FD)($,{children:[(0,i.FD)(I,{children:[(0,i.Y)(f.o.Title,{level:5,css:e=>(e=>w.AH`
  margin: ${3*e.sizeUnit}px 0;
`)(e),children:(0,s.t)("Schedule")}),(0,i.Y)("p",{children:(0,s.t)("The report will be sent to your email at")})]}),(0,i.Y)(k,{clearButton:!1,value:X.crontab||"0 12 * * 1",setValue:e=>{J({crontab:e})},onError:ee}),(0,i.Y)(M,{children:Z}),(0,i.Y)("div",{className:"control-label",css:e=>(e=>w.AH`
  margin: ${3*e.sizeUnit}px 0 ${2*e.sizeUnit}px;
`)(e),children:(0,s.t)("Timezone")}),(0,i.Y)(g.A,{timezone:X.timezone,onTimezoneChange:e=>{J({timezone:e})}}),V&&re,(!V||!B)&&le]}),X.error&&(0,i.Y)(m.F,{type:"error",css:e=>(e=>w.AH`
  margin: ${4*e.sizeUnit}px;
  margin-top: 0;
`)(e),message:oe?(0,s.t)("Failed to update report"):(0,s.t)("Failed to create report"),description:X.error})]})})},59482:(e,t,n)=>{var o;n.d(t,{S:()=>o}),function(e){e.Column="column",e.ColumnOption="columnOption",e.AdhocColumnOption="adhocColumn",e.Metric="metric",e.MetricOption="metricOption",e.AdhocMetricOption="adhocMetric",e.FilterOption="filterOption"}(o||(o={}))},60063:(e,t,n)=>{n.d(t,{A:()=>C});var o=n(2445),a=n(24002),i=n(61225),r=n(58561),l=n.n(r),s=n(74098),d=n(79378),c=n(81465),u=n(29645),h=n(8558),p=n(88217),m=n(4651),g=n(9876),v=n(90886),f=n(55204),b=n(61574);const y=c.I4.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,x=(0,c.I4)(f.Ay)`
  flex: 1;
`,S=c.I4.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,_={keys:["none"],columns:["database.backend"]},C=e=>{var t;const{sql:n,language:r="sql",datasource:C}=e,w=(0,c.DP)(),A=null==C?void 0:C.split("__")[0],D=(0,i.d4)(e=>{var t;return null==(t=e.explore)||null==(t=t.datasource)||null==(t=t.database)?void 0:t.backend}),[F,T]=(0,a.useState)(),[E,$]=(0,a.useState)(!0),Y=(0,b.W6)(),I=null!=(t=E?F:n)?t:n,k=(0,i.d4)(e=>{var t;return(0,v.L)("menu_access","SQL Lab",null==(t=e.user)?void 0:t.roles)});(0,a.useEffect)(()=>{(0,f.Fq)([r])},[r]);const M=(0,a.useCallback)(async()=>{if(F)$(e=>!e);else try{let e=D;if(!e){const t=l().encode(_);e=(await d.A.get({endpoint:`/api/v1/dataset/${A}?q=${t}`})).json.result.database}const t=await d.A.post({endpoint:"/api/v1/sqllab/format_sql/",body:JSON.stringify({sql:n,engine:e}),headers:{"Content-Type":"application/json"}});T(t.json.result),$(!0)}catch(e){$(!1)}},[n,A,F]),z=(0,a.useCallback)(e=>{const t={datasourceKey:C,sql:I};e.metaKey||e.ctrlKey?(e.preventDefault(),window.open(`/sqllab?datasourceKey=${C}&sql=${encodeURIComponent(I)}`,"_blank")):Y.push({pathname:"/sqllab",state:{requestedQuery:t}})},[Y,C,I]);return(0,a.useEffect)(()=>{M()},[n]),(0,o.Y)(m.Z,{bodyStyle:{padding:4*w.sizeUnit},children:(0,o.FD)(y,{children:[!F&&E?(0,o.Y)(u.Skeleton,{active:!0}):(0,o.Y)(x,{language:r,customStyle:{flex:1,marginBottom:3*w.sizeUnit},children:I}),(0,o.FD)(S,{children:[(0,o.FD)(u.Space,{size:2*w.sizeUnit,children:[(0,o.Y)(g.$r,{text:I,shouldShowText:!1,copyNode:(0,o.Y)(p.$,{buttonStyle:"secondary",buttonSize:"small",icon:(0,o.Y)(h.F.CopyOutlined,{}),children:(0,s.t)("Copy")})}),k&&(0,o.Y)(p.$,{buttonStyle:"secondary",buttonSize:"small",onClick:z,children:(0,s.t)("View in SQL Lab")})]}),(0,o.FD)(u.Space,{size:2*w.sizeUnit,align:"center",children:[(0,o.Y)(h.F.ConsoleSqlOutlined,{}),(0,o.Y)(u.Switch,{id:"formatSwitch",checked:E,onChange:M,checkedChildren:(0,s.t)("formatted"),unCheckedChildren:(0,s.t)("original")})]})]})]},n)})}},60838:(e,t,n)=>{n.d(t,{n:()=>o});const o=()=>{try{return window.self!==window.top||null!==window.frameElement}catch(e){return!0}}},61269:(e,t,n)=>{n.d(t,{e:()=>i,w:()=>r});var o=n(79378),a=n(45727);const i=new Map,r=(0,a.K)(o.A.get,i,({endpoint:e})=>e||"")},63626:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(3959);function a(e,t){const n=document.querySelector(e),a=o.Wp.table_to_book(n);(0,o._h)(a,`${t}.xlsx`)}},64216:(e,t,n)=>{n.d(t,{r:()=>l});var o=n(74098),a=n(99418);function i({title:e,body:t,footer:n}){const o=`\n    <div class="tooltip-detail">\n      ${e?`<div class="tooltip-detail-title">${e}</div>`:""}\n      ${t?`<div class="tooltip-detail-body">${t}</div>`:""}\n      ${n?`<div class="tooltip-detail-footer">${n}</div>`:""}\n    </div>\n  `;return a.default.sanitize(o)}var r=n(81237);function l(e){return e.map(({column_name:e,verbose_name:t,is_certified:n,certified_by:a,description:l,type:s})=>({name:t||e,value:e,docHTML:i({title:e,body:`type: ${s||"unknown"}<br />${l?`description: ${l}`:""}`,footer:n?(0,o.t)("Certified by %s",a):void 0}),score:r.v9,meta:"column"}))}},67217:(e,t,n)=>{n.d(t,{A:()=>m});var o=n(20249),a=n.n(o),i=n(67390),r=n.n(i),l=n(74098),s=n(91412);const d=.95,c=(e,t=new Date)=>`${a()(e)}-${t.toISOString().replace(/[: ]/g,"-")}`,u=new Set(["display","position","width","height","max-width","max-height","margin","padding","top","right","bottom","left","font","font-family","font-size","font-weight","font-style","line-height","letter-spacing","word-spacing","text-align","text-decoration","color","background-color","border","border-width","border-style","border-color","opacity","visibility","overflow","z-index","transform","flex","flex-direction","justify-content","align-items","grid","grid-template","grid-area","table-layout","vertical-align","text-align"]),h=new WeakMap,p=e=>{const t=e.cloneNode(!0);((e,t)=>{const n=[[e,t]],o=new WeakSet;for(;n.length;){var a;const[e,t]=n.shift();if(o.has(e))continue;o.add(e);let i=h.get(e);i||(i=window.getComputedStyle(e),h.set(e,i));for(const e of u){const n=i.getPropertyValue(e);n&&"initial"!==n&&"inherit"!==n&&t.style.setProperty(e,n,i.getPropertyPriority(e))}if(null!=(a=e.textContent)&&a.trim()){const{color:e}=i;e&&"transparent"!==e&&"rgba(0, 0, 0, 0)"!==e||(t.style.color="#000"),t.style.visibility="visible","none"===i.display&&(t.style.display="block")}for(let o=0;o<e.children.length;o+=1)n.push([e.children[o],t.children[o]])}})(e,t),((e,t)=>{const n=e.querySelectorAll("canvas"),o=t.querySelectorAll("canvas");n.forEach((e,t)=>{if(n[t]&&o[t]){const n=o[t],a=n.getContext("2d");a&&(n.width=e.width,n.height=e.height,a.drawImage(e,0,0))}})})(e,t);const n=document.createElement("div");return n.style.cssText="\n    position: absolute;\n    left: -20000px;\n    top: -20000px;\n    visibility: hidden;\n    pointer-events: none;\n    z-index: -1000;\n  ",n.appendChild(t),document.body.appendChild(n),(e=>{const t=e.style;t.height="auto",t.maxHeight="none",['[style*="overflow"]',".scrollable",".table-responsive",".ant-table-body",".table-container",".ant-table-container",".table-wrapper",".ant-table-tbody","tbody",".table-body",".virtual-table",".react-window",".react-virtualized"].forEach(t=>{e.querySelectorAll(t).forEach(e=>{const t=e;t.style.overflow="visible",t.style.height="auto",t.style.maxHeight="none"})}),e.querySelectorAll("table, .ant-table, .table-container, .data-table").forEach(e=>{const t=e;t.style.margin="0 auto",t.style.display="table",t.style.width="100%",t.style.tableLayout="auto"}),e.querySelectorAll("tr, .ant-table-row, .table-row, .data-row").forEach(e=>{const t=e;t.style.display="table-row",t.style.visibility="visible",t.style.height="auto"}),e.querySelectorAll("td, th, .ant-table-cell, .table-cell").forEach(e=>{const t=e;t.style.display="table-cell",t.style.visibility="visible"}),e.querySelectorAll("*").forEach(e=>{var t;const n=e;if(null!=(t=n.textContent)&&t.trim()){const e=window.getComputedStyle(n);"transparent"===e.color&&(n.style.color="#000"),n.style.visibility="visible","none"===e.display&&(n.style.display="block")}}),e.querySelectorAll("[data-virtualized], .virtualized, .lazy-load").forEach(e=>{const t=e;t.style.height="auto",t.style.maxHeight="none"})})(t),{clone:t,cleanup:()=>{null==h.delete||h.delete(e),n.parentElement&&n.parentElement.removeChild(n)}}};function m(e,t,n=!1,o){return async a=>{const i=n?document.querySelector(e):a.currentTarget.closest(e);if(!i)return void(0,s.Zd)((0,l.t)("Image download failed, please refresh and try again."));let u=null;try{const{clone:e,cleanup:n}=p(i);u=n;const a=e=>"string"!=typeof e.className||!e.className.includes("mapboxgl-control-container")&&!e.className.includes("header-controls"),l=await r().toJpeg(e,{bgcolor:null==o?void 0:o.colorBgContainer,filter:a,quality:d,height:e.scrollHeight,width:e.scrollWidth,cacheBust:!0});u(),u=null;const s=document.createElement("a");s.download=`${c(t)}.jpg`,s.href=l,s.click()}catch(e){console.error("Creating image failed",e),(0,s.Zd)((0,l.t)("Image download failed, please refresh and try again."))}finally{u&&u()}}}},68690:(e,t,n)=>{n.d(t,{r:()=>l});var o=n(91920),a=n(52451),i=n(49239),r=n(19171);const l=(e,t=a.v.Where)=>{var n;const l=(e=>{if(!e.filterDataMapping)return null;const{col:t,op:n}=e,o="val"in e?e.val:void 0;for(const[a,i]of Object.entries(e.filterDataMapping))if(Array.isArray(i)&&i.find(e=>e.col===t&&e.op===n&&JSON.stringify(e.val)===JSON.stringify(o)))return a;return null})(e),s=l?null==(n=e.layerFilterScope)?void 0:n[l]:void 0;let d;var c;return d=(0,o.q0)(e.col)?{expressionType:"SQL",clause:t,sqlExpression:(0,r.e)({expressionType:a.A.Simple,subject:`(${e.col.sqlExpression})`,operator:e.op,comparator:"val"in e?e.val:void 0})}:{expressionType:"SIMPLE",clause:t,operator:e.op,operatorId:null==(c=Object.entries(i.nS).find(t=>t[1].operation===e.op))?void 0:c[0],subject:e.col,comparator:"val"in e?e.val:void 0},e.isExtra&&Object.assign(d,{isExtra:!0,layerFilterScope:s,filterOptionName:`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}),d}},70353:(e,t,n)=>{n.d(t,{C:()=>l});var o=n(2445),a=n(17437),i=n(8558),r=n(95018);const l=({title:e,color:t})=>(0,o.Y)(r.m,{title:e,placement:"top",children:(0,o.Y)(i.F.InfoCircleOutlined,{css:e=>a.AH`
        color: ${t||e.colorTextLabel};
        margin-left: ${2*e.sizeUnit}px;
        &.anticon {
          font-size: unset;
          .anticon {
            line-height: unset;
            vertical-align: unset;
          }
        }
      `})})},73151:(e,t,n)=>{n.d(t,{A:()=>k});var o=n(24002),a=n(5556),i=n.n(a),r=n(90924),l=n(79378),s=n(75574),d=n(74098),c=n(98837),u=n(18865),h=n(97566),p=n(35382),m=n(49239),g=n(40795),v=n(14584),f=n(8558),b=n(97163),y=n(20941),x=n(2445),S=n(59482),_=n(54775);function C({adhocFilter:e,options:t,datasource:n,onFilterEdit:o,onRemoveFilter:a,partitionColumn:i,onMoveLabel:r,onDropLabel:l,index:s,sections:d,operators:c}){const{actualTimeRange:u,title:h}=(0,_.K)(e);return(0,x.Y)(y.A,{sections:d,operators:c,adhocFilter:e,options:t,datasource:n,onFilterEdit:o,partitionColumn:i,children:(0,x.Y)(v.Px,{label:null!=u?u:e.getDefaultLabel(),tooltipTitle:null!=h?h:e.getTooltipTitle(),onRemove:a,onMoveLabel:r,onDropLabel:l,index:s,type:S.S.FilterOption,withCaret:!0,isExtra:e.isExtra})})}var w=n(94229),A=n(31296),D=n(52451);const{warning:F}=b.aF,T=i().oneOfType([i().string,h.A]),E={label:i().oneOfType([i().object,i().string]),name:i().string,sections:i().arrayOf(i().string),operators:i().arrayOf(i().string),onChange:i().func,value:i().arrayOf(function(e){return null}),datasource:i().object,columns:i().arrayOf(i().object),savedMetrics:i().arrayOf(i().object),selectedMetrics:i().oneOfType([T,i().arrayOf(T)]),isLoading:i().bool,canDelete:i().func};function $(e){return e&&!(e instanceof w.A)&&e.expressionType}function Y(e){return[...e.columns,...(0,r.A)(e.selectedMetrics).map(e=>e&&("string"==typeof e?{saved_metric_name:e}:new p.A(e)))].filter(e=>e).reduce((e,t)=>(t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof p.A&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e),[]).sort((e,t)=>(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label))}class I extends o.Component{constructor(e){super(e),this.onRemoveFilter=this.onRemoveFilter.bind(this),this.onNewFilter=this.onNewFilter.bind(this),this.onFilterEdit=this.onFilterEdit.bind(this),this.moveLabel=this.moveLabel.bind(this),this.onChange=this.onChange.bind(this),this.mapOption=this.mapOption.bind(this),this.getMetricExpression=this.getMetricExpression.bind(this),this.removeFilter=this.removeFilter.bind(this);const t=(this.props.value||[]).map(e=>$(e)?new w.A(e):e);this.optionRenderer=e=>(0,x.Y)(g.A,{option:e}),this.valueRenderer=(e,t)=>(0,x.Y)(C,{index:t,adhocFilter:e,onFilterEdit:this.onFilterEdit,options:this.state.options,sections:this.props.sections,operators:this.props.operators,datasource:this.props.datasource,onRemoveFilter:e=>{e.stopPropagation(),this.onRemoveFilter(t)},onMoveLabel:this.moveLabel,onDropLabel:()=>this.props.onChange(this.state.values),partitionColumn:this.state.partitionColumn},t),this.state={values:t,options:Y(this.props),partitionColumn:null}}componentDidMount(){const{datasource:e}=this.props;if(e&&"table"===e.type){var t;const n=null==(t=e.database)?void 0:t.id,{datasource_name:o,catalog:a,schema:i,is_sqllab_view:r}=e;!r&&n&&o&&i&&l.A.get({endpoint:`/api/v1/database/${n}/table_metadata/extra/${(0,A.zJ)({name:o,catalog:a,schema:i})}`}).then(({json:e})=>{if(e&&e.partitions){const{partitions:t}=e;t&&t.cols&&1===Object.keys(t.cols).length&&this.setState({partitionColumn:t.cols[0]})}}).catch(e=>{s.A.error("fetch extra_table_metadata:",e.statusText)})}}componentDidUpdate(e){this.props.columns!==e.columns&&this.setState({options:Y(this.props)}),this.props.value!==e.value&&this.setState({values:(this.props.value||[]).map(e=>$(e)?new w.A(e):e)})}removeFilter(e){const t=[...this.state.values];t.splice(e,1),this.setState(e=>({...e,values:t})),this.props.onChange(t)}onRemoveFilter(e){const{canDelete:t}=this.props,{values:n}=this.state,o=null==t?void 0:t(n[e],n);"string"!=typeof o?this.removeFilter(e):F({title:(0,d.t)("Warning"),content:o})}onNewFilter(e){const t=this.mapOption(e);t&&this.setState(e=>({...e,values:[...e.values,t]}),()=>{this.props.onChange(this.state.values)})}onFilterEdit(e){this.props.onChange(this.state.values.map(t=>t.filterOptionName===e.filterOptionName?e:t))}onChange(e){const t=(e||[]).map(e=>this.mapOption(e)).filter(e=>e);this.props.onChange(t)}getMetricExpression(e){return this.props.savedMetrics.find(t=>t.metric_name===e).expression}moveLabel(e,t){const{values:n}=this.state,o=[...n];[o[t],o[e]]=[o[e],o[t]],this.setState({values:o})}mapOption(e){return e instanceof w.A?e:e.saved_metric_name?new w.A({expressionType:D.A.Sql,subject:this.getMetricExpression(e.saved_metric_name),operator:m.nS[m.ux.GreaterThan].operation,comparator:0,clause:D.v.Having}):e.label?new w.A({expressionType:D.A.Sql,subject:new p.A(e).translateToSql(),operator:m.nS[m.ux.GreaterThan].operation,comparator:0,clause:D.v.Having}):e.column_name?new w.A({expressionType:D.A.Simple,subject:e.column_name,operator:m.nS[m.ux.Equals].operation,comparator:"",clause:D.v.Where,isNew:!0}):null}addNewFilterPopoverTrigger(e){return(0,x.Y)(y.A,{operators:this.props.operators,sections:this.props.sections,adhocFilter:new w.A({}),datasource:this.props.datasource,options:this.state.options,onFilterEdit:this.onNewFilter,partitionColumn:this.state.partitionColumn,children:e})}render(){return(0,x.FD)("div",{className:"metrics-select",children:[(0,x.Y)(v.B3,{children:(0,x.Y)(u.A,{...this.props})}),(0,x.Y)(v.p6,{children:[...this.state.values.length>0?this.state.values.map((e,t)=>this.valueRenderer(e,t)):[],this.addNewFilterPopoverTrigger((0,x.FD)(v.JG,{role:"button",children:[(0,x.Y)(f.F.PlusOutlined,{iconSize:"m"}),(0,d.t)("Add filter")]}))]})]})}}I.propTypes=E,I.defaultProps={name:"",onChange:()=>{},columns:[],savedMetrics:[],selectedMetrics:[]};const k=(0,c.b)(I)},74018:(e,t,n)=>{n.d(t,{w:()=>r});var o=n(24002),a=n(43561);const i=new BroadcastChannel("tab_id_channel");function r(){const[e,t]=(0,o.useState)();return(0,o.useEffect)(()=>{if(!function(){try{return window.localStorage&&window.sessionStorage}catch(e){return!1}}())return void(e||t((0,a.Ak)()));const n=()=>{let e;try{e=window.localStorage.getItem("last_tab_id")}catch(e){}const n=String(e?Number.parseInt(e,10)+1:1);try{window.sessionStorage.setItem("tab_id",n),window.localStorage.setItem("last_tab_id",n)}catch(e){}t(n)};let o;try{o=window.sessionStorage.getItem("tab_id")}catch(e){}o?(i.postMessage({type:"REQUESTING_TAB_ID",tabId:o}),t(o)):n(),i.onmessage=t=>{if(t.data.tabId===e)if("REQUESTING_TAB_ID"===t.data.type){const e={type:"TAB_ID_DENIED",tabId:t.data.tabId};i.postMessage(e)}else"TAB_ID_DENIED"===t.data.type&&n()}},[e]),e}},75388:(e,t,n)=>{n.d(t,{M:()=>u});var o=n(2445),a=n(24002),i=n(74098),r=n(17437),l=n(81465),s=n(10320),d=n(22802),c=n(60838);const u=({dataset:e})=>{const t=(0,l.DP)();return{metadataBar:(0,a.useMemo)(()=>{if((0,c.n)())return null;const n=[];if(e){var a,l;const{changed_on_humanized:t,created_on_humanized:o,description:r,table_name:s,changed_by:c,created_by:u,owners:h}=e,p=(0,i.t)("Not available"),m=`${null!=(a=null==u?void 0:u.first_name)?a:""} ${null!=(l=null==u?void 0:u.last_name)?l:""}`.trim()||p,g=c?`${c.first_name} ${c.last_name}`:p,v=h&&h.length>0?h.map(e=>`${e.first_name} ${e.last_name}`):[p];n.push({type:d.Q.Table,title:s||p}),n.push({type:d.Q.LastModified,value:t||p,modifiedBy:g}),n.push({type:d.Q.Owner,createdBy:m,owners:v,createdOn:o||p}),r&&n.push({type:d.Q.Description,value:r})}return(0,o.Y)("div",{css:r.AH`
          display: flex;
          margin-bottom: ${4*t.sizeUnit}px;
        `,children:n.length>0&&(0,o.Y)(s.Ay,{items:n,tooltipPlacement:"bottom"})})},[e,t.sizeUnit])}}},90625:(e,t,n)=>{n.d(t,{A:()=>d});var o=n(2445),a=n(74098),i=n(29898),r=n(95018),l=n(27509);const s=(0,a.t)("The row limit set for the chart was reached. The chart may show partial data.");function d(e){const{rowcount:t=0,limit:n=null,loading:d,label:c}=e,u=n&&t>=n,h=u||0===t&&!d?"error":"default",p=(0,i.gV)()(t),m=(0,o.Y)(l.JU,{type:h,children:d?(0,a.t)("Loading..."):(0,o.Y)("span",{children:(0,a.tn)("%s row","%s rows",t,p)})});return u?(0,o.Y)(r.m,{id:"tt-rowcount-tooltip",title:(0,o.Y)("span",{children:s}),children:c||m}):c||m}},92026:(e,t,n)=>{n.d(t,{Kg:()=>g,J8:()=>p,Pz:()=>v,tg:()=>u,pY:()=>h,px:()=>m});var o=n(31463),a=n(81115),i=n(74098),r=n(46772);const l=e=>null!=e&&"function"==typeof e[Symbol.iterator];var s=n(29624),d=n(32064);const c=()=>{var e;const t=(0,d.Ay)();return(null==t||null==(e=t.common)||null==(e=e.conf)?void 0:e.NATIVE_FILTER_DEFAULT_ROW_LIMIT)||1e3},u=({datasetId:e,dependencies:t={},groupby:n,defaultDataMask:o,controlValues:a,filterType:i,sortMetric:l,adhoc_filters:s,time_range:d,granularity_sqla:u,type:h,dashboardId:p,id:m,cascade_parent_column:g,cascade_parent_value:v})=>{var f;const b={};e&&(b.datasource=`${e}__table`),n&&(b.groupby=[n]),l&&(b.sortMetric=l);const y={...a,...b,adhoc_filters:null!=s?s:[],extra_filters:[],extra_form_data:t,granularity_sqla:u,metrics:["count"],row_limit:c(),showSearch:!0,defaultValue:null==o||null==(f=o.filterState)?void 0:f.value,time_range:d,url_params:(0,r.A)("regular"),inView:!0,viz_type:i,type:h,dashboardId:p,native_filter_id:m};return g&&void 0!==v&&(y.cascade_parent_column=g,y.cascade_parent_value=v),y};function h(e={},t={}){const n={};return o.t1.forEach(o=>{const a=e[o],i=t[o],r=[...l(a)?a:[],...l(i)?i:[]];r.length&&(n[o]=r)}),o.zk.forEach(o=>{const a=e[o];void 0!==a&&(n[o]=a);const i=t[o];void 0!==i&&(n[o]=i)}),n}function p(e,t){let n={};return t.forEach(t=>{var o,a;n=h(n,null!=(o=null==(a=e[t])?void 0:a.extraFormData)?o:{})}),n}function m(e){return!e.includes(a.nS.NativeFilter)||e.includes(a.nS.InteractiveChart)}const g=(e,t)=>new Set(t.map(t=>{var n;return null==(n=e.find(e=>{var n;return(null==e||null==(n=e.meta)?void 0:n.chartId)===t}))||null==(n=n.parents)?void 0:n.filter(e=>e.startsWith(`${s.B8}-`))}).filter(e=>void 0!==e).flat()),v=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,i.t)("Unknown value")},93820:(e,t,n)=>{n.d(t,{k:()=>r});var o=n(90179),a=n.n(o);const i=["url_params"],r=e=>a()(e,i)},94229:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(49239),a=n(19171),i=n(52451);const r=[...o.Wy].map(e=>o.nS[e].operation);class l{constructor(e){var t;this.expressionType=e.expressionType||i.A.Simple,this.expressionType===i.A.Simple?(this.subject=e.subject,this.operator=null==(t=e.operator)?void 0:t.toUpperCase(),this.operatorId=e.operatorId,this.comparator=e.comparator,o.Sd.indexOf(e.operatorId)>=0&&(this.comparator=void 0),this.clause=e.clause||i.v.Where,this.sqlExpression=null):this.expressionType===i.A.Sql&&(this.sqlExpression="string"==typeof e.sqlExpression?e.sqlExpression:(0,a.e)(e,{useSimple:!0}),this.clause=e.clause,e.operator&&r.indexOf(e.operator)>=0?(this.subject=e.subject,this.operator=e.operator,this.operatorId=e.operatorId):(this.subject=null,this.operator=null),this.comparator=null),this.isExtra=!!e.isExtra,this.isNew=!!e.isNew,this.datasourceWarning=!!e.datasourceWarning,this.deck_slices=null==e?void 0:e.deck_slices,this.layerFilterScope=null==e?void 0:e.layerFilterScope,this.filterOptionName=e.filterOptionName||`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}duplicateWith(e){return new l({...this,isNew:!1,...e})}equals(e){return e.clause===this.clause&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.operatorId===this.operatorId&&e.comparator===this.comparator&&e.subject===this.subject}isValid(){if(this.expressionType===i.A.Simple){if(o.Sd.map(e=>o.nS[e].operation).indexOf(this.operator)>=0)return!!this.subject;if(this.operator&&this.subject&&this.clause)return Array.isArray(this.comparator)?this.comparator.length>0:null!==this.comparator}return this.expressionType===i.A.Sql&&!(!this.sqlExpression||!this.clause)}getDefaultLabel(){const e=this.translateToSql();return e.length<43?e:`${e.substring(0,40)}...`}getTooltipTitle(){return this.translateToSql()}translateToSql(){return(0,a.e)(this)}}},94921:(e,t,n)=>{n.d(t,{T:()=>l,c:()=>s});var o=n(79378),a=n(93820);const i=(e,t)=>{let n="api/v1/explore/form_data";return e&&(n=n.concat(`/${e}`)),t&&(n=n.concat(`?tab_id=${t}`)),n},r=(e,t,n,o)=>{const i={datasource_id:e,datasource_type:t,form_data:JSON.stringify((0,a.k)(n))};return o&&(i.chart_id=o),i},l=(e,t,n,a,l)=>o.A.post({endpoint:i(void 0,l),jsonPayload:r(e,t,n,a)}).then(e=>e.json.key),s=(e,t,n,a,l,s)=>o.A.put({endpoint:i(n,s),jsonPayload:r(e,t,a,l)}).then(e=>e.json.message)},95483:(e,t,n)=>{n.d(t,{n:()=>d});var o=n(2445),a=n(74098),i=n(97163),r=n(8558),l=n(88217),s=n(42566);const d=({showModal:e,onHide:t,handleSave:n,onConfirmNavigation:d,title:c="Unsaved Changes",body:u="If you don't save, changes will be lost."})=>(0,o.Y)(i.aF,{centered:!0,responsive:!0,onHide:t,show:e,width:"444px",title:(0,o.FD)(o.FK,{children:[(0,o.Y)(r.F.WarningOutlined,{iconSize:"m",style:{marginRight:8}}),c]}),footer:(0,o.FD)(o.FK,{children:[(0,o.Y)(l.$,{buttonStyle:"secondary",onClick:d,children:(0,a.t)("Discard")}),(0,o.Y)(l.$,{buttonStyle:"primary",onClick:n,children:(0,a.t)("Save")})]}),children:(0,o.Y)(s.o.Text,{children:u})})},97475:(e,t,n)=>{n.d(t,{t3:()=>M,oU:()=>z});var o=n(24002),a=n(61225),i=n(70532),r=n(7741),l=n(81465),s=n(17437),d=n(74098),c=n(99106),u=n(88217),h=n(29645),p=n(8558),m=n(41876),g=n(85600),v=n(64457),f=n(28674),b=n(67217),y=n(31296),x=n(77627),S=n(55169),_=n(25875),C=n(50816),w=n(63626),A=n(11908),D=n(42566),F=n(9876),T=n(85923),E=n(2445);const $=({formData:e,addDangerToast:t})=>{const[n,a]=(0,o.useState)("400"),[i,r]=(0,o.useState)("600"),[l,c]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),g=(0,o.useCallback)(e=>{const{value:t,name:n}=e.currentTarget;"width"===n&&r(t),"height"===n&&a(t)},[]),v=(0,o.useCallback)(()=>{c(""),(0,y.Kx)(e).then(e=>{c(e),m("")}).catch(()=>{m((0,d.t)("Error")),t((0,d.t)("Sorry, something went wrong. Try again later."))})},[t,e]);(0,o.useEffect)(()=>{v()},[]);const f=(0,o.useMemo)(()=>{if(!l)return"";const e=`${l}?${T.vX.standalone.name}=1&height=${n}`;return`<iframe\n  width="${i}"\n  height="${n}"\n  seamless\n  frameBorder="0"\n  scrolling="no"\n  src="${e}"\n>\n</iframe>`},[n,l,i]),b=u||f||(0,d.t)("Generating link, please wait..");return(0,E.FD)("div",{id:"embed-code-popover",children:[(0,E.FD)("div",{css:s.AH`
          display: flex;
          flex-direction: column;
        `,children:[(0,E.Y)(F.$r,{shouldShowText:!1,text:f,copyNode:(0,E.Y)("span",{role:"button","aria-label":"Copy to clipboard",children:(0,E.Y)(p.F.CopyOutlined,{})})}),(0,E.Y)(h.Input.TextArea,{name:"embedCode",disabled:!f,value:b,rows:"4",readOnly:!0,css:e=>s.AH`
            resize: vertical;
            margin-top: ${2*e.sizeUnit}px;
            padding: ${2*e.sizeUnit}px;
            font-size: ${e.fontSizeSM}px;
            border-radius: 4px;
            background-color: ${e.colorBgElevated};
          `})]}),(0,E.FD)(h.Space,{direction:"horizzontal",css:e=>s.AH`
          margin-top: ${e.margin}px;
        `,children:[(0,E.FD)("div",{children:[(0,E.Y)(D.o.Text,{type:"secondary",children:(0,d.t)("Chart height")}),(0,E.Y)(h.Input,{type:"number",defaultValue:n,name:"height",onChange:g})]}),(0,E.FD)("div",{children:[(0,E.Y)(D.o.Text,{type:"secondary",children:(0,d.t)("Chart width")}),(0,E.Y)(h.Input,{type:"number",defaultValue:i,name:"width",onChange:g,id:"embed-width"})]})]})]})};var Y=n(71519);const I="export_to_csv",k=[r.Y.PivotTable],M=l.I4.div`
  ${({theme:e})=>s.AH`
    display: flex;
    align-items: center;

    & svg {
      width: ${3*e.sizeUnit}px;
      height: ${3*e.sizeUnit}px;
    }

    & span[role='checkbox'] {
      display: inline-flex;
      margin-right: ${e.sizeUnit}px;
    }
  `}
`,z=((0,l.I4)(u.$)`
  ${({theme:e})=>s.AH`
    width: ${8*e.sizeUnit}px;
    height: ${8*e.sizeUnit}px;
    padding: 0;
    border: 1px solid ${e.colorPrimary};

    &.ant-btn > span.anticon {
      line-height: 0;
      transition: inherit;
    }

    &:hover:not(:focus) > span.anticon {
      color: ${e.colorPrimary};
    }
  `}
`,(e,t,n,r,u,D,F,T,M,...z)=>{const R=(0,l.DP)(),{addDangerToast:O,addSuccessToast:N}=(0,v.Yf)(),L=(0,a.wA)(),[U,q]=(0,o.useState)(!1),[H,j]=(0,o.useState)(""),P=(0,i.Q)(H,300),V=(0,a.d4)(e=>{var t;return null==(t=e.charts)?void 0:t[(0,f.kD)(e.explore)]}),B=(0,S.k)({chart:V,showReportModal:T,setCurrentReportDeleting:M}),{datasource:W}=e,G=(({chartId:e,dashboards:t=[],searchTerm:n=""})=>{const a=(0,l.DP)(),i=(0,o.useMemo)(()=>n?t.filter(e=>e.dashboard_title.toLowerCase().includes(n.toLowerCase())):t,[t,n]),r=e?`?focused_chart=${e}`:"",c=0===t.length,u=n&&0===i.length;return(0,o.useMemo)(()=>{const e=[];return c?e.push({key:"no-dashboards",label:(0,d.t)("None"),disabled:!0}):u?e.push({key:"no-results",label:(0,d.t)("No results found"),disabled:!0}):i.forEach(t=>{e.push({key:String(t.id),label:(0,E.FD)(Y.N_,{target:"_blank",rel:"noreferer noopener",to:`/superset/dashboard/${t.id}${r}`,css:s.AH`
                display: flex;
                flex-direction: row;
                align-items: center;
                width: 200px;
                justify-self: center;
              `,children:[(0,E.Y)("div",{css:s.AH`
                  white-space: normal;
                  flex: 1;
                `,children:t.dashboard_title}),(0,E.Y)(p.F.Full,{iconSize:"l",css:{marginLeft:2*a.sizeUnit}})]})})}),e},[i,r,c,u,a.sizeUnit])})({chartId:null==n?void 0:n.slice_id,dashboards:F,searchTerm:P}),Q=(null==F?void 0:F.length)>10,K=(0,o.useCallback)(async()=>{try{const t=(0,d.t)("Superset Chart"),n=await(0,y.Kx)(e),o=encodeURIComponent((0,d.t)("%s%s","Check out this chart: ",n));window.location.href=`mailto:?Subject=${t}%20&Body=${o}`}catch(e){O((0,d.t)("Sorry, something went wrong. Try again later."))}},[O,e]),X=(0,o.useCallback)(()=>t?(0,f.RY)({formData:e,ownState:D,resultType:"full",resultFormat:"csv"}):null,[t,e]),J=(0,o.useCallback)(()=>t?(0,f.RY)({formData:e,resultType:"post_processed",resultFormat:"csv"}):null,[t,e]),Z=(0,o.useCallback)(()=>t?(0,f.RY)({formData:e,resultType:"results",resultFormat:"json"}):null,[t,e]),ee=(0,o.useCallback)(()=>t?(0,f.RY)({formData:e,resultType:"results",resultFormat:"xlsx"}):null,[t,e]),te=(0,o.useCallback)(async()=>{try{if(!e)throw new Error;await(0,x.A)(()=>(0,y.Kx)(e)),N((0,d.t)("Copied to clipboard!"))}catch(e){O((0,d.t)("Sorry, something went wrong. Try again later."))}},[O,N,e]);return[(0,o.useMemo)(()=>{const o=[];n&&o.push({key:"edit_properties",label:(0,d.t)("Edit chart properties"),onClick:()=>{u(),q(!1)}});const a=[];Q&&a.push({key:"dashboard-search",label:(0,E.Y)(h.Input,{allowClear:!0,placeholder:(0,d.t)("Search"),prefix:(0,E.Y)(p.F.SearchOutlined,{iconSize:"l"}),css:s.AH`
              width: 220px;
              margin: ${2*R.sizeUnit}px ${3*R.sizeUnit}px;
            `,value:H,onChange:e=>j(e.currentTarget.value),onClick:e=>e.stopPropagation()}),disabled:!0}),G.forEach(e=>{a.push(e)}),o.push({key:"dashboards_added_to",type:"submenu",label:(0,d.t)("On dashboards"),children:a,popupStyle:{maxHeight:"300px",overflow:"auto"}}),o.push({type:"divider"});const i=[];k.includes(e.viz_type)?i.push({key:I,label:(0,d.t)("Export to original .CSV"),icon:(0,E.Y)(p.F.FileOutlined,{}),disabled:!t,onClick:()=>{X(),q(!1),L((0,_.logEvent)(C.xb,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}))}},{key:"export_to_csv_pivoted",label:(0,d.t)("Export to pivoted .CSV"),icon:(0,E.Y)(p.F.FileOutlined,{}),disabled:!t,onClick:()=>{J(),q(!1),L((0,_.logEvent)(C.vp,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}))}},{key:"export_to_pivot_xlsx",label:(0,d.t)("Export to Pivoted Excel"),icon:(0,E.Y)(p.F.FileOutlined,{}),disabled:!t,onClick:()=>{var e;const t=`#chart-id-${null==n?void 0:n.slice_id}`;(0,w.A)(`${t} .pvtTable`,null!=(e=null==n?void 0:n.slice_name)?e:(0,d.t)("pivoted_xlsx")),q(!1),L((0,_.logEvent)(C.k8,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}))}}):i.push({key:I,label:(0,d.t)("Export to .CSV"),icon:(0,E.Y)(p.F.FileOutlined,{}),disabled:!t,onClick:()=>{X(),q(!1),L((0,_.logEvent)(C.xb,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}))}}),i.push({key:"export_to_json",label:(0,d.t)("Export to .JSON"),icon:(0,E.Y)(p.F.FileOutlined,{}),disabled:!t,onClick:()=>{Z(),q(!1),L((0,_.logEvent)(C.v2,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}))}},{key:"download_as_image",label:(0,d.t)("Download as image"),icon:(0,E.Y)(p.F.FileImageOutlined,{}),onClick:e=>{var t;(0,b.A)(".panel-body .chart-container",null!=(t=null==n?void 0:n.slice_name)?t:(0,d.t)("New chart"),!0,R)(e.domEvent),q(!1),L((0,_.logEvent)(C.C7,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}))}},{key:"export_to_xlsx",label:(0,d.t)("Export to Excel"),icon:(0,E.Y)(p.F.FileOutlined,{}),disabled:!t,onClick:()=>{ee(),q(!1),L((0,_.logEvent)(C.k8,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}))}}),o.push({key:"download_submenu",type:"submenu",label:(0,d.t)("Download"),children:i});const l=[{key:"copy_permalink",label:(0,d.t)("Copy permalink to clipboard"),onClick:()=>{te(),q(!1)}},{key:"share_by_email",label:(0,d.t)("Share chart by email"),onClick:()=>{K(),q(!1)}}];return(0,c.G7)(c.TO.EmbeddableCharts)&&l.push({key:"embed_code",label:(0,E.Y)(m.g,{triggerNode:(0,E.Y)("div",{children:(0,d.t)("Embed code")}),modalTitle:(0,d.t)("Embed code"),modalBody:(0,E.Y)($,{formData:e,addDangerToast:O}),maxWidth:100*R.sizeUnit+"px",destroyOnHidden:!0,responsive:!0}),onClick:()=>q(!1)}),o.push({key:"share_submenu",type:"submenu",label:(0,d.t)("Share"),children:l}),o.push({type:"divider"}),B&&o.push(B),o.push({key:"view_query",label:(0,E.Y)(m.g,{triggerNode:(0,E.Y)("div",{children:(0,d.t)("View query")}),modalTitle:(0,d.t)("View query"),modalBody:(0,E.Y)(A.A,{latestQueryFormData:e}),draggable:!0,resizable:!0,responsive:!0}),onClick:()=>q(!1)}),W&&o.push({key:"run_in_sql_lab",label:(0,d.t)("Run in SQL Lab"),onClick:t=>{r(e,t.domEvent.metaKey),q(!1)}}),(0,E.Y)(g.W1,{selectable:!1,items:o,...z})},[O,t,te,F,G,H,P,W,L,X,J,ee,Z,e,r,u,B,K,Q,n,R.sizeUnit]),U,q]})},97566:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(5556),a=n.n(o),i=n(49239),r=n(25948),l=n(35382);const s=a().oneOfType([a().shape({expressionType:a().oneOf([l.t.SIMPLE]).isRequired,column:r.A.isRequired,aggregate:a().oneOf(Object.keys(i.dq)).isRequired,label:a().string.isRequired}),a().shape({expressionType:a().oneOf([l.t.SQL]).isRequired,sqlExpression:a().string.isRequired,label:a().string.isRequired})])},99609:(e,t,n)=>{n.d(t,{w:()=>r});var o=n(74098);const a=(0,o.t)("Create chart"),i=(0,o.t)("Update chart"),r=e=>(0,o.t)("Select values in highlighted field(s) in the control panel. Then run the query by clicking on the %s button.",`"${e?a:i}"`)}}]);