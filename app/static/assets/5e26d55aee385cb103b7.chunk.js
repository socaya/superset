"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5169],{35273:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(2445),l=a(81465),n=a(8558),s=a(95018),o=a(7437);const r=function({warningMarkdown:e,size:t,marginRight:a}){const r=(0,l.DP)();return(0,i.Y)(s.m,{id:"warning-tooltip",title:(0,i.Y)(o.z,{source:e}),children:(0,i.Y)(n.F.WarningOutlined,{iconColor:r.colorWarning,iconSize:t,css:{marginRight:null!=a?a:2*r.sizeUnit}})})}},48296:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Z});var i=a(2445),l=a(1763),n=a(81465),s=a(17437),o=a(74098),r=a(79378),d=a(24002),c=a(61574),u=a(71519),h=a(58561),p=a.n(h),m=a(71323),b=a(86784),y=a(54569),g=a(5250),f=a(8558),S=a(27509);const w=({datasetType:e})=>{const t=(0,n.DP)(),a="physical"===e?(0,o.t)("Physical"):(0,o.t)("Virtual"),l="physical"===e?(0,i.Y)(f.F.InsertRowAboveOutlined,{iconSize:"s",iconColor:t.colorPrimary}):(0,i.Y)(f.F.ConsoleSqlOutlined,{iconSize:"s"}),s="physical"===e?"primary":"default";return(0,i.Y)(S.JU,{icon:l,type:s,style:{color:"physical"===e?t.colorPrimaryText:t.colorPrimary},children:a})};var Y=a(95018),v=a(94551),D=a(19187),k=a(38961),F=a(56196),C=a(9876),x=a(42566),_=a(51304),T=a(20237),A=a(64457),z=a(35273),I=a(47305),P=a(31121),H=a(97163),N=a(23195),B=a(29645),O=a(51692);const E=({dataset:e,onHide:t,onDuplicate:a})=>{const[l,n]=(0,d.useState)(!1),[s,r]=(0,d.useState)(!1),[c,u]=(0,d.useState)(""),h=()=>{a(c)};return(0,d.useEffect)(()=>{u(""),n(null!==e)},[e]),(0,i.FD)(H.aF,{show:l,onHide:t,name:(0,o.t)("Duplicate dataset"),title:(0,i.Y)(O.r,{title:(0,o.t)("Duplicate dataset"),icon:(0,i.Y)(f.F.CopyOutlined,{})}),disablePrimaryButton:s,onHandledPrimaryAction:h,primaryButtonName:(0,o.t)("Duplicate"),children:[(0,i.Y)(N.l,{htmlFor:"duplicate",children:(0,o.t)("New dataset name")}),(0,i.Y)(B.Input,{type:"text",id:"duplicate",autoComplete:"off",value:c,onChange:e=>{var t;const a=null!=(t=e.target.value)?t:"";u(a),r(""===a)},onPressEnter:h})]})};var $=a(50880),R=a(75450);const M=n.I4.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
  max-height: 600px;
`,q=n.I4.div`
  overflow-y: auto;
  flex: 1;
  border: 1px solid ${({theme:e})=>e.colorBorder};
  border-radius: 4px;
`,L=n.I4.div`
  display: flex;
  gap: 24px;
  font-size: 12px;
  color: ${({theme:e})=>e.colorText};
  padding: 8px 0;
`,J=n.I4.div`
  font-size: 12px;
  color: ${({theme:e})=>e.colorTextSecondary};
  margin-bottom: 8px;
`,K=n.I4.div`
  padding: 12px;
  background-color: ${({theme:e})=>e.colorErrorBg};
  color: ${({theme:e})=>e.colorError};
  border-radius: 4px;
  font-size: 12px;
`,U=({dataset:e,onClose:t})=>{var a;const[l,n]=(0,d.useState)(!1),[s,r]=(0,d.useState)([]),[c,u]=(0,d.useState)([]),[h,p]=(0,d.useState)(null),[m,b]=(0,d.useState)(0),y=(0,d.useMemo)(()=>(null==e?void 0:e.sql)&&(e.sql.includes("/* DHIS2:")||e.sql.includes("-- DHIS2:")),[e]),g=(0,d.useCallback)(async()=>{if(e){n(!0),p(null);try{if(y&&e.database){const t=await R.Q.fetchChartData(Number(e.database.id),e.sql||"",1e3);t&&(r(t.rows),u(t.columns),b(t.total))}else{const t=await(0,$.getDatasourceSamples)((e.kind,"table"),e.id,!1,{},100,0);if(t){const e=t.colnames||[],a=t.data||[],i=e.map((e,t)=>({key:e,dataIndex:e,title:e,ellipsis:!0,render:e=>null==e?"-":String(e).substring(0,100)})),l=a.map((t,a)=>({...Object.fromEntries(e.map(e=>[e,t])),key:`row-${a}`}));u(i),r(l),b(t.rowcount||a.length)}}}catch(e){p(e.message||(0,o.t)("Failed to load dataset preview"))}finally{n(!1)}}},[e,y]);return(0,d.useEffect)(()=>{e&&e.id&&g()},[e,g]),e?(0,i.Y)(B.Modal,{title:(0,o.t)("Preview: %s",e.table_name),open:!0,onCancel:t,width:"90%",style:{maxWidth:"1400px"},footer:[(0,i.Y)(B.Button,{onClick:t,children:(0,o.t)("Close")},"close")],children:(0,i.Y)(M,{children:(0,i.FD)(B.Space,{direction:"vertical",style:{width:"100%"},children:[(0,i.Y)("div",{children:(0,i.FD)(J,{children:[(0,o.t)("Database"),": ",null==(a=e.database)?void 0:a.database_name," | ",(0,o.t)("Schema"),": ",e.schema," | ",(0,o.t)("Type"),": ",e.kind]})}),h&&(0,i.Y)(K,{children:h}),l?(0,i.Y)(B.Spin,{}):0===s.length?(0,i.Y)(B.Empty,{description:(0,o.t)("No data available")}):(0,i.FD)(i.FK,{children:[(0,i.FD)(L,{children:[(0,i.Y)("div",{children:(0,i.Y)(B.Tooltip,{title:(0,o.t)("Rows shown in preview"),children:(0,i.FD)("span",{children:[(0,o.t)("Showing"),": ",s.length," ",(0,o.t)("rows")]})})}),(0,i.Y)("div",{children:(0,i.Y)(B.Tooltip,{title:(0,o.t)("Total rows available"),children:(0,i.FD)("span",{children:[(0,o.t)("Total"),": ",m," ",(0,o.t)("rows")]})})}),(0,i.Y)("div",{children:(0,i.Y)(B.Tooltip,{title:(0,o.t)("Number of columns"),children:(0,i.FD)("span",{children:[(0,o.t)("Columns"),": ",c.length]})})})]}),(0,i.Y)(q,{children:(0,i.Y)(B.Table,{columns:c,dataSource:s,size:"small",pagination:!1,scroll:{x:"max-content",y:400},rowKey:"key"})})]})]})})}):null};var W=a(61225),j=a(79605),V=a(66124);const Q=(0,l.a)().get("dataset.delete.related"),X=n.I4.div`
  align-items: center;
  display: flex;
  gap: ${({theme:e})=>e.sizeUnit}px;

  svg {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,G=n.I4.div`
  ${({theme:e})=>s.AH`
    color: ${e.colorIcon};

    .disabled {
      svg,
      i {
        &:hover {
          path {
            fill: ${e.colorText};
          }
        }
      }
      color: ${e.colorTextDisabled};
      &:hover {
        cursor: not-allowed;
      }
      .ant-menu-item:hover {
        cursor: default;
      }
      &::after {
        color: ${e.colorTextDisabled};
      }
    }
  `}
`,Z=(0,A.Ay)(({addDangerToast:e,addSuccessToast:t,user:a})=>{const l=(0,c.W6)(),s=(0,n.DP)(),{state:{loading:h,resourceCount:S,resourceCollection:A,bulkSelectEnabled:H},hasPerm:N,fetchData:B,toggleBulkSelect:O,refreshData:$}=(0,b.RU)("dataset",(0,o.t)("dataset"),e),[R,M]=(0,d.useState)(null),[q,L]=(0,d.useState)(null),[J,K]=(0,d.useState)(null),[Z,ee]=(0,d.useState)(null),[te,ae]=(0,d.useState)(!1),[ie,le]=(0,d.useState)([]),[ne,se]=(0,d.useState)(!1),[oe,re]=(0,d.useState)([]),[de,ce]=(0,d.useState)([]),[ue,he]=(0,d.useState)([]),pe=(0,W.d4)(e=>{var t;return(null==(t=e.common)||null==(t=t.conf)?void 0:t.PREVENT_UNSAFE_DEFAULT_URLS_ON_DATASET)||!1}),me=N("can_write"),be=N("can_write"),ye=N("can_write"),ge=N("can_duplicate"),fe=N("can_export"),Se=P.Hu,we=(0,d.useCallback)(({id:t})=>{r.A.get({endpoint:`/api/v1/dataset/${t}`}).then(({json:e={}})=>{const t=e.result.columns.map(e=>{const{certification:{details:t="",certified_by:a=""}={}}=JSON.parse(e.extra||"{}")||{};return{...e,certification_details:t||"",certified_by:a||"",is_certified:t||a}});e.result.columns=[...t],L(e.result)}).catch(()=>{e((0,o.t)("An error occurred while fetching dataset related data"))})},[e]),Ye=async t=>{const a=t.map(({id:e})=>e);se(!0);try{await(0,_.A)("dataset",a,()=>{se(!1)})}catch(t){se(!1),e((0,o.t)("There was an issue exporting the selected datasets"))}},ve=(0,d.useMemo)(()=>[{Cell:({row:{original:{kind:e}}})=>null,accessor:"kind_icon",disableSortBy:!0,size:"xs",id:"id"},{Cell:({row:{original:{extra:e,table_name:t,description:a,explore_url:l}}})=>{let n;n=pe?(0,i.Y)(u.N_,{to:l,children:t}):(0,i.Y)(C.Kt,{to:l,children:t});try{const t=JSON.parse(e);return(0,i.FD)(X,{children:[(null==t?void 0:t.certification)&&(0,i.Y)(y.T,{certifiedBy:t.certification.certified_by,details:t.certification.details,size:"l"}),(null==t?void 0:t.warning_markdown)&&(0,i.Y)(z.A,{warningMarkdown:t.warning_markdown,size:"l"}),n,a&&(0,i.Y)(g.I,{tooltip:a})]})}catch{return n}},Header:(0,o.t)("Name"),accessor:"table_name",id:"table_name"},{Cell:({row:{original:{kind:e}}})=>(0,i.Y)(w,{datasetType:e}),Header:(0,o.t)("Type"),accessor:"kind",disableSortBy:!0,size:"sm",id:"kind"},{Header:(0,o.t)("Database"),accessor:"database.database_name",size:"xl",id:"database.database_name"},{Header:(0,o.t)("Schema"),accessor:"schema",size:"lg",id:"schema"},{accessor:"database",disableSortBy:!0,hidden:!0,id:"database"},{Cell:({row:{original:{owners:e=[]}}})=>(0,i.Y)(C.WM,{users:e}),Header:(0,o.t)("Owners"),id:"owners",disableSortBy:!0,size:"lg"},{Cell:({row:{original:{changed_on_delta_humanized:e,changed_by:t}}})=>(0,i.Y)(C.UW,{date:e,user:t}),Header:(0,o.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",id:"changed_on_delta_humanized"},{accessor:"sql",hidden:!0,disableSortBy:!0,id:"sql"},{Cell:({row:{original:l}})=>{const n=l.owners.map(e=>e.id).includes(a.userId)||(0,I.N6)(a);return me||be||fe||ge?(0,i.FD)(G,{className:"actions",children:[be&&(0,i.Y)(Y.m,{id:"delete-action-tooltip",title:(0,o.t)("Delete"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return e=l,r.A.get({endpoint:`/api/v1/dataset/${e.id}/related_objects`}).then(({json:t={}})=>{M({...e,charts:t.charts,dashboards:t.dashboards})}).catch((0,m.JF)(e=>(0,o.t)("An error occurred while fetching dataset related data: %s",e)));var e},children:(0,i.Y)(f.F.DeleteOutlined,{iconSize:"l"})})}),fe&&(0,i.Y)(Y.m,{id:"export-action-tooltip",title:(0,o.t)("Export"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>Ye([l]),children:(0,i.Y)(f.F.UploadOutlined,{iconSize:"l"})})}),(0,i.Y)(Y.m,{id:"preview-action-tooltip",title:(0,o.t)("Preview Data"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{ee(l)},children:(0,i.Y)(f.F.EyeOutlined,{iconSize:"l"})})}),(0,i.Y)(Y.m,{id:"refresh-action-tooltip",title:(0,o.t)("Refresh Data"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:async()=>{try{await r.A.put({endpoint:`/api/v1/dataset/${l.id}/refresh`}),t((0,o.t)("Dataset refreshed successfully")),$()}catch(t){e((0,o.t)("Failed to refresh dataset"))}},children:(0,i.Y)(f.F.ReloadOutlined,{iconSize:"l"})})}),me&&(0,i.Y)(Y.m,{id:"edit-action-tooltip",title:n?(0,o.t)("Edit"):(0,o.t)("You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access."),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button "+(n?"":"disabled"),onClick:n?()=>we(l):void 0,children:(0,i.Y)(f.F.EditOutlined,{iconSize:"l"})})}),ge&&"virtual"===l.kind&&(0,i.Y)(Y.m,{id:"duplicate-action-tooltip",title:(0,o.t)("Duplicate"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{K(l)},children:(0,i.Y)(f.F.CopyOutlined,{iconSize:"l"})})})]}):null},Header:(0,o.t)("Actions"),id:"actions",hidden:!me&&!be&&!ge,disableSortBy:!0},{accessor:j.H.ChangedBy,hidden:!0,id:j.H.ChangedBy}],[me,be,fe,we,ge,a]),De=(0,d.useMemo)(()=>[{Header:(0,o.t)("Name"),key:"search",id:"table_name",input:"search",operator:C.c0.Contains},{Header:(0,o.t)("Type"),key:"sql",id:"sql",input:"select",operator:C.c0.DatasetIsNullOrEmpty,unfilteredLabel:"All",selects:[{label:(0,o.t)("Virtual"),value:!1},{label:(0,o.t)("Physical"),value:!0}]},{Header:(0,o.t)("Database"),key:"database",id:"database",input:"select",operator:C.c0.RelationOneMany,unfilteredLabel:"All",fetchSelects:(0,m.u1)("dataset","database",(0,m.JF)(e=>(0,o.t)("An error occurred while fetching datasets: %s",e))),paginate:!0,dropdownStyle:{minWidth:V.f8}},{Header:(0,o.t)("Schema"),key:"schema",id:"schema",input:"select",operator:C.c0.Equals,unfilteredLabel:"All",fetchSelects:(0,m.$C)("dataset","schema",(0,m.JF)(e=>(0,o.t)("An error occurred while fetching schema values: %s",e))),paginate:!0,dropdownStyle:{minWidth:V.f8}},{Header:(0,o.t)("Owner"),key:"owner",id:"owners",input:"select",operator:C.c0.RelationManyMany,unfilteredLabel:"All",fetchSelects:(0,m.u1)("dataset","owners",(0,m.JF)(e=>(0,o.t)("An error occurred while fetching dataset owner values: %s",e)),a),paginate:!0,dropdownStyle:{minWidth:V.f8}},{Header:(0,o.t)("Certified"),key:"certified",id:"id",urlDisplay:"certified",input:"select",operator:C.c0.DatasetIsCertified,unfilteredLabel:(0,o.t)("Any"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,o.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:C.c0.RelationOneMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,m.u1)("dataset","changed_by",(0,m.JF)(e=>(0,o.t)("An error occurred while fetching dataset datasource values: %s",e)),a),paginate:!0,dropdownStyle:{minWidth:V.f8}}],[a]),ke={activeChild:"Datasets",name:(0,o.t)("Datasets")},Fe=[];return ye&&Fe.push({name:(0,i.Y)(Y.m,{id:"import-tooltip",title:(0,o.t)("Import datasets"),placement:"bottomRight",children:(0,i.Y)(f.F.DownloadOutlined,{iconColor:s.colorPrimary,iconSize:"l"})}),buttonStyle:"link",onClick:()=>{ae(!0)}}),(be||fe)&&Fe.push({name:(0,o.t)("Bulk select"),onClick:O,buttonStyle:"secondary"}),ye&&Fe.push({icon:(0,i.Y)(f.F.PlusOutlined,{iconSize:"m"}),name:(0,o.t)("Dataset"),onClick:()=>{l.push("/dataset/add/")},buttonStyle:"primary"}),ke.buttons=Fe,(0,i.FD)(i.FK,{children:[(0,i.Y)(T.A,{...ke}),R&&(0,i.Y)(v.T,{description:(0,i.FD)(i.FK,{children:[(0,i.FD)("p",{children:[(0,o.t)("The dataset"),(0,i.FD)("b",{children:[" ",R.table_name," "]}),(0,o.t)("is linked to %s charts that appear on %s dashboards. Are you sure you want to continue? Deleting the dataset will break those objects.",R.charts.count,R.dashboards.count)]}),R.dashboards.count>=1&&(0,i.FD)(i.FK,{children:[(0,i.Y)("h4",{children:(0,o.t)("Affected Dashboards")}),(0,i.Y)(D.B,{split:!1,size:"small",dataSource:R.dashboards.result.slice(0,10),renderItem:e=>(0,i.Y)(D.B.Item,{compact:!0,children:(0,i.Y)(D.B.Item.Meta,{avatar:(0,i.Y)("span",{children:"•"}),title:(0,i.Y)(x.o.Link,{href:`/superset/dashboard/${e.id}`,target:"_atRiskItem",children:e.title})})},e.id),footer:R.dashboards.result.length>10&&(0,i.Y)("div",{children:(0,o.t)("... and %s others",R.dashboards.result.length-10)})})]}),R.charts.count>=1&&(0,i.FD)(i.FK,{children:[(0,i.Y)("h4",{children:(0,o.t)("Affected Charts")}),(0,i.Y)(D.B,{split:!1,size:"small",dataSource:R.charts.result.slice(0,10),renderItem:e=>(0,i.Y)(D.B.Item,{compact:!0,children:(0,i.Y)(D.B.Item.Meta,{avatar:(0,i.Y)("span",{children:"•"}),title:(0,i.Y)(x.o.Link,{href:`/explore/?slice_id=${e.id}`,target:"_atRiskItem",children:e.slice_name})})},e.id),footer:R.charts.result.length>10&&(0,i.Y)("div",{children:(0,o.t)("... and %s others",R.charts.result.length-10)})})]}),Q&&(0,i.Y)(Q,{dataset:R})]}),onConfirm:()=>{R&&(({id:a,table_name:i})=>{r.A.delete({endpoint:`/api/v1/dataset/${a}`}).then(()=>{$(),M(null),t((0,o.t)("Deleted: %s",i))},(0,m.JF)(t=>e((0,o.t)("There was an issue deleting %s: %s",i,t))))})(R)},onHide:()=>{M(null)},open:!0,title:(0,o.t)("Delete Dataset?")}),q&&(0,i.Y)(C.XR,{datasource:q,onDatasourceSave:$,onHide:()=>{L(null)},show:!0}),(0,i.Y)(E,{dataset:J,onHide:()=>{K(null)},onDuplicate:t=>{null===J&&e((0,o.t)("There was an issue duplicating the dataset.")),r.A.post({endpoint:"/api/v1/dataset/duplicate",jsonPayload:{base_model_id:null==J?void 0:J.id,table_name:t}}).then(()=>{K(null),$()},(0,m.JF)(t=>e((0,o.t)("There was an issue duplicating the selected datasets: %s",t))))}}),(0,i.Y)(U,{dataset:Z,onClose:()=>{ee(null)}}),(0,i.Y)(k.h,{title:(0,o.t)("Please confirm"),description:(0,o.t)("Are you sure you want to delete the selected datasets?"),onConfirm:a=>{r.A.delete({endpoint:`/api/v1/dataset/?q=${p().encode(a.map(({id:e})=>e))}`}).then(({json:e={}})=>{$(),t(e.message)},(0,m.JF)(t=>e((0,o.t)("There was an issue deleting the selected datasets: %s",t))))},children:a=>{const l=[];return be&&l.push({key:"delete",name:(0,o.t)("Delete"),onSelect:a,type:"danger"}),fe&&l.push({key:"export",name:(0,o.t)("Export"),type:"primary",onSelect:Ye}),(0,i.Y)(C.uO,{className:"dataset-list-view",columns:ve,data:A,count:S,pageSize:P.md,fetchData:B,filters:De,loading:h,initialSort:Se,bulkActions:l,bulkSelectEnabled:H,disableBulkSelect:O,addDangerToast:e,addSuccessToast:t,refreshData:$,renderBulkSelectCopy:e=>{const{virtualCount:t,physicalCount:a}=e.reduce((e,t)=>("physical"===t.original.kind?e.physicalCount+=1:"virtual"===t.original.kind&&(e.virtualCount+=1),e),{virtualCount:0,physicalCount:0});return e.length?t&&!a?(0,o.t)("%s Selected (Virtual)",e.length,t):a&&!t?(0,o.t)("%s Selected (Physical)",e.length,a):(0,o.t)("%s Selected (%s Physical, %s Virtual)",e.length,a,t):(0,o.t)("0 Selected")}})}}),(0,i.Y)(C.zb,{resourceName:"dataset",resourceLabel:(0,o.t)("dataset"),passwordsNeededMessage:P.ry,confirmOverwriteMessage:P.R6,addDangerToast:e,addSuccessToast:t,onModelImport:()=>{ae(!1),$(),t((0,o.t)("Dataset imported"))},show:te,onHide:()=>{ae(!1)},passwordFields:ie,setPasswordFields:le,sshTunnelPasswordFields:oe,setSSHTunnelPasswordFields:re,sshTunnelPrivateKeyFields:de,setSSHTunnelPrivateKeyFields:ce,sshTunnelPrivateKeyPasswordFields:ue,setSSHTunnelPrivateKeyPasswordFields:he}),ne&&(0,i.Y)(F.R,{})]})})}}]);