"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3741],{13410:(e,t,n)=>{n.d(t,{E:()=>r});var i=n(2445),a=n(81465),l=n(29645);const r=(0,a.I4)(e=>(0,i.Y)(l.Badge,{...e}))`
  ${({theme:e,color:t,count:n})=>`\n    & > sup,\n    & > sup.ant-badge-count {\n      box-shadow: none;\n      ${void 0!==n?`background: ${t||e.colorPrimary};`:""}\n    }\n  `}
`},24006:(e,t,n)=>{n.d(t,{A:()=>k,e:()=>C});var i=n(2445),a=n(24002),l=n(74098),r=n(79378),o=n(81465),s=n(21325),d=n(25936),c=n(56196),p=n(42566),h=n(29645);const{Search:u}=h.Input,{Text:m}=p.o,g=["events","enrollments","trackedEntityInstances"],y=o.I4.div`
  ${({theme:e})=>`\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    background: ${e.colorBgContainer};\n  `}
`,v=o.I4.div`
  ${({theme:e})=>`\n    padding: ${2*e.sizeUnit}px;\n    min-height: 350px;\n  `}
`,b=o.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    gap: ${2*e.sizeUnit}px;\n    margin-bottom: ${2*e.sizeUnit}px;\n    flex-wrap: wrap;\n    align-items: center;\n  `}
`,f=o.I4.div`
  ${({theme:e})=>`\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    max-height: 280px;\n    overflow-y: auto;\n    background: ${e.colorBgContainer};\n  `}
`,S=o.I4.div`
  ${({theme:e,selected:t})=>`\n    padding: ${e.sizeUnit}px ${2*e.sizeUnit}px;\n    display: flex;\n    align-items: center;\n    gap: ${e.sizeUnit}px;\n    cursor: pointer;\n    border-bottom: 1px solid ${e.colorBorderSecondary};\n    background: ${t?e.colorPrimaryBg:"transparent"};\n    \n    &:hover {\n      background: ${e.colorBgTextHover};\n    }\n    \n    &:last-child {\n      border-bottom: none;\n    }\n  `}
`,Y=o.I4.div`
  ${({theme:e})=>`\n    padding: ${2*e.sizeUnit}px;\n    border-top: 1px solid ${e.colorBorder};\n    background: ${e.colorBgLayout};\n    max-height: 150px;\n    overflow-y: auto;\n  `}
`,x=o.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: ${e.sizeUnit}px;\n  `}
`,$=o.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-wrap: wrap;\n    gap: ${e.sizeUnit}px;\n  `}
`,I=o.I4.div`
  ${({theme:e})=>`\n    padding: ${4*e.sizeUnit}px;\n    text-align: center;\n  `}
`,L=o.I4.div`
  ${({theme:e})=>`\n    padding: ${4*e.sizeUnit}px;\n    text-align: center;\n  `}
`,A=o.I4.div`
  flex: 1;
  min-width: 0;
`,N=o.I4.div`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,T=o.I4.div`
  ${({theme:e})=>`\n    font-size: 11px;\n    color: ${e.colorTextSecondary};\n  `}
`,C=({databaseId:e,endpoint:t,value:n=[],onChange:o,onDimensionsLoad:p})=>{const C=g.includes(t),[k,w]=(0,a.useState)(C?"programs":"dataElements"),[R,D]=(0,a.useState)(!1),[_,E]=(0,a.useState)([]),[F,U]=(0,a.useState)([]),[z,B]=(0,a.useState)([]),[O,M]=(0,a.useState)([]),[H,P]=(0,a.useState)([]),[W,j]=(0,a.useState)([]),[G,J]=(0,a.useState)([]),[K,Q]=(0,a.useState)([]),[q,V]=(0,a.useState)(void 0),[X,Z]=(0,a.useState)(void 0),[ee,te]=(0,a.useState)(""),[ne,ie]=(0,a.useState)(null),ae=(0,a.useMemo)(()=>[..._,...F,...z,...O,...H,...W],[_,F,z,O,H,W]);(0,a.useEffect)(()=>{p&&ae.length>0&&queueMicrotask(()=>{p(ae)})},[ae,p]),(0,a.useEffect)(()=>{(async()=>{if(e){try{var t;const n=await r.A.get({endpoint:`/api/v1/database/${e}/dhis2_metadata/?type=dataElementGroups`});null!=(t=n.json)&&t.result&&J(n.json.result)}catch(e){}try{var n;const t=await r.A.get({endpoint:`/api/v1/database/${e}/dhis2_metadata/?type=indicatorGroups`});null!=(n=t.json)&&n.result&&Q(t.json.result)}catch(e){}}})()},[e]);const le=(0,a.useCallback)(async(n,i)=>{if(e){D(!0);try{var a;let l=`/api/v1/database/${e}/dhis2_metadata/?type=dataElements&table=${t}`;i&&(l+=`&group=${i}`),n&&n.length>=2&&(l+=`&search=${encodeURIComponent(n)}`);const o=await r.A.get({endpoint:l});null!=(a=o.json)&&a.result&&E(o.json.result.map(e=>({...e,type:"dataElement"})))}catch(e){E([])}finally{D(!1)}}},[e,t]),re=(0,a.useCallback)(async(t,n)=>{if(e){D(!0);try{var i;let a=`/api/v1/database/${e}/dhis2_metadata/?type=indicators`;n&&(a+=`&group=${n}`),t&&t.length>=2&&(a+=`&search=${encodeURIComponent(t)}`);const l=await r.A.get({endpoint:a});null!=(i=l.json)&&i.result&&U(l.json.result.map(e=>({...e,type:"indicator"})))}catch(e){U([])}finally{D(!1)}}},[e]),oe=(0,a.useCallback)(async t=>{if(e){D(!0);try{var n;let i=`/api/v1/database/${e}/dhis2_metadata/?type=programIndicators`;t&&t.length>=2&&(i+=`&search=${encodeURIComponent(t)}`);const a=await r.A.get({endpoint:i});null!=(n=a.json)&&n.result&&B(a.json.result.map(e=>({...e,type:"programIndicator"})))}catch(e){B([])}finally{D(!1)}}},[e]),se=(0,a.useCallback)(async t=>{if(e){D(!0);try{var n;let i=`/api/v1/database/${e}/dhis2_metadata/?type=dataSets`;t&&t.length>=2&&(i+=`&search=${encodeURIComponent(t)}`);const a=await r.A.get({endpoint:i});null!=(n=a.json)&&n.result&&M(a.json.result.map(e=>({...e,type:"dataSet"})))}catch(e){M([])}finally{D(!1)}}},[e]),de=(0,a.useCallback)(async t=>{if(e){D(!0);try{var n;let i=`/api/v1/database/${e}/dhis2_metadata/?type=programs`;t&&t.length>=2&&(i+=`&search=${encodeURIComponent(t)}`);const a=await r.A.get({endpoint:i});null!=(n=a.json)&&n.result&&P(a.json.result.map(e=>({...e,type:"program"})))}catch(e){P([])}finally{D(!1)}}},[e]),ce=(0,a.useCallback)(async t=>{if(e){D(!0);try{var n;let i=`/api/v1/database/${e}/dhis2_metadata/?type=trackedEntityTypes`;t&&t.length>=2&&(i+=`&search=${encodeURIComponent(t)}`);const a=await r.A.get({endpoint:i});null!=(n=a.json)&&n.result&&j(a.json.result.map(e=>({...e,type:"trackedEntityType"})))}catch(e){j([])}finally{D(!1)}}},[e]);(0,a.useEffect)(()=>{C&&"programs"===k?de(ee):C&&"trackedEntityTypes"===k?ce(ee):C||"dataElements"!==k?C||"indicators"!==k?C||"programIndicators"!==k?C||"dataSets"!==k||se(ee):oe(ee):re(ee,X):le(ee,q)},[k,q,X,C]);const pe=(0,a.useCallback)(e=>{if(te(e),ne&&clearTimeout(ne),e.length>=2||0===e.length){const t=setTimeout(()=>{C?"programs"===k?de(e):"trackedEntityTypes"===k&&ce(e):"dataElements"===k?le(e,q):"indicators"===k?re(e,X):"programIndicators"===k?oe(e):"dataSets"===k&&se(e)},300);ie(t)}},[k,C,q,X,le,re,oe,se,de,ce,ne]),he=e=>{const t=ae.find(t=>t.id===e);return(null==t?void 0:t.displayName)||e},ue=e=>{switch(e){case"dataElement":return"ðŸ“ˆ";case"indicator":return"ðŸ“Š";case"programIndicator":return"ðŸ“‹";case"dataSet":return"ðŸ“";case"program":return"ðŸ¥";case"trackedEntityType":return"ðŸ‘¤";default:return"ðŸ“Œ"}},me=e=>n.filter(t=>e.some(e=>e.id===t)).length,ge=e=>R?(0,i.FD)(L,{children:[(0,i.Y)(c.R,{}),(0,i.Y)("div",{style:{marginTop:8},children:(0,l.t)("Loading...")})]}):0===e.length?(0,i.Y)(I,{children:(0,i.Y)(d.S,{description:ee?(0,l.t)('No results found for "%s"',ee):(0,l.t)("Type at least 2 characters to search")})}):(0,i.Y)(f,{children:e.map(e=>(0,i.FD)(S,{selected:n.includes(e.id),onClick:()=>{return t=e.id,void(n.includes(t)?o(n.filter(e=>e!==t)):o([...n,t]));var t},children:[(0,i.Y)(h.Checkbox,{checked:n.includes(e.id)}),(0,i.Y)("span",{children:ue(e.type)}),(0,i.FD)(A,{children:[(0,i.Y)(N,{title:e.displayName,children:e.displayName}),e.category&&(0,i.Y)(T,{children:e.category})]})]},e.id))}),ye=[{key:"dataElements",label:(0,i.Y)(h.Badge,{count:me(_),size:"small",offset:[8,0],children:(0,i.Y)("span",{style:{paddingRight:12},children:(0,l.t)("Data Elements")})}),children:(0,i.FD)(v,{children:[(0,i.FD)(b,{children:[G.length>0&&(0,i.Y)(h.Select,{style:{width:250},placeholder:(0,l.t)("Filter by Data Element Group"),allowClear:!0,showSearch:!0,optionFilterProp:"label",value:q,onChange:e=>{V(e),le(ee,e)},options:G.map(e=>({value:e.id,label:e.displayName}))}),(0,i.Y)(u,{placeholder:(0,l.t)("Search data elements (min 2 chars)..."),style:{width:300},allowClear:!0,value:ee,onChange:e=>pe(e.target.value)})]}),(0,i.Y)(m,{type:"secondary",style:{display:"block",marginBottom:8},children:"analytics"===t?(0,l.t)("Showing numeric data elements compatible with analytics"):(0,l.t)("Showing all data elements")}),ge(_)]})},{key:"indicators",label:(0,i.Y)(h.Badge,{count:me(F),size:"small",offset:[8,0],children:(0,i.Y)("span",{style:{paddingRight:12},children:(0,l.t)("Indicators")})}),children:(0,i.FD)(v,{children:[(0,i.FD)(b,{children:[K.length>0&&(0,i.Y)(h.Select,{style:{width:250},placeholder:(0,l.t)("Filter by Indicator Group"),allowClear:!0,showSearch:!0,optionFilterProp:"label",value:X,onChange:e=>{Z(e),re(ee,e)},options:K.map(e=>({value:e.id,label:e.displayName}))}),(0,i.Y)(u,{placeholder:(0,l.t)("Search indicators (min 2 chars)..."),style:{width:300},allowClear:!0,value:ee,onChange:e=>pe(e.target.value)})]}),(0,i.Y)(m,{type:"secondary",style:{display:"block",marginBottom:8},children:(0,l.t)("Calculated indicators based on data element formulas")}),ge(F)]})},{key:"programIndicators",label:(0,i.Y)(h.Badge,{count:me(z),size:"small",offset:[8,0],children:(0,i.Y)("span",{style:{paddingRight:12},children:(0,l.t)("Program Indicators")})}),children:(0,i.FD)(v,{children:[(0,i.Y)(b,{children:(0,i.Y)(u,{placeholder:(0,l.t)("Search program indicators (min 2 chars)..."),style:{width:300},allowClear:!0,value:ee,onChange:e=>pe(e.target.value)})}),(0,i.Y)(m,{type:"secondary",style:{display:"block",marginBottom:8},children:(0,l.t)("Indicators calculated from tracker program data")}),ge(z)]})},{key:"dataSets",label:(0,i.Y)(h.Badge,{count:me(O),size:"small",offset:[8,0],children:(0,i.Y)("span",{style:{paddingRight:12},children:(0,l.t)("Reporting Rates")})}),children:(0,i.FD)(v,{children:[(0,i.Y)(b,{children:(0,i.Y)(u,{placeholder:(0,l.t)("Search data sets (min 2 chars)..."),style:{width:300},allowClear:!0,value:ee,onChange:e=>pe(e.target.value)})}),(0,i.Y)(m,{type:"secondary",style:{display:"block",marginBottom:8},children:(0,l.t)("Data set reporting rates and completeness")}),ge(O)]})}],ve=[{key:"programs",label:(0,i.Y)(h.Badge,{count:me(H),size:"small",offset:[8,0],children:(0,i.Y)("span",{style:{paddingRight:12},children:(0,l.t)("Programs")})}),children:(0,i.FD)(v,{children:[(0,i.Y)(b,{children:(0,i.Y)(u,{placeholder:(0,l.t)("Search programs (min 2 chars)..."),style:{width:300},allowClear:!0,value:ee,onChange:e=>pe(e.target.value)})}),(0,i.Y)(m,{type:"secondary",style:{display:"block",marginBottom:8},children:"events"===t?(0,l.t)("Select a program to fetch events from"):"enrollments"===t?(0,l.t)("Select a program to fetch enrollments from"):(0,l.t)("Select a program to fetch tracked entities from")}),ge(H)]})},{key:"trackedEntityTypes",label:(0,i.Y)(h.Badge,{count:me(W),size:"small",offset:[8,0],children:(0,i.Y)("span",{style:{paddingRight:12},children:(0,l.t)("Tracked Entity Types")})}),children:(0,i.FD)(v,{children:[(0,i.Y)(b,{children:(0,i.Y)(u,{placeholder:(0,l.t)("Search tracked entity types (min 2 chars)..."),style:{width:300},allowClear:!0,value:ee,onChange:e=>pe(e.target.value)})}),(0,i.Y)(m,{type:"secondary",style:{display:"block",marginBottom:8},children:(0,l.t)("Entity types like Person, Commodity, etc.")}),ge(W)]})}],be=C?ve:ye;return(0,i.FD)(y,{children:[(0,i.Y)(s.Ay,{activeKey:k,onChange:e=>{w(e),te("")},items:be}),n.length>0&&(0,i.FD)(Y,{children:[(0,i.FD)(x,{children:[(0,i.FD)(m,{strong:!0,children:[(0,l.t)("Selected")," (",n.length,")"]}),(0,i.Y)(h.Tag,{style:{cursor:"pointer"},onClick:()=>{o([])},color:"error",children:(0,l.t)("Clear All")})]}),(0,i.Y)($,{children:n.map(e=>{const t=ae.find(t=>t.id===e);return(0,i.FD)(h.Tag,{closable:!0,onClose:()=>(e=>{o(n.filter(t=>t!==e))})(e),children:[t?ue(t.type):"ðŸ“Œ"," ",he(e)]},e)})})]})]})},k=C},34622:(e,t,n)=>{n.d(t,{A:()=>U,y:()=>F});var i=n(2445),a=n(24002),l=n(74098),r=n(79378),o=n(81465),s=n(21325),d=n(56196),c=n(42566),p=n(29645);const{Search:h}=p.Input,{Text:u}=c.o,m=o.I4.div`
  ${({theme:e})=>`\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    background: ${e.colorBgContainer};\n  `}
`,g=o.I4.div`
  ${({theme:e})=>`\n    padding: ${2*e.sizeUnit}px;\n    min-height: 400px;\n  `}
`,y=o.I4.div`
  ${({theme:e})=>`\n    margin-bottom: ${2*e.sizeUnit}px;\n    padding: ${2*e.sizeUnit}px;\n    background: ${e.colorBgLayout};\n    border-radius: ${e.borderRadius}px;\n    border: 1px solid ${e.colorBorder};\n  `}
`,v=o.I4.div`
  font-weight: 600;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
`,b=o.I4.div`
  ${({theme:e})=>`\n    font-size: 12px;\n    color: ${e.colorTextSecondary};\n    margin-bottom: 12px;\n  `}
`,f=o.I4.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
`,S=o.I4.div`
  ${({theme:e,selected:t})=>`\n    padding: 16px;\n    border: 2px solid ${t?e.colorPrimary:e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    background: ${t?e.colorPrimaryBg:e.colorBgContainer};\n    cursor: pointer;\n    transition: all 0.2s;\n    position: relative;\n    \n    &:hover {\n      border-color: ${e.colorPrimary};\n      box-shadow: ${e.boxShadowSecondary};\n    }\n  `}
`,Y=o.I4.div`
  font-weight: 600;
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
`,x=o.I4.div`
  ${({theme:e})=>`\n    font-size: 12px;\n    color: ${e.colorTextSecondary};\n    margin-bottom: 8px;\n    line-height: 1.5;\n  `}
`,$=o.I4.div`
  ${({theme:e})=>`\n    font-size: 11px;\n    padding: 6px 8px;\n    background: ${e.colorBgLayout};\n    border-radius: 4px;\n    color: ${e.colorTextTertiary};\n    border-left: 3px solid ${e.colorPrimary};\n  `}
`,I=o.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    gap: ${2*e.sizeUnit}px;\n    margin-bottom: ${2*e.sizeUnit}px;\n    flex-wrap: wrap;\n    align-items: center;\n  `}
`,L=o.I4.div`
  ${({theme:e})=>`\n    padding: ${2*e.sizeUnit}px;\n    border-top: 1px solid ${e.colorBorder};\n    background: ${e.colorBgLayout};\n  `}
`,A=o.I4.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
`,N=o.I4.div`
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 12px;
`,T=o.I4.div`
  padding: 32px;
  text-align: center;
`,C=o.I4.div`
  ${({theme:e,type:t})=>{let n=e.colorBgLayout,i=e.colorBorder,a=e.colorText;return"relative"===t?(n=e.colorInfoBg,i=e.colorInfo,a=e.colorInfoText):"specific"===t?(n=e.colorSuccessBg,i=e.colorSuccess,a=e.colorSuccessText):"level"===t&&(n=e.colorWarningBg,i=e.colorWarning,a=e.colorWarningText),`\n      padding: 12px 16px;\n      border-left: 4px solid ${i};\n      background-color: ${n};\n      border-radius: ${e.borderRadius}px;\n      margin-bottom: 16px;\n      color: ${a};\n      font-size: 13px;\n      font-weight: 500;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    `}}
`,k=o.I4.div`
  ${({theme:e})=>`\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    max-height: 200px;\n    overflow-y: auto;\n    background: ${e.colorBgContainer};\n  `}
`,w=o.I4.div`
  ${({theme:e,selected:t})=>`\n    padding: 8px 12px;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n    border-bottom: 1px solid ${e.colorBorderSecondary};\n    background: ${t?e.colorPrimaryBg:"transparent"};\n    \n    &:hover {\n      background: ${e.colorBgTextHover};\n    }\n    \n    &:last-child {\n      border-bottom: none;\n    }\n  `}
`,R=o.I4.div`
  ${({theme:e,selected:t})=>`\n    padding: 8px 12px;\n    border: 1px solid ${t?e.colorPrimary:e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    background: ${t?e.colorPrimaryBg:e.colorBgContainer};\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 8px;\n    \n    &:hover {\n      border-color: ${e.colorPrimary};\n    }\n  `}
`,D=o.I4.div`
  ${({theme:e})=>`\n    padding: 12px;\n    background: ${e.colorInfoBg};\n    border: 1px solid ${e.colorInfoBorder};\n    border-radius: ${e.borderRadius}px;\n    font-family: monospace;\n    font-size: 11px;\n    word-break: break-all;\n  `}
`,_=[{id:"USER_ORGUNIT",displayName:"User Organisation Unit",description:"Show data for the org unit assigned to the current user",detailedDescription:"Each user sees data from their own organization unit. Perfect for role-based dashboards where each user manages their specific facility or district.",scope:"Single level: Only the user's assigned org unit",icon:"ðŸ‘¤"},{id:"USER_ORGUNIT_CHILDREN",displayName:"User Org Unit Children",description:"Show data for the org unit and its immediate children",detailedDescription:"If a user is assigned to a Region, they see data for that Region and all Districts directly under it. Useful for supervisory dashboards.",scope:"Two levels: User's org unit + immediate children",icon:"ðŸ‘¥"},{id:"USER_ORGUNIT_GRANDCHILDREN",displayName:"User Org Unit Grandchildren",description:"Show data for the org unit, its children, and grandchildren",detailedDescription:"If a user is assigned to a Region, they see data for that Region, all Districts, and all Facilities. Comprehensive view for higher-level managers.",scope:"Three levels: User's org unit + children + grandchildren",icon:"ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦"}],E=[{value:"all_levels",label:"ðŸ“Š All Hierarchy Columns",description:"Include National, Region, District, etc. columns"},{value:"data_levels_only",label:"âœ‚ï¸ Data Levels Only",description:"Only columns with actual data"}],F=({databaseId:e,value:t=[],onChange:n,availableLevels:o,onLevelsLoad:c,onSelectionChange:F,hierarchyColumnMode:U="all_levels",onHierarchyColumnModeChange:z})=>{const[B,O]=(0,a.useState)("relative"),[M,H]=(0,a.useState)(U),[P,W]=(0,a.useState)([]),[j,G]=(0,a.useState)(o||[]),[J,K]=(0,a.useState)(!1),[Q,q]=(0,a.useState)({}),[V,X]=(0,a.useState)(),[Z,ee]=(0,a.useState)(""),te=(0,a.useMemo)(()=>{const e=[],n=[],i=[];return t.forEach(t=>{if(t.startsWith("USER_ORGUNIT"))i.push(t);else if(t.startsWith("LEVEL-")){const e=parseInt(t.replace("LEVEL-",""),10);Number.isNaN(e)||n.push(e)}else e.push(t)}),{orgUnitIds:e,levelNumbers:n,relativeIds:i}},[t]),ne=(0,a.useMemo)(()=>te.relativeIds.length>0?"relative":0===te.orgUnitIds.length&&te.levelNumbers.length>0?"level":"specific",[te]),ie=(0,a.useMemo)(()=>{const e=[];return e.push(...te.orgUnitIds),e.push(...te.relativeIds),te.levelNumbers.forEach(t=>{e.push(`LEVEL-${t}`)}),e.join(";")},[te]),ae=(0,a.useRef)(F),le=(0,a.useRef)(z);(0,a.useEffect)(()=>{ae.current=F,le.current=z}),(0,a.useEffect)(()=>{const e={selectionType:ne,selectedOrgUnits:[...te.orgUnitIds,...te.relativeIds],selectedLevels:te.levelNumbers,hierarchyColumnMode:M,ouDimensionValue:ie};queueMicrotask(()=>{null==ae.current||ae.current(e),null==le.current||le.current(M)})},[ne,te,M,ie]),(0,a.useEffect)(()=>{(async()=>{if(e&&!o)try{var t;const n=await r.A.get({endpoint:`/api/v1/database/${e}/dhis2_metadata/?type=organisationUnitLevels`});if(null!=(t=n.json)&&t.result){const e=n.json.result.sort((e,t)=>e.level-t.level).map(e=>({level:e.level,displayName:e.displayName}));G(e),null==c||c(e)}}catch(e){console.warn("Failed to fetch org unit levels:",e)}})()},[e,o,c]);const re=(0,a.useCallback)(async(t,n)=>{if(e){K(!0);try{var i;let a=`/api/v1/database/${e}/dhis2_metadata/?type=organisationUnits`;t&&(a+=`&level=${t}`),n&&n.length>=2&&(a+=`&search=${encodeURIComponent(n)}`);const l=await r.A.get({endpoint:a});null!=(i=l.json)&&i.result&&W(l.json.result)}catch(e){console.warn("Failed to fetch org units:",e),W([])}finally{K(!1)}}},[e]);(0,a.useEffect)(()=>{"specific"===B&&re(V,Z)},[B,V,re]);const oe=(0,a.useCallback)(e=>{ee(e),(e.length>=2||0===e.length)&&re(V,e)},[V,re]),se=(e,t)=>{const i=te.orgUnitIds,a=te.levelNumbers;let l;i.includes(e)?(l=i.filter(t=>t!==e),q(t=>{const n={...t};return delete n[e],n})):(l=[...i,e],t&&q(n=>({...n,[e]:t})));const r=[...l,...a.map(e=>`LEVEL-${e}`)];n(r)},de=e=>{const t=te.orgUnitIds,i=te.levelNumbers;let a;a=i.includes(e)?i.filter(t=>t!==e):[...i,e].sort((e,t)=>e-t);const l=[...t,...a.map(e=>`LEVEL-${e}`)];n(l)},ce=e=>{const i=`LEVEL-${e}`,a=t.filter(e=>e.startsWith("LEVEL-"));let l;l=a.includes(i)?a.filter(e=>e!==i):[...a,i],n(l)},pe=e=>{const t=_.find(t=>t.id===e);if(t)return t.displayName;if(e.startsWith("LEVEL-")){const t=parseInt(e.replace("LEVEL-",""),10),n=j.find(e=>e.level===t);return n?`Level ${t}: ${n.displayName}`:e}if(Q[e])return Q[e];const n=P.find(t=>t.id===e);return(null==n?void 0:n.displayName)||e},he=e=>{const t=_.find(t=>t.id===e);return t?t.scope:""},ue=[{key:"relative",label:(0,i.Y)(p.Badge,{count:te.relativeIds.length,size:"small",offset:[8,0],children:(0,i.FD)("span",{style:{paddingRight:12},children:["ðŸ‘¤ ",(0,l.t)("Relative")]})}),children:(0,i.FD)(g,{children:[(0,i.Y)(C,{type:"relative",children:"ðŸ‘¤ User-Relative Selection: Data adjusts per user's org unit"}),(0,i.Y)(p.Alert,{type:"info",message:(0,l.t)("Dynamic User-Based Filtering"),description:(0,l.t)("Each user will see data filtered to their assigned organization unit. Perfect for role-based dashboards where different users manage different regions or facilities."),showIcon:!0,style:{marginBottom:16}}),(0,i.FD)(y,{children:[(0,i.FD)(v,{children:["ðŸŽ¯ ",(0,l.t)("Select Option"),(0,i.Y)(p.Tooltip,{title:"User-relative selections automatically adjust based on each user's assigned organization unit. This is ideal for role-based filtering.",children:(0,i.Y)("span",{style:{cursor:"help",fontSize:"12px"},children:"â„¹ï¸"})})]}),(0,i.Y)(f,{children:_.map(e=>(0,i.Y)(p.Tooltip,{title:e.detailedDescription,placement:"right",children:(0,i.FD)(S,{selected:t.includes(e.id),onClick:()=>{return t=e.id,void n([t]);var t},children:[(0,i.FD)(Y,{children:[e.icon," ",e.displayName,t.includes(e.id)&&(0,i.Y)("span",{style:{marginLeft:"auto",color:"var(--superset-color-success)",fontSize:"16px"},children:"âœ“"})]}),(0,i.Y)(x,{children:e.description}),(0,i.Y)($,{children:e.scope})]})},e.id))})]}),(0,i.FD)(y,{children:[(0,i.FD)(v,{children:["ðŸ“Š ",(0,l.t)("Output Columns"),(0,i.Y)(p.Tooltip,{title:"Control which hierarchy columns appear in your dataset. Choose based on your reporting needs.",children:(0,i.Y)("span",{style:{cursor:"help",fontSize:"12px"},children:"â„¹ï¸"})})]}),(0,i.Y)(p.Radio.Group,{value:M,onChange:e=>H(e.target.value),children:E.map(e=>(0,i.FD)(p.Radio,{value:e.value,style:{display:"block",marginBottom:12},children:[(0,i.Y)("span",{style:{fontWeight:500},children:e.label}),(0,i.Y)("div",{style:{fontSize:11,marginLeft:22,color:"#666"},children:e.description})]},e.value))})]})]})},{key:"specific",label:(0,i.Y)(p.Badge,{count:te.orgUnitIds.length+te.levelNumbers.length,size:"small",offset:[8,0],children:(0,i.FD)("span",{style:{paddingRight:12},children:["ðŸ¢ ",(0,l.t)("Specific")]})}),children:(0,i.FD)(g,{children:[(0,i.Y)(C,{type:"specific",children:"ðŸ¢ Specific Selection: Fixed org units + optional disaggregation"}),(0,i.Y)(p.Alert,{type:"info",message:(0,l.t)("Static Org Unit Selection"),description:(0,l.t)("Select specific org units and optionally add hierarchy levels to disaggregate data. For example, select a Region and add District and Facility levels to see data broken down by facility."),showIcon:!0,style:{marginBottom:16}}),(0,i.FD)(y,{children:[(0,i.FD)(v,{children:["ðŸ¢ ",(0,l.t)("Select Organisation Units"),(0,i.Y)(p.Tooltip,{title:"Search or filter by level to find and select specific organization units like facilities, districts, or regions.",children:(0,i.Y)("span",{style:{cursor:"help",fontSize:"12px"},children:"â„¹ï¸"})})]}),(0,i.Y)(b,{children:(0,l.t)("Use the search box or level filter to find specific org units.")}),(0,i.FD)(I,{children:[(0,i.Y)(h,{placeholder:(0,l.t)("Search org units..."),style:{width:250},allowClear:!0,value:Z,onChange:e=>oe(e.target.value),size:"middle"}),(0,i.Y)(p.Select,{style:{width:180},placeholder:(0,l.t)("Filter by level"),allowClear:!0,value:V,onChange:X,options:j.map(e=>({value:e.level,label:`${e.level}. ${e.displayName}`})),size:"middle"})]}),J?(0,i.Y)(T,{children:(0,i.Y)(d.R,{})}):(0,i.Y)(k,{children:0===P.length?(0,i.Y)("div",{style:{padding:16,textAlign:"center"},children:Z?(0,l.t)("No org units found"):(0,l.t)("Select a level or search")}):P.map(e=>(0,i.FD)(w,{selected:te.orgUnitIds.includes(e.id),onClick:()=>se(e.id,e.displayName),children:[(0,i.Y)(p.Checkbox,{checked:te.orgUnitIds.includes(e.id)}),(0,i.FD)("div",{style:{flex:1},children:[(0,i.Y)("div",{children:e.displayName}),e.level&&(0,i.FD)(u,{type:"secondary",style:{fontSize:11},children:["Level ",e.level]})]})]},e.id))})]}),te.orgUnitIds.length>0&&(0,i.FD)(y,{children:[(0,i.FD)(v,{children:["ðŸ“Š ",(0,l.t)("Disaggregation Levels"),(0,i.Y)(p.Tooltip,{title:"Add hierarchy levels to break down data. Selecting additional levels creates row groups for each level value.",children:(0,i.Y)("span",{style:{cursor:"help",fontSize:"12px"},children:"â„¹ï¸"})})]}),(0,i.Y)(b,{children:(0,l.t)('Add levels to show detailed data. For example, if you selected a Region, add "District" and "Facility" to see data broken down by each facility.')}),(0,i.Y)("div",{style:{marginBottom:12},children:j.map(e=>(0,i.FD)(R,{selected:te.levelNumbers.includes(e.level),onClick:()=>de(e.level),children:[(0,i.Y)(p.Checkbox,{checked:te.levelNumbers.includes(e.level)}),(0,i.FD)("div",{style:{flex:1},children:[(0,i.FD)("strong",{children:["Level ",e.level,":"]})," ",e.displayName]})]},e.level))})]}),(0,i.FD)(y,{children:[(0,i.FD)(v,{children:["ðŸ“Š ",(0,l.t)("Output Columns")]}),(0,i.Y)(p.Radio.Group,{value:M,onChange:e=>H(e.target.value),size:"small",children:E.map(e=>(0,i.Y)(p.Radio,{value:e.value,children:e.label},e.value))})]})]})},{key:"level",label:(0,i.Y)(p.Badge,{count:"level"===ne?te.levelNumbers.length:0,size:"small",offset:[8,0],children:(0,i.FD)("span",{style:{paddingRight:12},children:["ðŸ“¶ ",(0,l.t)("By Level")]})}),children:(0,i.FD)(g,{children:[(0,i.Y)(C,{type:"level",children:"ðŸ“Š Level-Based Selection: All org units at selected level(s)"}),(0,i.Y)(p.Alert,{type:"info",message:(0,l.t)("Comprehensive Level Selection"),description:(0,l.t)("Select ALL organization units at one or more levels. Useful for comprehensive reports across all districts, all facilities, etc. No need to select individual org units."),showIcon:!0,style:{marginBottom:16}}),(0,i.FD)(y,{children:[(0,i.FD)(v,{children:["ðŸ“Š ",(0,l.t)("Select Levels"),(0,i.Y)(p.Tooltip,{title:"Select one or more levels to include ALL organization units at those levels. Useful for comprehensive reports.",children:(0,i.Y)("span",{style:{cursor:"help",fontSize:"12px"},children:"â„¹ï¸"})})]}),(0,i.Y)(b,{children:(0,l.t)("Select levels to include all org units at those levels. For example, selecting Level 4 (Facilities) will include data from every facility in the system.")}),0===j.length?(0,i.Y)(T,{children:(0,i.Y)(d.R,{})}):(0,i.Y)("div",{style:{marginBottom:12},children:j.map(e=>(0,i.FD)(R,{selected:"level"===ne&&te.levelNumbers.includes(e.level),onClick:()=>ce(e.level),children:[(0,i.Y)(p.Checkbox,{checked:"level"===ne&&te.levelNumbers.includes(e.level)}),(0,i.FD)("div",{style:{flex:1},children:[(0,i.FD)("strong",{children:["Level ",e.level,":"]})," ",e.displayName,(0,i.Y)("div",{style:{fontSize:11,color:"#666"},children:(0,l.t)("Includes all org units at this level")})]})]},e.level))})]}),(0,i.FD)(y,{children:[(0,i.FD)(v,{children:["ðŸ“Š ",(0,l.t)("Output Columns")]}),(0,i.Y)(p.Radio.Group,{value:M,onChange:e=>H(e.target.value),size:"small",children:E.map(e=>(0,i.Y)(p.Radio,{value:e.value,children:e.label},e.value))})]})]})}];return(0,i.FD)(m,{children:[(0,i.Y)(p.Alert,{type:"warning",message:"Selection Type Guide",description:(0,i.FD)("div",{style:{fontSize:12,lineHeight:1.6},children:[(0,i.Y)("strong",{children:"ðŸ‘¤ Relative:"})," Data filters by each user's assigned org unit (USER_ORGUNIT, USER_ORGUNIT_CHILDREN, USER_ORGUNIT_GRANDCHILDREN).",(0,i.Y)("br",{}),(0,i.Y)("strong",{children:"ðŸ¢ Specific:"})," Choose exact org units. Optionally add hierarchy levels to disaggregate data by region/district/facility.",(0,i.Y)("br",{}),(0,i.Y)("strong",{children:"ðŸ“Š By Level:"})," Include ALL org units at selected level(s) - useful for comprehensive reports."]}),showIcon:!0,closable:!0,style:{marginBottom:16}}),(0,i.Y)(s.Ay,{activeKey:B,onChange:O,items:ue,size:"small"}),t.length>0&&(0,i.FD)(L,{children:[(0,i.FD)(A,{children:[(0,i.FD)("div",{children:[(0,i.Y)(u,{strong:!0,style:{fontSize:14},children:(0,l.t)("Selection Summary")}),(0,i.FD)(u,{type:"secondary",style:{fontSize:11,display:"block",marginTop:2},children:[t.length," item(s) selected"]})]}),(0,i.Y)(p.Tag,{style:{cursor:"pointer",marginLeft:"auto"},onClick:()=>{n([]),q({})},color:"error",children:(0,l.t)("Clear All")})]}),(0,i.Y)(p.Divider,{style:{margin:"12px 0"}}),(0,i.FD)("div",{children:[te.relativeIds.length>0&&(0,i.FD)("div",{style:{marginBottom:12},children:[(0,i.Y)(u,{type:"secondary",style:{fontSize:12,fontWeight:500},children:"ðŸ‘¤ User-Relative Options:"}),(0,i.Y)(N,{children:te.relativeIds.map(e=>(0,i.Y)(p.Tooltip,{title:he(e),placement:"top",children:(0,i.Y)(p.Tag,{color:"blue",style:{marginTop:4,cursor:"help"},children:pe(e)})},e))})]}),te.orgUnitIds.length>0&&(0,i.FD)("div",{style:{marginBottom:12},children:[(0,i.Y)(u,{type:"secondary",style:{fontSize:12,fontWeight:500},children:"ðŸ¢ Specific Organisations:"}),(0,i.Y)(N,{children:te.orgUnitIds.map(e=>(0,i.Y)(p.Tag,{closable:!0,onClose:()=>se(e),color:"green",style:{marginTop:4},children:pe(e)},e))})]}),te.levelNumbers.length>0&&(0,i.FD)("div",{style:{marginBottom:12},children:[(0,i.Y)(u,{type:"secondary",style:{fontSize:12,fontWeight:500},children:"ðŸ“Š Hierarchy Levels:"}),(0,i.Y)(N,{children:te.levelNumbers.map(e=>{var t;return(0,i.FD)(p.Tag,{closable:!0,onClose:()=>"level"===ne?ce(e):de(e),color:"purple",style:{marginTop:4},children:["Level ",e,":"," ",null==(t=j.find(t=>t.level===e))?void 0:t.displayName]},`LEVEL-${e}`)})})]})]}),(0,i.Y)(p.Divider,{style:{margin:"12px 0"}}),(0,i.FD)("div",{children:[(0,i.FD)(u,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:8,fontWeight:500},children:["ðŸ”— ",(0,l.t)("DHIS2 API Parameter"),":"]}),(0,i.FD)(D,{children:["dimension=ou:",ie]}),(0,i.Y)(u,{type:"secondary",style:{fontSize:10,display:"block",marginTop:8,lineHeight:1.6},children:"This parameter will be included in your DHIS2 API request. The organization unit values will be filtered based on each user's assigned org unit if using relative keywords."})]})]})]})},U=F},35273:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(2445),a=n(81465),l=n(8558),r=n(95018),o=n(7437);const s=function({warningMarkdown:e,size:t,marginRight:n}){const s=(0,a.DP)();return(0,i.Y)(r.m,{id:"warning-tooltip",title:(0,i.Y)(o.z,{source:e}),children:(0,i.Y)(l.F.WarningOutlined,{iconColor:s.colorWarning,iconSize:t,css:{marginRight:null!=n?n:2*s.sizeUnit}})})}},42323:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(24002),a=n(24777);function l(e,t){const n=(0,i.useRef)(),[l,r]=(0,i.useState)(t);return(0,i.useEffect)(()=>{var t;n.current=null!=(t=n.current)?t:(0,a.Gq)(a.Hh.CommonResizableSidebarWidths,{}),n.current[e]&&r(n.current[e])},[e]),[l,function(t){r(t),(0,a.SO)(a.Hh.CommonResizableSidebarWidths,{...n.current,[e]:t})}]}},81574:(e,t,n)=>{n.d(t,{g:()=>c});var i=n(20249),a=n.n(i),l=n(2445),r=n(29645),o=n(17437),s=n(81465),d=n(95018);const c=({popupRender:e,tooltip:t,tooltipPlacement:n,children:i,...c})=>{const p=(0,s.DP)(),{type:h}=c,u=o.AH`
    ${(!h||"default"===h)&&".ant-dropdown-trigger {\n      position: relative;\n      &:before {\n        content: '';\n        position: absolute;\n        left: 0;\n        top: 0;\n        width: 1px;\n        height: 100%;\n      }\n      .anticon {\n        vertical-align: middle;\n      }\n    }"}
  `,m=(0,l.Y)(r.Dropdown.Button,{popupRender:e,...c,css:[u,o.AH`
          .ant-btn {
            height: 30px;
            box-shadow: none;
            font-size: ${p.fontSizeSM}px;
            font-weight: ${p.fontWeightStrong};
          }
        `],children:i});return t?(0,l.Y)(d.m,{placement:n,id:`${a()(t)}-tooltip`,title:t,children:m}):m}},88657:(e,t,n)=>{n.d(t,{A:()=>k,r:()=>C});var i=n(2445),a=n(24002),l=n(74098),r=n(79378),o=n(81465),s=n(21325),d=n(56196),c=n(42566),p=n(29645);const{Text:h}=c.o,u=o.I4.div`
  ${({theme:e})=>`\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    background: ${e.colorBgContainer};\n  `}
`,m=o.I4.div`
  ${({theme:e})=>`\n    padding: ${2*e.sizeUnit}px;\n    min-height: 300px;\n  `}
`,g=o.I4.div`
  ${({theme:e})=>`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));\n    gap: ${e.sizeUnit}px;\n    max-height: 250px;\n    overflow-y: auto;\n    padding: ${e.sizeUnit}px;\n    border: 1px solid ${e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    background: ${e.colorBgContainer};\n  `}
`,y=o.I4.div`
  ${({theme:e,selected:t})=>`\n    padding: ${e.sizeUnit}px ${1.5*e.sizeUnit}px;\n    border: 1px solid ${t?e.colorPrimary:e.colorBorder};\n    border-radius: ${e.borderRadius}px;\n    background: ${t?e.colorPrimaryBg:e.colorBgContainer};\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: ${e.sizeUnit}px;\n    font-size: 13px;\n    \n    &:hover {\n      border-color: ${e.colorPrimary};\n      background: ${e.colorPrimaryBg};\n    }\n  `}
`,v=o.I4.div`
  ${({theme:e})=>`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n    gap: ${e.sizeUnit}px;\n  `}
`,b=o.I4.div`
  ${({theme:e})=>`\n    padding: ${2*e.sizeUnit}px;\n    border-top: 1px solid ${e.colorBorder};\n    background: ${e.colorBgLayout};\n    max-height: 120px;\n    overflow-y: auto;\n  `}
`,f=o.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: ${e.sizeUnit}px;\n  `}
`,S=o.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-wrap: wrap;\n    gap: ${e.sizeUnit}px;\n  `}
`,Y=o.I4.div`
  ${({theme:e})=>`\n    margin-bottom: ${2*e.sizeUnit}px;\n    display: flex;\n    align-items: center;\n    gap: ${2*e.sizeUnit}px;\n    flex-wrap: wrap;\n  `}
`,x=o.I4.div`
  display: flex;
  align-items: center;
  gap: 8px;
`,$=o.I4.div`
  ${({theme:e})=>`\n    padding: ${4*e.sizeUnit}px;\n    text-align: center;\n  `}
`,I=o.I4.div`
  ${({theme:e})=>`\n    text-align: center;\n    padding: ${3*e.sizeUnit}px;\n    color: ${e.colorTextSecondary};\n  `}
`,L={days:[{id:"TODAY",displayName:"Today"},{id:"YESTERDAY",displayName:"Yesterday"},{id:"LAST_3_DAYS",displayName:"Last 3 days"},{id:"LAST_7_DAYS",displayName:"Last 7 days"},{id:"LAST_14_DAYS",displayName:"Last 14 days"},{id:"LAST_30_DAYS",displayName:"Last 30 days"},{id:"LAST_60_DAYS",displayName:"Last 60 days"},{id:"LAST_90_DAYS",displayName:"Last 90 days"},{id:"LAST_180_DAYS",displayName:"Last 180 days"}],weeks:[{id:"THIS_WEEK",displayName:"This week"},{id:"LAST_WEEK",displayName:"Last week"},{id:"LAST_4_WEEKS",displayName:"Last 4 weeks"},{id:"LAST_12_WEEKS",displayName:"Last 12 weeks"},{id:"LAST_52_WEEKS",displayName:"Last 52 weeks"}],biWeeks:[{id:"THIS_BIWEEK",displayName:"This bi-week"},{id:"LAST_BIWEEK",displayName:"Last bi-week"},{id:"LAST_4_BIWEEKS",displayName:"Last 4 bi-weeks"}],months:[{id:"THIS_MONTH",displayName:"This month"},{id:"LAST_MONTH",displayName:"Last month"},{id:"LAST_3_MONTHS",displayName:"Last 3 months"},{id:"LAST_6_MONTHS",displayName:"Last 6 months"},{id:"LAST_12_MONTHS",displayName:"Last 12 months"},{id:"MONTHS_THIS_YEAR",displayName:"Months this year"}],biMonths:[{id:"THIS_BIMONTH",displayName:"This bi-month"},{id:"LAST_BIMONTH",displayName:"Last bi-month"},{id:"LAST_6_BIMONTHS",displayName:"Last 6 bi-months"}],quarters:[{id:"THIS_QUARTER",displayName:"This quarter"},{id:"LAST_QUARTER",displayName:"Last quarter"},{id:"LAST_4_QUARTERS",displayName:"Last 4 quarters"},{id:"QUARTERS_THIS_YEAR",displayName:"Quarters this year"}],sixMonths:[{id:"THIS_SIX_MONTH",displayName:"This six-month"},{id:"LAST_SIX_MONTH",displayName:"Last six-month"},{id:"LAST_2_SIXMONTHS",displayName:"Last 2 six-months"}],financialYears:[{id:"THIS_FINANCIAL_YEAR",displayName:"This financial year"},{id:"LAST_FINANCIAL_YEAR",displayName:"Last financial year"},{id:"LAST_5_FINANCIAL_YEARS",displayName:"Last 5 financial years"}],years:[{id:"THIS_YEAR",displayName:"This year"},{id:"LAST_YEAR",displayName:"Last year"},{id:"LAST_5_YEARS",displayName:"Last 5 years"},{id:"LAST_10_YEARS",displayName:"Last 10 years"}]},A=[{value:"YEARLY",label:"Yearly"},{value:"FINANCIAL_YEAR_JULY",label:"Financial year (July)"},{value:"FINANCIAL_YEAR_APRIL",label:"Financial year (April)"},{value:"FINANCIAL_YEAR_OCT",label:"Financial year (October)"},{value:"SIX_MONTHLY",label:"Six-monthly"},{value:"SIX_MONTHLY_APRIL",label:"Six-monthly (April)"},{value:"QUARTERLY",label:"Quarterly"},{value:"BI_MONTHLY",label:"Bi-monthly"},{value:"MONTHLY",label:"Monthly"},{value:"WEEKLY",label:"Weekly"},{value:"DAILY",label:"Daily"}],N=["January","February","March","April","May","June","July","August","September","October","November","December"],T=["Q1","Q2","Q3","Q4"],C=({databaseId:e,value:t=[],onChange:n})=>{const[o,c]=(0,a.useState)("relative"),[C,k]=(0,a.useState)(!1),[w,R]=(0,a.useState)("YEARLY"),[D,_]=(0,a.useState)((new Date).getFullYear()),[E,F]=(0,a.useState)([]),U=(0,a.useMemo)(()=>{const e=(new Date).getFullYear();return Array.from({length:20},(t,n)=>e-n)},[]),z=(0,a.useCallback)(async()=>{if(k(!0),e)try{var t;const n=await r.A.get({endpoint:`/api/v1/database/${e}/dhis2_metadata/?type=periods&periodType=${w}`});if(null!=(t=n.json)&&t.result&&n.json.result.length>0){let e=n.json.result;return["YEARLY","FINANCIAL_YEAR_JULY","FINANCIAL_YEAR_APRIL","FINANCIAL_YEAR_OCT"].includes(w)||(e=e.filter(e=>e.id.startsWith(String(D)))),F(e),void k(!1)}}catch{}const n=function(e,t){const n=[];switch(e){case"YEARLY":for(let e=t-4;e<=t+5;e+=1)n.push({id:String(e),displayName:String(e),type:"YEARLY"});break;case"MONTHLY":for(let e=1;e<=12;e+=1){const i=String(e).padStart(2,"0");n.push({id:`${t}${i}`,displayName:`${N[e-1]} ${t}`,type:"MONTHLY"})}break;case"QUARTERLY":for(let e=1;e<=4;e+=1)n.push({id:`${t}Q${e}`,displayName:`${t} ${T[e-1]}`,type:"QUARTERLY"});break;case"SIX_MONTHLY":n.push({id:`${t}S1`,displayName:`January - June ${t}`,type:"SIX_MONTHLY"}),n.push({id:`${t}S2`,displayName:`July - December ${t}`,type:"SIX_MONTHLY"});break;case"SIX_MONTHLY_APRIL":n.push({id:`${t}AprilS1`,displayName:`April - September ${t}`,type:"SIX_MONTHLY_APRIL"}),n.push({id:`${t}AprilS2`,displayName:`October ${t} - March ${t+1}`,type:"SIX_MONTHLY_APRIL"});break;case"BI_MONTHLY":{const e=[{startMonth:"01",name:"January - February"},{startMonth:"03",name:"March - April"},{startMonth:"05",name:"May - June"},{startMonth:"07",name:"July - August"},{startMonth:"09",name:"September - October"},{startMonth:"11",name:"November - December"}];for(let i=0;i<6;i+=1)n.push({id:`${t}${e[i].startMonth}B`,displayName:`${e[i].name} ${t}`,type:"BI_MONTHLY"});break}case"WEEKLY":for(let e=1;e<=52;e+=1)n.push({id:`${t}W${e}`,displayName:`${t} Week ${e}`,type:"WEEKLY"});break;case"FINANCIAL_YEAR_JULY":for(let e=t-4;e<=t+5;e+=1)n.push({id:`${e}July`,displayName:`July ${e} - June ${e+1}`,type:"FINANCIAL_YEAR_JULY"});break;case"FINANCIAL_YEAR_APRIL":for(let e=t-4;e<=t+5;e+=1)n.push({id:`${e}April`,displayName:`April ${e} - March ${e+1}`,type:"FINANCIAL_YEAR_APRIL"});break;case"FINANCIAL_YEAR_OCT":for(let e=t-4;e<=t+5;e+=1)n.push({id:`${e}Oct`,displayName:`October ${e} - September ${e+1}`,type:"FINANCIAL_YEAR_OCT"});break;case"DAILY":for(let e=1;e<=31;e+=1){const i=String(e).padStart(2,"0");n.push({id:`${t}01${i}`,displayName:`January ${e}, ${t}`,type:"DAILY"})}}return n}(w,D);F(n),k(!1)},[e,w,D]);(0,a.useEffect)(()=>{"fixed"===o&&z()},[o,w,D,z]);const B=e=>{t.includes(e)?n(t.filter(t=>t!==e)):n([...t,e])},O=e=>{const t=E.find(t=>t.id===e);if(t)return t.displayName;for(const t of Object.values(L)){const n=t.find(t=>t.id===e);if(n)return n.displayName}return e},M=e=>(0,i.Y)(v,{children:e.map(e=>(0,i.FD)(y,{selected:t.includes(e.id),onClick:()=>B(e.id),children:[(0,i.Y)(p.Checkbox,{checked:t.includes(e.id)}),e.displayName]},e.id))}),H=[{key:"days",label:(0,l.t)("Days"),children:M(L.days)},{key:"weeks",label:(0,l.t)("Weeks"),children:M(L.weeks)},{key:"biWeeks",label:(0,l.t)("Bi-weeks"),children:M(L.biWeeks)},{key:"months",label:(0,l.t)("Months"),children:M(L.months)},{key:"biMonths",label:(0,l.t)("Bi-months"),children:M(L.biMonths)},{key:"quarters",label:(0,l.t)("Quarters"),children:M(L.quarters)},{key:"sixMonths",label:(0,l.t)("Six-months"),children:M(L.sixMonths)},{key:"financialYears",label:(0,l.t)("Financial Years"),children:M(L.financialYears)},{key:"years",label:(0,l.t)("Years"),children:M(L.years)}],P=[{key:"relative",label:(0,i.Y)(p.Badge,{count:(()=>{const e=Object.values(L).flat();return t.filter(t=>e.some(e=>e.id===t)).length})(),size:"small",offset:[8,0],children:(0,i.Y)("span",{style:{paddingRight:12},children:(0,l.t)("Relative Periods")})}),children:(0,i.FD)(m,{children:[(0,i.Y)(h,{type:"secondary",style:{display:"block",marginBottom:16},children:(0,l.t)("Select relative periods that automatically adjust based on the current date.")}),(0,i.Y)(p.Collapse,{defaultActiveKey:["months","quarters","years"],items:H})]})},{key:"fixed",label:(0,i.Y)(p.Badge,{count:t.filter(e=>E.some(t=>t.id===e)).length,size:"small",offset:[8,0],children:(0,i.Y)("span",{style:{paddingRight:12},children:(0,l.t)("Fixed Periods")})}),children:(0,i.FD)(m,{children:[(0,i.Y)(h,{type:"secondary",style:{display:"block",marginBottom:16},children:(0,l.t)("Select specific fixed periods by type and year.")}),(0,i.FD)(Y,{children:[(0,i.Y)(h,{strong:!0,children:(0,l.t)("Period Type:")}),(0,i.Y)(p.Select,{style:{width:200},value:w,onChange:e=>R(e),options:A}),!["YEARLY","FINANCIAL_YEAR_JULY","FINANCIAL_YEAR_APRIL","FINANCIAL_YEAR_OCT"].includes(w)&&(0,i.FD)(i.FK,{children:[(0,i.Y)(h,{strong:!0,children:(0,l.t)("Year:")}),(0,i.FD)(x,{children:[(0,i.FD)(p.Button,{size:"small",onClick:()=>_(e=>e-1),disabled:D<=(new Date).getFullYear()-20,children:["â† ",(0,l.t)("Prev")]}),(0,i.Y)(p.Select,{style:{width:100},value:D,onChange:e=>_(e),options:U.map(e=>({value:e,label:String(e)}))}),(0,i.FD)(p.Button,{size:"small",onClick:()=>_(e=>e+1),disabled:D>=(new Date).getFullYear()+5,children:[(0,l.t)("Next")," â†’"]})]})]})]}),C?(0,i.FD)($,{children:[(0,i.Y)(d.R,{}),(0,i.Y)("div",{style:{marginTop:8},children:(0,l.t)("Loading periods...")})]}):0===E.length?(0,i.Y)(I,{children:(0,l.t)("No periods available for this type and year")}):(0,i.Y)(g,{children:E.map(e=>(0,i.FD)(y,{selected:t.includes(e.id),onClick:()=>B(e.id),children:[(0,i.Y)(p.Checkbox,{checked:t.includes(e.id)}),e.displayName]},e.id))})]})}];return(0,i.FD)(u,{children:[(0,i.Y)(s.Ay,{activeKey:o,onChange:c,items:P}),t.length>0&&(0,i.FD)(b,{children:[(0,i.FD)(f,{children:[(0,i.FD)(h,{strong:!0,children:[(0,l.t)("Selected")," (",t.length,")"]}),(0,i.Y)(p.Tag,{style:{cursor:"pointer"},onClick:()=>{n([])},color:"error",children:(0,l.t)("Clear All")})]}),(0,i.Y)(S,{children:t.map(e=>(0,i.FD)(p.Tag,{closable:!0,onClose:()=>(e=>{n(t.filter(t=>t!==e))})(e),children:["ðŸ“… ",O(e)]},e))})]})]})},k=C},94083:(e,t,n)=>{n.d(t,{Ay:()=>x,Kt:()=>Y,cs:()=>f});var i=n(2445),a=n(24002),l=n(74098),r=n(81465),o=n(59744),s=n(2801),d=n(54569),c=n(23195),p=n(9876),h=n(8558),u=n(9992),m=n(35273),g=n(64457),y=n(98244);const v=r.I4.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.sizeUnit}px;\n      margin-top: ${5*e.sizeUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .divider {\n      border-bottom: 1px solid ${e.colorSplit};\n      margin: 15px 0;\n    }\n\n    .table-length {\n      color: ${e.colorTextSecondary};\n    }\n\n    .select {\n      flex: 1;\n      max-width: calc(100% - ${e.sizeUnit+30}px)\n    }\n  `}
`,b=r.I4.span`
  align-items: center;
  display: flex;
  white-space: nowrap;

  svg,
  small {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,f=({table:e})=>{const{value:t,type:n,extra:a}=e;return(0,i.FD)(b,{title:t,children:["view"===n?(0,i.Y)(h.F.FunctionOutlined,{iconSize:"m"}):"materialized_view"===n?(0,i.Y)(h.F.ProfileOutlined,{iconSize:"m"}):(0,i.Y)(h.F.TableOutlined,{iconSize:"m"}),(null==a?void 0:a.certification)&&(0,i.Y)(d.T,{certifiedBy:a.certification.certified_by,details:a.certification.details,size:"l"}),(null==a?void 0:a.warning_markdown)&&(0,i.Y)(m.A,{warningMarkdown:a.warning_markdown,size:"l",marginRight:4}),t]})},S=({database:e,emptyState:t,formMode:n=!1,getDbList:r,handleError:d,isDatabaseSelectEnabled:h=!0,onDbChange:m,onCatalogChange:b,onSchemaChange:S,readOnly:Y=!1,onEmptyResults:x,catalog:$,schema:I,sqlLabMode:L=!0,tableSelectMode:A="single",tableValue:N,onTableSelectChange:T,customTableOptionLabelRenderer:C})=>{const{addSuccessToast:k}=(0,g.Yf)(),[w,R]=(0,a.useState)($),[D,_]=(0,a.useState)(I),[E,F]=(0,a.useState)(void 0),{currentData:U,isFetching:z,refetch:B}=(0,y.ty)({dbId:null==e?void 0:e.id,catalog:w,schema:D,onSuccess:(e,t)=>{t&&k((0,l.t)("List updated"))},onError:e=>{(0,o.h4)(e).then(e=>{d((0,o.hi)((0,l.t)("There was an error loading the tables"),e))})}}),O=(0,a.useMemo)(()=>U?U.options.map(e=>({value:e.value,label:C?C(e):(0,i.Y)(f,{table:e}),text:e.value})):[],[U,C]);(0,a.useEffect)(()=>{void 0===e&&(R(void 0),_(void 0),F(void 0))},[e,A]),(0,a.useEffect)(()=>{F("single"===A?O.find(e=>e.value===N):(null==O?void 0:O.filter(e=>e&&(null==N?void 0:N.includes(e.value))))||[])},[O,N,A]);const M=(0,a.useMemo)(()=>(e,t)=>{const n=e.trim().toLowerCase(),{value:i}=t;return i.toLowerCase().includes(n)},[]);return(0,i.FD)(v,{children:[(0,i.Y)(p.RA,{db:e,emptyState:t,formMode:n,getDbList:r,handleError:d,onDbChange:Y?void 0:e=>{m&&m(e),R(void 0),_(void 0),F("single"===A?void 0:[])},onEmptyResults:x,onCatalogChange:Y?void 0:e=>{R(e),b&&b(e),_(void 0),F("single"===A?void 0:[])},catalog:w,onSchemaChange:Y?void 0:e=>{_(e),S&&S(e),F("single"===A?void 0:[])},schema:D,sqlLabMode:L,isDatabaseSelectEnabled:h&&!Y,readOnly:Y}),L&&!n&&(0,i.Y)("div",{className:"divider"}),function(){const e=D&&!n&&Y||!D,t=L?(0,i.Y)(c.l,{children:(0,l.t)("See table schema")}):(0,i.Y)(c.l,{children:(0,l.t)("Table")});return a=(0,i.Y)(s.A,{ariaLabel:(0,l.t)("Select table or type to search tables"),disabled:e,filterOption:M,header:t,labelInValue:!0,loading:z,name:"select-table",onChange:e=>{return t=e,void(D?null==T||T(Array.isArray(t)?t.map(e=>null==e?void 0:e.value):null==t?void 0:t.value,w,D):F(t));var t},options:O,placeholder:(0,l.t)("Select table or type to search tables"),showSearch:!0,mode:A,value:E,allowClear:"multiple"===A,allowSelectAll:!1}),r=!Y&&(0,i.Y)(u.A,{onClick:()=>B(),tooltipContent:(0,l.t)("Force refresh table list")}),(0,i.FD)("div",{className:"section",children:[(0,i.Y)("span",{className:"select",children:a}),(0,i.Y)("span",{className:"refresh",children:r})]});var a,r}()]})},Y=e=>(0,i.Y)(S,{tableSelectMode:"multiple",...e}),x=S}}]);